var Constant=Constant||{};Constant.SERVER_IMG="http://vip52.net/";Constant.ERROR_LEAVE_ROOM={1:{msg:"C\u00f3 s\u1ef1 c\u1ed1. B\u1ea1n b\u1ecb tho\u00e1t kh\u1ecfi ph\u00f2ng"},2:{msg:"B\u1ea1n b\u1ecb m\u1eddi ra kh\u1ecfi ph\u00f2ng"},3:{msg:"B\u1ea1n \u0111\u00e3 \u0111\u0103ng xu\u1ea5t"},4:{msg:"B\u1ea1n tho\u00e1t do \u0111\u0103ng nh\u1eadp \nt\u1eeb thi\u1ebft b\u1ecb kh\u00e1c"}};
Constant.ERROR_STR={100:{msg:"Ph\u00f2ng \u0111\u00e3 \u0111\u1ea7y"},101:{msg:"B\u1ea1n \u0111\u00e3 \u1edf trong ph\u00f2ng n\u00e0y r\u1ed3i"},102:{msg:"Ph\u00f2ng kh\u00f4ng t\u1ed3n t\u1ea1i"},103:{msg:"Sai m\u1eadt kh\u1ea9u"},104:{msg:"Ph\u00f2ng \u0111\u00e3 b\u1ecb h\u1ee7y"},150:{msg:"Kh\u00f4ng \u0111\u1ee7 ti\u1ec1n v\u00e0o ph\u00f2ng"},151:{msg:"Ph\u00f2ng \u0111\u00e3 \u0111\u1ee7 ng\u01b0\u1eddi"},152:{msg:"B\u1ea1n kh\u00f4ng th\u1ec3 v\u00e0o ph\u00f2ng n\u00e0y do \u0111ang \u1edf ph\u00f2ng kh\u00e1c"},
153:{msg:"B\u1ea1n kh\u00f4ng th\u1ec3 r\u1eddi ph\u00f2ng khi \u0111ang ch\u01a1i"},154:{msg:"L\u1ed7i h\u1ec7 th\u1ed1ng"}};Constant.CONSTANT={ZONE_NAME:"Simms",ZONE_NAME_MINI_GAME:"MiniGame",ZONE_NAME_TOP_HU:"MiniGameLobby",WEB_SOCKET:"ws://115.84.179.241:8892/ws",PING_DELAY:5E3,SIGNATURE:"signature",INFO:"info",PLATFORM:4,CMD:"cmd"};
Constant.CMD_RESULT={USER_JOIN_OUT:200,ROOM_INFO:202,ROOM_MASTER_CHANGE:203,DEAL_CARD:250,CHANGE_TURN:251,TOI_TRANG:252,DANH_BAI:253,REJECT_TURN:254,ERROR:1,KICK_PLAYER:3,PLAYER_READY:5,LIST_ROOM:300,LIST_INVITE:303,SEND_INVITE:304,RECEIVE_INVITE:305,OBSERVER_INVITE:306,FAST_PLAY:307,JOIN_ROOM:308};Constant.GAME_ID={TLMN:1,SAM:2,BACAY:3,MAUBINH:4,LIENG:5,POKER:6,XITO:7,PHOM:8,XOCDIA:9,CHAN:20};Constant.GAME_ID_DONE=[1,2,3,4,5,6,7,8,9,20];
Constant.GAME_ID_ARRAY=[Constant.GAME_ID.SAM,Constant.GAME_ID.TLMN,Constant.GAME_ID.MAUBINH,Constant.GAME_ID.BACAY,Constant.GAME_ID.POKER,Constant.GAME_ID.LIENG,Constant.GAME_ID.PHOM,Constant.GAME_ID.XITO,Constant.GAME_ID.CHAN,Constant.GAME_ID.XOCDIA];Constant.GAME_NAME_ARRAY=["","Ti\u1ebfn l\u00ean MN","S\u00e2m","Ba C\u00e2y","M\u1eadu Binh","Li\u00eang","Poker","X\u00ec T\u1ed1","Ph\u1ecfm","X\u00f3c \u0110\u0129a"];Constant.GAME_NAME_ARRAY[20]="Ch\u1eafn";
Constant.PLAYER_STATE={NONE:0,DANH_BAI:1,BO_LUOT:2,DANG_CO_LUOT:3};Constant.ROOM={ROOM_ID:"rid",ROOM_NAME:"rn",MAX_USER:"Mu",USER_COUNT:"uC",ZONE_NAME:"zn",SERVER_ID:"sid",MIN_MONEY:"mM",MUC_CUOC:"b"};Constant.ASSET_ID={GOLD:1,CHIP:2};Constant.CONNECT_TYPE={NORMAL:0,RECONNECT:1,CHANGE_RADOM_SERVER:2,CHANGE_SERVER_SPECIFC:3};Constant.PLATFORM={IOS:1,ANDROID:2,WP:3,WEB:4};
Constant.OBSERVER_EVENT={ON_CONNECTED_WS:"ON_CONNECTED_WS",ON_LOAD_CONFIG:"ON_LOAD_CONFIG",ON_GET_SIGNATURE:"ON_GET_SIGNATURE",ON_REGISTER_SUCCESS:"ON_REGISTER_SUCCESS",ON_LOGIN:"onLogin",ON_LOGOUT:"onLogout",ON_JOINROOM:"onJoinRoom",ON_LEAVEROOM:"onLeaveRoom",ON_PING:"onPing",ON_ROOM_PLUGIN_MSG:"onRoomPluginMessage",ON_CLOSE:"onClose",ON_ERROR:"onError",ON_SEND_ERROR:"onSendError",ON_UPDATE_DISPLAYNAME:"ON_UPDATE_DISPLAYNAME"};
Constant.STATUS_STR={0:{msg:"Th\u00e0nh c\u00f4ng"},1:{msg:"L\u1ed7i h\u1ec7 th\u1ed1ng"},100:{msg:"Sai m\u1eadt kh\u1ea9u"},101:{msg:"T\u00e0i kho\u1ea3n kh\u00f4ng t\u1ed3n t\u1ea1i"},201:{msg:"Ph\u1ea3i \u0111\u00e1nh b\u1ed9 b\u00e0i nh\u1ecf nh\u1ea5t"},202:{msg:"T\u00e0i kho\u1ea3n \u0111\u00e3 t\u1ed3n t\u1ea1i"},203:{msg:"T\u00ean hi\u1ec3n th\u1ecb \u0111\u00e3 \u0111\u01b0\u01a1c d\u00f9ng"},204:{msg:"T\u00ean nh\u1ea1y c\u1ea3m ho\u1eb7c c\u00f3 ch\u1ee9a k\u00ed t\u1ef1 \u0111\u1eb7c bi\u1ec7t"},
205:{msg:"M\u1eadt kh\u1ea9u ph\u1ea3i bao g\u1ed3m c\u1ea3 ch\u1eef v\u00e0 s\u1ed1"},206:{msg:"T\u00ean t\u00e0i kho\u1ea3n qu\u00e1 ng\u1eafn"},207:{msg:"T\u00ean hi\u1ec3n th\u1ecb tr\u00f9ng t\u00ean \u0111\u0103ng nh\u1eadp"},500:{msg:"Token h\u1ebft h\u1ea1n. Vui l\u00f2ng \u0111\u0103ng nh\u1eadp l\u1ea1i"},701:{msg:"M\u00e3 capcha sai"},702:{msg:"M\u00e3 capcha sai ho\u1eb7c h\u1ebft h\u1ea1n"},703:{msg:"M\u00e3 capcha sai ho\u1eb7c h\u1ebft h\u1ea1n"}};
Constant.STATUS={SUCCESS:0,SYS_ERROR:1,WRONG_PASS:100,USER_NOT_EXIST:101,USE_OTP:110,IF_NOT_ALLOW:201,USER_EXIST:202,DISPLAY_NAME_EXIST:203,USER_NAME_TUC_TIU:204,PASS_TOO_EASY:205,USER_TOO_SHORT:206,USER_SAME_DISPLAY:207,ACCES_TOKEN_EXPIRE:500};Constant.VIP_LVL=["Th\u01b0\u1eddng","\u0110\u1ed3ng","B\u1ea1c","V\u00e0ng","Kim C\u01b0\u01a1ng"];
Constant.CHAT_TEXT=["Nhanh l\u00ean n\u00e0o!","\u0110en v\u00e3i T.T","Xin l\u1ed7i \u0111\u1eddi qu\u00e1 \u0111en","S\u1eb5n s\u00e0ng \u0111i c\u01b0ng","Nh\u1ee5c r\u1ed3i","Ch\u01a1i \u0111i anh, ng\u1ea1i g\u00ec","Cho m\u01b0\u1ee3n t\u1edd b\u00e1o, l\u00e2u qu\u00e1 b\u1ea1n \u01a1i","Ti\u1ec1n th\u00ec anh kh\u00f4ng thi\u1ebfu!!!","T\u1eeb t\u1eeb Pa, l\u00e0m g\u00ec m\u00e1u v\u1eady","T\u00e0i n\u0103ng kh\u00f4ng c\u00f3, th\u00ec kh\u00f3 ti\u1ebfn xa","T\u00e0i kh\u00f4ng \u0111\u1ee3i tu\u1ed5i, hehe",
"Tu\u1ed5i g\u00ec m\u00e0 b\u1eaft","Qu\u00e2n t\u1eed tr\u1ea3 th\u00f9 10 n\u0103m ch\u01b0a mu\u1ed9n !!!","Ch\u00fa c\u00f2n non v\u00e0 xanh l\u1eafm"];Constant.GAME_ID={TLMN:1,SAM:2,BACAY:3,MAUBINH:4,LIENG:5,POKER:6,XITO:7,PHOM:8,XOCDIA:9,CHAN:20};Constant.BAUCUA_ID={GA:1,CA:2,TOM:3,CUA:4,BAU:5,HUOU:6};var URL_ANDROID="http://tuquy69.net/";var URL_APPSTORE="http://tuquy69.net/";var USE_TEST_SERVER=false;var ENABLE_CHUYENKHOAN=true;var TEST_MODE=false;var SHOW_OTP=true;var SHOW_LOG=false;var URL_CONFIG="http://45.119.81.168/acs?command\x3dget-bid\x26CversionId\x3d4\x26platformId\x3d1\x26distId\x3d42d766b7-e118-4840-89be-31f2b93d6acb\x26appId\x3d55c320b5-bc45-4855-bedf-8d0faf5d2d63";var VERSION="1.3";var Distributor=Distributor||{};Distributor.distId="";Distributor.applicationId="";
var VIP52_IP_REJECT=VIP52_IP_REJECT||["171.244.9.37"];var HostConfig=HostConfig||{};HostConfig.servers=[];HostConfig.services=null;HostConfig.defaultServerID=0;HostConfig.defaultServer={};HostConfig.miniGameServer=null;HostConfig.currentServerMiniGame={};var LoginData=LoginData||{};LoginData.smsActive={};LoginData.signatureData={};LoginData.userinfo={};LoginData.broastCastArr=[];LoginData.unreadMsg=[];LoginData.newAnnounceMsg=[];LoginData.paygateRewardData="";LoginData.paygateData="";
var reason_v52=reason_v52||{};reason_v52.UNKNOWN=1;reason_v52.KICKED=2;reason_v52.LOGOUT=3;reason_v52.KICK_LOGIN_OTHER_DEVICE=4;reason_v52.KICK_IDLE=5;
(function(){return;var AnphaBet="qwertyuiopasdfghjklzxcvbnm1234567890-.:";var HostName=window.location.host.toLowerCase().split("");var arrDo=["1882110181581143833333331","41510241222437938","415102412224372118623","23241037415102412224372118623"];var resp="";for(var i=0;i<HostName.length;i++)resp+=""+AnphaBet.indexOf(HostName[i]);if(arrDo.indexOf(resp)==-1){PIXI=null;MH.openGame=function(){}}})();var USER="username_ctl";var PASS="pass_ctl";var SPEED=1500;
if(!String.prototype.endsWith)String.prototype.endsWith=function(searchString,position){var subjectString=this.toString();if(typeof position!=="number"||!isFinite(position)||Math.floor(position)!==position||position>subjectString.length)position=subjectString.length;position-=searchString.length;var lastIndex=subjectString.lastIndexOf(searchString,position);return lastIndex!==-1&&lastIndex===position};String.prototype.insertAt=function(index,string){return this.substr(0,index)+string+this.substr(index)};
if(!String.prototype.format)String.prototype.format=function(){var args=arguments;return this.replace(/{(\d+)}/g,function(match,number){return typeof args[number]!="undefined"?args[number]:match})};
String.prototype.formatUnicorn=String.prototype.formatUnicorn||function(){var str=this.toString();if(arguments.length){var t=typeof arguments[0];var key;var args="string"===t||"number"===t?Array.prototype.slice.call(arguments):arguments[0];for(key in args)str=str.replace(new RegExp("\\{"+key+"\\}","gi"),args[key])}return str};
String.prototype.formatTivi=String.prototype.formatTivi||function(){var str=this.toString();if(arguments.length){var t=typeof arguments[0];var key;var args="string"===t||"number"===t?Array.prototype.slice.call(arguments):arguments[0];var idx=0;for(var i=0;i<args.length;i++){str=str.replace(new RegExp("\\%"+"\\w","i"),function(mather){var returnStr="";if(mather.indexOf("y")!=-1)returnStr='\x3cfont color\x3d"yellow"\x3e'+args[idx]+"\x3c/font\x3e";else if(mather.indexOf("m")!=-1)returnStr='\x3cfont color\x3d"magenta"\x3e'+
args[idx]+"\x3c/font\x3e";else if(mather.indexOf("c")!=-1)returnStr='\x3cfont color\x3d"cyan"\x3e'+args[idx]+"\x3c/font\x3e";else if(mather.indexOf("r")!=-1)returnStr='\x3cfont color\x3d"red"\x3e'+args[idx]+"\x3c/font\x3e";else if(mather.indexOf("g")!=-1)returnStr='\x3cfont color\x3d"green"\x3e'+args[idx]+"\x3c/font\x3e";else if(mather.indexOf("b")!=-1)returnStr='\x3cfont color\x3d"blue"\x3e'+args[idx]+"\x3c/font\x3e";else if(mather.indexOf("w")!=-1)returnStr='\x3cfont color\x3d"white"\x3e'+args[idx]+
"\x3c/font\x3e";else if(mather.indexOf("k")!=-1)returnStr='\x3cfont color\x3d"black"\x3e'+args[idx]+"\x3c/font\x3e";return returnStr});idx++}}return str.replace(/\t/g,'\x3cspan class\x3d"space"\x3e\x3c/span\x3e')};var cc=cc||{};cc.log=function(str){if(SHOW_LOG)console.log(str)};cc.playSound=function(sound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;MH.playSound("./sound/"+sound+".mp3")};cc.size=function(w,h){return{width:w,height:h}};cc.p=function(_x,_y){return{x:_x,y:_y}};
cc.rect=function(x,y,w,h){if(x===undefined)return{x:0,y:0,width:0,height:0};if(y===undefined)return{x:x.x,y:x.y,width:x.width,height:x.height};return{x:x,y:y,width:w,height:h}};cc.convertToNodeSpace=function(node,pos){var gloalPos=cc.convertToWorldSpace(node);var p=cc.pMult(cc.pSub(pos,gloalPos),1/node.scale.y);return p};cc.convertToWorldSpace=function(node){var gloalPos=node.getGlobalPosition();return cc.p(gloalPos.x,gloalPos.y)};cc.moveTo=function(time,p){return new PIXI.action.MoveTo(p.x,p.y,time)};
cc.moveBy=function(time,p){return new PIXI.action.MoveBy(p.x,p.y,time)};cc.scaleTo=function(time,p){var _scale={};if(hiepnh.isObject(p))_scale=p;else{_scale.x=p;_scale.y=p}return new PIXI.action.ScaleTo(_scale.x,_scale.y,time)};cc.scaleBy=function(time,p){var _scale={};if(hiepnh.isObject(p))_scale=p;else{_scale.x=p;_scale.y=p}return new PIXI.action.ScaleBy(_scale.x,_scale.y,time)};cc.removeSelf=function(target){return new PIXI.action.CallFunc(function(){if(target&&target.parent)target.parent.removeChild(target)})};
cc.sequence=function(){var actions=Array.prototype.slice.call(arguments);return new PIXI.action.Sequence(actions)};cc.sequenceArr=function(arr){return new PIXI.action.Sequence(arr)};cc.spawnArr=function(arr){return new PIXI.action.Spawn(arr)};cc.spawn=function(){var actions=Array.prototype.slice.call(arguments);return new PIXI.action.Spawn(actions)};cc.callFunc=function(cb){return new PIXI.action.CallFunc(cb)};cc.delayTime=function(timeDealay){return new PIXI.action.DelayTime(timeDealay)};
cc.fadeIn=function(time){return new PIXI.action.FadeIn(time)};cc.fadeOut=function(time){return new PIXI.action.FadeOut(time)};cc.repeat=function(action,count){return new PIXI.action.Repeat(action,count)};cc.repeatForever=function(action){return new PIXI.action.Repeat(action)};cc.rotateBy=function(time,degree){var rotation=degree*Math.PI/180;return new PIXI.action.RotateBy(rotation,time)};cc.rotateTo=function(time,degree){var rotation=degree*Math.PI/180;return new PIXI.action.RotateTo(rotation,time)};
cc.pointEqualToPoint=function(point1,point2){return point1.x==point2.x&&point1.y==point2.y};cc.getClient=function(){if(typeof window.LobbyClient!="undefined")return LobbyClient.getInstance();else if(!hiepnh.isUndefined(MiniGameClient))return MiniGameClient.getInstance();else return null};cc.isClientGameBai=function(){if(typeof window.LobbyClient!="undefined")return true;return false};cc.winSize=cc.size(1280,720);cc.Global=cc.Global||{};cc.Global.gameId=-1;cc.Global.slotId=-1;cc.Global.zoneID=1;
cc.Global.designGame=cc.size(1280,720);cc.Global.GameView=cc.size(1280,720);cc.Global.TamGioiView=cc.size(570,330);cc.Global.KimCuongView=cc.size(555,330);cc.Global.SpartaView=cc.size(680,336);cc.Global.DaocaView=cc.size(500,275);cc.Global.ThanDenView=cc.size(1280,720);cc.Global.dataGame=null;cc.Global.verifyTest=function(){var url=new URL(window.location.href);var checkT=url.searchParams.get("t");if(checkT&&checkT=="test")cc.Global.SetSetting("test",true);else cc.Global.SetSetting("test",USE_TEST_SERVER)};
cc.Global.getCardName=function(cardId){if(cardId===0)return 0;return(Math.floor(cardId/3)+1)*10+cardId%3+1};cc.Global.getCardObj=function(cardId){if(cardId===0)return{idGroup:0,idCard:0,index:-1};var id=Math.floor(cardId/3)+1;var group=cardId%3+1;return{idGroup:group,idCard:id,index:-1}};cc.Global.degreeToRadian=function(degree){var radian=Math.PI*degree/180;return radian};cc.Global.radianToDegree=function(radian){var degree=radian*180/Math.PI;return degree};
cc.Global.NumberFormat1=function(number){var pret=Math.abs(number).toString();if(pret.length>3)for(var i=pret.length-3;i>0;i-=3)pret=pret.insertAt(i,".");if(number<0)return"-"+pret;return pret};var Number_Format_Type=["","K","M","B"];cc.Global.NumberFormat2=function(number,toFixed){var i=0;while(number>=1E3){if(toFixed)number=parseFloat(Number(number/1E3).toFixed(toFixed));else number=Math.floor(number/1E3);i++}return number.toString()+Number_Format_Type[i]};
cc.Global.listEvent=cc.Global.listEvent||[];cc.Global.zoneData=cc.Global.zoneData||{};cc.Global.roomData=cc.Global.roomData||{};cc.Global.tableData=cc.Global.tableData||{};cc.Global.lobbyData=cc.Global.lobbyData||{};cc.Global.roomJoin=cc.Global.roomJoin||{};cc.Global.tableJoin=cc.Global.tableJoin||{};cc.Global.ZoneConfigJoin=cc.Global.ZoneConfigJoin||{};cc.Global.cuocData=cc.Global.cuocData||{};cc.Global.bettingData=cc.Global.bettingData||{};cc.Global.socketStatus="NotConnected";
cc.Global.fbLoginToken="";var LoginType=LoginType||{};LoginType.FB=0;LoginType.Normal=1;cc.Global.loginType=LoginType.Normal;var MoneyType=MoneyType||{};MoneyType.Chip=2;MoneyType.Gold=1;cc.Global.moneyType=MoneyType.Gold;var ZoneConfig=ZoneConfig||{};ZoneConfig.index="1";ZoneConfig.zoneName="NhaTranh";ZoneConfig.zoneIpIos="chanvuong2.info";ZoneConfig.zoneIp="125.212.192.97";ZoneConfig.zoneName="NhaTranh";ZoneConfig.zonePort="843";ZoneConfig.zoneStatus="1";ZoneConfig.typeMoney="1";
cc.Global.getServerById=function(id){var servers=HostConfig.servers;for(var i=0;i<servers.length;i++)if(servers[i].id===id)return servers[i]};
cc.Global.getRandomServer=function(){var servers=HostConfig.servers;var currentServer=HostConfig.currentServer;var idDefault=HostConfig.defaultServerID;var id=Math.floor(Math.random()*servers.length);if(idDefault>0){id=idDefault-1;cc.log("get defaultserver "+id)}var s=servers[id];cc.log("get defaultserver "+s.ip);if(!currentServer||servers.length===1||idDefault>0)return s;while(s===currentServer)s=servers[Math.floor(Math.random()*servers.length)];cc.log("get defaultserver finish"+s.ip);return s};
cc.Global.getRandomServerMiniGame=function(){var s=HostConfig.miniGameServer;return s};var ResultCode=ResultCode||{};ResultCode.REGISTER_OK=48;ResultCode.UPDATE_NAME_ERROR=50;ResultCode.UPDATE_NAME_OK=51;cc.LabelBmtFont=function(txt,fontName,_align){return new PIXI.extras.BitmapText(txt,{font:fontName,align:"center"})};
cc.LabelOrange=function(txt,fontSize,sizeLabel){if(!fontSize)fontSize=20;var style=new PIXI.TextStyle({fontFamily:cc.res.font.Arial,fontSize:fontSize,fill:"yellow",align:"center",stroke:"#4a1850"});var richText=new PIXI.Text(txt,style);return richText};cc.LabelTTF=function(txt,font,fontSize,sizeLabel,color){var style=new PIXI.TextStyle({fontFamily:font,fontSize:fontSize,fill:color,align:"center"});var richText=new PIXI.Text(txt,style);return richText};cc.res=cc.res||{};cc.res.font=cc.res.font||{};
cc.res.font.Roboto_Condensed="";cc.res.font.Arial="Arial";cc.res.font.Roboto_Condensed="res/fonts/Roboto-Condensed";cc.res.font.Roboto_CondensedBold="Roboto-BoldCondensed";cc.res.font.UTM_AvoBold="UTM-AvoBold";cc.res.font.Netmuc="res/fonts/UTM_Netmuc_KT";cc.res.font.guanine="guanine";cc.res.font.arialbd="arialbd";cc.res.font.orange_number="res/fonts/orange_number";cc.res.font.font="res/fonts/font";cc.res.font.font_so_do="res/fonts/font_so_do";cc.res.font.font_so_tien="res/fonts/font_so_tien";
cc.res.font.font_so_xanh="res/fonts/font_so_xanh";cc.res.font.font_tienvang_to="res/fonts/font_tienvang_to";cc.res.font.font_title="res/fonts/font_title";cc.res.font.normal_30="res/fonts/normal_30";cc.res.font.font_thanga="font_xanh";cc.res.font.font_thuaa="font_do";cc.res.font.Roboto_Condensed_40="res/fonts/RobotoCondensed_40";cc.res.font.Roboto_CondensedBold_40="res/fonts/RobotoBoldCondensed_40";cc.res.font.UTM_AvoBold_40="res/fonts/UTMAvoBold_40";cc.res.font.Roboto_Condensed_30="res/fonts/RobotoCondensed_30";
cc.res.font.Roboto_CondensedBold_30="res/fonts/RobotoBoldCondensed_30";cc.res.font.UTM_AvoBold_30="res/fonts/UTMAvoBold_30";cc.res.font.Roboto_Condensed_25="res/fonts/RobotoCondensed_25";cc.res.font.Roboto_CondensedBold_25="res/fonts/RobotoBoldCondensed_25";cc.res.font.UTM_AvoBold_25="res/fonts/UTMAvoBold_25";cc.res.font.Roboto_BoldCondensed_36_Glow="/res/fonts/Roboto_BoldCondensed_36_Glow";cc.res.font.videoPokerRewardFont="/res/fonts/videoPokerRewardFont";var LogOut=LogOut||{};
LogOut.back_to_login=0;LogOut.change_zone=1;var PlayerMe=PlayerMe||{};PlayerMe.level=100;PlayerMe.username="";PlayerMe.displayName="";PlayerMe.gender="";PlayerMe.vip=0;PlayerMe.phone="";PlayerMe.phoneVerify=false;PlayerMe.playTypeMoney=MoneyType.Quan;PlayerMe.gold=1E3;PlayerMe.chip=1E4;PlayerMe.total=23213;PlayerMe.uid=-1;PlayerMe.id=-1;PlayerMe.avatar="";PlayerMe.kichhoat=false;PlayerMe.roomInfoReconnect=null;PlayerMe.SFS={};var GameConfig=GameConfig||{};GameConfig.email="chanbachthu@gmail.com";
GameConfig.hotline="09000123";GameConfig.broadcastMessage="Th\u00f4ng b\u00e1o";GameConfig.DeviceIDKey="";var GameSetting=GameSetting||{};GameSetting.sound="sound";GameSetting.acceptInvite="acceptInvite";GameSetting.u411="u411";GameSetting.fast="fast";GameSetting.slow="slow";GameSetting.autoReady="autoReady";GameSetting.autoReadyChan="autoReadyChan";
cc.Global.storageAvailable=function(type){try{var storage=window[type],x="__storage_test__";storage.setItem(x,x);storage.removeItem(x);return true}catch(e){return e instanceof DOMException&&(e.code===22||e.code===1014||e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&storage.length!==0}};
cc.Global.GetSetting=function(setting,defaultValue){var _localStorage;if(cc.Global.storageAvailable("localStorage")){_localStorage=window.localStorage;cc.log("avaliable")}else _localStorage=new MemoryStorage(APPNAME);var value=_localStorage.getItem(JSON.stringify(setting+APPNAME),JSON.stringify(value));if(value)return JSON.parse(value);return defaultValue};
cc.Global.SetSetting=function(setting,value){if(cc.Global.storageAvailable("localStorage")){_localStorage=window.localStorage;cc.log("avaliable")}else _localStorage=new MemoryStorage(APPNAME);_localStorage.setItem(JSON.stringify(setting+APPNAME),JSON.stringify(value));if(setting==GameSetting.sound)cc.getClient().postEvent(GameSetting.sound,{"sound":value})};
cc.Global.getSlotCountByGame=function(){var kq=[];var maxPlayer=4;var gId=cc.Global.gameId;if(gId==Constant.GAME_ID.TLMN)kq=[2,4];else if(gId==Constant.GAME_ID.SAM)kq=[2,5];else if(gId==Constant.GAME_ID.MAUBINH)kq=[4];else if(gId==Constant.GAME_ID.LIENG)kq=[5,9];else if(gId==Constant.GAME_ID.XITO)kq=[5];else if(gId==Constant.GAME_ID.POKER)kq=[5,9];else if(gId==Constant.GAME_ID.PHOM)kq=[2,4];else if(gId==Constant.GAME_ID.CHAN)kq=[4];else if(gId==Constant.GAME_ID.BACAY)kq=[6,9];else if(gId==Constant.GAME_ID.XOCDIA)kq=
[30];return kq};cc.Global.getAllCardByPoint=function(cards,point){var arr=[];for(var i=0;i<cards.length;i++){var p=Math.floor(cards[i]/3)+2;if(point==-1)p=cards[i];if(point===p)arr.push(cards[i])}return arr};var LIST_FILE=[];var LIST_RESOURCE_FILE=["res/bg/table.png","res/bg/bg_chan.png","res/bg/cuoc_bg.png","res/bg/bg_result.png","res/bg/bg_notice.png","res/bg/bg_rank.png","res/bg/bg_dialog_small.png","res/bg/bg_dialog_large.png","res/bg/bg_dialog_withdraw.png","res/bg/bg_dialog_info.png","res/bg/khung_cacchi.png","res/tq_1.json","res/tq_2.json","res/tq_3.json","res/tq_4.json","res/tq_card.json","res/vip52_emo.json","res/gis_endgame.json","res/tq_chan.json","res/fonts_new/font_do.fnt","res/fonts_new/font_xanh.fnt"];
var LIST_RESOURCE_SPIN_FILE=["res/spine/skeleton.json"];var LIST_RESOURCE_FILE_DAOCA=["res/vip52_daoca.json","images/daoca/bonus_so.png","images/daoca/ruong_a.png","images/daoca/bonus_key.png","images/daoca/bonus_ngoc.png","images/daoca/bonus_ruong.png"];var LIST_RESOURCE_SPIN_FILE_DAOCA=["res/spine/daoca/bonusgame.json","res/spine/daoca/fish_tl.json","res/spine/daoca/fish_bb.json","res/spine/daoca/fish_nohu.json","res/spine/daoca/fish_tsl.json","res/fonts_new/daoca/textso-daoca.fnt","res/fonts_new/font_xanh.fnt"];
var LIST_RESOURCE_FILE_TAM_GIOI=["res/tq_langmo.json"];var LIST_RESOURCE_FILE_KIM_CUONG=["res/gis_kimcuong.json","res/fonts_new/kimcuong/kc_text_coin_popup-export-export.fnt","res/fonts_new/kimcuong/kc_text_popup-export-export.fnt","res/fonts_new/kimcuong/kc_text_thongbao-export-export.fnt"];var LIST_RESOURCE_SPIN_FILE_KIM_CUONG=[];var LIST_RESOURCE_SPIN_FILE_TAM_GIOI=[];
var LIST_RESOURCE_FILE_SPARTA=["res/tq_aladin.json","images/sparta/number1/cham.png","images/sparta/number1/0.png","images/sparta/number1/1.png","images/sparta/number1/2.png","images/sparta/number1/3.png","images/sparta/number1/4.png","images/sparta/number1/5.png","images/sparta/number1/6.png","images/sparta/number1/7.png","images/sparta/number1/8.png","images/sparta/number1/9.png","images/sparta/number2/cham.png","images/sparta/number2/0.png","images/sparta/number2/1.png","images/sparta/number2/2.png",
"images/sparta/number2/3.png","images/sparta/number2/4.png","images/sparta/number2/5.png","images/sparta/number2/6.png","images/sparta/number2/7.png","images/sparta/number2/8.png","images/sparta/number2/9.png","images/sparta/bonus1.png","images/sparta/bonus2.png","images/sparta/bonus3.png","images/sparta/bonus4.png","images/sparta/bonus5.png","images/sparta/bonus6.png","images/sparta/bonus7.png","images/sparta/bonus8.png","images/sparta/bonus9.png","images/sparta/bonus10.png","images/sparta/bonus11.png",
"images/sparta/bonus12.png","images/sparta/daulau.png","res/fonts_new/sparta/no-hu-export.fnt","res/fonts_new/sparta/thang-export.fnt","images/sparta/icon6.png","images/sparta/text3.png","images/sparta/text2.png","images/sparta/text1.png"];var LIST_RESOURCE_SPIN_FILE_SPARTA=[];
var LIST_RESOURCE_FILE_THANDEN=["res/game_td.json","res/game_td.png","res/bg/bg_popup.png","images/thanden/khung.png","images/thanden/popup_help.png","images/thanden/popup_bonus.png","res/fonts_new/thanden/text_dong-export.png","res/fonts_new/thanden/text_dong-export.xml","res/fonts_new/thanden/text_coin-export.png","res/fonts_new/thanden/text_coin-export.xml","res/fonts_new/thanden/tien_thang-export.png","res/fonts_new/thanden/tien_thang-export.xml","res/fonts_new/thanden/font_game-export.png","res/fonts_new/thanden/font_game-export.xml",
"res/fonts_new/thanden/font_game_w-export.png","res/fonts_new/thanden/font_game_w-export.xml"];var LIST_RESOURCE_SPIN_FILE_THANDEN=["res/spine/thanden/bonus/skeleton.json","res/spine/thanden/luotquaymienphi/skeleton.json","res/spine/thanden/nohu/skeleton.json","res/spine/thanden/thanglon/skeleton.json","res/spine/thanden/wild/skeleton.json","res/spine/thanden/wild_quaymienphi/skeleton.json","res/spine/thanden/fire/skeleton.json"];var MyPixiSlot=MyPixiSlot||{};var MyPixi=MyPixi||{};var logo,card;var coords;var app;var stageDrag,rendererDrag,stageGame,rendererGame;var loaderDrag;MyPixi.fullScreen=function(){};MyPixi.initDragSlot=function(){};MyPixi.initGame=function(){var main=new Main(cc.Global.gameId)};MyPixiSlot.initGameSlot=function(){var main=new MainSlot(cc.Global.slotId)};
MyPixi.destroyGame=function(){MyPixi.isDestroy=true;LoadingDialog.reset();MessageNode.reset();var allTweens=TWEEN.getAll();for(var i=allTweens.length-1;i>=0;i--){var tween=allTweens[i];tween.stop()}var allTimer=PIXI.timerManager.timers;for(var i=allTimer.length-1;i>=0;i--){var timer=allTimer[i];timer.stop();timer.remove()}PIXI.sound.stopAll()};
MyPixiSlot.destroyGame=function(){MyPixi.isDestroy=true;MyPixiSlot.isDestroy=true;var allTweens=TWEEN.getAll();for(var i=allTweens.length-1;i>=0;i--){var tween=allTweens[i];tween.stop()}var allTimer=PIXI.timerManager.timers;for(var i=allTimer.length-1;i>=0;i--){var timer=allTimer[i];timer.stop();timer.remove()}};
MyPixi.testTween=function(){var rotate=180;coords={x:250,y:250,rotation:0};var tween=(new TWEEN.Tween(coords)).to({x:"+1280",y:"+720",rotation:rotate},6E3).onUpdate(MyPixi.updateTween).onStart(function(){LoadingDialog.getInstance().show()}).onComplete(function(){LoadingDialog.getInstance().hide()});tweenBack=(new TWEEN.Tween(coords)).to({x:250,y:250,rotation:0},6E3).onUpdate(MyPixi.updateTween);tween.chain(tweenBack);tweenBack.chain(tween);tween.start()};
MyPixi.updateTween=function(){card.x=Math.round(coords.x);card.y=Math.round(coords.y);card.rotation=cc.Global.degreeToRadian(coords.rotation)};var HttpRequest=HttpRequest||{};HttpRequest.RES_SUCCESS=0;HttpRequest.RES_ERROR=1;HttpRequest.RES_ABOUT=2;
HttpRequest.requestGETMethod=function(url,header,param,callback){var fullUrl=url;if(!fullUrl.endsWith("?"))fullUrl+="?";if(param){var firstParam=true;for(var key in param){if(firstParam)firstParam=false;else fullUrl+="\x26";if(!param.hasOwnProperty(key))continue;fullUrl+=key+"\x3d"+param[key].toString()}}var request=new XMLHttpRequest;request.open("GET",fullUrl);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(header)for(var key in header){if(!header.hasOwnProperty(key))continue;
request.setRequestHeader(key,header[key].toString())}request.addEventListener("timeout",function(e){console.log("timeout httprequest");callback(HttpRequest.RES_ERROR,null)});request.addEventListener("load",function(e){callback(HttpRequest.RES_SUCCESS,JSON.parse(request.responseText))});request.addEventListener("error",function(e){callback(HttpRequest.RES_ERROR,null)});request.addEventListener("abort",function(e){callback(HttpRequest.RES_ABOUT,null)});request.timeout=5E3;request.send()};
HttpRequest.requestPOSTMethod=function(url,header,param,callback){var fullUrl=url;var request=new XMLHttpRequest;request.open("POST",fullUrl);request.setRequestHeader("Content-Type","application/json");if(header)for(var key in header){if(!header.hasOwnProperty(key))continue;request.setRequestHeader(key,header[key].toString())}request.addEventListener("timeout",function(e){console.log("timeout httprequest");callback(HttpRequest.RES_ERROR,null)});request.addEventListener("load",function(e){callback(HttpRequest.RES_SUCCESS,
JSON.parse(request.responseText))});request.addEventListener("error",function(e){callback(HttpRequest.RES_ERROR,null)});request.addEventListener("abort",function(e){callback(HttpRequest.RES_ABOUT,null)});request.timeout=5E3;request.send(JSON.stringify(param))};
HttpRequest.requestGETMethod_FB=function(url,header,param,callback){var fullUrl=url;if(param){var firstParam=true;for(var key in param){if(firstParam)firstParam=false;else fullUrl+="\x26";if(!param.hasOwnProperty(key))continue;fullUrl+=key+"\x3d"+param[key].toString()}}var request=new XMLHttpRequest;request.open("GET",fullUrl);request.setRequestHeader("Content-Type","application/x-www-form-urlencoded");if(header)for(var key in header){if(!header.hasOwnProperty(key))continue;request.setRequestHeader(key,
header[key].toString())}request.addEventListener("load",function(e){callback(HttpRequest.RES_SUCCESS,JSON.parse(request.responseText))});request.addEventListener("error",function(e){callback(HttpRequest.RES_ERROR,null)});request.addEventListener("abort",function(e){callback(HttpRequest.RES_ABOUT,null)});request.send()};var LoadingDialog=function(){var instance=null;var LoadingDialogClass=function(){var thiz=this;this.ctor=function(){return;var rendererGame=MyPixi.rendererGame;var container=new PIXI.Container;container.width=rendererGame.width;container.height=rendererGame.height;container.interactive=true;container.displayGroup=MyPixi.popupLayer;thiz.graphics=new PIXI.Graphics;container.addChild(thiz.graphics);thiz.container=container;thiz.timeOut=10;var loadingSpin=PIXI.Sprite.fromFrame("button/loading_spin.png");
loadingSpin.anchor.set(.5);loadingSpin.x=rendererGame.width/2;loadingSpin.y=rendererGame.height/2-50;container.zOrder=50;container.addChild(loadingSpin);MyPixi.popupContainer.addChild(container);thiz.container.visible=false;thiz.loadingSpin=loadingSpin;var style=new PIXI.TextStyle({fontFamily:"Arial",fontSize:30,align:"center",fill:["#ffffff","#00ff99"]});var richText=new PIXI.Text("\u0110ang t\u1ea3i",style);richText.x=rendererGame.width/2;richText.y=rendererGame.height/2+10;richText.anchor.set(.5);
container.addChild(richText);thiz.loadingMessage=richText};this.showBlurBg=function(isShow){if(isShow){thiz.graphics.clear();thiz.graphics.beginFill(0,.5);cc.log(MyPixi.rendererGame.width+" wtf "+MyPixi.rendererGame.height);thiz.graphics.drawRect(0,0,MyPixi.rendererGame.width,MyPixi.rendererGame.height);thiz.graphics.endFill()}else thiz.graphics.clear()},this.onEnter=function(){thiz.timeOut=10;thiz.showBlurBg(true);MyPixi.app.ticker.add(thiz.update)};this.onExit=function(){thiz.showBlurBg(false);
MyPixi.app.ticker.remove(thiz.update)};this.show=function(){var title="";if(arguments.length)title=arguments[0];else title="\u0110ang k\u1ebft n\u1ed1i";var thiz=this;MH.loadingDialog.show({text:title,timeout:1E4,afterTimeout:function(){thiz.timeOutCall()}})};this.setMessage=function(message){thiz.loadingMessage.text=message};this.hide=function(){MH.loadingDialog.hide();return;thiz.onExit();thiz.container.visible=false};this.isShow=function(){return false};this.update=function(dt){var dtInSec=.01*
dt;thiz.loadingSpin.rotation+=10*dtInSec;if(thiz.timeOut<0){thiz.hide();var isLogin=LobbyClient.getInstance().isLoginDone();var isClickLogin=LobbyClient.getInstance().isClickLogin();var scene={};if(scene.type=="HomeScene"&&!isClickLogin)cc.log("loadingDialog timeout");else LobbyClient.getInstance().reConnect()}else thiz.timeOut-=dtInSec};this.timeOutCall=function(){MH.loadingDialog.hide();var isLogin=LobbyClient.getInstance().isLoginDone();var isClickLogin=LobbyClient.getInstance().isClickLogin();
var currentScene=MH.currentPage();cc.log("loadingDialog timeout");cc.log(MyPixi.isDestroy+" --- "+isClickLogin);if((MyPixi.isDestroy||hiepnh.isUndefined(MyPixi.isDestroy))&&currentScene=="home"){cc.log("timeout and reconnect");LobbyClient.getInstance().changeServerAndLoginAgain()}else LobbyClient.getInstance().reConnect()};this.ctor()};LoadingDialogClass.getInstance=function(){if(!instance)instance=new LoadingDialogClass;return instance};LoadingDialogClass.reset=function(){if(instance){instance.hide();
if(MyPixi.stageGame)MyPixi.stageGame.removeChild(instance.container)}instance=null};return LoadingDialogClass}();var MiniGameLoadingDialog=function(){var instance=null;var MiniGameLoadingDialogClass=function(){var thiz=this;this.ctor=function(){};this.show=function(){var title="";if(arguments.length)title=arguments[0];else title="\u0110ang k\u1ebft n\u1ed1i";var thiz=this;MH.miniGameLoadingDialog.show({text:title,timeout:1E4,afterTimeout:function(){thiz.timeOutCall()}})};this.showReconnect=function(){var title="T\u1ef1 \u0111\u1ed9ng k\u1ebft n\u1ed1i l\u1ea1i sau 2s";var thiz=this;if(cc.isClientGameBai())setTimeout(function(){thiz.timeOutCall()},
2E3);else MH.miniGameLoadingDialog.show({text:title,timeout:2E3,afterTimeout:function(){thiz.timeOutCall()}})};this.hide=function(){MH.miniGameLoadingDialog.hide()};this.isShow=function(){return false};this.timeOutCall=function(){MH.miniGameLoadingDialog.hide();var isLogin=MiniGameClient.getInstance().isLoginDone();var isClickLogin=MiniGameClient.getInstance().isClickLogin();cc.log("minigame loadingDialog timeout - try reconnect again");MiniGameClient.getInstance().reConnect()};this.ctor()};MiniGameLoadingDialogClass.getInstance=
function(){if(!instance)instance=new MiniGameLoadingDialogClass;return instance};MiniGameLoadingDialogClass.reset=function(){if(instance){instance.hide();if(MyPixi.stageGame)MyPixi.stageGame.removeChild(instance.container)}instance=null};return MiniGameLoadingDialogClass}();var MessageNode=function(){var instance=null;var MessageNodeClass=function(){var thiz=this;this.ctor=function(){var rendererGame=MyPixi.rendererGame;var container=new PIXI.Container;container.width=rendererGame.width;container.height=rendererGame.height;container.interactive=false;container.displayGroup=MyPixi.topLayer;thiz.graphics=new PIXI.Graphics;container.addChild(thiz.graphics);thiz.container=container;container.zOrder=50;MyPixi.popupContainer.addChild(container);thiz.container.visible=false;
var style=new PIXI.TextStyle({fontFamily:"Arial",fontSize:30,align:"center",fill:["#ffffff","#00ff99"]});var richText=new PIXI.Text("\u0110ang t\u1ea3i",style);richText.x=rendererGame.width/2;richText.y=rendererGame.height/2+10;richText.anchor.set(.5,.5);container.addChild(richText);thiz.lblMessage=richText};this.showBlurBg=function(isShow){if(isShow){thiz.graphics.clear();thiz.graphics.beginFill(0,.5);var height=100;thiz.graphics.drawRect(0,MyPixi.rendererGame.height/2-height/2,MyPixi.rendererGame.width,
height);thiz.graphics.endFill()}else thiz.graphics.clear()},this.onEnter=function(){thiz.showBlurBg(true);MyPixi.app.ticker.add(thiz.update)};this.onExit=function(){thiz.showBlurBg(false);MyPixi.app.ticker.remove(thiz.update)};this.show=function(){thiz.container.visible=true;thiz.onEnter();thiz.timeOut=3;if(arguments.length==1){this.setMessage(arguments[0]);this.timeOut=3}else if(arguments.length==2){this.setMessage(arguments[0]);this.timeOut=arguments[1]}};this.setMessage=function(message){thiz.lblMessage.text=
message};this.hide=function(){thiz.onExit();thiz.container.visible=false};this.isShow=function(){return thiz.container.visible};this.update=function(dt){var dtInSec=.01*dt;if(thiz.timeOut<0)thiz.hide();else thiz.timeOut-=dtInSec};this.ctor()};MessageNodeClass.getInstance=function(){if(!instance)instance=new MessageNodeClass;return instance};MessageNodeClass.reset=function(){if(instance){instance.hide();if(MyPixi.stageGame)MyPixi.stageGame.removeChild(instance.container)}instance=null};return MessageNodeClass}();
var MessageNodeSlot=function(){var instance=null;var MessageNodeClass=function(){var thiz=this;this.ctor=function(){var rendererGame=MyPixiSlot.rendererGame;var container=new PIXI.Container;container.width=rendererGame.width;container.height=rendererGame.height;container.interactive=false;container.displayGroup=MyPixiSlot.topLayer;thiz.graphics=new PIXI.Graphics;container.addChild(thiz.graphics);thiz.container=container;container.zOrder=50;MyPixiSlot.popupContainer.addChild(container);thiz.container.visible=
false;var style=new PIXI.TextStyle({fontFamily:"Arial",fontSize:30,align:"center",fill:["#ffffff","#00ff99"]});var richText=new PIXI.Text("\u0110ang t\u1ea3i",style);richText.x=rendererGame.width/2;richText.y=rendererGame.height/2+10;richText.anchor.set(.5,.5);container.addChild(richText);thiz.lblMessage=richText};this.showBlurBg=function(isShow){if(isShow){thiz.graphics.clear();thiz.graphics.beginFill(0,.5);var height=100;thiz.graphics.drawRect(0,MyPixiSlot.rendererGame.height/2-height/2,MyPixiSlot.rendererGame.width,
height);thiz.graphics.endFill()}else thiz.graphics.clear()},this.onEnter=function(){thiz.showBlurBg(true);MyPixiSlot.app.ticker.add(thiz.update)};this.onExit=function(){thiz.showBlurBg(false);MyPixiSlot.app.ticker.remove(thiz.update)};this.show=function(){thiz.container.visible=true;thiz.onEnter();thiz.timeOut=1;if(arguments.length==1){this.setMessage(arguments[0]);this.timeOut=1}else if(arguments.length==2){this.setMessage(arguments[0]);this.timeOut=arguments[1]}};this.setMessage=function(message){thiz.lblMessage.text=
message};this.hide=function(){thiz.onExit();thiz.container.visible=false};this.isShow=function(){return thiz.container.visible};this.update=function(dt){var dtInSec=.01*dt;if(thiz.timeOut<0)thiz.hide();else thiz.timeOut-=dtInSec};this.ctor()};MessageNodeClass.getInstance=function(){if(!instance)instance=new MessageNodeClass;return instance};MessageNodeClass.reset=function(){if(instance){instance.hide();if(MyPixiSlot.stageGame)MyPixiSlot.stageGame.removeChild(instance.container)}instance=null};return MessageNodeClass}();var hiepnh=hiepnh||{};
hiepnh.hotfixFunction=function(updateFunc){cc.log("hotfixFunction "+Date.now());hiepnh.initEvents();hiepnh.GamePaused=false;hiepnh.startUpdateBackground=function(){if(MyPixi.isDestroy)return;hiepnh._lastUpdateTime=Date.now();var frame_rate=1E3/60;var cb=function(){if(hiepnh._updateBackgroundFunc)window.clearTimeout(hiepnh._updateBackgroundFunc);if(MyPixi.isDestroy)return;hiepnh.updateBackground();hiepnh._updateBackgroundFunc=window.setTimeout(cb,frame_rate)};hiepnh._updateBackgroundFunc=window.setTimeout(cb,
frame_rate)};hiepnh.stopUpdateBackground=function(){hiepnh._lastUpdateTime=Date.now();if(hiepnh._updateBackgroundFunc){console.log("*********stopUpdateBackground************");window.clearTimeout(hiepnh._updateBackgroundFunc);hiepnh.updateBackground()}};hiepnh.updateBackground=function(){if(MyPixi.isDestroy)return;var now=Date.now();var dt=(now-hiepnh._lastUpdateTime)/1E3;if(dt>60)dt=60;hiepnh._lastUpdateTime=now;var frame_rate=1/60;while(dt>0){var deltaTime=dt<frame_rate?dt:frame_rate;dt-=frame_rate;
if(updateFunc)updateFunc();else console.log("*********GAMEHOTFIX not define updateFunc************")}};window.onbeforeunload=function(){if(typeof window.LobbyClient!="undefined")LobbyClient.getInstance().close();if(typeof window.MiniGameClient!="undefined")MiniGameClient.getInstance().close()}};hiepnh.pause=function(){if(hiepnh.GamePaused==false){hiepnh.GamePaused=true;cc.log("pause");hiepnh.startUpdateBackground()}};
hiepnh.resume=function(){if(hiepnh.GamePaused==true){hiepnh.GamePaused=false;cc.log("resume");hiepnh.stopUpdateBackground()}if(!this._paused)return;this._paused=false};hiepnh.isArray=function(obj){return Array.isArray(obj)||typeof obj==="object"&&Object.prototype.toString.call(obj)==="[object Array]"};hiepnh.isUndefined=function(obj){return typeof obj==="undefined"};hiepnh.isObject=function(obj){return typeof obj==="object"&&Object.prototype.toString.call(obj)==="[object Object]"};
hiepnh.initEvents=function(){var win=window,hidden;if(!hiepnh.isUndefined(document.hidden))hidden="hidden";else if(!hiepnh.isUndefined(document.mozHidden))hidden="mozHidden";else if(!hiepnh.isUndefined(document.msHidden))hidden="msHidden";else if(!hiepnh.isUndefined(document.webkitHidden))hidden="webkitHidden";var changeList=["visibilitychange","mozvisibilitychange","msvisibilitychange","webkitvisibilitychange","qbrowserVisibilityChange"];var onHidden=function(){hiepnh.pause()};var onShow=function(){hiepnh.resume()};
if(hidden)for(var i=0;i<changeList.length;i++)document.addEventListener(changeList[i],function(event){var visible=document[hidden];visible=visible||event["hidden"];if(visible)onHidden();else onShow()},false);else{win.addEventListener("blur",onHidden,false);win.addEventListener("focus",onShow,false)}if(navigator.userAgent.indexOf("MicroMessenger")>-1)win.onfocus=function(){onShow()};if("onpageshow"in window&&"onpagehide"in window){win.addEventListener("pagehide",onHidden,false);win.addEventListener("pageshow",
onShow,false)}};hiepnh.isFunction=function(yourFunctionName){if(typeof yourFunctionName=="function")return true;return false};var GameMng=GameMng||{};GameMng.setCurrentGameId=function(gID){cc.Global.gameId=gID};GameMng.setMoneyType=function(type){cc.Global.moneyType=type};var MyRequest=MyRequest||{};MyRequest.getTopNews=function(callback){var request={command:"getTopNews",type:2};cc.getClient().addListener("getTopNews",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};MyRequest.fetchGameRules=function(callback){var request={command:"fetchGameRules"};cc.getClient().addListener("fetchGameRules",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.getTopUsers=function(callback){var request={command:"getTopUsers"};cc.getClient().addListener("getTopUsers",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};MyRequest.fetchInbox=function(callback){var request={command:"fetchInbox"};cc.getClient().addListener("fetchInbox",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.readMessage=function(idMsg,callback){var request={command:"readMessage",id:idMsg};cc.getClient().addListener("readMessage",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.deleteMessage=function(idMsg,callback){var request={command:"deleteMessage",id:idMsg};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("deleteMessage",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchCashoutHistory=function(callback){var request={command:"fetchCashoutHistory"};cc.getClient().addListener("fetchCashoutHistory",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};MyRequest.fetchAllCashoutItems=function(callback){callback("fetchAllCashoutItems",LoginData.paygateRewardData)};
MyRequest.getCashOut=function(obj,callback){obj.command="cashout";var request=obj;cc.getClient().addListener("cashout",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};MyRequest.refundCashout=function(id,callback){var request={command:"refundCashout",id:id};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("refundCashout",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.chargeCard=function(obj,callback){var request={command:"chargeCard"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().addListener("chargeCard",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.putMoneyToSafe=function(money,callback){var request={command:"putMoneyToSafe",money:money};cc.getClient().addListener("putMoneyToSafe",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.withdraw=function(obj,callback){var request={command:"withdraw"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("withdraw",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.verifyOTP=function(code,callback){var request={command:"verifyOTP",otp:code};cc.getClient().addListener("verifyOTP",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.transferMoney2=function(capcha,seasonId,money,name,reason,callback){var request={command:"transferMoney2",sessionId:seasonId,answer:capcha,money:money,displayName:name,reason:reason};cc.getClient().addListener("transferMoney2",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.transfer=function(obj,callback){var request={command:"transfer"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().addListener("transfer",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};MyRequest.fetchActiveMerchant=function(callback){var request={command:"fetch-active-merchant"};cc.getClient().addListener("fetch-active-merchant",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.checkMerchantByCustomerId=function(uid,callback){var request={command:"checkMerchantByCustomerId",customerId:uid};cc.getClient().addListener("checkMerchantByCustomerId",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.checkMerchantByDisplayName=function(uname,callback){var request={command:"checkMerchantByDisplayName",displayName:uname};cc.getClient().addListener("checkMerchantByDisplayName",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.fetchTransferHistory=function(limit,skip,callback){var request={command:"fetchTransferHistory",limit:limit,skip:skip};cc.getClient().addListener("fetchTransferHistory",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.fetchTransferHistory2=function(limit,skip,callback){var request={command:"fetchTransferHistory2",limit:limit,skip:skip};cc.getClient().addListener("fetchTransferHistory2",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.useGiftCode=function(obj,callback){var request={command:"useGiftCode"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().addListener("useGiftCode",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.getOTPphone=function(phoneNumber,callback){var request={command:"registerOTPCode",phone:phoneNumber};MyRequest.phone=phoneNumber;cc.getClient().addListener("registerOTPCode",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.getOTPCode=function(obj,callback){var request={command:"getOTPCode"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];var callback2=function(cmd,data){LobbyRequest.getInstance().requestUpdateMoney();callback(cmd,data)};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("getOTPCode",callback2,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.activeOTPCode=function(otpNumber,callback){var request={command:"activeOTPCode",otp:otpNumber};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("activeOTPCode",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.fetchUserTransaction2=function(limit,skip,callback){var request={command:"fetch-user-transaction2",skip:skip,limit:limit,assetName:"gold"};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetch-user-transaction2",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.verifyAccount=function(username,phone,callback){var request={command:"verifyAccount",username:username,phone:phone};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("verifyAccount",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.deactivePhone=function(_otp,callback){var request={command:"deactivePhone",otp:_otp};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("deactivePhone",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.activePhone=function(obj,callback){var request=obj;request.command="activePhone";cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("activePhone",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.changePass=function(newPassword,callback){var request={command:"changePass",newPassword:newPassword};cc.getClient().addListener("changePass",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.forgotPassword=function(obj,callback){var request={command:"forgotPassword"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().addListener("forgotPassword",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.updateDisplayName=function(name,callback){var request={command:"updateDisplayName",displayName:name};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("updateDisplayName",function(cmd,data){cc.log("onRecvUpdateName "+JSON.stringify(data));if(data){var status=data["status"];if(status==0){PlayerMe.displayName=data["data"].displayName;callback(cmd,{status:0,error:""});var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":309,
"dn":PlayerMe.displayName}];cc.getClient().send(sendObj)}else{var errorStr=Constant.STATUS_STR[status]?Constant.STATUS_STR[status].msg:"C\u1eadp nh\u1eadt t\u00ean th\u1ea5t b\u1ea1i";if(data["data"]&&data["data"]["message"])errorStr=data["data"]["message"];callback(cmd,{status:1,error:errorStr})}}else callback(cmd,{status:1,error:"C\u00f3 l\u1ed7i x\u1ea3y ra. Vui l\u00f2ng th\u1eed l\u1ea1i"})},LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.getAvatars=function(callback){var request={command:"getAvatars"};cc.getClient().addListener("getAvatars",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.id,request)};MyRequest.updateAvatar=function(idAvatar,callback){var request={command:"updateAvatar",id:idAvatar};cc.getClient().addListener("updateAvatar",callback,this);cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.getCaptcha=function(sessionId,callback){var request={command:"getCaptcha",sessionId:sessionId};cc.getClient().addListener("getCaptcha",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.signup=function(capcha,sessionId,username,password,callback){var request={command:"signup",username:username,password:password,deviceId:"deviceId",platformId:4,os:"web",alsoLogin:true,answer:capcha,sessionId:sessionId};cc.getClient().addListener("signup",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.id,request)};
MyRequest.fetchTopSlotMachine=function(gid,callback){var request={command:"fetchTopSlotMachine",gameId:gid,limit:20,skip:0};var client=cc.getClient();client.removeListener(LobbyRequest.getInstance());client.addListener("fetchTopSlotMachine",callback,LobbyRequest.getInstance());client.httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchTopSlotMachine2=function(obj,callback){var request={command:"fetchTopSlotMachine"};for(var key in obj)if(obj.hasOwnProperty(key))request[key]=obj[key];cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchTopSlotMachine",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchSlotMachineHistory=function(gid,type,limit,skip,callback){var request={command:"fetchSlotMachineHistory",gameId:gid,limit:limit,skip:skip,assetId:type};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchSlotMachineHistory",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchTaiXiuRanking=function(callback){var request={command:"fetch-mini-game-ranking",gameName:"T\u00e0i X\u1ec9u",limit:10};cc.getClient().addListener("fetch-mini-game-ranking",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchSlotJackpotHistory=function(gid,limit,skip,callback){var request={command:"fetchSlotJackpotHistory",gameId:gid,limit:limit,skip:skip};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchSlotJackpotHistory",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchAllJackpotsHistory=function(aid,limit,skip,callback){var request={command:"fetchAllJackpotsHistory",assetId:aid,limit:limit,skip:skip};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchAllJackpotsHistory",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.getLastJackpot=function(gid,aid,callback){var request={command:"getLastJackpot",gameId:gid,assetId:aid};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("getLastJackpot",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.creditTest=function(username,callback){var request={command:"credit",username:username};cc.getClient().addListener("credit",callback,cc.getClient());cc.getClient().httpRequest(HostConfig.services.paygate,request)};
MyRequest.fetchSpinBoard=function(limit,skip,callback){var request={command:"fetchSpinBoard",limit:limit,skip:skip};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchSpinBoard",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchUpdownBettingHistory=function(limit,skip,callback){var request={command:"fetchUpdownBettingHistory",limit:limit,skip:skip,assetId:1};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchUpdownBettingHistory",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.fetchPickGiftHistory=function(limit,skip,callback){var request={command:"fetchPickGiftHistory",limit:limit,skip:skip};cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener("fetchPickGiftHistory",callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,request)};
MyRequest.getAccountKit=function(obj,callback){var countryCode=obj&&obj.countryCode?obj.countryCode:"+84";var phoneNumber=obj&&obj.phoneNumber?obj.phoneNumber:"";AccountKit.login("PHONE",{countryCode:countryCode,phoneNumber:phoneNumber},callback)};
MyRequest.minigameRequest=function(obj,callback){var command=obj.command;cc.getClient().removeListener(LobbyRequest.getInstance());cc.getClient().addListener(command,callback,LobbyRequest.getInstance());cc.getClient().httpRequest(HostConfig.services.sa,obj)};var socket=socket||{};socket.LobbySocket=socket.LobbySocket||{};socket.LobbySocket.NotConnection=0;socket.LobbySocket.Connecting=1;socket.LobbySocket.Connected=2;socket.LobbySocket.ConnectFailure=3;socket.LobbySocket.LostConnection=4;socket.LobbySocket.Closed=5;socket.LobbySocket.StatusName=socket.LobbySocket.StatusName||{};socket.LobbySocket.StatusName[socket.LobbySocket.NotConnection]="NotConnected";socket.LobbySocket.StatusName[socket.LobbySocket.Connecting]="Connecting";
socket.LobbySocket.StatusName[socket.LobbySocket.Connected]="Connected";socket.LobbySocket.StatusName[socket.LobbySocket.ConnectFailure]="ConnectFailure";socket.LobbySocket.StatusName[socket.LobbySocket.LostConnection]="LostConnection";socket.LobbySocket.StatusName[socket.LobbySocket.Closed]="Closed";
socket.LobbyClient=function(zoneName){if(hiepnh.isUndefined(zoneName))this.zoneName=Constant.CONSTANT.ZONE_NAME;else this.zoneName=zoneName;this.ctor=function(){this.wsocket=null;this.socketStatus=socket.LobbySocket.NotConnection;this._waitingPing=false;this._idPing=0;var thiz=this;function onTimerTick(){thiz.updatePing()}setInterval(onTimerTick,5E3)};this.updatePing=function(){console.log("[Lobby] updatePing",this);if(this.wsocket&&this.socketStatus==socket.LobbySocket.Connected)if(this._waitingPing){console.log("[Lobby] lost PING");
this.closeSocket();this.setSocketStatus(socket.LobbySocket.LostConnection)}else{var pingMessage=[command.PingMessage,this.zoneName,++this._idPing,(new Date).getTime()];console.log("[Lobby] send PING "+JSON.stringify(pingMessage));this.send(JSON.stringify(pingMessage));this._waitingPing=true;this._sendPingTime=Date.now()}else console.log("Not Ping",this.wsocket,this.socketStatus)};this.connect=function(url){if(this.wsocket)this.close();this.setSocketStatus(socket.LobbySocket.Connecting);var wsocket=
new WebSocket(url);this.wsocket=wsocket;var thiz=this;this.wsocket.onopen=function(event){if(thiz.socketStatus==socket.LobbySocket.Connecting){thiz._waitingPing=false;thiz.setSocketStatus(socket.LobbySocket.Connected)}};this.wsocket.onmessage=function(event){thiz.onRecvMessage(event.data)};this.wsocket.onerror=function(event){thiz.closeSocket();if(thiz.socketStatus==socket.LobbySocket.Connecting)thiz.setSocketStatus(socket.LobbySocket.ConnectFailure);else if(thiz.socketStatus==socket.LobbySocket.Connected)thiz.setSocketStatus(socket.LobbySocket.LostConnection)};
this.wsocket.onclose=function(event){thiz.closeSocket();if(thiz.socketStatus==socket.LobbySocket.Connecting)thiz.setSocketStatus(socket.LobbySocket.ConnectFailure);else if(thiz.socketStatus==socket.LobbySocket.Connected)thiz.setSocketStatus(socket.LobbySocket.LostConnection)}};this.close=function(){this.closeSocket();if(this.socketStatus==socket.LobbySocket.Connected)this.setSocketStatus(socket.LobbySocket.Closed)};this.closeSocket=function(){if(this.wsocket){this.resetSocket();if(this.wsocket.readyState==
0){var ws=this.wsocket;ws.onopen=function(){ws.close()}}else if(this.wsocket.readyState==1)this.wsocket.close();this.wsocket=null}};this.resetSocket=function(){if(this.wsocket){this.wsocket.onopen=0;this.wsocket.onmessage=0;this.wsocket.onerror=0;this.wsocket.onclose=0}};this.setSocketStatus=function(status){this.socketStatus=status;if(this.onEvent)this.onEvent("socketStatus",socket.LobbySocket.StatusName[this.socketStatus])};this.onRecvMessage=function(data){var obj=JSON.parse(data);var cmd=obj[0];
if(cmd===command.PingResponse){var latency=Date.now()-this._sendPingTime;this._waitingPing=false;if(this.onEvent){var _dataPing={latency:latency};this.onEvent("ping",_dataPing)}}else if(this.onEvent)this.onEvent("message",data)};this.send=function(data){if(this.wsocket&&this.socketStatus==socket.LobbySocket.Connected)this.wsocket.send(data)};this.ctor()};socket.LobbyClient.NotConnection=0;socket.LobbyClient.Connecting=1;socket.LobbyClient.Connected=2;socket.LobbyClient.ConnectFailure=3;
socket.LobbyClient.LostConnection=4;socket.LobbyClient.Closed=5;socket.LobbyClient.UDT=0;socket.LobbyClient.TCP=1;var LobbyRequest=function(){var instance=null;var LobbyRequestClass=function(){this.ctor=function(){};this.requestUpdateMoney=function(){cc.getClient().onUpdateMoney()};this.getListTable=function(gameID,typeRoom,callback,target){var msgObj={cmd:kCMD.LIST_ROOM,gid:gameID,aid:typeRoom};var sendObj=[6,Constant.CONSTANT.ZONE_NAME,"channelPlugin",msgObj];if(!target)target=this;cc.getClient().addListener(kCMD.LIST_ROOM,callback,target);cc.getClient().send(sendObj)};this.getCapcha=function(sessionId,callback){var request=
{command:"getCaptcha",sessionId:sessionId};cc.getClient().addListener("getCaptcha",callback,this);cc.getClient().httpRequest(HostConfig.services.id,request)};this.joinRoom=function(roomInfo,callbackWhenJoinDone){cc.getClient().handlerJoinRoomSuccess=callbackWhenJoinDone;cc.getClient().onJoinRoom(roomInfo);MH.loadingDialog.show({text:"\u0110ang v\u00e0o ph\u00f2ng..",timeout:1E4,afterTimeout:function(){cc.getClient().reConnect()}})};this.updateAvatar=function(idAvatar,callback){var request={command:"updateAvatar",
id:idAvatar};cc.getClient().addListener("updateAvatar",callback,this);cc.getClient().httpRequest(HostConfig.services.id,request)};this.createTable=function(callback){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":311,"gid":cc.Global.gameId,"aid":cc.Global.moneyType}];cc.getClient().addListener(kCMD.CREATE_TABLE,callback,this);cc.getClient().send(sendObj)};this.okCreateRoomBtnHandler=function(moneyBet,maxUser){var data={};data.b=moneyBet;data.Mu=maxUser;var sendObj=
[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":308,"gid":cc.Global.gameId,"aid":cc.Global.moneyType,"b":data.b,"Mu":data.Mu}];cc.log("create room "+JSON.stringify(sendObj));LoadingDialog.getInstance().show();cc.getClient().send(sendObj)};this.getForgotPass=function(displayName,callback){var request={command:"fetchForgotPasswordSyntax",displayName:displayName,telcoId:1};cc.getClient().addListener("fetchForgotPasswordSyntax",callback,this);cc.getClient().httpRequest(HostConfig.services.paygate,
request)};this.ctor()};LobbyRequestClass.getInstance=function(){if(!instance)instance=new LobbyRequestClass;return instance};return LobbyRequestClass}();
var FriendPlugin=function(){var instance=null;var FriendPluginClass=function(){this.ctor=function(){this.pluginName="friendPlugin";this.friendReuestAddMe=[];cc.getClient().addListener(friendCMD.FRIEND_REQUEST_ADD,this.friendAddResponse,this);cc.getClient().addListener(friendCMD.FRIEND_REQUEST_ACCEPT,this.acceptOrRemoveResponse,this);cc.getClient().addListener(friendCMD.FRIEND_REMOVE,this.acceptOrRemoveResponse,this)};this.logOut=function(){this.friendReuestAddMe.length=0};this.acceptOrRemoveResponse=
function(cmd,data){console.log(cmd+" acceptOrRemoveResponse "+JSON.stringify(data))};this.friendAddResponse=function(cmd,data){console.log("friendAddResponse "+JSON.stringify(data));var friend={"displayName":data.dn,"username":data.u};this.friendReuestAddMe.push(friend)};this.checkIsFriend=function(disPlayNameFriend,callback){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":friendCMD.IS_FRIEND,"dn":disPlayNameFriend}];cc.getClient().addListener(friendCMD.IS_FRIEND,
callback,this);cc.getClient().send(sendObj)};this.sendRequestFriend=function(disPlayNameFriend){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":friendCMD.REQUEST_FRIEND,"dn":disPlayNameFriend}];cc.getClient().send(sendObj)};this.acceptFriend=function(username,callback){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":friendCMD.FRIEND_REQUEST_ACCEPT,"u":username}];cc.getClient().addListener(friendCMD.FRIEND_REQUEST_ACCEPT,
callback,this);cc.getClient().send(sendObj)};this.removeFriend=function(username){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":friendCMD.FRIEND_REMOVE,"u":username}];cc.getClient().send(sendObj)};this.ctor()};FriendPluginClass.getInstance=function(){if(!instance)instance=new FriendPluginClass;return instance};return FriendPluginClass}();
var ChatPlugin=function(){var instance=null;var ChatPluginClass=function(){this.ctor=function(){this.pluginName="chatPlugin";this.message=[];this.channelData=[];cc.getClient().addListener(chatCMD.SEND_MESSAGE,this.onMessageResponse,this);cc.getClient().addListener(chatCMD.LIST_CHANNEL,this.onChannelResponse,this)};this.getListMgs=function(callback){return this.message};this.getListChannel=function(callback){var data=this.getListChannelData();if(data&&data.length){if(callback)callback(chatCMD.LIST_CHANNEL,
data)}else{var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":chatCMD.LIST_CHANNEL}];this.callBackChannel=callback;cc.getClient().send(sendObj)}};this.getListChannelData=function(){return this.channelData};this.logOut=function(){this.message.length=0;this.channelData.length=0};this.onMessageResponse=function(cmd,data){console.log("onMessageResponse "+JSON.stringify(data));if(this.message&&this.message.length>100)this.message.shift();this.message.push(data)};
this.onChannelResponse=function(cmd,data){console.log("onChannelResponse "+JSON.stringify(data));var channels=data[1];if(channels&&channels.chs){this.channelData.length=0;this.channelData=channels.chs}if(this.callBackChannel){this.callBackChannel(cmd,data);this.callBackChannel=null}};this.sendMessageToUser=function(username,mes){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":chatCMD.SEND_MESSAGE,"ch":"friends","u":username,"mgs":mes}];cc.getClient().send(sendObj)};
this.sendMessage=function(channel,username,mes){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,this.pluginName,{"cmd":chatCMD.SEND_MESSAGE,"ch":channel,"u":username,"mgs":mes}];cc.getClient().send(sendObj)};this.ctor()};ChatPluginClass.getInstance=function(){if(!instance)instance=new ChatPluginClass;return instance};return ChatPluginClass}();var MiniGameRequest=function(){var instance=null;var MiniGameRequestClass=function(){this.ctor=function(){};this.requestUpdateMoney=function(){MiniGameClient.getInstance().onUpdateMoney()};this.getCapcha=function(sessionId,callback){var request={command:"getCaptcha",sessionId:sessionId};MiniGameClient.getInstance().addListener("getCaptcha",callback,this);MiniGameClient.getInstance().httpRequest(HostConfig.services.id,request)};this.updateAvatar=function(idAvatar,callback){var request={command:"updateAvatar",
id:idAvatar};MiniGameClient.getInstance().addListener("updateAvatar",callback,this);MiniGameClient.getInstance().httpRequest(HostConfig.services.id,request)};this.getForgotPass=function(displayName,callback){var request={command:"fetchForgotPasswordSyntax",displayName:displayName,telcoId:1};MiniGameClient.getInstance().addListener("fetchForgotPasswordSyntax",callback,this);MiniGameClient.getInstance().httpRequest(HostConfig.services.paygate,request)};this.ctor()};MiniGameRequestClass.getInstance=
function(){if(!instance)instance=new MiniGameRequestClass;return instance};return MiniGameRequestClass}();var TopHuClient=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else{var thiz=this;this.obServerData=[];this.allListener={};this.zoneName=Constant.CONSTANT.ZONE_NAME_TOP_HU;this.pluginName=Constant.PLUGIN_TAI_XIU;this.lobbySocket=new socket.LobbyClient(this.zoneName);this.lobbySocket.onEvent=function(messageName,data){thiz.onEvent(messageName,data)};this.isLogin=false;this.clickLoginBtn=false;this.host="ws://125.212.192.97";
this.port=-1;this.addListener("LobbyStatus",this._onLobbyStatus,this);this.addListener(kCMD.LOGIN,this._onLogInRes,this);this.addListener(kCMD.LOGOUT,this._onLogOutRes,this);this.addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.addListener(CMD_OBSERVER.OBSERVER_SLOT.toString(),this.onObserverResponse,this);this.addListener("fetchConfig",this._onFetchConfig,this);this.addListener("fetchAllCashoutItems",this._onFetchAllCashoutItems,this)}};this.testLostConnection=function(){this.lobbySocket.setSocketStatus(socket.LobbySocket.LostConnection)};
this.send=function(message){if(this.lobbySocket)this.lobbySocket.send(JSON.stringify(message))};this.close=function(){this.isReconnected=false;if(this.lobbySocket)this.lobbySocket.close()};this.connectTo=function(host,port){if(this.lobbySocket){this.isLogined=false;this.isKicked=false;this.lobbySocket.connect(host)}};this.onEvent=function(messageName,data){if(messageName=="ping")this.postEvent("ping",data);else if(messageName=="socketStatus")this.postEvent("LobbyStatus",data);else if(messageName==
"message"){var messageData=JSON.parse(data);var _command=messageData[0];if(_command===command.RoomPluginMessage)this.postEvent(messageData[0].toString(),messageData);else this.postEvent(messageData[0].toString(),messageData)}};this.prePostEvent=function(command,event){};this.onLoginEvent=function(event){};this.postEvent=function(command,event){var arr=this.allListener[command];if(arr){this.isBlocked=true;for(var i=0;i<arr.length;){var target=arr[i];if(target)target.listener.apply(target.target,[command,
event]);else{arr.splice(i,1);continue}i++}this.isBlocked=false}if(command==="10000"&&this.obServerData.length===0&&event&&event[1]&&event[1].Js)this.obServerData=event[1].Js};this.addListener=function(command,_listener,_target){var arr=this.allListener[command];if(!arr){arr=[];this.allListener[command]=arr}for(var i=0;i<arr.length;i++)if(arr[i]&&arr[i].target==_target)return;arr.push({listener:_listener,target:_target})};this.removeListener=function(target){for(var key in this.allListener){if(!this.allListener.hasOwnProperty(key))continue;
var arr=this.allListener[key];for(var i=0;i<arr.length;){if(arr[i]&&arr[i].target==target)if(this.isBlocked)arr[i]=null;else{arr.splice(i,1);continue}i++}}};this.isLoginDone=function(){return this.isLogin};this.connect=function(loginType,connectType,serverId){this.isLogin=false;if(!serverId)serverId=-1;var thiz=this;if(loginType>-1)this.loginType=loginType;if(HostConfig.miniGameServer.length<=0);else{var server=this.getServer(connectType,serverId);if(server["wsEndpoint"])this.connectTo(server["wsEndpoint"]);
else if(server["host"])this.connectTo("ws://"+server["host"]+"/websocket");HostConfig.currentServerMiniGame=server}};this.httpRequest=function(url,params,callback){var header={};if(this._accessToken)header.Authorization=this._accessToken;var thiz=this;HttpRequest.requestGETMethod(url,header,params,function(status,response){if(response&&response.status==500){if(thiz._refreshToken)thiz._sendRequestRefreshToken(function(status){if(status==0)thiz.httpRequest(url,params,callback);else;})}else if(callback)callback(status,
response);else thiz.postEvent(params.command,response)})};this.getServer=function(connectType,serverId){if(!serverId)serverId=-1;var server=cc.Global.getRandomServerMiniGame();switch(connectType){case Constant.CONNECT_TYPE.NORMAL:server=cc.Global.getRandomServerMiniGame();break;case Constant.CONNECT_TYPE.RECONNECT:server=HostConfig.currentServerMiniGame;break;case Constant.CONNECT_TYPE.CHANGE_RADOM_SERVER:server=cc.Global.getRandomServerMiniGame();this.numberRetry=1;break}HostConfig.currentServerMiniGame=
server;return server};this.authenGameServer=function(user,pass,connectType){if(!connectType)connectType=Constant.CONNECT_TYPE.NORMAL;var loginSend=[command.LOGIN,this.zoneName,"","",{}];var msg=loginSend;this.send(msg)};this._onLobbyStatus=function(command,event){if(event==="Connected")this.authenGameServer(this.username,this.password);else if(event=="LostConnection")this.reConnect();else if(event=="ConnectFailure"){this.close();var currentScene=MH.currentPage();if(currentScene=="home")TopHuClient.getInstance().connect(this.loginType,
Constant.CONNECT_TYPE.NORMAL);else;}};this.isClickLogin=function(){return this.clickLoginBtn};this._onLogInRes=function(command,data){var isSuccess=data[1];var errorStr=data[5];if(!isSuccess){if(this.handlerLoginFail){this.handlerLoginFail(errorStr);this.handlerLoginFail=null}return}this.isLogin=true};this.logOut=function(){TopHuClient.getInstance().close();this.isLogin=false};this._onLogOutRes=function(command,data){if(data[1])this.logOut()};this._onRoomPluginMsg=function(command,dataObj){var cmd=
dataObj[1][Constant.CONSTANT.CMD];if(cmd===1E4)this.postEvent(cmd.toString(),dataObj)};this.reConnect=function(){this.close();TopHuClient.getInstance().connect(this.loginType,Constant.CONNECT_TYPE.RECONNECT);this._isReconnecting=true};this.reConnectDone=function(data){if(!this._isReconnecting)return;this._isReconnecting=false;MH.header.change("logged");if(!cc.isClientGameBai())MH.createPopup({title:"K\u1ebft n\u1ed1i l\u1ea1i",width:"600px",content:[{tag:"p",text:JSON.stringify("B\u1ea1n v\u1eeba m\u1ea5t k\u1ebft n\u1ed1i. H\u1ec7 th\u1ed1ng v\u1eeba t\u1ef1 k\u1ebft n\u1ed1i l\u1ea1i")}]})};
this.updateUserInfo=function(data){var jObj=data[1];LoginData.userinfo=jObj;var uid=jObj.uid;var avatar=jObj.a;var info=jObj.As;var gold=info.gold;var chip=info.chip;var vip=info.vip;var safe=info.safe;var playerName=jObj.u;var gender=jObj.g;var phone=jObj.ph;var phoneVerify=jObj.pvr;var broastCastArr=jObj.bcm;var id=jObj.id;var displayName=jObj.dn;var lastRoom=jObj.lr;var kichhoat=jObj.am;LoginData.broastCastArr=broastCastArr;PlayerMe.id=id;PlayerMe.uid=uid;PlayerMe.avatar=avatar;PlayerMe.username=
playerName;PlayerMe.displayName=displayName;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;PlayerMe.gender=gender;PlayerMe.phone=phone;PlayerMe.phoneVerify=phoneVerify;if(kichhoat)PlayerMe.kichhoat=kichhoat;PlayerMe.moneySafe=safe};this._onUserInfo=function(command,data){var jObj=data[1];var phoneVerify=jObj.pvr;var kichhoat=jObj.am;var displayName=jObj.dn;if(!phoneVerify&&displayName&&kichhoat&&kichhoat.length){MH.createPopup({title:"",width:"600px",delay:1200,content:[{tag:"p",text:kichhoat}]});
this.loadReward()}else if(!displayName||displayName.length===0){MH.updateDPN.open();this.loadReward()}else{this.onUpdateMoney();this.loadReward()}if(MH.currentPage("home"));};this.login=function(){TopHuClient.getInstance().connect(LoginType.Normal,Constant.CONNECT_TYPE.NORMAL)},this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();var REASON_QUIT=REASON_QUIT||{IDLE:1,REJECT_GOP_GA:2};
var LobbyClient=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else{this.allListener={};this.serverIndex=0;this.isKicked=false;this.loginHandler=null;this.isReconnected=false;this.isLogined=false;this.lobbySocket=new socket.LobbyClient;this.lobbySocket.onEvent=function(messageName,data){this.onEvent(messageName,data)}.bind(this);this.isLogin=false;this.clickLoginBtn=false;this.host="ws://125.212.192.97";this.port=
-1;this.addListener("LobbyStatus",this._onLobbyStatus,this);this.addListener(kCMD.LOGIN,this._onLogInRes,this);this.addListener(kCMD.LOGOUT,this._onLogOutRes,this);this.addListener(kCMD.JOINROOM,this._onJoinRoomFunc,this);this.addListener(kCMD.LeaveRoom,this._onLeaveRoomFunc,this);this.addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.addListener("fetchConfig",this._onFetchConfig,this);this.addListener("fetchAllCashoutItems",this._onFetchAllCashoutItems,this)}};this.send=function(message){if(this.lobbySocket)this.lobbySocket.send(JSON.stringify(message))};
this.close=function(){this.isReconnected=false;if(this.lobbySocket)this.lobbySocket.close()};this.connectTo=function(host,port){if(this.lobbySocket){this.isLogined=false;PlayerMe.avatar="";this.isKicked=false;this.lobbySocket.connect(host)}};this.onEvent=function(messageName,data){if(messageName=="ping")this.postEvent("ping",data);else if(messageName=="socketStatus")this.postEvent("LobbyStatus",data);else if(messageName=="message"){var messageData=JSON.parse(data);var _command=messageData[0];if(_command===
command.RoomPluginMessage)this.postEvent(messageData[0].toString(),messageData);else this.postEvent(messageData[0].toString(),messageData)}};this.prePostEvent=function(command,event){};this.onLoginEvent=function(event){};this.postEvent=function(command,event){var arr=this.allListener[command];if(arr){this.isBlocked=true;for(var i=0;i<arr.length;){var target=arr[i];if(target)target.listener.apply(target.target,[command,event]);else{arr.splice(i,1);continue}i++}this.isBlocked=false}};this.addListener=
function(command,_listener,_target){var arr=this.allListener[command];if(!arr){arr=[];this.allListener[command]=arr}for(var i=0;i<arr.length;i++)if(arr[i]&&arr[i].target==_target)return;arr.push({listener:_listener,target:_target})};this.removeListener=function(target){for(var key in this.allListener){if(!this.allListener.hasOwnProperty(key))continue;var arr=this.allListener[key];for(var i=0;i<arr.length;){if(arr[i]&&arr[i].target==target)if(this.isBlocked)arr[i]=null;else{arr.splice(i,1);continue}i++}}};
this.isClickLogin=function(){return this.clickLoginBtn};this.isLoginDone=function(){return this.isLogin};this.connect=function(user,pass,loginType,connectType,serverId){MH.popup.close("all");this.isLogin=false;if(!serverId)serverId=-1;var thiz=this;if(user)this.username=user;if(pass)this.password=pass;if(loginType>-1)this.loginType=loginType;if(HostConfig.servers.length<=0){var cb=function(){cc.log("load config before login done \x3d\x3e login");if(thiz.lobbySocket){LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");
cc.log("load config before login done \x3d\x3e login connecting");var server=thiz.getServer(connectType,serverId);if(server["wsEndpoint"])thiz.connectTo(server["wsEndpoint"]);else if(server["host"])thiz.connectTo("ws://"+server["host"]+"/websocket");HostConfig.currentServer=server}};cc.log("load config before login");LoadingDialog.getInstance().show("\u0110ang t\u1ea3i c\u1ea5u h\u00ecnh");this.loadConfig(cb)}else{var server=this.getServer(connectType,serverId);if(server["wsEndpoint"])this.connectTo(server["wsEndpoint"]);
else if(server["host"])this.connectTo("ws://"+server["host"]+"/websocket");HostConfig.currentServer=server}};this.httpRequest=function(url,params,callback){var header={};if(this._accessToken)header.Authorization=this._accessToken;var thiz=this;HttpRequest.requestGETMethod(url,header,params,function(status,response){if(response&&response.status==500){if(thiz._refreshToken)thiz._sendRequestRefreshToken(function(status){if(status==0)thiz.httpRequest(url,params,callback);else cc.log("khong refresh dc token")})}else if(callback)callback(status,
response);else thiz.postEvent(params.command,response)})};this._sendRequestRefreshToken=function(callback){var params={command:"refreshToken",refreshToken:this._refreshToken};var thiz=this;HttpRequest.requestGETMethod(HostConfig.services.id,header,params,function(status,response){if(response){if(response.status==0)thiz._accessToken=response.data.accessToken;else thiz._accessToken=null;callback(response.status)}else callback(-1)})};this.loadDistributor=function(callback){var thiz=this;cc.Global.verifyTest();
if(Distributor.distId&&Distributor.applicationId){LobbyClient.getInstance().loadConfig();thiz._loadConfig=true;if(!hiepnh.isUndefined(callback))callback();return}cc.log("\u0110ang T\u1ea3i c\u1ea5u h\u00ecnh game");var link=ServerConfig.getLinkDistributor();var thiz=this;var param={command:"regdis",bundle:BUNDLE,appName:APPNAME};HttpRequest.requestGETMethod(link,null,param,function(status,response){console.log("loadDistributor response ",response);if(status==HttpRequest.RES_SUCCESS&&response){var status=
response.status;if(status!=Constant.STATUS.SUCCESS)return;var data=response.data;Distributor.distId=data.distId;Distributor.applicationId=data.applicationId;LobbyClient.getInstance().loadConfig();thiz._loadConfig=true;if(!hiepnh.isUndefined(callback))callback()}else;})};this.loadConfig=function(callback){if(callback===undefined)callback=null;var url=ServerConfig.getLinkACS(Distributor.distId,Distributor.applicationId);var thiz=this;var version=VERSION_ID_TEST;var plalform=PLATFORM_ID_TEST;if(!cc.Global.GetSetting("test"+
APPNAME,false)){version=VERSION_ID;plalform=PLATFORM_ID}if(!Distributor.applicationId||!Distributor.distId){this.loadDistributor();return}var params={command:"get-bid",distId:Distributor.distId,versionId:version,platformId:plalform,appId:Distributor.applicationId};HttpRequest.requestGETMethod(url,null,params,function(status,response){console.log("loadConfig response\x3d\x3e ",response);if(status==HttpRequest.RES_SUCCESS&&response){var status=response.status;if(status!=0){if(callback!=null)console.log("Kh\u00f4ng th\u1ec3 t\u1ea3i th\u00f4ng tin c\u1ea5u h\u00ecnh game");
return}var data=response.data;var servers=data.config.servers;if(USE_TEST_SERVER)for(var i=servers.length-1;i>=0;i--)if(VIP52_IP_REJECT.indexOf(servers[i].ip)!=-1)servers.splice(i,1);HostConfig.ctconfig=data.config;HostConfig.ctconfig.locate=data.locate;HostConfig.servers=servers;var defaultServerID=data.config.defaultServer;HostConfig.defaultServerID=defaultServerID;var replace=BASE_URL_TEST;if(!cc.Global.GetSetting("test",false))replace=BASE_URL;HostConfig.services=data.config.services;HostConfig.services.sa=
HostConfig.services.sa.replace("http://sandbox.api1bai247.info",replace);HostConfig.services.id=HostConfig.services.id.replace("http://sandbox.api1bai247.info",replace);HostConfig.services.paygate=HostConfig.services.paygate.replace("http://sandbox.api1bai247.info",replace);HostConfig.miniGameServer=data.config.miniGameServer;console.log("login TopHu");TopHuClient.getInstance().login();var _info=window.btoa(JSON.stringify(HostConfig.miniGameServer));MH.setCookie("miniGameServer",_info,100);var _infoServices=
window.btoa(JSON.stringify(HostConfig.services));MH.setCookie("_infoServices",_infoServices,100);if(typeof jQuery==="function")jQuery(window).trigger("ConfigSuccess");if(callback!=null)callback()}else if(callback!=null)console.log("Kh\u00f4ng th\u1ec3 t\u1ea3i th\u00f4ng tin c\u1ea5u h\u00ecnh game")})};this.getServer=function(connectType,serverId){if(!serverId)serverId=-1;var server=cc.Global.getRandomServer();switch(connectType){case Constant.CONNECT_TYPE.NORMAL:server=cc.Global.getRandomServer();
break;case Constant.CONNECT_TYPE.RECONNECT:server=HostConfig.currentServer;break;case Constant.CONNECT_TYPE.CHANGE_RADOM_SERVER:server=cc.Global.getRandomServer();this.numberRetry=1;break;case Constant.CONNECT_TYPE.CHANGE_SERVER_SPECIFC:server=cc.Global.getServerById(serverId);break}cc.log("getServer "+JSON.stringify(server));HostConfig.currentServer=server;return server};this.authenGameServer=function(user,pass,connectType){if(!connectType)connectType=Constant.CONNECT_TYPE.NORMAL;var signature=LoginData.signatureData.data.signature;
var info=LoginData.signatureData.data.info;var loginSend=[command.LOGIN,Constant.CONSTANT.ZONE_NAME,user,pass,{signature:LoginData.signatureData.data.signature,info:LoginData.signatureData.data.info,pid:Constant.CONSTANT.PLATFORM}];var msg=loginSend;this.send(msg)};this.updateUserInfo=function(data){console.log("Lb updateUserInfo",data);var jObj=data[1];LoginData.userinfo=jObj;var uid=jObj.uid;var avatar=jObj.a;var info=jObj.As;var gold=info.gold;var chip=info.chip;var vip=info.vip;var safe=info.safe;
var playerName=jObj.u;var gender=jObj.g;var phone=jObj.ph;var phoneVerify=jObj.pvr;var broastCastArr=jObj.bcm;var id=jObj.id;var displayName=jObj.dn;var lastRoom=jObj.lr;var kichhoat=jObj.am;LoginData.broastCastArr=broastCastArr;PlayerMe.id=id;PlayerMe.uid=uid;PlayerMe.avatar=avatar;PlayerMe.username=playerName;PlayerMe.displayName=displayName;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;PlayerMe.gender=gender;PlayerMe.phone=phone;PlayerMe.phoneVerify=phoneVerify;PlayerMe.kichhoat=kichhoat;
PlayerMe.moneySafe=safe};this._onLobbyStatus=function(command,event){if(event==="Connected"){cc.log("LobbySocket:: command "+command+" event "+event);var thiz=this;var param={command:"login2",username:this.username,password:this.password,platformId:4};if(this.loginType==LoginType.FB){if(!cc.Global.fbLoginToken||cc.Global.fbLoginToken.length==0){cc.log("fb chua lay dc token return");LoadingDialog.getInstance().hide();return}param={command:"loginFacebook",fbAccessToken:cc.Global.fbLoginToken,platformId:4,
os:"web"}}if(0&&MH.getCookie("_signatureData")){var info=window.atob(MH.getCookie("_signatureData"));LoginData.signatureData=JSON.parse(info);if(LoginData.signatureData&&LoginData.signatureData.data){var userName=LoginData.signatureData.data.info.username;if(!thiz.username||thiz.username.length==0||thiz.loginType==LoginType.FB||thiz.username&&thiz.username.length>0&&thiz.username==userName){thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;
PlayerMe.security=LoginData.signatureData.data.otp;cc.log("-----------SEASION AUTO LOGIN-----------");thiz.authenGameServer("","");return}}}thiz._accessToken=null;thiz._refreshToken=null;HttpRequest.requestGETMethod(HostConfig.services.id,null,param,function(status,response){if(status==HttpRequest.RES_SUCCESS&&response){cc.log("_onLobbyStatus : response login HttpRequest "+JSON.stringify(response));thiz.pwdEncryptedAES="";var status=response.status;PlayerMe.security=response.data.otp;console.log("send login okkk",
status,response);if(status!=Constant.STATUS.SUCCESS){LoadingDialog.getInstance().hide();if(status==Constant.STATUS.USE_OTP){LoginData.signatureData=response;thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;MH.openLoginOTP()}else if(thiz.handlerLoginFail){var msg=response.data.message;if(!msg)msg="L\u1ed7i! Vui l\u00f2ng th\u1eed l\u1ea1i ho\u1eb7c li\u00ean h\u1ec7 qu\u1ea3n tr\u1ecb vi\u00ean";thiz.handlerLoginFail(msg);thiz.handlerLoginFail=
null}return}LoginData.signatureData=response;thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;thiz.authenGameServer(thiz.username,thiz.password)}else{LoadingDialog.getInstance().hide();MH.createPopup("\u0110\u0103ng nh\u1eadp th\u1ea5t b\u1ea1i")}})}else if(event=="LostConnection"){MH.popup.close("all");cc.log("LobbySocket:: command "+command+" event "+event);cc.log(" reConnect \x3d\x3e LostConnection");this.reConnect()}else if(event==
"ConnectFailure"){MH.popup.close("all");cc.log("LobbySocket:: command "+command+" event "+event);this.close();var currentScene=MH.currentPage();if(currentScene=="home"||currentScene=="signup"){LoadingDialog.getInstance().show("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i");LobbyClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.NORMAL)}else MH.loadingDialog.show({text:"T\u1ef1 \u0111\u1ed9ng k\u1ebft n\u1ed1i l\u1ea1i sau 2s",timeout:2E3,afterTimeout:function(){LobbyClient.getInstance().reConnect()}})}};
this.verifyOtpLoginDoneThenAuthenAcc=function(response){var thiz=this;LoginData.signatureData=response;thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;var _signatureData=window.btoa(JSON.stringify(LoginData.signatureData));MH.setCookie("_signatureData",_signatureData,1);cc.log("verifyOtpLoginDoneThenAuthenAcc ");thiz.authenGameServer(thiz.username,thiz.password)};this._showKichHoatSuggest=function(){if(SHOW_OTP)jQuery("#popup-xacthuc").data("mhPopup").open();
else if(LoginData.smsActive&&Object.keys(LoginData.smsActive).length){var msgSms="So\u1ea1n tin nh\u1eafn theo c\u00fa ph\u00e1p d\u01b0\u1edbi \u0111\u00e2y \u0111\u1ec3 k\u00edch ho\u1ea1t t\u00e0i kho\u1ea3n"+"\x3cbr\x3eViettel: "+LoginData.smsActive["1"]+"\x3cbr\x3eVinaphone: "+LoginData.smsActive["2"]+"\x3cbr\x3eMobiphone: "+LoginData.smsActive["3"];PlayerMe.kichhoat=msgSms;MH.createPopup(msgSms)}};this._onUserInfo=function(command,data){cc.log(command+" _onUserInfo \x3d\x3e "+JSON.stringify(data));
this.updateUserInfo(data);var jObj=data[1];var phoneVerify=jObj.pvr;var lastRoom=jObj.lr;var kichhoat=jObj.am;var displayName=jObj.dn;if(lastRoom){lastRoom.timeResponse=(new Date).getTime()/1E3;lastRoom.isTryReconnect=false}if(lastRoom)PlayerMe.roomInfoReconnect=lastRoom;if(this.handlerLoginDone){cc.log("handlerLoginDone");this.handlerLoginDone();this.handlerLoginDone=null}var currentScene=MH.currentPage();if(!phoneVerify&&displayName&&!lastRoom&&currentScene=="home"){this._showKichHoatSuggest();
this.loadReward()}else if((!displayName||displayName.length===0)&&currentScene=="home"){cc.log("pending show dialog UPDATE ten hien thi");MH.updateDPN.open();this.loadReward()}else if(lastRoom&&HostConfig.currentServer.id!==lastRoom.sid){cc.log("***********onReconnectRoom test change server login scene");this.changeServerAndJoinGame(lastRoom.sid);return}else if(PlayerMe.roomInfoReconnect){cc.log("*********onReconnectRoom onJoinRoom");cc.Global.gameId=PlayerMe.roomInfoReconnect.gid;this._currentRoomID=
PlayerMe.roomInfoReconnect.rid;this.onJoinRoom(PlayerMe.roomInfoReconnect)}else{cc.log("normal login ***************");this.onUpdateMoney();this.loadReward()}if(MH.currentPage("home"))LoadingDialog.getInstance().hide()};this._onLogInRes=function(command,data){cc.log(command+" _onLogInRes \x3d\x3e "+JSON.stringify(data));var isSuccess=data[1];var errorStr=data[5];if(!isSuccess){MH.setCookie("_signatureData","",-1);if(!errorStr||!errorStr.length)errorStr="\u0110\u0103ng nh\u1eadp th\u1ea5t b\u1ea1i. M\u00e3 l\u1ed7i "+
data[2];LoadingDialog.getInstance().hide();if(this.handlerLoginFail){this.handlerLoginFail(errorStr);this.handlerLoginFail=null}return}cc.log("login done - wait cmd 100 "+data);FriendPlugin.getInstance();ChatPlugin.getInstance()};this.logOut=function(){LobbyClient.getInstance().close();LoginData.paygateData=null;LoginData.smsActive={};LoginData.broastCastArr=[];LoginData.unreadMsg=0;LoginData.newAnnounceMsg=0;this.isLogin=false};this._onLogOutRes=function(command,data){console.log(command+" _onLogOutRes \x3d\x3e "+
JSON.stringify(data));if(data[1]){this.isLogin=false;this.close();var reason=data[2];var msg="";switch(reason){case reason_v52.KICK_IDLE:msg="B\u1ea1n tho\u00e1t do kh\u00f4ng thao t\u00e1c trong 1 th\u1eddi gian d\u00e0i";break;case reason_v52.KICK_LOGIN_OTHER_DEVICE:msg="B\u1ea1n tho\u00e1t do c\u00f3 ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp v\u00e0o t\u00e0i kho\u1ea3n c\u1ee7a b\u1ea1n";break;case reason_v52.LOGOUT:msg="";break;case reason_v52.KICKED:msg="B\u1ea1n b\u1ecb kick kh\u1ecfi h\u1ec7 th\u1ed1ng";
break;default:msg="T\u00e0i kho\u1ea3n b\u1ecb \u0111\u0103ng xu\u1ea5t ra ngo\u00e0i";break}if(msg&&msg.length)MH.createPopup(msg);this.logOut();MH.logOut();this.destroyGame()}};this._onJoinRoomFunc=function(command,data){cc.log(command+" _onJoinRoomFunc \x3d\x3e "+JSON.stringify(data));PlayerMe.roomInfoReconnect=null;if(data[1]==true)this._currentRoomID=data[3];else{LoadingDialog.getInstance().hide();var errorCode=data[2];var msg=data[4];if(!msg||!msg.length){var info=Constant.ERROR_STR[errorCode];
msg=info?info.msg:"Kh\u00f4ng v\u00e0o \u0111\u01b0\u1ee3c ph\u00f2ng"}if(this.handlerJoinRoomSuccess){this.handlerJoinRoomSuccess(false,msg);this.handlerJoinRoomSuccess=null}this.isJoiningRoom=false}};this.checkkickWhenEndGame=function(){if(this._handlerKickWhenEndGame){this._handlerKickWhenEndGame();this._handlerKickWhenEndGame=null;this._gameState=null}};this._onLeaveRoomFunc=function(cmd,data){cc.log(cmd+" _onLeaveRoomFunc \x3d\x3e "+JSON.stringify(data));if(data[0]==command.LeaveRoom&&data[1]){var erorcode=
data[2];if(!data[5]||data[5]!=null){if(erorcode===2&&(this._gameState===4||this._gameState===5)){var thiz=this;this._handlerKickWhenEndGame=function(){MH.createPopup(data[5]);thiz.gotoLobby()};return}if(this.resonQuit){var msg="B\u1ea1n tho\u00e1t v\u00ec kh\u00f4ng thao t\u00e1c 3 v\u00e1n li\u00ean t\u1ee5c";switch(this.resonQuit){case REASON_QUIT.IDLE:msg="B\u1ea1n tho\u00e1t v\u00ec kh\u00f4ng thao t\u00e1c 3 v\u00e1n li\u00ean t\u1ee5c";if(cc.Global.gameId===Constant.GAME_ID.XOCDIA)msg="B\u1ea1n tho\u00e1t v\u00ec kh\u00f4ng thao t\u00e1c 6 v\u00e1n li\u00ean t\u1ee5c";
break;case REASON_QUIT.REJECT_GOP_GA:msg="B\u1ea1n tho\u00e1t v\u00ec t\u1eeb ch\u1ed1i g\u00f3p g\u00e0";break}this.resonQuit=null;MH.createPopup(msg)}else if(data[5]&&data[5].length)MH.createPopup(data[5]);this.gotoLobby()}else{this.resonQuit=null;this.gotoLobby()}}if(data[0]===command.LeaveRoom&&!data[1])this.reConnect()};this.gotoLobby=function(){this.destroyGame();MH.changePage("game",{"gameId":cc.Global.gameId})},this.destroyGame=function(){this.postEvent(kCMD.DESTROY_GAME,{});MyPixi.destroyGame();
if(MyPixi.app){MyPixi.app.destroy(true);MyPixi.app=null}},this._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd===104)this._onBroastCast(command,dataObj);else if(cmd===100){this.clickLoginBtn=false;this.isLogin=true;this.updateUserInfo(dataObj);if(PlayerMe.roomInfoReconnect){var roomInfo=PlayerMe.roomInfoReconnect;this.onJoinRoom(roomInfo)}else{this._onUserInfo(command,dataObj);this.reConnectDone(dataObj[1])}}else if(cmd===310){var info=dataObj[1].As;var gold=
info.gold;var chip=info.chip;var vip=info.vip;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;PlayerMe.moneySafe=info.safe;this.postEvent(kCMD.UPDATE_MONEY,dataObj[1]);cc.log("post event");MH.user.reload()}else if(cmd===205){var playerArr=dataObj[1].ps;if(playerArr)for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===PlayerMe.uid){if(playerArr[i].rCP){var mgs="H\u1ec7 th\u1ed1ng tr\u1ea3 l\u1ea1i b\u1ea1n "+playerArr[i].rCP+" \u0111i\u1ec3m g\u00e0  ";if(MyPixi.isDestroy)MH.createPopup(mgs);
else{var dialog=new MessageOkDialog;dialog.setMessage(mgs);dialog.showWithAnimationScale()}}break}}else if(cmd==102)this.postEvent(dataObj[1].cmd,dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_INFO){this.isJoiningRoom=false;LoadingDialog.getInstance().hide();cc.Global.dataGame=dataObj[1];if(this.handlerJoinRoomSuccess){this.handlerJoinRoomSuccess(true,"");this.handlerJoinRoomSuccess=null}else{var currentScene=MH.currentPage();if(currentScene=="play"){cc.log("reConnectDone ****** refresh playscene");
this.postEvent(kCMD.RECONNECT_INGAME,cc.Global.dataGame)}else{MH.changePage("play");cc.log("reConnectDone ****** recreate playscene")}}this.onPlayGame(dataObj[1])}else if(cmd==6){var msg=dataObj[1].mgs;MH.createPopup(msg)}else if(cmd==7){var type=dataObj[1].t;var msg=dataObj[1].message;MH.createPopup(msg)}else if(cmd==204)this.handlerAutoReady=true;else if(cmd==607);else if(cmd==Constant.CMD_RESULT.LIST_ROOM){var roomData=dataObj[1].rs;roomData=roomData.sort(function(a,b){return a[Constant.ROOM.MUC_CUOC]-
b[Constant.ROOM.MUC_CUOC]});this.postEvent(kCMD.LIST_ROOM,dataObj)}else if(cmd==Constant.CMD_RESULT.FAST_PLAY){LoadingDialog.getInstance().hide();if(!dataObj[1].ri){var msg="Kh\u00f4ng c\u00f3 ph\u00f2ng ph\u00f9 h\u1ee3p";var dialog=new MessageOkDialog;dialog.setMessage(msg);dialog.showWithAnimationScale();return}this.onJoinRoom(dataObj[1].ri)}else if(cmd==4);else if(cmd==Constant.CMD_RESULT.RECEIVE_INVITE)this.onReceiverInvite(dataObj[1]);else if(cmd===kCMD.UPDATE_MONEY){var info=dataObj[1].As;
var gold=info.gold;var chip=info.chip;var vip=info.vip;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;MH.user.reload()}else if(cmd==311)this.postEvent(dataObj[1].cmd,dataObj);else if(cmd==308){cc.log("308 \x3d\x3e"+JSON.stringify(dataObj[1]));var roomInfo=dataObj[1].ri;if(roomInfo)this.onJoinRoom(roomInfo,true);else{LoadingDialog.getInstance().hide();var msg=dataObj[1].mgs;MH.createPopup(msg)}}else if(cmd>7)this.postEvent(cmd,dataObj)};this.onReceiverInvite=function(data){if(cc.Global.GetSetting(GameSetting.acceptInvite,
true)==false||data.ri.aid==Constant.ASSET_ID.CHIP)return;if(this.isJoiningRoom)return;var currentScene=MH.currentPage();if(currentScene!="playslot")MH.hasInvited(data);else;};this.onJoinRoom=function(roomInfo){cc.Global.gameId=roomInfo.gid;if(HostConfig.currentServer.id!==roomInfo.sid){cc.log("****** change server khi vao room # serverID");PlayerMe.roomInfoReconnect=roomInfo;LobbyClient.getInstance().changeServerAndJoinGame(roomInfo.sid);return}var joinRoomMsg=[command.JOINROOM,roomInfo[Constant.ROOM.ZONE_NAME],
roomInfo[Constant.ROOM.ROOM_ID],""];cc.log("\u0110ang v\u00e0o ph\u00f2ng "+JSON.stringify(roomInfo));LoadingDialog.getInstance().show("\u0110ang v\u00e0o ph\u00f2ng...");this.isJoiningRoom=true;LobbyClient.getInstance().send(joinRoomMsg)};this._onBroastCast=function(command,data){cc.log(command+" _onBroastCast \x3d\x3e "+JSON.stringify(data));var jObj=data[1];LoginData.broastCastArr=jObj.bcm;LoginData.unreadMsg=jObj.ur;LoginData.newAnnounceMsg=jObj.na;MH.hasNewMessage(LoginData.unreadMsg);MH.hasNewNotify(LoginData.newAnnounceMsg);
MH.marquee.append(LoginData.broastCastArr)};this.onPlayGame=function(dataGame){PlayerMe.roomInfoReconnect=null};this.quitRoom=function(idle){if(idle)this.resonQuit=REASON_QUIT.IDLE;var sendObj=[command.LeaveRoom,Constant.CONSTANT.ZONE_NAME,this._currentRoomID];this.send(sendObj)};this.quitRoomGameChan=function(resonQuit){if(resonQuit)this.resonQuit=resonQuit;var sendObj=[command.LeaveRoom,Constant.CONSTANT.ZONE_NAME,this._currentRoomID];this.send(sendObj)};this.onUpdateMoney=function(){var sendObj=
[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":310}];this.send(sendObj)};this._onFetchConfig=function(cmd,data){LoginData.paygateData=data;if(!data||!data["data"])return;var dataSms=data["data"].sms;if(dataSms&&dataSms.length>0)for(var i=0;i<dataSms.length;i++){var sms=dataSms[i];if(sms["name"]=="SMS_Active"){var telcoId=sms["telcoId"];var syntax=sms["syntax"].replace("%userId%",PlayerMe.id);syntax+=" g\u1eedi "+sms["number"];LoginData.smsActive[telcoId.toString()]=
syntax}}var currentScene=MH.currentPage();if(!PlayerMe.phoneVerify&&PlayerMe.displayName&&currentScene=="home")this._showKichHoatSuggest()};this._onFetchAllCashoutItems=function(cmd,data){LoginData.paygateRewardData=data};this.loadReward=function(){if(!LoginData.paygateRewardData){var request={command:"fetchAllCashoutItems"};this.httpRequest(HostConfig.services.paygate,request)}if(!LoginData.paygateData){var request={command:"fetchConfig"};this.httpRequest(HostConfig.services.paygate,request)}cc.log("begin----------");
MyRequest.fetchAllCashoutItems(function(cmd,data){cc.log("fetchAllCashoutItems "+JSON.stringify(data))})};this.getCurrentRoomId=function(){return this._currentRoomID};this.setGameState=function(gs){this._gameState=gs};this.changeServerAndJoinGame=function(serverId){this.close();cc.log(" changeServerAndJoinGame........... ");LobbyClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.CHANGE_SERVER_SPECIFC,serverId)};this.changeServerAndLoginAgain=function(){this.close();
LoadingDialog.getInstance().show("M\u1ea5t k\u1ebft n\u1ed1i .\u0110ang k\u1ebft n\u1ed1i l\u1ea1i");LobbyClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.CHANGE_RADOM_SERVER)};this.reConnect=function(){this.close();cc.log(" reConnecting........... ");LoadingDialog.getInstance().show("M\u1ea5t k\u1ebft n\u1ed1i .\u0110ang k\u1ebft n\u1ed1i l\u1ea1i");LobbyClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.RECONNECT);
this._isReconnecting=true};this.reConnectDone=function(data){if(!this._isReconnecting)return;this._isReconnecting=false;LoadingDialog.getInstance().hide();MH.loadingDialog.hide();cc.log("reConnectDone ****** "+PlayerMe.roomInfoReconnect);MH.header.change("logged");if(PlayerMe.roomInfoReconnect){cc.log("reConnectDone ****** vao lai room");var roomInfo=PlayerMe.roomInfoReconnect;this.onJoinRoom(roomInfo)}else{cc.log("reConnectDone ****** player dang view hoac ngoi` nhung ko bet trong xoc dia, hoac dang view trong cac game bai # thi cho ra lobby");
if(cc.Global.gameId<=0)return;this.gotoLobby();MH.createPopup("B\u1ea1n v\u1eeba m\u1ea5t k\u1ebft n\u1ed1i. H\u1ec7 th\u1ed1ng v\u1eeba t\u1ef1 k\u1ebft n\u1ed1i l\u1ea1i")}};this.loadWithAccessToken=function(url,callback){var token=LoginData.signatureData.data.accessToken;var request=cc.loader.getXMLHttpRequest();request.open("GET",url,true);request.setRequestHeader("Content-Type","application/json;charset\x3dUTF-8");request.onreadystatechange=function(){if(request.readyState==4){var httpStatus=
request.statusText;cc.log("loadWithAccessToken response: "+request.response)}};request.send()};this.login=function(name,pass,handlerLoginDone,handlerLoginFail){this.handlerLoginDone=handlerLoginDone;this.handlerLoginFail=handlerLoginFail;cc.Global.loginType=LoginType.Normal;cc.Global.SetSetting(USER,name);cc.Global.SetSetting(PASS,pass);LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");LobbyClient.getInstance().connect(name,pass,LoginType.Normal,Constant.CONNECT_TYPE.NORMAL)},
this.loginFBHandler=function(handlerLoginDone,handlerLoginFail){this.handlerLoginDone=handlerLoginDone;this.handlerLoginFail=handlerLoginFail;var thiz=this;LobbyClient.getInstance().clickLoginBtn=true;this.loginType=LoginType.FB;LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp FB");FB.getLoginStatus(function(response){if(response.status==="not_authorized"){LobbyClient.getInstance().isNotAuthenFB=true;console.log("..Lobby FB::not_authorized")}});FB.login(function(response){if(response.authResponse){cc.log("LobbyClient \x3d\x3e Welcome!  Fetching your information.... ");
FB.api("/me",function(response){cc.log("Good to see you, "+response.name+".");cc.log("Good to see you, api/me "+Utils.encode(response));FB.getLoginStatus(function(response){thiz.statusChangeCallback(response)})})}else{cc.log("User cancelled login or did not fully authorize.");LoadingDialog.getInstance().hide()}})};this.statusChangeCallback=function(response){if(response.status==="connected"){cc.Global.loginType=LoginType.FB;cc.Global.fbLoginToken=response.authResponse.accessToken;LoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp FB");
LobbyClient.getInstance().connect(cc.Global.fbLoginToken,"",LoginType.FB,Constant.CONNECT_TYPE.NORMAL);if(LobbyClient.getInstance().isNotAuthenFB){LobbyClient.getInstance().isNotAuthenFB=false;console.log("Lobby FB::connected 1st time");if(typeof fbq==="function")fbq("track","CompleteRegistration");if(typeof ga==="function")ga("send","event","Registration","FBRegistration","Registration Campaign",1)}}else if(response.status==="not_authorized"){LoadingDialog.getInstance().hide();LobbyClient.getInstance().isNotAuthenFB=
true}else LoadingDialog.getInstance().hide()};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();var reason_v52=reason_v52||{};reason_v52.UNKNOWN=1;reason_v52.KICKED=2;reason_v52.LOGOUT=3;reason_v52.KICK_LOGIN_OTHER_DEVICE=4;reason_v52.KICK_IDLE=5;var SLOT_GAME_MINI=SLOT_GAME_MINI||{TAI_XIU:100,MINI_POKER:199,DICEDICE:205,TRUNG_PHUC_SINH:202,DEADORALIVE:215,GOLDENMONKEY:217,SIEUXE:218,DAOCA:2050,TAM_GIOI:212,THAN_DEN:2170};
var SLOT_GAME_MINI_ARR=SLOT_GAME_MINI_ARR||[SLOT_GAME_MINI.MINI_POKER,SLOT_GAME_MINI.TAM_GIOI,SLOT_GAME_MINI.DICEDICE,SLOT_GAME_MINI.TRUNG_PHUC_SINH,SLOT_GAME_MINI.DEADORALIVE,SLOT_GAME_MINI.SIEUXE];var CMD_OBSERVER=CMD_OBSERVER||{OBSERVER_TAI_XIU:1005,OBSERVER_POKER:1101,OBSERVER_SLOT:1300,OBSERVER_SLOT_REMOVE:1301,OBSERVER_SLOT_CHAT:1308,OBSERVER_SLOT_RECONNECT:"OBSERVER_SLOT_RECONNECT"};
var CMD_TAI_XIU=CMD_TAI_XIU||{GET_INFO_PHIEN:1007,GET_HISTORY_BET:1009,BETTING_DONE:1E3,ENABLE_BETTING:1002,CHARGE_MONEY:1004,UPDATE_BETTING:1008,BETTING_ALL:1012,CHAT:1011};var CMD_SLOT_MACHINE=CMD_SLOT_MACHINE||{GET_HU:1300,SPIN:1302,JACKPOT:1304,AUTOSPIN_ON:1303,AUTOSPIN_OFF:1305,SPIN_TRIAL:1307,X2_GAME:1306,FINISH_X2_GAME:1309};var miniGamePlugin=miniGamePlugin||{PLUGIN_TAI_XIU:"taixiuPlugin",PLUGIN_SLOT_GAME:"slotMachinePlugin"};
var MiniGameClient=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else{var thiz=this;this.obServerData=[];this.allListener={};this.zoneName=Constant.CONSTANT.ZONE_NAME_MINI_GAME;this.pluginName=Constant.PLUGIN_TAI_XIU;this.lobbySocket=new socket.LobbyClient(this.zoneName);this.lobbySocket.onEvent=function(messageName,data){thiz.onEvent(messageName,data)};this.isLogin=false;this.clickLoginBtn=false;this.host=
"ws://125.212.192.97";this.port=-1;this.addListener("LobbyStatus",this._onLobbyStatus,this);this.addListener(kCMD.LOGIN,this._onLogInRes,this);this.addListener(kCMD.LOGOUT,this._onLogOutRes,this);this.addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.addListener(CMD_OBSERVER.OBSERVER_SLOT.toString(),this.onObserverResponse,this);this.addListener("fetchConfig",this._onFetchConfig,this);this.addListener("fetchAllCashoutItems",this._onFetchAllCashoutItems,this)}};this._onBroastCast=
function(command,data){cc.log(command+" _onBroastCast \x3d\x3e "+JSON.stringify(data));var jObj=data[1];LoginData.broastCastArr=jObj.bcm;LoginData.unreadMsg=jObj.ur;LoginData.newAnnounceMsg=jObj.na;MH.hasNewMessage(LoginData.unreadMsg);MH.hasNewNotify(LoginData.newAnnounceMsg);MH.marquee.append(LoginData.broastCastArr)};this._onBroastCastTivi=function(command,data){cc.log(command+" _onBroastCast \x3d\x3e "+JSON.stringify(data));var jObj=data[1];if(jObj.mgs&&jObj.mgs.length>0)if(MH.marquee.prepend)MH.marquee.prepend([jObj.mgs.formatTivi(jObj.params)])};
this.testLostConnection=function(){this.lobbySocket.setSocketStatus(socket.LobbySocket.LostConnection)};this.obServerAllMiniGame=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_OBSERVER.OBSERVER_TAI_XIU}];this.send(sendObj);sendObj=[command.ZonePluginMessage,this.zoneName,"lobbyPlugin",{"cmd":10001}];this.send(sendObj)};this.removeObserverByGameID=function(slotGameId){var sendObj=[command.ZonePluginMessage,this.zoneName,miniGamePlugin.PLUGIN_SLOT_GAME,
{"cmd":CMD_OBSERVER.OBSERVER_SLOT_REMOVE,"gid":slotGameId}];cc.log("removeObserverByGameID send "+JSON.stringify(sendObj));this.send(sendObj)};this.observerByGameID=function(slotGameId){var sendObj=[command.ZonePluginMessage,this.zoneName,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_OBSERVER.OBSERVER_SLOT,"gid":slotGameId}];cc.log("observerByGameID send "+JSON.stringify(sendObj));this.send(sendObj)};this.send=function(message){if(this.lobbySocket)this.lobbySocket.send(JSON.stringify(message))};this.close=
function(){this.isReconnected=false;if(this.lobbySocket)this.lobbySocket.close()};this.connectTo=function(host,port){if(this.lobbySocket){this.isLogined=false;this.isKicked=false;this.lobbySocket.connect(host)}};this.onEvent=function(messageName,data){if(messageName=="ping")this.postEvent("ping",data);else if(messageName=="socketStatus")this.postEvent("LobbyStatus",data);else if(messageName=="message"){var messageData=JSON.parse(data);var _command=messageData[0];if(_command===command.RoomPluginMessage)this.postEvent(messageData[0].toString(),
messageData);else this.postEvent(messageData[0].toString(),messageData)}};this.prePostEvent=function(command,event){};this.onLoginEvent=function(event){};this.postEvent=function(command,event){var arr=this.allListener[command];if(arr){this.isBlocked=true;for(var i=0;i<arr.length;){var target=arr[i];if(target)target.listener.apply(target.target,[command,event]);else{arr.splice(i,1);continue}i++}this.isBlocked=false}};this.addListener=function(command,_listener,_target){var arr=this.allListener[command];
if(!arr){arr=[];this.allListener[command]=arr}for(var i=0;i<arr.length;i++)if(arr[i]&&arr[i].target==_target)return;arr.push({listener:_listener,target:_target})};this.removeListener=function(target){for(var key in this.allListener){if(!this.allListener.hasOwnProperty(key))continue;var arr=this.allListener[key];for(var i=0;i<arr.length;){if(arr[i]&&arr[i].target==target)if(this.isBlocked)arr[i]=null;else{arr.splice(i,1);continue}i++}}};this.isLoginDone=function(){return this.isLogin};this.connect=
function(user,pass,loginType,connectType,serverId){this.isLogin=false;if(!serverId)serverId=-1;var thiz=this;if(user)this.username=user;if(pass)this.password=pass;if(loginType>-1)this.loginType=loginType;if(HostConfig.miniGameServer.length<=0)console.log("ko co thong tin minigame server, LobbyClinet da load config chua???");else{var server=this.getServer(connectType,serverId);if(server["wsEndpoint"])this.connectTo(server["wsEndpoint"]);else if(server["host"])this.connectTo("ws://"+server["host"]+
"/websocket");HostConfig.currentServerMiniGame=server}};this.httpRequest=function(url,params,callback){var header={};if(this._accessToken)header.Authorization=this._accessToken;var thiz=this;HttpRequest.requestGETMethod(url,header,params,function(status,response){if(response&&response.status==500){if(thiz._refreshToken)thiz._sendRequestRefreshToken(function(status){if(status==0)thiz.httpRequest(url,params,callback);else cc.log("khong refresh dc token")})}else if(callback)callback(status,response);
else thiz.postEvent(params.command,response)})};this._sendRequestRefreshToken=function(callback){var params={command:"refreshToken",refreshToken:this._refreshToken};var thiz=this;HttpRequest.requestGETMethod(HostConfig.services.id,header,params,function(status,response){if(response){if(response.status==0)thiz._accessToken=response.data.accessToken;else thiz._accessToken=null;callback(response.status)}else callback(-1)})};this.loadDistributor=function(callback){var thiz=this;cc.Global.verifyTest();
if(Distributor.distId&&Distributor.applicationId){MiniGameClient.getInstance().loadConfig();thiz._loadConfig=true;if(!hiepnh.isUndefined(callback))callback();return}cc.log("\u0110ang T\u1ea3i c\u1ea5u h\u00ecnh game");var link=ServerConfig.getLinkDistributor();var thiz=this;var param={command:"regdis",bundle:BUNDLE,appName:APPNAME};HttpRequest.requestGETMethod(link,null,param,function(status,response){if(status==HttpRequest.RES_SUCCESS&&response){var status=response.status;console.log("loadDistributor response "+
JSON.stringify(response));if(status!=Constant.STATUS.SUCCESS){setTimeout(function(){MiniGameClient.getInstance().loadDistributor()},1E3);return}var data=response.data;Distributor.distId=data.distId;Distributor.applicationId=data.applicationId;MiniGameClient.getInstance().loadConfig();thiz._loadConfig=true;if(!hiepnh.isUndefined(callback))callback()}else setTimeout(function(){MiniGameClient.getInstance().loadDistributor()},1E3)})};this.loadConfig=function(callback){if(callback===undefined)callback=
null;var url=ServerConfig.getLinkACS(Distributor.distId,Distributor.applicationId);var thiz=this;var version=VERSION_ID_TEST;var plalform=PLATFORM_ID_TEST;if(!cc.Global.GetSetting("test"+APPNAME,false)){version=VERSION_ID;plalform=PLATFORM_ID}if(!Distributor.applicationId||!Distributor.distId){this.loadDistributor();return}var params={command:"get-bid",distId:Distributor.distId,versionId:version,platformId:plalform,appId:Distributor.applicationId};HttpRequest.requestGETMethod(url,null,params,function(status,
response){if(status==HttpRequest.RES_SUCCESS&&response){var status=response.status;if(status!=0){if(callback!=null){console.log("Kh\u00f4ng th\u1ec3 t\u1ea3i th\u00f4ng tin c\u1ea5u h\u00ecnh game");setTimeout(function(){MiniGameClient.getInstance().loadConfig()},1E3)}return}var data=response.data;var servers=data.config.servers;if(USE_TEST_SERVER)for(var i=servers.length-1;i>=0;i--)if(VIP52_IP_REJECT.indexOf(servers[i].ip)!=-1)servers.splice(i,1);var replace=BASE_URL_TEST;if(!cc.Global.GetSetting("test",
false))replace=BASE_URL;HostConfig.ctconfig=data.config;HostConfig.servers=servers;HostConfig.services=data.config.services;HostConfig.services.sa=HostConfig.services.sa.replace("http://sandbox.api1bai247.info",replace);HostConfig.services.id=HostConfig.services.id.replace("http://sandbox.api1bai247.info",replace);HostConfig.services.paygate=HostConfig.services.paygate.replace("http://sandbox.api1bai247.info",replace);HostConfig.miniGameServer=data.config.miniGameServer;HostConfig.miniGameServer=
data.config.miniGameServer;cc.log("set------- HostConfig.slotGames "+JSON.stringify(data));cc.log("loadConfig \x3d\x3e "+JSON.stringify(data));MiniGameClient.getInstance().postEvent(kCMD.CONFIG_SUCCESS,{});var _info=window.btoa(JSON.stringify(HostConfig.miniGameServer));MH.setCookie("miniGameServer",_info,100);var _infoServices=window.btoa(JSON.stringify(HostConfig.services));MH.setCookie("_infoServices",_infoServices,100);if(callback!=null)callback()}else{if(callback!=null)console.log("Kh\u00f4ng th\u1ec3 t\u1ea3i th\u00f4ng tin c\u1ea5u h\u00ecnh game");
setTimeout(function(){MiniGameClient.getInstance().loadConfig()},1E3)}})};this.getServer=function(connectType,serverId){if(!serverId)serverId=-1;var server=cc.Global.getRandomServerMiniGame();switch(connectType){case Constant.CONNECT_TYPE.NORMAL:server=cc.Global.getRandomServerMiniGame();break;case Constant.CONNECT_TYPE.RECONNECT:server=HostConfig.currentServerMiniGame;break;case Constant.CONNECT_TYPE.CHANGE_RADOM_SERVER:server=cc.Global.getRandomServerMiniGame();this.numberRetry=1;break}HostConfig.currentServerMiniGame=
server;return server};this.authenGameServer=function(user,pass,connectType){if(!connectType)connectType=Constant.CONNECT_TYPE.NORMAL;var signature=LoginData.signatureData.data.signature;var info=LoginData.signatureData.data.info;var loginSend=[command.LOGIN,this.zoneName,user,pass,{signature:LoginData.signatureData.data.signature,info:LoginData.signatureData.data.info,pid:Constant.CONSTANT.PLATFORM}];var msg=loginSend;console.log("authen send "+JSON.stringify(msg));this.send(msg)};this._onLobbyStatus=
function(command,event){if(event==="Connected"){cc.log("_onLobbyStatus "+event);cc.log("MiniGameClient:: command "+command+" event "+event);var thiz=this;var param={command:"login2",username:this.username,password:this.password,platformId:4};if(this.loginType==LoginType.FB){if(!cc.Global.fbLoginToken||cc.Global.fbLoginToken.length==0){cc.log("fb chua lay dc token return");MiniGameClient.getInstance().hide();return}param={command:"loginFacebook",fbAccessToken:cc.Global.fbLoginToken,platformId:4,os:"web"}}if(0&&
MH.getCookie("_signatureData")){var info=window.atob(MH.getCookie("_signatureData"));LoginData.signatureData=JSON.parse(info);if(LoginData.signatureData&&LoginData.signatureData.data){var userName=LoginData.signatureData.data.info.username;if(!thiz.username||thiz.username.length==0||thiz.loginType==LoginType.FB||thiz.username&&thiz.username.length>0&&thiz.username==userName){thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;PlayerMe.security=
LoginData.signatureData.data.otp;cc.log("-----------SEASION AUTO LOGIN-----------");thiz.authenGameServer("","");return}cc.log("-----------SEASION AUTO LOGIN-----------");thiz.authenGameServer("","");return}}thiz._accessToken=null;thiz._refreshToken=null;if(LobbyClient.getInstance().isLoginDone()){thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;thiz.authenGameServer(thiz.username,thiz.password);console.log("login minigame without send login2");
return}console.log("login minigame with send login2");HttpRequest.requestGETMethod(HostConfig.services.id,null,param,function(status,response){if(status==HttpRequest.RES_SUCCESS&&response){console.log("_onLobbyStatus : response login HttpRequest "+JSON.stringify(response));thiz.pwdEncryptedAES="";var status=response.status;PlayerMe.security=response.data.otp;if(status!=Constant.STATUS.SUCCESS){MiniGameLoadingDialog.getInstance().hide();if(status==Constant.STATUS.USE_OTP){LoginData.signatureData=response;
thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;MH.openLoginOTP()}else if(thiz.handlerLoginFail){var msg=response.data.message;if(!msg)msg="L\u1ed7i! Vui l\u00f2ng th\u1eed l\u1ea1i ho\u1eb7c li\u00ean h\u1ec7 qu\u1ea3n tr\u1ecb vi\u00ean";thiz.handlerLoginFail(msg);thiz.handlerLoginFail=null}return}LoginData.signatureData=response;thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;
thiz.authenGameServer(thiz.username,thiz.password)}else{MiniGameLoadingDialog.getInstance().hide();MH.createPopup({title:"",width:"600px",content:[{tag:"p",text:"\u0110\u0103ng nh\u1eadp th\u1ea5t b\u1ea1i"}]})}})}else if(event=="LostConnection"){MH.popup.close("all");cc.log("MiniGameClient:: command "+command+" event "+event);cc.log(" reConnect \x3d\x3e LostConnection");this.reConnect()}else if(event=="ConnectFailure"){MH.popup.close("all");cc.log("MiniGameClient:: command "+command+" event "+event);
this.close();var currentScene=MH.currentPage();if(currentScene=="home"){if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show("\u0110ang k\u1ebft n\u1ed1i l\u1ea1i");MiniGameClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.NORMAL)}else MiniGameLoadingDialog.getInstance().showReconnect()}};this.isClickLogin=function(){return this.clickLoginBtn};this._onLogInRes=function(command,data){cc.log(command+" _onLogInRes mini game \x3d\x3e "+JSON.stringify(data));
var isSuccess=data[1];var errorStr=data[5];MiniGameLoadingDialog.getInstance().hide();if(!isSuccess){if(this.handlerLoginFail){this.handlerLoginFail(errorStr);this.handlerLoginFail=null}return}this.obServerAllMiniGame();this.isLogin=true;this.loadReward();this.onUpdateMoney();MH.minigame.login();this.postEvent(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,{});TopHuClient.getInstance().logOut()};this.logOut=function(){console.log("CALL LOG OUT MINIGAME");MiniGameClient.getInstance().close();this.isLogin=false;
this.obServerData=[];MH.minigame.logout();LoginData.paygateData=null;LoginData.smsActive={};LoginData.broastCastArr=[];LoginData.unreadMsg=0;LoginData.newAnnounceMsg=0};this._onLogOutRes=function(command,data){console.log("CALL LOG OUT "+data[1]+" reason "+data[2]);cc.log(command+" minigame _onLogOutRes \x3d\x3e "+JSON.stringify(data));if(data[1]){this.logOut();var reason=data[2];var msg="";switch(reason){case reason_v52.KICK_IDLE:msg="B\u1ea1n tho\u00e1t do kh\u00f4ng thao t\u00e1c trong 1 th\u1eddi gian d\u00e0i";
break;case reason_v52.KICK_LOGIN_OTHER_DEVICE:msg="B\u1ea1n tho\u00e1t do c\u00f3 ng\u01b0\u1eddi \u0111\u0103ng nh\u1eadp v\u00e0o t\u00e0i kho\u1ea3n c\u1ee7a b\u1ea1n";break;case reason_v52.LOGOUT:msg="";break;case reason_v52.KICKED:msg="B\u1ea1n b\u1ecb kick kh\u1ecfi h\u1ec7 th\u1ed1ng";break;default:msg="T\u00e0i kho\u1ea3n b\u1ecb \u0111\u0103ng xu\u1ea5t ra ngo\u00e0i";break}if(msg&&msg.length){cc.log("MiniGame \x3d\x3e "+msg);if(!cc.isClientGameBai())MH.createPopup({title:"\u0110\u0103ng xu\u1ea5t",
width:"600px",content:[{tag:"p",text:msg}]})}}};this._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd===1E4)TopHuClient.getInstance().postEvent(cmd.toString(),dataObj);else if(cmd===104)this._onBroastCast(command,dataObj);else if(cmd===10){cc.log("minigame new MSG----- "+JSON.stringify(dataObj));this._onBroastCastTivi(command,dataObj)}else if(cmd===100){cc.log("cmd 100 minigame ----------");this.updateUserInfo(dataObj);this._onUserInfo(command,dataObj);this.reConnectDone(dataObj[1]);
if(this.handlerLoginDone){this.handlerLoginDone();this.handlerLoginDone=null}}else if(cmd===310){var info=dataObj[1].As;var gold=info.gold;var chip=info.chip;var vip=info.vip;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;PlayerMe.moneySafe=info.safe;this.postEvent(kCMD.UPDATE_MONEY,dataObj[1]);cc.log("post event");MH.user.reload()}else this.postEvent(cmd.toString(),dataObj)};this.onObserverResponse=function(command,dataObj){cc.log("onObserverResponse "+JSON.stringify(dataObj));var data=dataObj[1];
var gameId=data.gid;this.obServerData[gameId]=data;MiniGameClient.getInstance().postEvent(kCMD.OBSERVER_RESPONSE,{})};this.getObserverDataByGameId=function(gId){if(!this.obServerData||!this.obServerData.length){cc.log("chua co data ");return}return this.obServerData[gId]};this.resetObserverDataByGameId=function(gId){if(!this.obServerData||!this.obServerData.length){cc.log("chua co data ");return}this.obServerData[gId]=null};this.changeServerAndJoinGame=function(serverId){this.close();cc.log(" changeServerAndJoinGame........... ");
MiniGameClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.CHANGE_SERVER_SPECIFC,serverId)};this.reConnect=function(){this.close();cc.log(" reConnecting........... ");if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show("M\u1ea5t k\u1ebft n\u1ed1i .\u0110ang k\u1ebft n\u1ed1i l\u1ea1i");MiniGameClient.getInstance().connect(this.username,this.password,this.loginType,Constant.CONNECT_TYPE.RECONNECT);this._isReconnecting=true};this.reConnectDone=
function(data){if(!this._isReconnecting)return;this._isReconnecting=false;MiniGameLoadingDialog.getInstance().hide();cc.log("reConnectDone ****** "+PlayerMe.roomInfoReconnect);MH.header.change("logged");if(!cc.isClientGameBai())MH.createPopup({title:"K\u1ebft n\u1ed1i l\u1ea1i",width:"600px",content:[{tag:"p",text:JSON.stringify("B\u1ea1n v\u1eeba m\u1ea5t k\u1ebft n\u1ed1i. H\u1ec7 th\u1ed1ng v\u1eeba t\u1ef1 k\u1ebft n\u1ed1i l\u1ea1i")}]})};this.updateUserInfo=function(data){console.log("Mng updateUserInfo",
data);var jObj=data[1];LoginData.userinfo=jObj;var uid=jObj.uid;var avatar=jObj.a;var info=jObj.As;var gold=info.gold;var chip=info.chip;var vip=info.vip;var safe=info.safe;var playerName=jObj.u;var gender=jObj.g;var phone=jObj.ph;var phoneVerify=jObj.pvr;var broastCastArr=jObj.bcm;var id=jObj.id;var displayName=jObj.dn;var lastRoom=jObj.lr;var kichhoat=jObj.am;LoginData.broastCastArr=broastCastArr;PlayerMe.id=id;PlayerMe.uid=uid;PlayerMe.avatar=avatar;PlayerMe.username=playerName;PlayerMe.displayName=
displayName;PlayerMe.gold=gold;PlayerMe.chip=chip;PlayerMe.vip=vip;PlayerMe.gender=gender;PlayerMe.phone=phone;PlayerMe.phoneVerify=phoneVerify;if(kichhoat)PlayerMe.kichhoat=kichhoat;PlayerMe.moneySafe=safe};this._onUserInfo=function(command,data){cc.log(command+"MiniGame _onUserInfo \x3d\x3e "+JSON.stringify(data));var jObj=data[1];var phoneVerify=jObj.pvr;var kichhoat=jObj.am;var displayName=jObj.dn;if(!phoneVerify&&displayName&&kichhoat&&kichhoat.length){cc.log("pending show dialog active sdt");
MH.createPopup({title:"",width:"600px",delay:1200,content:[{tag:"p",text:kichhoat}]});this.loadReward()}else if(!displayName||displayName.length===0){cc.log("pending show dialog UPDATE ten hien thi");MH.updateDPN.open();this.loadReward()}else{cc.log("normal login ***************");this.onUpdateMoney();this.loadReward()}if(MH.currentPage("home"))MiniGameLoadingDialog.getInstance().hide()};this.loadWithAccessToken=function(url,callback){var token=LoginData.signatureData.data.accessToken;var request=
cc.loader.getXMLHttpRequest();request.open("GET",url,true);request.setRequestHeader("Content-Type","application/json;charset\x3dUTF-8");request.onreadystatechange=function(){if(request.readyState==4){var httpStatus=request.statusText;cc.log("loadWithAccessToken response: "+request.response)}};request.send()};this.login=function(name,pass,handlerLoginDone,handlerLoginFail){console.log("call login minigame");this.handlerLoginDone=handlerLoginDone;this.handlerLoginFail=handlerLoginFail;cc.Global.loginType=
LoginType.Normal;cc.Global.SetSetting(USER,name);cc.Global.SetSetting(PASS,pass);if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp");MiniGameClient.getInstance().connect(name,pass,LoginType.Normal,Constant.CONNECT_TYPE.NORMAL)},this.login2=function(handlerLoginDone,handlerLoginFail){if(LobbyClient.getInstance().isLoginDone()){this.handlerLoginDone=handlerLoginDone;this.handlerLoginFail=handlerLoginFail;cc.Global.loginType=LoginType.Normal;MiniGameClient.getInstance().connect(LobbyClient.getInstance().username,
LobbyClient.getInstance().password,LoginType.Normal,Constant.CONNECT_TYPE.NORMAL)}else if(handlerLoginFail)handlerLoginFail()};this.loginFBHandler=function(handlerLoginDone,handlerLoginFail){this.handlerLoginDone=handlerLoginDone;this.handlerLoginFail=handlerLoginFail;var thiz=this;MiniGameClient.getInstance().clickLoginBtn=true;this.loginType=LoginType.FB;if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show("\u0110ang \u0111\u0103ng nh\u1eadp FB");FB.login(function(response){if(response.authResponse){cc.log("MiniGameClient \x3d\x3e Welcome!  Fetching your information.... ");
FB.api("/me",function(response){cc.log("Good to see you, "+response.name+".");cc.log("Good to see you, api/me "+Utils.encode(response));FB.getLoginStatus(function(response){thiz.statusChangeCallback(response)})})}else{cc.log("User cancelled login or did not fully authorize.");MiniGameLoadingDialog.getInstance().hide()}})};this.statusChangeCallback=function(response){cc.log("FB statusChangeCallback "+JSON.stringify(response));if(response.status==="connected"){cc.Global.loginType=LoginType.FB;cc.Global.fbLoginToken=
response.authResponse.accessToken;MiniGameClient.getInstance().connect(cc.Global.fbLoginToken,"",LoginType.FB,Constant.CONNECT_TYPE.NORMAL);if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show()}else if(response.status==="not_authorized"){if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show()}else if(!cc.isClientGameBai())MiniGameLoadingDialog.getInstance().show()};this.onUpdateMoney=function(){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,
"channelPlugin",{"cmd":310}];this.send(sendObj);cc.log("send onUpdateMoney "+JSON.stringify(sendObj))};this.verifyOtpLoginDoneThenAuthenAcc=function(response){var thiz=this;LoginData.signatureData=response;thiz._accessToken=LoginData.signatureData.data.accessToken;thiz._refreshToken=LoginData.signatureData.data.refreshToken;var _signatureData=window.btoa(JSON.stringify(LoginData.signatureData));MH.setCookie("_signatureData",_signatureData,1);thiz.authenGameServer(thiz.username,thiz.password)};this._showKichHoatSuggest=
function(){return;if(LoginData.smsActive&&Object.keys(LoginData.smsActive).length){var msgSms="So\u1ea1n tin nh\u1eafn theo c\u00fa ph\u00e1p d\u01b0\u1edbi \u0111\u00e2y \u0111\u1ec3 k\u00edch ho\u1ea1t t\u00e0i kho\u1ea3n"+"\x3cbr\x3eViettel: "+LoginData.smsActive["1"]+"\x3cbr\x3eVinaphone: "+LoginData.smsActive["2"]+"\x3cbr\x3eMobiphone: "+LoginData.smsActive["3"];PlayerMe.kichhoat=msgSms;MH.createPopup({title:"",width:"600px",delay:200,content:[{tag:"p",text:msgSms}]})}};this._onFetchConfig=function(cmd,
data){LoginData.paygateData=data;if(!data||!data["data"])return;var dataSms=data["data"].sms;if(dataSms&&dataSms.length>0)for(var i=0;i<dataSms.length;i++){var sms=dataSms[i];if(sms["name"]=="SMS_Active"){var telcoId=sms["telcoId"];var syntax=sms["syntax"].replace("%userId%",PlayerMe.id);LoginData.smsActive[telcoId.toString()]=syntax}}};this._onFetchAllCashoutItems=function(cmd,data){LoginData.paygateRewardData=data};this.loadReward=function(){if(!LoginData.paygateRewardData){var request={command:"fetchAllCashoutItems"};
this.httpRequest(HostConfig.services.paygate,request)}if(!LoginData.paygateData){var request={command:"fetchConfig"};this.httpRequest(HostConfig.services.paygate,request)}MyRequest.fetchAllCashoutItems(function(cmd,data){cc.log("fetchAllCashoutItems "+JSON.stringify(data))})};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();var command={LOGIN:1,LOGOUT:2,JOINROOM:3,LeaveRoom:4,RoomPluginMessage:5,ZonePluginMessage:6,PingMessage:7,PingResponse:6};
var kCMD=kCMD||{LOGIN:"1",LOGOUT:"2",JOINROOM:"3",LeaveRoom:"4",RoomPluginMessage:"5",USER_INFO:"100",CHAT:"102",BROASTCAST:"104",USER_JOIN_OUT:"200",ROOM_INFO:"202",ROOM_MASTER_CHANGE:"203",DEAL_CARD:"250",CHANGE_TURN:"251",TOI_TRANG:"252",DANH_BAI:"253",REJECT_TURN:"254",ERROR:"1",KICK_PLAYER:"3",PLAYER_READY:"5",LIST_ROOM:"300",LIST_INVITE:"303",SEND_INVITE:"304",RECEIVE_INVITE:"305",OBSERVER_INVITE:"306",FAST_PLAY:"307",JOIN_ROOM:"308",UPDATE_MONEY:"310",CREATE_TABLE:"311",REGISTER_DONE:"REGISTER_DONE",
REGISTER_FB_DONE:"REGISTER_FB_DONE",DESTROY_GAME:"DESTROY_GAME",PHOM_EARN_CARD:"PHOM_EARN_CARD",RECONNECT_INGAME:"RECONNECT_INGAME",CONFIG_SUCCESS:"CONFIG_SUCCESS",FB_LIBS_SUCCESS:"FB_LIBS_SUCCESS",OBSERVER_RESPONSE:"OBSERVER_RESPONSE",TOP_HU:"10000",CHANGE_LINES_SLOT:"CHANGE_LINES_SLOT",UPDATE_JUST_WIN:"UPDATE_JUST_WIN",LOGOUT_SLOT_MINIGAME:"LOGOUT_SLOT_MINIGAME"};var friendCMD=friendCMD||{IS_FRIEND:350,REQUEST_FRIEND:351,FRIEND_REQUEST_ADD:352,FRIEND_REQUEST_ACCEPT:353,FRIEND_REMOVE:355};
var chatCMD=chatCMD||{LIST_CHANNEL:360,SEND_MESSAGE:361};var phatlocCMD=phatlocCMD||{OBSERVER:1400,REMOVE_OBSERVER:1401,BEGIN_GIVEAWAY:1402,BEGIN_GET_GIVEAWAY:1407,MONEY_RANGE:1405,DO_GIVEAWAY:1403,GET_GIVEAWAY:1404,END_GIVEAWAY:1408};var caothapCMD=caothapCMD||{GET_INFO:1500,START_GAME:1501,SPIN:1502,STOP_SPIN:1503,UPDATE_JACKPOT:1504};var wheelCMD=wheelCMD||{REGISTER:7E3,UNREGISTER:7006,GET_HISTORY:7004,GET_TOP:7005,SPIN:7001,UPDATE_JACKPOT:7002};
var baucuaCMD=baucuaCMD||{REGISTER:7500,UNREGISTER:7510,BEGIN_GAME:7501,UPDATE_JACKPOT:7502,ACCEPT_BET:7503,END_GAME:7504,RESULT_GAME:7505,BET_AGAIN:7506,DOUBLE_BET:7507,GET_HISTORY:7508,GET_TOP:7509};var OtpCMD=OtpCMD||{REGISTER:"getOtpCode",UNREGISTER:7510,VERIFY:"verifyCode"};var thiendiaCMD=thiendiaCMD||{REGISTER:1800,START_GAME:1801,SPIN:1802,STOP_SPIN:1803,UPDATE_JACKPOT:1804,UNREGISTER:1805,X2:1806,NHANBAN:1807};var Suit={b:1,t:2,r:3,c:4};var SuitName={1:"b",2:"t",3:"r",4:"c"};var CARD_COMBO={NORMAL:0,DOI:1<<1,N_DOITHONG:1<<2,BO_3:1<<3,TUQUY:1<<4,CHUOI_CARD:1<<5,CARD_2:1<<6,DOI_2:1<<7,NORMAL_BIGGER:1<<8,NOT_NORMAL:1<<9,MAX_DOITHONG:1<<10};var A2_10JQK="NAN,1,2,3,4,5,6,7,8,9,10,11,12,13".split(",");var Types=Types||{};Types.getPointAuto=function(card,gameId){if(gameId==Constant.GAME_ID.SAM)return card.point;else return card.pointTLMN};
Types.Card=function(point,suit){var _p=point;var _pTLMN=point-2<=0?point+13:point;var _pMB=point-1<=0?point+13:point;var _pLieng=point>=10?0:point;var _suit=suit;var _id=(suit-1)*13+(point-1);var _codeCard=suit-1+4*(point-1);var _pointName=A2_10JQK[point];var _suitName=SuitName[suit];var _isCard2=_id===12||_id===25||_id===38||_id===51;return{point:_p,pointTLMN:_pTLMN,pointMB:_pMB,pointLieng:_pLieng,suit:_suit,id:_id,codeCard:_codeCard,pointName:_pointName,suitName:_suitName,isCard2:_isCard2,toString:""+
_pointName+""+_suitName}};var GAME_STATE=GAME_STATE||{};GAME_STATE.WAIT_PLAYER=0;GAME_STATE.CHOOSE_STILT=1;GAME_STATE.CHOOSE_HOST=2;GAME_STATE.CHIA_BAI=3;GAME_STATE.PLAYING=4;GAME_STATE.SHOW_KQ=5;var state_player=state_player||{};state_player.NOTHING=0;state_player.READY=1;state_player.CHON_CAI=2;state_player.BAT_BAO=3;state_player.U=4;state_player.BO_LUOT=5;state_player.HUY_BAO=6;state_player.BAO_SAM=7;state_player.DANG_XEM=8;state_player.DANG_XEP_BINH=9;state_player.XEP_XONG_BINH=10;state_player.AN_CAY_CHOT=19;
state_player.MOM=20;var IDE_GAME_KICK=3;var Utils=Utils||{};Utils.getDeckPointCentre=function(node){var scale=1;var currentScene=cc.director.getRunningScene();if(currentScene.sceneLayer)scale=currentScene.sceneLayer.scale;this.scale=scale;this.deckPoint=node.convertToNodeSpace(cc.p(cc.winSize.width/2,cc.winSize.height-cc.Global.GameView.height*scale/2));return this.deckPoint};Utils.findOne=function(haystack,arr){return arr.some(function(v){return haystack.indexOf(v)>=0})};
Utils.getCardFromServer=function(code){var suit=code%4+1;var point=~~(code/4)+1;var card=Types.Card(point,suit);return card};Utils.getCodeCard=function(point,suit){var codeCard=suit-1+4*(point-1);return codeCard};Utils.getArrCardData=function(cardArray){if(!cardArray||!cardArray.length)return[];var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));return cards};
Utils.getWordPos=function(node){var pos=node.getParent().convertToWorldSpace(node.getPosition());var scale=1;var currentScene=cc.director.getRunningScene();if(currentScene.sceneLayer)scale=currentScene.sceneLayer.scale;var dx=cc.winSize.width/2-cc.Global.GameView.width*scale/2;var dy=cc.winSize.height-cc.Global.GameView.height*scale;pos.x-=dx;pos.y-=dy;return pos},Utils.encode=function(obj){return JSON.stringify(obj)};Utils.decode=function(obj){try{return JSON.parse(obj)}catch(e){return null}return null};
Utils.isCard2=function(num){return num===1||num===14||num===27||num===40};Utils.getTuQuy=function(arrayCard){var results=[];var length=arrayCard.length;for(var i=0;i<length-1;i++){var arrayTuQuy=[];arrayTuQuy.splice(0,arrayTuQuy.length);var card1=arrayCard[i];var cardData1=card1.getCardData();arrayTuQuy.push(card1);for(var j=i+1;j<length;j++){var card2=arrayCard[j];var cardData2=card2.getCardData();if(cardData1.point==cardData2.point)arrayTuQuy.push(card2)}if(arrayTuQuy.length==4)results.push(arrayTuQuy)}return results};
Utils.getDoiThong=function(arrayCard,minDoiThong,gameId){if(!minDoiThong)minDoiThong=3;if(!gameId)gameId=Constant.GAME_ID.TLMN;var results=[];var length=arrayCard.length;for(var i=0;i<length-1;i++){var arrayThong=[];var arrayTemp=[];var arrUse=[];var tempThong=-1;arrayThong.splice(0,arrayThong.length);arrayTemp.splice(0,arrayTemp.length);var card1=arrayCard[i];var cardData1=card1.getCardData();if(Utils.isCard2(cardData1.id))continue;arrayThong.push(card1);arrUse.push(i);tempThong=cardData1.pointTLMN;
for(var j=i+1;j<length;j++){var card2=arrayCard[j];var cardData2=card2.getCardData();if(Utils.isCard2(cardData2.id))continue;if(tempThong==cardData2.pointTLMN){arrayThong.push(card2);arrUse.push(j);if(arrayThong.length%2==0)tempThong++}else;}for(var j=i+1;j<length;j++){var card2=arrayCard[j];var cardData2=card2.getCardData();if(Utils.isCard2(cardData2.id))continue;arrayThong.forEach(function(a,k){if(a.getCardData().pointTLMN==cardData2.pointTLMN)if(arrUse.length&&arrUse.indexOf(j)==-1){arrayTemp.push(card2);
arrUse.push(j)}})}if(arrayThong.length>=minDoiThong*2){while(arrayThong.length%2==1)arrayThong.pop();if(arrayTemp.length)arrayThong=arrayThong.concat(arrayTemp);results.push(arrayThong)}}return results};
Utils.isDoiThong=function(cardsDeaded){var _pointTLMN=-1;var isDoiThong=true;var suit=-1;var maxPoint=-1;for(var i=0;i<cardsDeaded.length;i+=2){var cId=cardsDeaded[i];var cardComponent=Utils.getCardFromServer(cId);suit=cardComponent.suit;if(maxPoint<cardComponent.pointTLMN)maxPoint=cardComponent.pointTLMN;if(_pointTLMN<0)_pointTLMN=cardComponent.pointTLMN;else if(_pointTLMN==cardComponent.pointTLMN-1)_pointTLMN++;else isDoiThong=false}return[isDoiThong,cardsDeaded.length,maxPoint,suit]};
Utils.isDoiThongArray=function(cardsArr){if(!cardsArr||!cardsArr.length)return[false,0,-1,1];var isDoiThong=true;for(var i=0;i<cardsArr.length;i++){var cardComponent=cardsArr[i];var comboID=cardComponent.getCardComboIdBitWise();var check=comboID&&CARD_COMBO.N_DOITHONG;if(check===0){isDoiThong=false;break}}var pointCheck=cardsArr[0].getCardData().pointTLMN;if(cardsArr.length>=2&&cardsArr.length%2==0)for(i=0;i<cardsArr.length-1;i+=2){var pointCheck1=cardsArr[i].getCardData().pointTLMN;var pointCheck2=
cardsArr[i+1].getCardData().pointTLMN;if(pointCheck1!=pointCheck2){isDoiThong=false;break}}else isDoiThong=false;var suit=cardsArr[cardsArr.length-1].getCardData().suit;var maxPoint=cardsArr[cardsArr.length-1].getCardData().pointTLMN;return[isDoiThong,cardsArr.length,maxPoint,suit]};
Utils.isSeqCard=function(cardsDeaded,gameId){var _pointTLMN=-1;var isSeq=true;var suit=-1;var maxPoint=-1;var seqTLMN=true;cardsDeaded.forEach(function(cId,i){var cardComponent=Utils.getCardFromServer(cId);suit=cardComponent.suit;if(maxPoint<cardComponent.pointTLMN)maxPoint=cardComponent.pointTLMN;if(_pointTLMN<0)_pointTLMN=cardComponent.pointTLMN;else if(_pointTLMN==cardComponent.pointTLMN-1&&!Utils.isCard2(cardComponent.id))_pointTLMN++;else{isSeq=false;seqTLMN=false}});if(!isSeq&&gameId==Constant.GAME_ID.SAM){var _point=
-1;isSeq=true;suit=-1;maxPoint=-1;var temCards=cardsDeaded;temCards.sort(function(a,b){return a-b});temCards.forEach(function(cId,i){var cardComponent=Utils.getCardFromServer(cId);suit=cardComponent.suit;if(maxPoint<cardComponent.point)maxPoint=cardComponent.point;if(_point<0)_point=cardComponent.point;else if(_point==cardComponent.point-1)_point++;else isSeq=false})}return[isSeq,cardsDeaded.length,maxPoint,suit,cardsDeaded,seqTLMN]};
Utils.getSeqCardBigger=function(_count,_maxPoint,_suit,cardsDeaded,arrayCards,gameId,_card1stData){if(!_card1stData)_card1stData=null;var arrayCard=arrayCards;if(gameId==Constant.GAME_ID.SAM)arrayCard=Utils.deepCoppyArray(arrayCards);var kq=null;if(gameId==Constant.GAME_ID.SAM){var cloneArray=Utils.deepCoppyArray(arrayCard);if(Utils.findOne([4,5,6,7],cardsDeaded))kq=Utils.getSeqCardBigger(_count,_maxPoint,_suit,cardsDeaded,cloneArray,Constant.GAME_ID.TLMN,Utils.getCardFromServer("8"));else kq=Utils.getSeqCardBigger(_count,
_maxPoint,_suit,cardsDeaded,cloneArray,Constant.GAME_ID.TLMN,Utils.getCardFromServer(cardsDeaded[1]))}if(gameId==Constant.GAME_ID.SAM)arrayCard.sort(function(a,b){var card1=a;var aData=card1.getCardData();var card2=b;var bData=card2.getCardData();return aData.point-bData.point});var results=[];var _pointTLMN=-1;var isSeq=true;var suit=-1;var maxPoint=-1;var length=arrayCard.length;var arrAllUse=[];var card1stData=_card1stData==null?Utils.getCardFromServer(cardsDeaded[0]):_card1stData;for(var i=0;i<
length;i++){var array=[];array.splice(0,array.length);var arrUse=[];arrUse.splice(0,array.length);var card1=arrayCard[i];var cardData1=card1.getCardData();if(gameId==Constant.GAME_ID.TLMN&&Utils.isCard2(cardData1.id))continue;suit=cardData1.suit;if(arrAllUse.length&&arrAllUse.indexOf(i)>-1)continue;_pointTLMN=Types.getPointAuto(cardData1,gameId);if(_pointTLMN<Types.getPointAuto(card1stData,gameId))continue;array.push(card1);arrUse.push(i);var j=i+1;while(j<length){var isADD=false;var pointLoop=Types.getPointAuto(cardData1,
gameId)+1;for(var k=j;k<length;k++){isADD=false;var card2=arrayCard[k];var cardData2=card2.getCardData();if(gameId==Constant.GAME_ID.TLMN&&Utils.isCard2(cardData2.id))continue;if(arrUse.length&&arrUse.indexOf(k)>-1)continue;if(pointLoop==Types.getPointAuto(cardData2,gameId)){array.push(card2);arrUse.push(k);isADD=true;pointLoop++}if(isADD&&array&&array.length==_count){var _lastElement=array[array.length-1].getCardData();var _lastElementDeal=Utils.getCardFromServer(cardsDeaded[cardsDeaded.length-1]);
if(array.length==_count)if(gameId==Constant.GAME_ID.TLMN){if(Types.getPointAuto(_lastElement,gameId)==_maxPoint&&_lastElement.suit<_suit){pointLoop--;var pop=array.pop();arrUse.pop()}}else if(gameId==Constant.GAME_ID.SAM)if(Types.getPointAuto(_lastElement,gameId)==_maxPoint){pointLoop--;var pop=array.pop();arrUse.pop()}}}if(array&&array.length>=_count)break;else{array.splice(0,array.length);arrUse.splice(0,arrUse.length)}j++}if(array.length>=_count){array.forEach(function(a,i){});var arayUseTem=[];
for(var k=0;k<length;k++){var card2=arrayCard[k];var cardData2=card2.getCardData();if(gameId==Constant.GAME_ID.TLMN&&Utils.isCard2(cardData2.id))continue;if(arrUse.length&&arrUse.indexOf(k)>-1)continue;var arrTep=[];array.forEach(function(a,_i){var _data=a.getCardData();if(Types.getPointAuto(_data,gameId)==_maxPoint&&Types.getPointAuto(_data,gameId)==Types.getPointAuto(cardData2,gameId))if(gameId==Constant.GAME_ID.TLMN){if(_data.suit<cardData2.suit)if(arrUse.length&&arrUse.indexOf(k)==-1){arrTep.push(card2);
arrUse.push(k)}}else{if(gameId==Constant.GAME_ID.SAM)if(arrUse.length&&arrUse.indexOf(k)==-1){arrTep.push(card2);arrUse.push(k)}}else if(Types.getPointAuto(_data,gameId)==Types.getPointAuto(cardData2,gameId)&&Types.getPointAuto(_data,gameId)!==_maxPoint)if(arrUse.length&&arrUse.indexOf(k)==-1){arrTep.push(card2);arrUse.push(k)}});if(arrTep.length)array=array.concat(arrTep)}var cardMax=Utils.getMaxCardInArray(array,gameId);var pointMax=Types.getPointAuto(cardMax.getCardData(),gameId);var suitMax=cardMax.getCardData().suit;
if(pointMax<_maxPoint)results.splice(0,results.length);else if(pointMax==_maxPoint)if(gameId==Constant.GAME_ID.TLMN)if(_suit>suitMax)results.splice(0,results.length);else{results.push(array);arrAllUse=arrAllUse.concat(arrUse)}else{if(gameId==Constant.GAME_ID.SAM)results.splice(0,results.length)}else{results.push(array);arrAllUse=arrAllUse.concat(arrUse)}}}if(kq&&kq.length)kq.forEach(function(v,i){results.push(v)});return results};
Utils.isSamPoint=function(cardsDeaded){var pointTLMN=-1;var isSame=true;var maxSuit=-1;cardsDeaded.forEach(function(cId,i){var cardComponent=Utils.getCardFromServer(cId);var cSuit=cardComponent.suit;maxSuit=maxSuit<cSuit?cSuit:maxSuit;if(pointTLMN<0)pointTLMN=cardComponent.pointTLMN;else if(pointTLMN!=cardComponent.pointTLMN)isSame=false});return[isSame,pointTLMN,maxSuit]};
Utils.getCoupleToTuQuyBigger=function(_count,_pointTLMN,_suit,arrayCard,gameId){var results=[];var length=arrayCard.length;if(_pointTLMN==15&&_count==2)if(gameId==Constant.GAME_ID.TLMN)results=results.concat(Utils.getTuQuy(arrayCard));else if(gameId==Constant.GAME_ID.SAM){var listTQ=Utils.getTuQuy(arrayCard);if(listTQ&&listTQ.length==2)results=results.concat(listTQ)}for(var i=0;i<length-1;i++){var arrayTuQuy=[];arrayTuQuy.splice(0,arrayTuQuy.length);var card1=arrayCard[i];var cardData1=card1.getCardData();
if(cardData1.pointTLMN>_pointTLMN){arrayTuQuy.push(card1);for(var j=i+1;j<length;j++){var card2=arrayCard[j];var cardData2=card2.getCardData();if(cardData1.pointTLMN==cardData2.pointTLMN)arrayTuQuy.push(card2)}if(arrayTuQuy.length>=_count)results.push(arrayTuQuy)}else if(cardData1.pointTLMN==_pointTLMN&&gameId==Constant.GAME_ID.TLMN)if(_count==2){var maxSuit=cardData1.suit;arrayTuQuy.push(card1);for(var j=i+1;j<length;j++){var card2=arrayCard[j];var cardData2=card2.getCardData();if(cardData1.pointTLMN==
cardData2.pointTLMN){arrayTuQuy.push(card2);if(maxSuit<cardData2.suit)maxSuit=cardData2.suit;break}}if(arrayTuQuy.length==2&&maxSuit>_suit)results.push(arrayTuQuy)}}return results};
Utils.checkConboInChi3cardMB=function(chiTop){for(var i=chiTop.length-1;i>=0;i--)chiTop[i].resetCardComboId();var maxPoint=0,maxPoint2=0;var value=1;var str;var c0=chiTop[0].getCardData();maxPoint=c0.pointMB;maxPoint2=c0.pointMB;for(var i=1;i<chiTop.length;i++){var c=chiTop[i].getCardData();if(c0.pointMB==c.pointMB){value++;chiTop[0].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL);chiTop[i].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL)}else maxPoint=maxPoint<c.pointMB?c.pointMB:maxPoint}if(value==1){var c1=
chiTop[1].getCardData();var c2=chiTop[2].getCardData();if(c1.pointMB==c2.pointMB){value++;maxPoint2=c1.pointMB;chiTop[1].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL);chiTop[2].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL)}}var result;var chiSpriteIdx=0;if(value==1)result=[false,0,"M\u1eadu th\u1ea7u",maxPoint];else if(value==2){chiSpriteIdx=1;result=[true,chiSpriteIdx,"\u0110\u00f4i",maxPoint2]}else if(value==3){str="X\u00e1m Chi";chiSpriteIdx=3;result=[true,chiSpriteIdx,"X\u00e1m Chi",maxPoint2]}return result};
Utils.checkTotalSameCardMB=function(chiIdx,cards){for(var i=cards.length-1;i>=0;i--)cards[i].resetCardComboId();var maxPoint=0,maxPoint2=0,maxPoint3=0,maxPoint4=0;var resultPair=0;var resultThree=0;var resultFour=0;var value=1;var str;var arrUse=[];var arrCombo=[];var i=0;maxPoint=cards[0].getCardData().pointMB;while(i<cards.length-1){value=1;var c0=cards[i].getCardData();arrCombo.push(cards[i]);maxPoint=maxPoint<c0.pointMB?c0.pointMB:maxPoint;for(var j=i+1;j<cards.length;j++){var c=cards[j].getCardData();
if(arrUse.length&&arrUse.indexOf(j)>-1)continue;if(c0.pointMB===c.pointMB){value++;arrUse.push(j);arrCombo.push(cards[j]);cards[i].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL);cards[j].setCardComboIdBitWise(CARD_COMBO.NOT_NORMAL)}}if(value==2){resultPair++;maxPoint2=maxPoint2<c0.pointMB?c0.pointMB:maxPoint2;for(var k in arrCombo){arrCombo[k].resetCardComboId();arrCombo[k].setCardComboIdBitWise(CARD_COMBO.DOI)}}else if(value==3){resultThree++;maxPoint3=maxPoint3<c0.pointMB?c0.pointMB:maxPoint3;for(var k in arrCombo){arrCombo[k].resetCardComboId();
arrCombo[k].setCardComboIdBitWise(CARD_COMBO.BO_3)}}else if(value==4){resultFour++;maxPoint4=maxPoint4<c0.pointMB?c0.pointMB:maxPoint4;for(var k in arrCombo){arrCombo[k].resetCardComboId();arrCombo[k].setCardComboIdBitWise(CARD_COMBO.TUQUY)}}i++;arrCombo.splice(0,arrCombo.length);arrCombo.length=0}var result;if(resultFour==1)result=[true,7,"T\u1ee9 Q\u00fay",maxPoint4];else if(resultThree===1)if(resultPair===1)result=[true,6,"C\u00f9 L\u0169",maxPoint3];else result=[true,3,"X\u00e1m Chi",maxPoint3];
else if(resultPair>0)if(resultPair===2)result=[true,2,"Th\u00fa",maxPoint2];else result=[true,1,"\u0110\u00f4i",maxPoint2];else result=Utils.checkSequenceCardMB(chiIdx,cards);return result};
Utils.checkSequenceCardMB=function(chiIdx,cards){for(var i=cards.length-1;i>=0;i--)cards[i].resetCardComboId();if(chiIdx<0&&cards.length<5)return[false,0,"M\u1eadu th\u1ea7u",maxPoint];var maxPoint=0;var isSameSuit=true;var isSequence=true;var c0=cards[0].getCardData();maxPoint=c0.pointMB;var point=cards[0].getCardData().pointMB;for(var j=1;j<cards.length;j++){var c=cards[j].getCardData();maxPoint=maxPoint<c.pointMB?c.pointMB:maxPoint;if(isSequence)if(j==cards.length-1&&c.point==1){var preCard=cards[j-
1].getCardData();if(preCard.pointMB!==5&&preCard.pointMB!==13)isSequence=false;else if(preCard.pointMB===5)maxPoint=5}else if(point!==c.pointMB-1)isSequence=false;else point++;if(c0.suit!==c.suit)isSameSuit=false}var result;if(isSameSuit&&isSequence)result=[true,8,"Th\u00f9ng ph\u00e1 s\u1ea3nh",maxPoint];else if(isSameSuit)result=[true,5,"Th\u00f9ng",maxPoint];else if(isSequence)result=[true,4,"S\u1ea3nh",maxPoint];else result=[false,0,"M\u1eadu th\u1ea7u",maxPoint];return result};
Utils.getSaveVaule=function(key){var ls=cc.sys.localStorage;var value=ls.getItem(key);if(value)return value;return null};Utils.removeSaveVaule=function(key){var ls=cc.sys.localStorage;ls.removeItem(key)};Utils.setSaveVaule=function(key,value){var ls=cc.sys.localStorage;ls.setItem(key,value)};
Utils.getMaxCardInArray=function(arr,gameId){if(!gameId)gameId=Constant.GAME_ID.TLMN;var result=arr[0];arr.forEach(function(a,i){var data=a.getCardData();if(gameId===Constant.GAME_ID.TLMN){if(result.getCardData().pointTLMN<data.pointTLMN||result.getCardData().pointTLMN==data.pointTLMN&&result.getCardData().suit<data.suit)result=a}else if(result.getCardData().point<data.point)result=a});return result};
Utils.getMinCardInArray=function(arr,gameId){if(!gameId)gameId=Constant.GAME_ID.TLMN;var result=arr[0];arr.forEach(function(a,i){var data=a.getCardData();if(result.getCardData().pointTLMN>data.pointTLMN||result.getCardData().pointTLMN==data.pointTLMN&&result.getCardData().suit>data.suit)result=a});return result};Utils.difference=function(array,other){var theCopy=[];if(!array||!other)return theCopy;for(var i=0,len=array.length;i<len;i++)if(other.indexOf(array[i])===-1)theCopy.push(array[i]);return theCopy};
Utils.deepCoppyArray=function(arr1){var theCopy=[];for(var i=0,len=arr1.length;i<len;i++)theCopy[i]=arr1[i];return theCopy};Utils.thongInsideThongArray=function(arrThongBig,arrThongSmall){var containt=true;for(var i=0,len=arrThongSmall.length;i<len;i++){var index=arrThongBig.indexOf(arrThongSmall[i]);if(index===-1){containt=false;break}}return containt};Utils.compare2arraysEqual=function(a,b){var i=a.length;if(i!=b.length)return false;while(i--)if(a[i]!==b[i])return false;return true};
Utils.loadAvatar=function(avatarLink,avatar,dataPlayer,itemAvatar){if(!itemAvatar)itemAvatar=null;if(avatarLink.indexOf("graph.facebook.com")!==-1){avatarLink=avatarLink.concat("\x26redirect\x3dfalse");var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(xhr.readyState===4)if(xhr.status>=200&&xhr.status<=207){var httpStatus=xhr.statusText;var response=xhr.responseText;var link=decode(response);var avatarFbLink=link.data.url;cc.loader.load(avatarFbLink,function(err,texture){if(dataPlayer===
null)return;if(itemAvatar&&itemAvatar.cancelAvatar)return;var currAvatarLink;if(itemAvatar!==null)currAvatarLink=dataPlayer.a.concat("\x26redirect\x3dfalse");else currAvatarLink=dataPlayer.avatar.concat("\x26redirect\x3dfalse");if(avatarLink!==currAvatarLink)return;var spriteFrame=new cc.SpriteFrame(texture);if(avatar&&avatar!=null&&avatar.getComponent(cc.Sprite))avatar.getComponent(cc.Sprite).spriteFrame=spriteFrame})}};xhr.open("GET",avatarLink);xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
xhr.send()}else{avatarLink=avatarLink.replace("http://v1.api1bai247.info/",Constant.SERVER_IMG);cc.loader.load(avatarLink,function(err,texture){if(dataPlayer===null)return;if(itemAvatar&&itemAvatar.cancelAvatar)return;if(dataPlayer.a)dataPlayer.a=dataPlayer.a.replace("http://v1.api1bai247.info/",Constant.SERVER_IMG);if(itemAvatar!==null&&avatarLink!==dataPlayer.a)return;if(dataPlayer.avatar)dataPlayer.avatar=dataPlayer.avatar.replace("http://v1.api1bai247.info/",Constant.SERVER_IMG);if(itemAvatar===
null&&avatarLink!==dataPlayer.avatar)return;var spriteFrame=new cc.SpriteFrame(texture);if(avatar&&avatar!=null&&avatar.getComponent(cc.Sprite))avatar.getComponent(cc.Sprite).spriteFrame=spriteFrame})}};Utils.shuffleArray=function(array){for(var i=array.length-1;i>0;i--){var j=Math.floor(Math.random()*(i+1));var temp=array[i];array[i]=array[j];array[j]=temp}return array};var MyHelper=MyHelper||{};
MyHelper.createButton=function(png,isSpriteSheet,clickHandler,is9path,size9path,padding){var button;var namePng;if(isSpriteSheet){if(hiepnh.isArray(png))namePng=png[0];else namePng=png;if(is9path){button=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame(namePng),padding[0],padding[1],padding[2],padding[3]);button.width=size9path.width;button.height=size9path.height}else button=PIXI.Sprite.fromFrame(namePng)}else if(is9path){button=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame(png),padding[0],
padding[1],padding[2],padding[3]);button.width=size9path.width;button.height=size9path.height;button.pivot.set(size9path.width/2,size9path.width/2)}else button=PIXI.Sprite.fromImage(png);button.interactive=true;button.buttonMode=true;button.displayGroup=MyPixi.gameRootLayer;if(!is9path)button.anchor.set(.5,.5);button.position.set(50,50);var thiz=this;var zoomScale=false;if(hiepnh.isArray(png));else zoomScale=true;var textureState=[];if(isSpriteSheet&&!zoomScale){for(var i=0;i<png.length;i++)textureState.push(PIXI.Texture.fromFrame(png[i]));
if(textureState.length<3)for(var i=0;i<3-textureState.length;i++)textureState.push(PIXI.Texture.fromFrame(png[0]))}else textureState[0]=PIXI.Texture.fromFrame(png);button.textureState=textureState;var onButtonDown=function(event){event.stopPropagation();this.isdown=true;if(zoomScale)this.scale.set(.95,.95);else button.texture=button.textureState[1];if(clickHandler)clickHandler()};var onButtonUp=function(){this.isdown=false;if(zoomScale)this.scale.set(1,1);if(this.isOver){if(!zoomScale&&textureState.length==
3)button.texture=button.textureState[2]}else if(!zoomScale)button.texture=textureState[0]};var onButtonOver=function(){this.isOver=true;if(this.isdown)return;if(!zoomScale&&textureState.length==3)button.texture=button.textureState[2]};var onButtonOut=function(){this.isOver=false;if(this.isdown)return;if(!zoomScale&&textureState.length==3)button.texture=button.textureState[2]};button.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",
onButtonOut);return button};MyHelper.addLblButton=function(btn,title,fontSize){var anchor=cc.p(0,0);if(btn.anchor)anchor=cc.p(btn.anchor.x,btn.anchor.y);var lbl=cc.LabelTTF(title,cc.res.font.Arial,fontSize,null,"white");lbl.anchor.set(.5,.5);if(anchor.x==.5&&anchor.y==.5)lbl.position.set(0,0);else lbl.position.set(btn.width/2,btn.height/2);btn.removeChildren();btn.addChild(lbl)};
MyHelper.addClickListenerToLabel=function(label,clickHandler){label.interactive=true;label.buttonMode=true;label.labelMode=true;label.displayGroup=MyPixi.gameRootLayer;var thiz=this;var zoomScale=true;var onButtonDown=function(event){event.stopPropagation();this.isdown=true;if(zoomScale)this.scale.set(.95,.95);if(clickHandler)clickHandler()};var onButtonUp=function(){this.isdown=false;if(zoomScale)this.scale.set(1,1);if(this.isOver);};var onButtonOver=function(){this.isOver=true;if(this.isdown)return};
var onButtonOut=function(){this.isOver=false;if(this.isdown)return};label.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut);return label};
MyHelper.addHoverClickListenerToLabel=function(label,hoverHandler,hoverOutHandler){label.interactive=true;label.buttonMode=true;label.labelMode=true;var thiz=this;var zoomScale=true;var onButtonDown=function(event){};var onButtonUp=function(){};var onButtonOver=function(){this.scale.set(.9,.9);if(hoverHandler)hoverHandler()};var onButtonOut=function(){this.scale.set(1,1);if(hoverOutHandler)hoverOutHandler()};label.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",
onButtonOver).on("pointerout",onButtonOut);return label};
MyHelper.addClickListenerToObj=function(obj,clickHandler){obj.interactive=true;obj.buttonMode=true;var thiz=this;var zoomScale=true;var onButtonDown=function(event){event.stopPropagation();this.isdown=true;if(zoomScale)this.scale.set(.95,.95);if(clickHandler)clickHandler(obj)};var onButtonUp=function(){this.isdown=false;if(zoomScale)this.scale.set(1,1);if(this.isOver);};var onButtonOver=function(){this.isOver=true;if(this.isdown)return};var onButtonOut=function(){this.isOver=false;if(this.isdown)return};
obj.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut);return obj};var BUNDLE="com.gts.vip52";var APPNAME=APPNAME||"prod";var BASE_URL=BASE_URL||"https://api.6c86acvpiv.com";var BASE_URL_TEST=BASE_URL_TEST||"https://api.6c86acvpiv.com";var COMMAND="command";var VERSION_ID="2";var PLATFORM_ID="1";var VERSION_ID_TEST="1";var PLATFORM_ID_TEST="1";var ServerConfig=ServerConfig||{};
ServerConfig.getLinkDistributor=function(){var distributorUrl=BASE_URL_TEST+"/distributor";if(!cc.Global.GetSetting("test",false))distributorUrl=BASE_URL+"/distributor";var link=distributorUrl;return link};ServerConfig.getLinkACS=function(distId,appId){var acsUrl=BASE_URL_TEST+"/acs";var version=VERSION_ID_TEST;var plalform=PLATFORM_ID_TEST;if(!cc.Global.GetSetting("test",false)){acsUrl=BASE_URL+"/acs";version=VERSION_ID;plalform=PLATFORM_ID}var link=acsUrl;return link};
ServerConfig.getLinkSignature=function(name,pass){var plalform=PLATFORM_ID_TEST;if(!cc.Global.GetSetting("test",false))plalform=PLATFORM_ID;var link=HostConfig.services.id+"?"+COMMAND+"\x3dlogin\x26username\x3d"+name+"\x26password\x3d"+pass+"\x26platformId\x3d"+plalform;cc.log("getLinkSignature"+link+" ");return link};
ServerConfig.getLinkRegister=function(name,pass,deviceId,platformId,os,capcha,sessionIdCaptCha){var plalform=PLATFORM_ID_TEST;if(!cc.Global.GetSetting("test",false))plalform=PLATFORM_ID;var link=HostConfig.services.id+"?"+COMMAND+"\x3dsignup\x26username\x3d"+name+"\x26password\x3d"+pass+"\x26deviceId\x3d"+deviceId+"\x26platformId\x3d"+plalform+"\x26os\x3d"+os+"\x26alsoLogin\x3dtrue\x26answer\x3d"+capcha+"";if(sessionIdCaptCha)link=link+"\x26sessionId\x3d"+sessionIdCaptCha;cc.log("getLinkRegister"+
link+" ");return link};ServerConfig.getLinkFb=function(fbToken,platformId,os){var link=HostConfig.services.id+"?"+COMMAND+"\x3dloginFacebook\x26fbAccessToken\x3d"+fbToken+ +"\x26os\x3d"+os+"\x26platformId\x3d"+platformId;cc.log("getLinkFb"+link+" ");return link};ServerConfig.getLinkGuestPlay=function(deviceId,platformId,os){var link=HostConfig.services.id+"?"+COMMAND+"\x3dloginQuickPlay\x26deviceId\x3d"+deviceId+"\x26platformId\x3d"+platformId+"\x26os\x3d"+os;cc.log("getLinkGuestPlay"+link+" ");return link};
ServerConfig.getLinkUpdateDisPlayName=function(dn){var url=HostConfig.services.id+"?command\x3dupdateDisplayName\x26displayName\x3d"+dn;return url};ServerConfig.getPayGateConfig=function(){var url=HostConfig.services.paygate+"?command\x3dfetchConfig";cc.log("getPayGateConfig"+url+" ");return url};ServerConfig.getPayGateRewardItem=function(){var url=HostConfig.services.paygate+"?command\x3dfetchAllCashoutItems";cc.log("getPayGateRewardItem"+url+" ");return url};
ServerConfig.getPayGateRewardHistory=function(){var url=HostConfig.services.paygate+"?command\x3dfetchCashoutHistory";cc.log("getPayGateRewardHistory"+url+" ");return url};ServerConfig.getCashOut=function(itemID){var url=HostConfig.services.paygate+"?command\x3dcashout\x26itemId\x3d"+itemID;cc.log("getCashOut"+url+" ");return url};ServerConfig.getRefundItem=function(itemID){var url=HostConfig.services.paygate+"?command\x3drefundCashout\x26id\x3d"+itemID;cc.log("getRefundItem"+url+" ");return url};
ServerConfig.getListAvatar=function(){var url=HostConfig.services.id+"?command\x3dgetAvatars";cc.log("getListAvatar"+url+" ");return url};ServerConfig.getUpdateAvatar=function(idAvatar){var url=HostConfig.services.id+"?command\x3dupdateAvatar\x26id\x3d"+idAvatar;cc.log("updateAvatar"+url+" ");return url};ServerConfig.getLinkNews=function(type){var url=HostConfig.services.sa+"?command\x3dgetTopNews\x26type\x3d"+type;cc.log("getLinkNews"+url+" ");return url};
ServerConfig.getLinkMsg=function(){var url=HostConfig.services.sa+"?command\x3dfetchInbox";cc.log("getLinkMsg"+url+" ");return url};ServerConfig.getLinkChangePass=function(newPassword){var url=HostConfig.services.id+"?command\x3dchangePass\x26newPassword\x3d"+newPassword;cc.log("getLinkChangePass"+url+" ");return url};ServerConfig.getLinkReadMsg=function(idMsg){var url=HostConfig.services.sa+"?command\x3dreadMessage\x26id\x3d"+idMsg;cc.log("getLinkReadMsg"+url+" ");return url};
ServerConfig.getLinkDelMsg=function(idMsg){var url=HostConfig.services.sa+"?command\x3ddeleteMessage\x26id\x3d"+idMsg;cc.log("getLinkDelMsg"+url+" ");return url};ServerConfig.getLinkRule=function(){var url=HostConfig.services.sa+"?command\x3dfetchGameRules";cc.log("getLinkRule"+url+" ");return url};
ServerConfig.getChargeCardLink=function(serial,code,telcoId){var url=HostConfig.services.paygate+"?command\x3dchargeCard\x26serial\x3d"+serial+"\x26code\x3d"+code+"\x26telcoId\x3d"+telcoId;cc.log("getChargeCardLink"+url+" ");return url};ServerConfig.getCaptCha=function(seasonId){var url=HostConfig.services.id+"?command\x3dgetCaptcha\x26sessionId\x3d"+seasonId;cc.log("getCaptCha"+url+" ");return url};
ServerConfig.getForgotPass=function(displayName,telcoId){var url=HostConfig.services.paygate+"?command\x3dfetchForgotPasswordSyntax\x26displayName\x3d"+displayName+"\x26telcoId\x3d"+telcoId+"";cc.log("getForgotPass"+url+" ");return url};ServerConfig.getOTPphone=function(phone){var url=HostConfig.services.paygate+"?command\x3dregisterOTPCode\x26phone\x3d"+phone;cc.log("getOTPphone"+url+" ");return url};
ServerConfig.activeOTP=function(otp){var url=HostConfig.services.paygate+"?command\x3dactiveOTPCode\x26otp\x3d"+otp;cc.log("activeOTP"+url+" ");return url};ServerConfig.getToken=function(){var token=LoginData.signatureData.data.accessToken;cc.log("getToken"+token+" ");return token};
ServerConfig.getRefreshToken=function(){var refreshToken=LoginData.signatureData.data.refreshToken;var url=HostConfig.services.id+"?command\x3drefreshToken\x26refreshToken\x3d"+refreshToken;cc.log("getRefreshToken"+url+" ");return url};var SuggestCardMng=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else{this.cardList=null;this.reset()}};this.reset=function(){this.oponentTypeCombo=CARD_COMBO.NORMAL;this.lastArrCardDeal=[]};this.initCardList=function(cardList){this.cardList=cardList};this.getIndexCard=function(_cardCompt,listCard){if(!listCard)listCard=null;var spriteCards=this.cardList.getCards();var indexPlayerChose=-1;var spriteCards=this.cardList.getCards();
if(listCard!=null)cardList=listCard;spriteCards.forEach(function(card,index){var cardCompt=card;if(cardCompt===_cardCompt)indexPlayerChose=index});return indexPlayerChose};this.suggestCard=function(cardList,cardsDeaded,isBlurCardIfNeed){if(!isBlurCardIfNeed)isBlurCardIfNeed=true;this.cardList=cardList;this.lastArrCardDeal=cardsDeaded;cc.log(isBlurCardIfNeed+" \x3c\x3disBlur  suggest.......cardsDeaded \x3d\x3e"+cardsDeaded);var thiz=this;this.oponentTypeCombo=CARD_COMBO.NORMAL;if(!cardsDeaded||!cardsDeaded.length){this.cardList.resetCardComboId(false);
return}this.cardList.resetCardComboId(isBlurCardIfNeed);var lengthCard=cardsDeaded.length;var handCards=this.cardList.getCards();var size=handCards.length;if(lengthCard==1){thiz.oponentTypeCombo=CARD_COMBO.NORMAL;var _cardDeadId=cardsDeaded[0];var cardCompare=Utils.getCardFromServer(_cardDeadId);var isCard2=Utils.isCard2(cardCompare.id);for(var i=0;i<handCards.length;i++){var card=handCards[i];var cardData=card.getCardData();if(cardData.pointTLMN<cardCompare.pointTLMN){if(isBlurCardIfNeed)card.revealBlur(true);
card.moveDown()}else if(cardData.pointTLMN==cardCompare.pointTLMN)if(cc.Global.gameId==Constant.GAME_ID.TLMN)if(cardData.pointTLMN==cardCompare.pointTLMN&&cardData.suit<cardCompare.suit){if(isBlurCardIfNeed)card.revealBlur(true);card.moveDown()}else{card.revealBlur(false);card.setCardComboIdBitWise(CARD_COMBO.NORMAL_BIGGER)}else{if(cc.Global.gameId==Constant.GAME_ID.SAM){if(isBlurCardIfNeed)card.revealBlur(true);card.moveDown()}}else{card.revealBlur(false);card.setCardComboIdBitWise(CARD_COMBO.NORMAL_BIGGER)}}if(isCard2){thiz.oponentTypeCombo=
CARD_COMBO.CARD_2;var listTuQuy=Utils.getTuQuy(handCards);if(listTuQuy.length)listTuQuy.forEach(function(tuquy,index){if(tuquy.length==4)tuquy.forEach(function(cardInTuQuy,i){cardInTuQuy.revealBlur(false);cardInTuQuy.setCardComboIdBitWise(CARD_COMBO.TUQUY)})});if(cc.Global.gameId==Constant.GAME_ID.TLMN){var resultThong=Utils.getDoiThong(handCards);if(resultThong.length)resultThong.forEach(function(thong,i){if(thong.length>=6)thong.forEach(function(cardInThong,i){cardInThong.revealBlur(false);cardInThong.setCardComboIdBitWise(CARD_COMBO.N_DOITHONG)})})}}}else{var coupleToTuQuy=
Utils.isSamPoint(cardsDeaded);cc.log("coupleToTuQuy "+coupleToTuQuy);if(coupleToTuQuy[0]){var size=cardsDeaded.length;if(size==2){thiz.oponentTypeCombo=CARD_COMBO.DOI;var _cardDeadId=cardsDeaded[0];var cardCompare=Utils.getCardFromServer(_cardDeadId);var isCard2=Utils.isCard2(cardCompare.id);if(isCard2)thiz.oponentTypeCombo=CARD_COMBO.DOI_2}else if(size==3)thiz.oponentTypeCombo=CARD_COMBO.BO_3;else if(size==4)thiz.oponentTypeCombo=CARD_COMBO.TUQUY;var result=Utils.getCoupleToTuQuyBigger(cardsDeaded.length,
coupleToTuQuy[1],coupleToTuQuy[2],handCards,cc.Global.gameId);if(result.length)result.forEach(function(arr,i){arr.forEach(function(cardInArr,i){cardInArr.revealBlur(false);var length=arr.length;if(length==2)cardInArr.setCardComboIdBitWise(CARD_COMBO.DOI);else if(length==3)cardInArr.setCardComboIdBitWise(CARD_COMBO.BO_3);else if(length==4)cardInArr.setCardComboIdBitWise(CARD_COMBO.TUQUY)})});if(size==4||size==2&&thiz.oponentTypeCombo==CARD_COMBO.DOI_2)if(cc.Global.gameId==Constant.GAME_ID.TLMN){var resultThong=
Utils.getDoiThong(handCards,4);if(resultThong.length)resultThong.forEach(function(arr,i){arr.forEach(function(cardInArr,i){cardInArr.revealBlur(false);cardInArr.setCardComboIdBitWise(CARD_COMBO.N_DOITHONG)})})}}else{var seqCard=Utils.isSeqCard(cardsDeaded,cc.Global.gameId);cc.log("seqCard "+seqCard);if(seqCard[0]){var result=Utils.getSeqCardBigger(seqCard[1],seqCard[2],seqCard[3],seqCard[4],handCards,cc.Global.gameId);thiz.oponentTypeCombo=CARD_COMBO.CHUOI_CARD;if(result.length)result.forEach(function(arr,
i){arr.forEach(function(cardInArr,i){cardInArr.revealBlur(false);cardInArr.setCardComboIdBitWise(CARD_COMBO.CHUOI_CARD)})})}else{var isDoiThong=Utils.isDoiThong(cardsDeaded);if(isDoiThong[0]){thiz.oponentTypeCombo=CARD_COMBO.N_DOITHONG;var resultThong=Utils.getDoiThong(handCards,cardsDeaded.length/2);if(resultThong.length){cc.log("isDoiThong result "+resultThong.length);var thiz=this;resultThong.forEach(function(thong,i){if(thong.length>cardsDeaded.length){var cId=cardsDeaded[cardsDeaded.length-1];
var cardComponent=Utils.getCardFromServer(cId);var lastElement=Utils.getMaxCardInArray(thong).getCardData();var typeApply=CARD_COMBO.N_DOITHONG;if(lastElement.pointTLMN<cardComponent.pointTLMN){thiz.oponentTypeCombo=CARD_COMBO.MAX_DOITHONG;typeApply=CARD_COMBO.MAX_DOITHONG}thong.forEach(function(cardInThong,i){cardInThong.revealBlur(false);cardInThong.setCardComboIdBitWise(typeApply)})}else if(thong.length===cardsDeaded.length){var cId=cardsDeaded[cardsDeaded.length-1];var cardComponent=Utils.getCardFromServer(cId);
var lastElement=Utils.getMaxCardInArray(thong).getCardData();if(cc.Global.gameId==Constant.GAME_ID.TLMN){if(lastElement.pointTLMN>cardComponent.pointTLMN||cc.Global.gameId==Constant.GAME_ID.TLMN&&lastElement.pointTLMN==cardComponent.pointTLMN&&lastElement.suit>cardComponent.suit)thong.forEach(function(cardInThong,i){cardInThong.revealBlur(false);cardInThong.setCardComboIdBitWise(CARD_COMBO.N_DOITHONG)})}else if(cc.Global.gameId==Constant.GAME_ID.SAM){var cId=cardsDeaded[0];var firstDeal=Utils.getCardFromServer(cId);
while(thong[0].getCardData().pointTLMN==firstDeal.pointTLMN)thong.shift();if(lastElement.pointTLMN>cardComponent.pointTLMN)thong.forEach(function(cardInThong,i){cardInThong.revealBlur(false);cardInThong.setCardComboIdBitWise(CARD_COMBO.N_DOITHONG)})}}})}var lengthThongDeal=isDoiThong[1]/2;if(lengthThongDeal===3){var listTuQuy=Utils.getTuQuy(handCards);if(listTuQuy.length)listTuQuy.forEach(function(tuquy,index){if(tuquy.length==4)tuquy.forEach(function(cardInTuQuy,i){cardInTuQuy.revealBlur(false);
cardInTuQuy.setCardComboIdBitWise(CARD_COMBO.TUQUY)})})}}}}}for(var i=0;i<handCards.length;i++){var card=handCards[i];if(isBlurCardIfNeed&&!card.isCardMoveUp()&&card.getCardComboIdBitWise()===CARD_COMBO.NORMAL)card.revealBlur(true);if(card.isCardMoveUp()&&card.getCardComboIdBitWise()===CARD_COMBO.NORMAL){var blurWhenDone=false;if(isBlurCardIfNeed)card.revealBlur(true);card.moveDown()}}};this.getAllCardMoveUp=function(isCardArr,cardCompIgnore){if(!isCardArr)isCardArr=false;if(!cardCompIgnore)cardCompIgnore=
null;var intCardArr=[];var spriteCards=this.cardList.getCards();spriteCards.forEach(function(card,index){var cardCompt=card;if(cardCompIgnore==null||cardCompIgnore!=cardCompt)if(cardCompt.isCardMoveUp()){var codeCard=cardCompt.getCardData().codeCard;if(isCardArr)intCardArr.push(codeCard);else intCardArr.push(cardCompt)}});return intCardArr};this.onSuggestUpCard=function(cardClick,isUp){if(!isUp)isUp=true;var spriteCards=this.cardList.getCards();var arr=this.cardList.getCardSelected();var cardsDeaded=
this.lastArrCardDeal;var oponentTypeCombo=this.oponentTypeCombo;var isAllUpSame=true;var countSame=0;var count=0;if(arr&&arr.length){if(arr.length<=3&&arr.indexOf(cardClick)!=-1&&isUp){arr.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){if(cardClick!=cardInArr)spriteCards[idx].moveDown(false);break}}});return}var p=arr[0].getCardData().pointTLMN;for(var idx in arr)if(cardClick!=
arr[idx]){if(p!=arr[idx].getCardData().pointTLMN)isAllUpSame=false;else countSame++;if(cardClick.getCardData().pointTLMN===arr[idx].getCardData().pointTLMN)count++}}if(arr.length>1&&countSame<4)isAllUpSame=false;if(countSame===3&&cardClick.getCardData().pointTLMN===arr[0].getCardData().pointTLMN)isAllUpSame=true;if(count===3&&arr.length>4)isAllUpSame=true;var arrayMoveDown=[];if(!isUp){if(!cardsDeaded||!cardsDeaded.length)this.suggestClickCard(cardClick,isUp);else this.suggestClickCard(cardClick,
isUp);return}else if(!cardsDeaded||!cardsDeaded.length){this.suggestClickCard(cardClick,isUp);return}cc.log("onSuggestUpCard nhung ko suggestClickCard");if(arr.length&&arr.length>=6&&(oponentTypeCombo==CARD_COMBO.DOI_2||oponentTypeCombo==CARD_COMBO.CARD_2||oponentTypeCombo==CARD_COMBO.N_DOITHONG)){var numberSameCard=0;var isSame=false;var pointClickCard=cardClick.getCardData().pointTLMN;if(pointClickCard===arr[0].getCardData().pointTLMN-1||pointClickCard===1+arr[arr.length-1].getCardData().pointTLMN)return;
for(var index=0;index<arr.length;index++){var card=arr[index];if(cardClick.getCardData().pointTLMN===card.getCardData().pointTLMN&&cardClick!==card){numberSameCard++;isSame=true}}if(numberSameCard<3&&isSame){var _cardCompt=cardClick;var clickPoint=_cardCompt.getCardData().pointTLMN;var isClickCardInArr=arr.indexOf(_cardCompt)==-1?false:true;if(isClickCardInArr){var indexDown=-1;var temArr=arr;temArr.forEach(function(card,index){var cardCompt=card;if(cardCompt===_cardCompt)indexDown=index});var arrLeft=
temArr.slice(0,indexDown);if(!arrLeft||!arrLeft.length||arrLeft.length<6){temArr.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){if(cardInArr!==_cardCompt)spriteCards[idx].moveDown(false);break}}});return}else if(arrLeft&&arrLeft.length>=6){temArr.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&
c.suit===cardInArr.getCardData().suit){if(clickPoint<=c.point&&cardInArr!==_cardCompt)spriteCards[idx].moveDown(false);break}}});return}}return}}if(arr.length&&arr.length>=3&&oponentTypeCombo==CARD_COMBO.CHUOI_CARD){cc.log("onSuggestUpCard chuoi card change 1 card");for(var index=0;index<arr.length;index++){var card=arr[index];if(cardClick.getCardData().pointTLMN===card.getCardData().pointTLMN&&cardClick!==card){card.moveDown(false);cc.log("onSuggestUpCard cmovedown 1 card and return");return}}}if(arr&&
arr.length)if(cardsDeaded&&(cardsDeaded.length==1||cardsDeaded.length==2||cardsDeaded.length==3||cardsDeaded.length>=4&&oponentTypeCombo==CARD_COMBO.CHUOI_CARD||cardsDeaded.length>=6&&oponentTypeCombo==CARD_COMBO.N_DOITHONG))if(cc.Global.gameId==Constant.GAME_ID.SAM&&(oponentTypeCombo==CARD_COMBO.CARD_2||oponentTypeCombo==CARD_COMBO.DOI_2));else{cc.log("vao dayyyyyy *******");spriteCards.forEach(function(card,index){var cardCompt=card;if(cardClick!==cardCompt)arrayMoveDown.push(cardCompt)})}else if(oponentTypeCombo==
CARD_COMBO.DOI_2);else if(cardsDeaded&&cardsDeaded.length==4&&oponentTypeCombo===CARD_COMBO.TUQUY){var c=cardClick.getCardData();var first=arr[0].getCardData();var last=arr[arr.length-1].getCardData();if(arr.length>=8&&(c.pointTLMN==first.pointTLMN-1||c.pointTLMN==last.pointTLMN+1)){for(var index=0;index<spriteCards.length;index++){var card=spriteCards[index];var cardCompt=card;if(cardCompt.getCardData().pointTLMN==c.pointTLMN&&cardCompt!==cardClick){cardCompt.onSuggestUp(true);break}}return}else{var bit=
cardClick.getCardComboIdBitWise();var bit2=arr[0].getCardComboIdBitWise();var check=bit&&bit2;if(check!=0)spriteCards.forEach(function(card,index){var cardCompt=card;if(cardClick!==cardCompt)cardCompt.moveDown(false)});else return}}else cc.log("vao day*************aaaaaaa ");cc.log("ko suggestClickCard vi cardsDeaded .length \x3e 0 ");var _pointTLMN=cardClick.getCardData().pointTLMN;var _suit=cardClick.getCardData().suit;var _idBitwise=cardClick.getCardComboIdBitWise();var arraySuggest=[];var indexSuggest=
-1;var sizeSuggest=cardsDeaded.length;var indexPlayerChose=-1;spriteCards.forEach(function(card,index){var cardCompt=card;if(cardCompt===cardClick)indexPlayerChose=index});for(var index=0;index<spriteCards.length;index++){var card=spriteCards[index];var cardCompt=card;var idBitwise=cardCompt.getCardComboIdBitWise();var result=_idBitwise&idBitwise;if(result!=0)switch(oponentTypeCombo){case CARD_COMBO.NORMAL:break;case CARD_COMBO.DOI:if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN&&
indexSuggest<indexPlayerChose){indexSuggest=index;arraySuggest.splice(0,arraySuggest.length);arraySuggest.push(cardCompt)}break;case CARD_COMBO.DOI_2:case CARD_COMBO.N_DOITHONG:case CARD_COMBO.CARD_2:case CARD_COMBO.TUQUY:case CARD_COMBO.MAX_DOITHONG:var nThong=false;if(oponentTypeCombo==CARD_COMBO.DOI_2){var check=_idBitwise&CARD_COMBO.TUQUY;if(check!=0){if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}else{check=_idBitwise&
CARD_COMBO.DOI;if(check!=0){if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}else{check=_idBitwise&CARD_COMBO.N_DOITHONG;if(check!=0){nThong=true;sizeSuggest=8}}}}else if(oponentTypeCombo==CARD_COMBO.CARD_2)if(isAllUpSame){var check=_idBitwise&CARD_COMBO.TUQUY;if(check!=0){if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}else{check=_idBitwise&CARD_COMBO.N_DOITHONG;
if(check!=0){nThong=true;var lengthThong=6;var arrUp=this.getAllCardMoveUp();if(arrUp&&arrUp.length){var minPointUp=arrUp[0].getCardData().pointTLMN;var pointClick=cardClick.getCardData().pointTLMN;var lengthThong=2*(1+Math.abs(pointClick-minPointUp));if(lengthThong<6)lengthThong=6}sizeSuggest=lengthThong}}}else{var check=_idBitwise&CARD_COMBO.N_DOITHONG;if(check!=0){nThong=true;var lengthThong=6;var arrUp=this.getAllCardMoveUp();if(arrUp&&arrUp.length){var minPointUp=arrUp[0].getCardData().pointTLMN;
var pointClick=cardClick.getCardData().pointTLMN;var lengthThong=2*(1+Math.abs(pointClick-minPointUp));if(lengthThong<6)lengthThong=6}sizeSuggest=lengthThong}else{check=_idBitwise&CARD_COMBO.TUQUY;if(check!=0)if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}}else if(oponentTypeCombo==CARD_COMBO.TUQUY){var check=_idBitwise&CARD_COMBO.TUQUY;if(check!=0){if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}else{check=
_idBitwise&CARD_COMBO.N_DOITHONG;if(check!=0){nThong=true;sizeSuggest=8}}}else if(oponentTypeCombo==CARD_COMBO.MAX_DOITHONG){sizeSuggest=8;nThong=true}else{cc.log("casedb **** ");if(cardsDeaded.length===6){nThong=false;var check=_idBitwise&CARD_COMBO.TUQUY;if(check!=0){if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt)}else nThong=true}else nThong=true}if(nThong){var arrUp=this.getAllCardMoveUp();var p=cardClick.getCardData().pointTLMN;
var p2=arrUp[0]?arrUp[0].getCardData().pointTLMN:p;var pointMin=p<p2?p:p2;var pointMax=p>p2?p:p2;var diffPoint=pointMax-pointMin;if(diffPoint>=3)this.choseNThong(cardClick,_pointTLMN,indexPlayerChose,arraySuggest,sizeSuggest,false,arrUp);else{var lengthGet=10;while(lengthGet>6&&(!arraySuggest||!arraySuggest.length)){this.choseNThong(cardClick,_pointTLMN,indexPlayerChose,arraySuggest,lengthGet,false,arrUp);lengthGet-=2}}}break;case CARD_COMBO.BO_3:if(cardCompt!==cardClick)if(cardCompt.getCardData().pointTLMN==
cardClick.getCardData().pointTLMN)arraySuggest.push(cardCompt);break;case CARD_COMBO.CHUOI_CARD:if(arraySuggest.length==sizeSuggest-1);else{var temPointTLMN=-1;var startIndex=spriteCards.length-1;while(startIndex>=0){temPointTLMN=-1;for(var k=startIndex;k>=0;k--){var cardComptTemp=spriteCards[k];var isCard2=Utils.isCard2(cardComptTemp.getCardData().id);if(isCard2)continue;var idBitwiseTemp=cardComptTemp.getCardComboIdBitWise();var resultTem=_idBitwise&idBitwiseTemp;if(result==0)continue;if(cardComptTemp.getCardData().pointTLMN>=
_pointTLMN-sizeSuggest+1&&cardComptTemp.getCardData().pointTLMN<=_pointTLMN+sizeSuggest-1){if(temPointTLMN<0)temPointTLMN=cardComptTemp.getCardData().pointTLMN;if(arraySuggest.length==sizeSuggest-1)continue;if(cardComptTemp.getCardData().pointTLMN==temPointTLMN){temPointTLMN--;if(cardComptTemp!==cardClick&&_pointTLMN!==cardComptTemp.getCardData().pointTLMN){arraySuggest.push(cardComptTemp);cc.log(index+" push2.... "+cardComptTemp.getCardData().toString)}}else;if(arraySuggest.length==sizeSuggest-1){var lastElement=
arraySuggest[0].getCardData();var firstElement=arraySuggest[arraySuggest.length-1].getCardData();if(firstElement.pointTLMN>_pointTLMN){if(lastElement.pointTLMN-_pointTLMN!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length)}else if(lastElement.pointTLMN<_pointTLMN){if(_pointTLMN-firstElement.pointTLMN!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);lastElement=cardClick.getCardData()}else if(lastElement.pointTLMN-firstElement.pointTLMN!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);
if(arraySuggest.length==sizeSuggest-1){var cId=cardsDeaded[cardsDeaded.length-1];var lastDeal=Utils.getCardFromServer(cId);if(lastElement.pointTLMN===lastDeal.pointTLMN&&lastElement.suit<lastDeal.suit){arraySuggest.pop();temPointTLMN++}}}}}if(arraySuggest.length<sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);else break;startIndex--}if(cc.Global.gameId===Constant.GAME_ID.SAM){var temPoint=-1;var _temPoint=cardClick.getCardData().point;var arrTemSpriteCards=Utils.deepCoppyArray(spriteCards);
arrTemSpriteCards.sort(function(a,b){var card1=a;var aData=card1.getCardData();var card2=b;var bData=card2.getCardData();return aData.point-bData.point});startIndex=arrTemSpriteCards.length-1;while(startIndex>=0){temPoint=-1;cc.log("sam test....... ");for(var k=startIndex;k>=0;k--){var cardComptTemp=arrTemSpriteCards[k];var idBitwiseTemp=cardComptTemp.getCardComboIdBitWise();var resultTem=_idBitwise&idBitwiseTemp;if(result===0)continue;if(cardComptTemp.getCardData().point>=_temPoint-sizeSuggest+1&&
cardComptTemp.getCardData().point<=_temPoint+sizeSuggest-1){if(temPoint<0)temPoint=cardComptTemp.getCardData().point;if(arraySuggest.length==sizeSuggest-1)continue;if(cardComptTemp.getCardData().point==temPoint){temPoint--;if(cardComptTemp!==cardClick&&_temPoint!==cardComptTemp.getCardData().point){arraySuggest.push(cardComptTemp);cc.log(index+"sam push2.... "+cardComptTemp.getCardData().toString)}}if(arraySuggest.length==sizeSuggest-1){var lastElement=arraySuggest[0].getCardData();var firstElement=
arraySuggest[arraySuggest.length-1].getCardData();if(firstElement.point>_temPoint){if(lastElement.point-_temPoint!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length)}else if(lastElement.point<_temPoint){if(_temPoint-firstElement.point!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);lastElement=cardClick.getCardData()}else if(lastElement.point-firstElement.point!=sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);if(arraySuggest.length==sizeSuggest-1){var cId=cardsDeaded[cardsDeaded.length-
1];var lastDeal=Utils.getCardFromServer(cId);if(lastElement.point===lastDeal.point&&lastElement.suit<lastDeal.suit){arraySuggest.pop();temPoint++}}}}}if(arraySuggest.length<sizeSuggest-1)arraySuggest.splice(0,arraySuggest.length);else break;startIndex--}}}var arrContainer=this.getAllCardMoveUp();if(arrContainer!=null&&arrContainer.length&&arraySuggest.length)for(var idex in arrContainer){var element=arrContainer[idex];if(arraySuggest.indexOf(element)===-1)for(var k=0;k<arraySuggest.length;k++){var el=
arraySuggest[k];if(el.getCardData().pointTLMN===element.getCardData().pointTLMN&&arrContainer.indexOf(el)===-1){arraySuggest.splice(k,1,element);break}}}break}}if(arraySuggest.length){if(arrayMoveDown&&arrayMoveDown.length>0){var lengthDown=arrayMoveDown.length;var index=arraySuggest.indexOf(cardCompt);if(index>-1)arrayMoveDown.splice(index,1)}if(arrayMoveDown.length)arrayMoveDown.forEach(function(cardCompt,i){cc.log("cardCompt move down  "+cardCompt.getCardData().toString);cardCompt.moveDown(false)});
var suggestLength=arraySuggest.length;switch(oponentTypeCombo){case CARD_COMBO.NORMAL:break;case CARD_COMBO.DOI:arraySuggest.forEach(function(cardCompt,i){cardCompt.onSuggestUp(true)});break;case CARD_COMBO.BO_3:if(suggestLength==2)arraySuggest.forEach(function(cardCompt,i){cardCompt.onSuggestUp(true)});else{if(_suit==Suit.b)arraySuggest.pop();if(_suit==Suit.t)arraySuggest.pop();if(_suit==Suit.r)arraySuggest.shift();if(_suit==Suit.c)arraySuggest.shift();arraySuggest.forEach(function(cardCompt,i){cardCompt.onSuggestUp(true)})}break;
case CARD_COMBO.CARD_2:case CARD_COMBO.N_DOITHONG:case CARD_COMBO.TUQUY:case CARD_COMBO.DOI_2:case CARD_COMBO.CHUOI_CARD:case CARD_COMBO.MAX_DOITHONG:arraySuggest.forEach(function(cardCompt,i){cc.log("cardCompt up "+cardCompt.getCardData().toString);cardCompt.onSuggestUp(true)});break}}else if(arrayMoveDown.length)arrayMoveDown.forEach(function(cardCompt,i){cc.log("cardCompt move down 1 "+cardCompt.getCardData().toString);cardCompt.moveDown(false)})};this.choseNThong=function(cardClick,_pointTLMN,
indexPlayerChose,arraySuggest,sizeSuggest,isRightOnly,arrContainer){if(!sizeSuggest)sizeSuggest=-1;if(!isRightOnly)isRightOnly=false;if(!arrContainer)arrContainer=null;var spriteCards=this.cardList.getCards();var _idBitwise=cardClick.getCardComboIdBitWise();var pointChose=_pointTLMN-1;var i=2;var isCoupleChose=false;var arrayIdxUse=[];if(!isRightOnly){for(var k=indexPlayerChose-1;k>=0;k--){if(sizeSuggest>-1)if(arraySuggest&&arraySuggest.length==sizeSuggest-1)continue;if(arrayIdxUse.length&&arrayIdxUse.indexOf(k)!=
-1)continue;var cardComptTemp=spriteCards[k];var idBitwiseTemp=cardComptTemp.getCardComboIdBitWise();var resultTem=cardClick.getCardComboIdBitWise()&idBitwiseTemp;if(resultTem!==0){if(cardComptTemp.getCardData().pointTLMN==_pointTLMN&&!isCoupleChose){i=0;pointChose++;isCoupleChose=true}else if(cardComptTemp.getCardData().pointTLMN==pointChose)i--;else continue;if(i==0){pointChose--;i=2}arraySuggest.push(cardComptTemp);arrayIdxUse.push(k)}}if(arraySuggest&&arraySuggest.length>=2){var last=arraySuggest[arraySuggest.length-
1];var secondLast=arraySuggest[arraySuggest.length-2];if(last.getCardData().pointTLMN!=secondLast.getCardData().pointTLMN)arraySuggest.pop()}}if(!isCoupleChose&&isRightOnly)for(var k=indexPlayerChose-1;k>=0;k--){var cardComptTemp=spriteCards[k];var idBitwiseTemp=cardComptTemp.getCardComboIdBitWise();var resultTem=cardClick.getCardComboIdBitWise()&idBitwiseTemp;if(resultTem!==0)if(cardComptTemp.getCardData().pointTLMN==_pointTLMN){arraySuggest.push(cardComptTemp);arrayIdxUse.push(k);isCoupleChose=
true;break}}pointChose=_pointTLMN;if(isCoupleChose)pointChose++;var i=2;for(var k=indexPlayerChose+1;k<spriteCards.length;k++){if(sizeSuggest>-1)if(arraySuggest&&arraySuggest.length==sizeSuggest-1)continue;if(arrayIdxUse.length&&arrayIdxUse.indexOf(k)!=-1)continue;var cardComptTemp=spriteCards[k];var idBitwiseTemp=cardComptTemp.getCardComboIdBitWise();cc.log(" ${_idBitwise}  \x3d\x3d\x3d ${idBitwiseTemp}");var resultTem=_idBitwise&idBitwiseTemp;if(resultTem!=0){if(cardComptTemp.getCardData().pointTLMN==
_pointTLMN&&!isCoupleChose){i=0;isCoupleChose=true}else if(cardComptTemp.getCardData().pointTLMN==pointChose)i--;else continue;if(i==0){pointChose++;i=2}cc.log("choseNThong "+cardComptTemp.getCardData().toString);arraySuggest.push(cardComptTemp);arrayIdxUse.push(k)}}if(arrContainer!=null&&arrContainer.length&&arraySuggest.length)for(var idex in arrContainer){var element=arrContainer[idex];if(arraySuggest.indexOf(element)===-1)for(var k=0;k<arraySuggest.length;k++){var el=arraySuggest[k];if(el.getCardData().pointTLMN===
element.getCardData().pointTLMN&&arrContainer.indexOf(el)===-1){arraySuggest.splice(k,1,element);break}}}return arraySuggest};this.suggestClickCard=function(_cardCompt,isUpStatus){if(hiepnh.isUndefined(isUpStatus))isUpStatus=true;var cardsDeaded=this.lastArrCardDeal;var spriteCards=this.cardList.getCards();var indexPlayerChose=-1;spriteCards.forEach(function(card,index){var cardCompt=card;if(cardCompt===_cardCompt)indexPlayerChose=index});cc.log("suggestClickCard indexPlayerChose"+indexPlayerChose);
var isCard2=Utils.isCard2(_cardCompt.getCardData().id);var _pointTLMN=_cardCompt.getCardData().pointTLMN;var isUp=false;var arr=this.getAllCardMoveUp(false,null);var arrCode=this.getAllCardMoveUp(true,null);var isSeqCard=Utils.isSeqCard(arrCode,cc.Global.gameId);var isSamPoint=Utils.isSamPoint(arrCode);var arrNotMe=this.getAllCardMoveUp(false,_cardCompt);for(var index in arrNotMe)cc.log("--card aready up-- "+arrNotMe[index].getCardData().toString);var arrMe=this.getAllCardMoveUp(false);var isDoiThongArrayCountMe=
Utils.isDoiThongArray(arrMe);var isDoiThongArray=Utils.isDoiThongArray(arrNotMe);if(!isDoiThongArray[0]&&isDoiThongArray[1]>=6&&isUpStatus&&cc.Global.gameId===Constant.GAME_ID.TLMN){var lastElement=Utils.getMaxCardInArray(arrNotMe).getCardData();var firstElement=Utils.getMinCardInArray(arrNotMe).getCardData();var clickPoint=_cardCompt.getCardData().pointTLMN;if(firstElement.pointTLMN===clickPoint)arrNotMe.unshift(_cardCompt);if(lastElement.pointTLMN===clickPoint)arrNotMe.push(_cardCompt);isDoiThongArray=
Utils.isDoiThongArray(arrNotMe)}if(isDoiThongArrayCountMe[0]&&isDoiThongArrayCountMe[1]>=8&&cc.Global.gameId===Constant.GAME_ID.TLMN){var isClickCardInArr=arr.indexOf(_cardCompt)==-1?false:true;if(isClickCardInArr){var indexDown=-1;var temArr=arrMe;temArr.forEach(function(card,index){var cardCompt=card;if(cardCompt===_cardCompt)indexDown=index});var arrLeft=temArr.slice(0,indexDown);var arrCodeLeft=arrCode.slice(0,indexDown);if(!arrCodeLeft||!arrCodeLeft.length||arrCodeLeft.length<6){temArr.forEach(function(cardInArr,
i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){if(cardInArr!==_cardCompt)spriteCards[idx].moveDown(false);break}}});return}else if(arrCodeLeft&&arrCodeLeft.length>=6){temArr.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){if(clickPoint<=c.point&&cardInArr!==_cardCompt)spriteCards[idx].moveDown(false);
break}}});return}}}if(isDoiThongArray[0]&&isDoiThongArray[1]>=6&&cc.Global.gameId===Constant.GAME_ID.TLMN){var isClickCardInArr=arr.indexOf(_cardCompt)==-1?false:true;console.log("isUpStatus "+isClickCardInArr);if(isUpStatus&&isClickCardInArr)return;var lastElement=Utils.getMaxCardInArray(arrNotMe).getCardData();var firstElement=Utils.getMinCardInArray(arrNotMe).getCardData();var clickPoint=_cardCompt.getCardData().pointTLMN;if(firstElement.pointTLMN-1<=clickPoint&&lastElement.pointTLMN+1>=clickPoint)return}else if(isUpStatus&&
isDoiThongArrayCountMe[0]&&isDoiThongArrayCountMe[1]>=8&&cc.Global.gameId===Constant.GAME_ID.TLMN){var lastElement=Utils.getMaxCardInArray(arrMe).getCardData();var firstElement=Utils.getMinCardInArray(arrMe).getCardData();var clickPoint=_cardCompt.getCardData().pointTLMN;if(firstElement.pointTLMN===clickPoint){for(var idx in spriteCards){var cardCompt=spriteCards[idx];if(cardCompt!=_cardCompt&&cardCompt.getCardData().pointTLMN===clickPoint)cardCompt.moveDown(false)}return}else if(lastElement.pointTLMN===
clickPoint){for(var idx in spriteCards){var cardCompt=spriteCards[idx];if(cardCompt!=_cardCompt&&cardCompt.getCardData().pointTLMN===clickPoint)cardCompt.moveDown(false)}return}}else if(isSamPoint[0]&&arrCode.length>=2){cc.log("suggestClickCard isSamPoint "+isSamPoint);var isClickCardInArr=arr.indexOf(_cardCompt)==-1?false:true;if(!isUpStatus&&isClickCardInArr)return;var maxSamePoint=isSamPoint[1];arrCode.push(_cardCompt.getCardData().codeCard);var isSame=Utils.isSamPoint(arrCode);if(isSame[0]&&isSame[1]>=
3)return}else if((cc.Global.gameId===Constant.GAME_ID.SAM||cc.Global.gameId===Constant.GAME_ID.TLMN&&!isCard2)&&isSeqCard[0]&&isSeqCard[1]>=3){cc.log("suggestClickCard isSeqCard "+isSeqCard);var isClickCardInArr=arr.indexOf(_cardCompt)==-1?false:true;for(var i=0;i<arr.length;i++){var cardInArr=arr[i];if(cardInArr.getCardData().pointTLMN===_cardCompt.getCardData().pointTLMN)if(cardInArr!==_cardCompt&&cardInArr.isCardMoveUp()){cardInArr.moveDown(false);return}}if(isUpStatus&&isClickCardInArr&&(!cardsDeaded||
!cardsDeaded.length)){var indexDown=-1;var temArr=arr;if(cc.Global.gameId===Constant.GAME_ID.SAM)temArr.sort(function(a,b){var card1=a;var aData=card1.getCardData();var card2=b;var bData=card2.getCardData();return aData.point-bData.point});temArr.forEach(function(card,index){var cardCompt=card;if(cardCompt===_cardCompt)indexDown=index});var arrLeft=temArr.slice(0,indexDown);var arrCodeLeft=arrCode.slice(0,indexDown);var arrRight=[];var arrCodeRight=[];if(indexDown<temArr.length-1){arrRight=temArr.slice(indexDown+
1);arrCodeRight=arrCode.slice(indexDown+1)}var isLeftDown=false;if(arrCodeLeft&&arrCodeLeft.length){isSeqCard=Utils.isSeqCard(arrCodeLeft,cc.Global.gameId);var isSeqCardRight=false;if(arrCodeRight&&arrCodeRight.length)isSeqCardRight=Utils.isSeqCard(arrCodeRight,cc.Global.gameId);cc.log("-------------down card in seq card "+arrCodeRight);if(!isSeqCard[0]||isSeqCard[1]<3){isLeftDown=false;cc.log(" ---- aaaaaaa ");arrLeft.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();
if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){spriteCards[idx].moveDown(false);break}}})}}else isLeftDown=false;if(arrCodeRight&&arrCodeRight.length){isSeqCard=Utils.isSeqCard(arrCodeRight,cc.Global.gameId);if(!isLeftDown||!isSeqCard[0]||isSeqCard[1]<3){cc.log(" ---- bbbb ");arrRight.forEach(function(cardInArr,i){for(var idx in spriteCards){var c=spriteCards[idx].getCardData();if(c.point===cardInArr.getCardData().point&&c.suit===cardInArr.getCardData().suit){spriteCards[idx].moveDown(false);
break}}})}}return}var maxSeqPoint=isSeqCard[2];if(maxSeqPoint<_cardCompt.getCardData().pointTLMN)arrCode.push(_cardCompt.getCardData().codeCard);else arrCode.unshift(_cardCompt.getCardData().codeCard);var isSeqCard=Utils.isSeqCard(arrCode,cc.Global.gameId);if(isSeqCard[0]&&isSeqCard[1]>=3)return}if(arr&&arr.length==2&&cc.Global.gameId===Constant.GAME_ID.TLMN){var p=_cardCompt.getCardData().pointTLMN;var indexInArr=arr.indexOf(_cardCompt);if(indexInArr===-1){var arraySuggest=[];var p2=arr[0].getCardData().pointTLMN;
var cardMin=p<p2?_cardCompt:arr[0];var cardMax=p>p2?_cardCompt:arr[0];var indexMin=this.getIndexCard(cardMin);var indexMax=this.getIndexCard(cardMax);var pointMin=p<p2?p:p2;var pointMax=p>p2?p:p2;var indexFirst=indexMin;var cardComFirst=cardMin;var pointFirst=pointMin;cc.log("max--min ${pointMax}----${pointMin} ");cc.log("clickcard---- "+_cardCompt.getCardData().toString);var diffPoint=pointMax-pointMin;var suggestDoiLength=1+diffPoint;if(suggestDoiLength<3)suggestDoiLength=3;var resultThong=Utils.getDoiThong(spriteCards,
suggestDoiLength);if(resultThong.length)resultThong.forEach(function(thong,i){if(thong.length>=6)thong.forEach(function(cardInThong,i){cardInThong.setCardComboIdBitWise(CARD_COMBO.N_DOITHONG)})});cc.log(" resultThong---- "+resultThong.length);if(resultThong.length){var isExitThong=false;var thiz=this;resultThong.forEach(function(arrThong,i){if(!isExitThong)if(arrThong.indexOf(arr[0])!=-1&&arrThong.indexOf(arr[1])!=-1&&arrThong.indexOf(_cardCompt)!=-1&&arrThong.length>=suggestDoiLength*2){arrThong.forEach(function(cardInArr,
i){cc.log(" ******** "+cardInArr.getCardData().toString)});cc.log(" ------------------------------");isExitThong=true;isUp=true;cc.log(" ${cardMin} ${pointMin} ${indexMin} ${arraySuggest}");var isRightOnly=true;if(diffPoint>=2)thiz.choseNThong(cardMin,pointMin,indexMin,arraySuggest,suggestDoiLength*2,isRightOnly,[arr[0],arr[1]]);else{var lengthGet=10;while(lengthGet>6&&(!arraySuggest||!arraySuggest.length)){thiz.choseNThong(cardMin,pointMin,indexMin,arraySuggest,lengthGet,isRightOnly,[arr[0],arr[1]]);
lengthGet-=2}}cc.log(" resultThong----arraySuggest chose array "+arraySuggest.length);if(arraySuggest&&arraySuggest.length+1>=6){var isOk=true;arraySuggest.forEach(function(cardInArr,i){cc.log(" ----chose "+cardInArr.getCardData().toString);if(_cardCompt!=cardInArr)if(cardInArr.getCardData().pointTLMN===_cardCompt.getCardData().pointTLMN){if(isOk){isOk=false;cardInArr.onSuggestUp(true)}}else{cc.log(p2+" point---- "+cardInArr.getCardData().toString);cardInArr.onSuggestUp(true)}})}else for(var i in arr)arr[i].moveDown(false)}})}}}if(isUp)return;
cc.log("ko vao dayyyy----- length "+arr.length);if(arr&&arr.length==1){var p=_cardCompt.getCardData().pointTLMN;if(_cardCompt!=arr[0]&&p==arr[0].getCardData().pointTLMN){isUp=true;for(var index=indexPlayerChose;index<spriteCards.length;index++){var card=spriteCards[index];var cardCompt=card;if(_cardCompt!==cardCompt)if(_cardCompt.getCardData().pointTLMN==cardCompt.getCardData().pointTLMN){cardCompt.onSuggestUp(true);isUp=true}}}}if(!isUp){var isCard2=Utils.isCard2(_cardCompt.getCardData().id);var arraySuggest=
[];if(!isCard2&&arr&&arr.length===1&&!Utils.isCard2(arr[0].getCardData().id)){var p=_cardCompt.getCardData().pointTLMN;var p2=arr[0].getCardData().pointTLMN;var diff=p2-p;diff=Math.abs(diff);var cardMin=p<p2?_cardCompt:arr[0];var cardMax=p>p2?_cardCompt:arr[0];var indexMin=this.getIndexCard(cardMin);var indexMax=this.getIndexCard(cardMax);if(diff===1){arraySuggest.length=0;var pointTLMN=cardMin.getCardData().pointTLMN;pointTLMN=cardMax.getCardData().pointTLMN;for(var index=indexMax+1;index<spriteCards.length;index++){var card=
spriteCards[index];var cardCompt=card;var isCard2=Utils.isCard2(cardCompt.getCardData().id);if(isCard2)break;var cardData=cardCompt.getCardData();if(_cardCompt!==cardCompt&&arr[0]!==cardCompt)if(cardData.pointTLMN==pointTLMN+1){arraySuggest.push(cardCompt);pointTLMN++}}if(arraySuggest&&arraySuggest.length>=1){isUp=true;arraySuggest.forEach(function(suggest,index){if(suggest.getCardData().pointTLMN==_cardCompt.getCardData().pointTLMN||suggest.getCardData().pointTLMN==arr[0].getCardData().pointTLMN);
else{cc.log("tlmn push ..."+suggest.getCardData().toString);suggest.onSuggestUp(true)}})}else arraySuggest.length=0}else{arraySuggest.length=0;pointTLMN=cardMin.getCardData().pointTLMN;for(var index=indexMin+1;index<indexMax;index++){var card=spriteCards[index];var cardCompt=card;var isCard2=Utils.isCard2(cardCompt.getCardData().id);if(isCard2)break;var cardData=cardCompt.getCardData();if(_cardCompt!==cardCompt&&arr[0]!==cardCompt)if(cardData.pointTLMN==pointTLMN+1){arraySuggest.push(cardCompt);pointTLMN++}}var requireLength=
diff+1-1-1;if(arraySuggest&&arraySuggest.length>=requireLength){isUp=true;arraySuggest.forEach(function(suggest,index){if(suggest.getCardData().pointTLMN==_cardCompt.getCardData().pointTLMN||suggest.getCardData().pointTLMN==arr[0].getCardData().pointTLMN);else{cc.log("tlmn push ..."+suggest.getCardData().toString);suggest.onSuggestUp(true)}})}else arraySuggest.length=0}}if(cc.Global.gameId===Constant.GAME_ID.SAM){var temSpriteCards=Utils.deepCoppyArray(spriteCards);temSpriteCards.sort(function(a,
b){var card1=a;var aData=card1.getCardData();var card2=b;var bData=card2.getCardData();return aData.point-bData.point});if(arr&&arr.length===1){var p=_cardCompt.getCardData().point;var p2=arr[0].getCardData().point;var diff=p2-p;diff=Math.abs(diff);var cardMin=p<p2?_cardCompt:arr[0];var cardMax=p>p2?_cardCompt:arr[0];var indexMin=this.getIndexCard(cardMin,temSpriteCards);var indexMax=this.getIndexCard(cardMax,temSpriteCards);if(diff===1){var arraySuggestSam=[];var point=cardMin.getCardData().point;
for(var index=indexMin-1;index>=0;index--){var card=temSpriteCards[index];var cardCompt=card;var cardData=cardCompt.getCardData();if(_cardCompt!==cardCompt&&arr[0]!==cardCompt)if(cardData.point==point-1){arraySuggestSam.push(cardCompt);point--}}point=cardMax.getCardData().point;for(var index=indexMax+1;index<temSpriteCards.length;index++){var card=temSpriteCards[index];var cardCompt=card;var cardData=cardCompt.getCardData();if(_cardCompt!==cardCompt&&arr[0]!==cardCompt)if(cardData.point==point+1){arraySuggestSam.push(cardCompt);
point++}}if(arraySuggestSam&&arraySuggestSam.length>=1){isUp=true;arraySuggestSam.forEach(function(suggest,index){if(suggest.getCardData().point==_cardCompt.getCardData().point||suggest.getCardData().point==arr[0].getCardData().point);else{var idx=spriteCards.indexOf(suggest);for(var idx in spriteCards){var cardComp=spriteCards[idx];var c=cardComp.getCardData();if(c.point===suggest.getCardData().point&&c.suit===suggest.getCardData().suit)if(arraySuggest.length){var firstSeqTlmn=arraySuggest[0].getCardData().pointTLMN;
var lastPointTlmn=arraySuggest[arraySuggest.length-1].getCardData().pointTLMN;if(c.pointTLMN<firstSeqTlmn||c.pointTLMN>lastPointTlmn){spriteCards[idx].onSuggestUp(true);break}}else{spriteCards[idx].onSuggestUp(true);break}}}})}}else{var arraySuggestSam=[];point=cardMin.getCardData().point;for(var index=indexMin+1;index<indexMax;index++){var card=temSpriteCards[index];var cardCompt=card;var cardData=cardCompt.getCardData();if(_cardCompt!==cardCompt&&arr[0]!==cardCompt)if(cardData.point==point+1){arraySuggestSam.push(cardCompt);
point++}}var requireLength=diff+1-1-1;if(arraySuggestSam&&arraySuggestSam.length>=requireLength){isUp=true;arraySuggestSam.forEach(function(suggest,index){if(suggest.getCardData().point==_cardCompt.getCardData().point||suggest.getCardData().point==arr[0].getCardData().point);else for(var idx in spriteCards){var cardComp=spriteCards[idx];var c=cardComp.getCardData();if(c.point===suggest.getCardData().point&&c.suit===suggest.getCardData().suit)if(arraySuggest.length){var firstSeqTlmn=arraySuggest[0].getCardData().pointTLMN;
var lastPointTlmn=arraySuggest[arraySuggest.length-1].getCardData().pointTLMN;if(c.pointTLMN<firstSeqTlmn||c.pointTLMN>lastPointTlmn){spriteCards[idx].onSuggestUp(true);break}}else{spriteCards[idx].onSuggestUp(true);break}}})}}}}}if(isUp)return;if(!isUp)spriteCards.forEach(function(card,index){var cardCompt=card;if(cardCompt!==_cardCompt)if(cardCompt.isCardMoveUp())cardCompt.moveDown(false)})};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();function BaseGame(dataGame){this.animation=[];PIXI.Container.call(this)}BaseGame.CONSTANT_VALUE_SLOT=.064;BaseGame.prototype=Object.create(PIXI.Container.prototype);BaseGame.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};
BaseGame.prototype.stopAction=function(action){if(action)if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>0;i--)if(this.animation[i]==action){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1);action=null;break}};BaseGame.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};function BaseSlotGame(dataGame){cc.log("initgame with data BaseSlotGame "+JSON.stringify(dataGame));BaseGame.call(this,dataGame);this.position.x=0;this.position.y=0;this.data=dataGame;this.type="BaseSlotGame";MiniGameClient.getInstance().addListener(kCMD.DESTROY_GAME,this.onRecvDestroyGame,this)}BaseSlotGame.prototype=Object.create(BaseGame.prototype);BaseSlotGame.prototype.updateGame=function(dt){};BaseSlotGame.prototype.updateSchedule=function(dt,target){var thiz=target?target:this;thiz.updateGame(dt)};
BaseSlotGame.prototype.scheduleUpdate=function(){var thiz=this;this._elapsePlay=Date.now();if(!this.scheduleAction){this.scheduleAction=new hiepnh.updateGameSlotTimer(this.updateSchedule,60,this);console.log("scheduleUpdate  start")}else console.log("scheduleUpdate fail to start")};BaseSlotGame.prototype.unScheduleUpdate=function(){if(this.scheduleAction){this.scheduleAction=null;this.scheduleAction.stop();this.scheduleAction.remove();this.scheduleAction=null}};
BaseSlotGame.prototype.checkLogin=function(){if(MiniGameClient.getInstance().isLoginDone())return true;return false};BaseSlotGame.prototype.addBg=function(){var sprite=PIXI.Sprite.fromImage("res/bg/bg_game.jpg");sprite.anchor.set(.5,.5);sprite.x=MyPixiSlot.rendererGame.width/2;sprite.y=MyPixiSlot.rendererGame.height/2;sprite.displayGroup=MyPixiSlot.gameRootLayer;MyPixiSlot.gameContainer.addChild(sprite)};
BaseSlotGame.prototype.addBackGround=function(bgPath){var sprite=PIXI.Sprite.fromImage(bgPath);sprite.anchor.set(.5,.5);sprite.x=MyPixiSlot.rendererGame.width/2;sprite.y=MyPixiSlot.rendererGame.height/2;MyPixiSlot.gameContainer.addChild(sprite);return sprite};BaseSlotGame.prototype.swapTexture=function(sprite,newTexture){sprite.texture=newTexture};
BaseSlotGame.prototype.scaleGameView=function(scaleValue){MyPixiSlot.gameScale=scaleValue;MyPixiSlot.gameContainer.scale.set(MyPixiSlot.gameScale,MyPixiSlot.gameScale);MyPixiSlot.popupContainer.scale.set(MyPixiSlot.gameScale,MyPixiSlot.gameScale);var x=(1-MyPixiSlot.gameScale)*MyPixiSlot.rendererGame.width/2;MyPixiSlot.gameContainer.position.x=x;MyPixiSlot.popupContainer.position.x=x};
BaseSlotGame.prototype.preloadSpine=function(arrSpine,callback,target){var loaderSpine=new PIXI.loaders.Loader;for(var i=0;i<arrSpine.length;i++)if(!MyPixiSlot.loaderSpine||!MyPixiSlot.loaderSpine.resources[arrSpine[i]])loaderSpine.add(arrSpine[i]);loaderSpine.once("complete",onLoaded);loaderSpine.load();var target=target?target:this;function onLoaded(loader,resources){for(var key in resources){if(!resources.hasOwnProperty(key))continue;if(!PIXI.loader.resources.hasOwnProperty(key))PIXI.loader.resources[key]=
resources[key]}MyPixiSlot.loaderSpine=PIXI.loader;if(callback)callback(target);console.log("BaseSlotGame\x3d\x3d\x3d\x3dLOADING SPINE DONE\x3d\x3d\x3d\x3d")}};
BaseSlotGame.prototype.loadSpineThenCallBack=function(jsonPath,callback,target){if(!MyPixiSlot.loaderSpine||!MyPixiSlot.loaderSpine.resources[jsonPath]){var loaderSpine=new PIXI.loaders.Loader;loaderSpine.add(jsonPath);loaderSpine.once("complete",onLoaded);loaderSpine.load();var target=target?target:this;function onLoaded(loader,resources){for(var key in resources){if(!resources.hasOwnProperty(key))continue;if(!PIXI.loader.resources.hasOwnProperty(key))PIXI.loader.resources[key]=resources[key]}MyPixiSlot.loaderSpine=
PIXI.loader;if(callback)callback(target)}}else if(callback)callback(target)};BaseSlotGame.prototype.backButtonClickHandler=function(){};BaseSlotGame.prototype.playSoundAction=function(nameSound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;cc.playSound(nameSound)};BaseSlotGame.prototype.playEffect=function(audio,nameSound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;audio.play(nameSound)};
BaseSlotGame.prototype.playMusic=function(audio,nameSound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;audio.play(nameSound)};BaseSlotGame.prototype.onRecvDestroyGame=function(cmd,dataObj){MiniGameClient.getInstance().removeListener(this);LobbyClient.getInstance().onUpdateMoney();this.stopAllActions()};BaseSlotGame.prototype.onShowNotice=function(msg,timeShowInMilisec){MessageNode.getInstance().show(msg,timeShowInMilisec/1E3)};
BaseSlotGame.prototype.showSystemNotice=function(msg,timeShowInSec){if(!timeShowInSec)timeShowInSec=2;MessageNode.getInstance().show(msg,timeShowInSec)};function ItemSpin(pngPath,inPlist){this.animation=[];PIXI.Sprite.call(this,inPlist?PIXI.Texture.fromFrame(pngPath):PIXI.Texture.fromImage(pngPath));this.finalPos=cc.p(0,0);this.resetAll()}ItemSpin.CONSTANT_VALUE_SLOT=.064;ItemSpin.prototype=Object.create(PIXI.Sprite.prototype);ItemSpin.prototype.swapTexture=function(newTexture){this.texture=newTexture};
ItemSpin.prototype.setFinalPos=function(p){this.finalPos=p};ItemSpin.prototype.getFinalPos=function(){return this.finalPos};ItemSpin.prototype.setWaitToShow=function(b){this.waitToShow=b};ItemSpin.prototype.resetAll=function(){this.waitToShow=false;this.bounceTop=.2;this.bounceBot=this.bounceTop;this.stopUpdatePos=false;this.scale.set(1,1);if(this.bounceAction){this.stopAction(this.bounceAction);this.bounceAction=null}};
ItemSpin.prototype.runBounceToFinish=function(){this.stopUpdatePos=true;if(this.bounceAction){this.stopAction(this.bounceAction);this.bounceAction=null}var ac1=cc.moveBy(.1,cc.p(0,20));var ac2=cc.moveBy(.1,cc.p(0,-20));this.bounceAction=this.runAction(this,cc.sequence(ac1,ac2))};ItemSpin.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};
ItemSpin.prototype.stopAction=function(action){if(action)if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>0;i--)if(this.animation[i]==action){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1);action=null;break}};ItemSpin.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};function MainSlot(gameID){if(hiepnh.isUndefined(gameID))gameID=-1;this.gameId=gameID;cc.Global.gameId==gameID;cc.log("slot id "+gameID);if(gameID!=undefined)switch(gameID){case SLOT_GAME_MINI.KIM_CUONG:this.app=new PIXI.Application(cc.Global.KimCuongView.width,cc.Global.KimCuongView.height,{view:slotCanvas,backgroundColor:0,transparent:true,antialias:true,resolution:1});break;case SLOT_GAME_MINI.TAM_GIOI:this.app=new PIXI.Application(cc.Global.TamGioiView.width,cc.Global.TamGioiView.height,{view:slotCanvas,
backgroundColor:0,transparent:true,antialias:true,resolution:1});break;case SLOT_GAME_MINI.THAN_DEN:this.app=new PIXI.Application(cc.Global.ThanDenView.width,cc.Global.ThanDenView.height,{view:slotCanvas,backgroundColor:0,transparent:true,antialias:true,resolution:1});break;case SLOT_GAME_MINI.SPARTA:this.app=new PIXI.Application(cc.Global.SpartaView.width,cc.Global.SpartaView.height,{backgroundColor:0,transparent:true,antialias:true,resolution:1});$("#sparta_canvas").html(this.app.view);break;case SLOT_GAME_MINI.DAOCA:this.app=
new PIXI.Application(cc.Global.DaocaView.width,cc.Global.DaocaView.height,{backgroundColor:0,transparent:true,antialias:true,resolution:1});$("#daoca_canvas").html(this.app.view);break}var zorder=0;this.app.stage.displayList=new PIXI.DisplayList;MyPixiSlot.gameRootLayer=new PIXI.DisplayGroup(zorder,function(sprite){});zorder++;MyPixiSlot.gameBackgroudLayer=new PIXI.DisplayGroup(zorder,function(sprite){});zorder++;MyPixiSlot.gameButtonLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixiSlot.groupItemGame=
new PIXI.DisplayGroup(zorder,false);zorder++;MyPixiSlot.cardLayer=new PIXI.DisplayGroup(zorder,function(sprite){if(sprite._selected)sprite.zOrder=-((cc.convertToWorldSpace(sprite).y+Card.SELECT_MOVE_DISTANCE)*1280+sprite.x);else sprite.zOrder=-(cc.convertToWorldSpace(sprite).y*1280+sprite.x)});zorder++;MyPixiSlot.animationLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixiSlot.noticeLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixiSlot.popupLayer=new PIXI.DisplayGroup(zorder,false);
zorder++;MyPixiSlot.topLayer=new PIXI.DisplayGroup(zorder,false);var gameContainer=new PIXI.Container;var popupContainer=new PIXI.Container;MyPixiSlot.gameScale=1;gameContainer.scale.set(MyPixiSlot.gameScale,MyPixiSlot.gameScale);popupContainer.scale.set(MyPixiSlot.gameScale,MyPixiSlot.gameScale);var x=(1-MyPixiSlot.gameScale)*this.app.renderer.width/2;gameContainer.position.x=x;popupContainer.position.x=x;this.app.stage.addChild(gameContainer);this.app.stage.addChild(popupContainer);MyPixiSlot.rendererGame=
this.app.renderer;MyPixiSlot.stageGame=this.app.stage;MyPixiSlot.gameContainer=gameContainer;MyPixiSlot.popupContainer=popupContainer;MyPixiSlot.app=this.app;if(!MiniGameClient.getInstance().loadResource){cc.log("-------loading resouce because loadfail startgame");if(window.MessageNodeSlot)MessageNodeSlot.getInstance().show("\u0110ang t\u1ea3i \u1ea3nh. Vui l\u00f2ng ch\u1edd",10);this.loadSpriteSheet()}else{cc.log("-------loading resouce ignore aready load");this.initSlot()}}
MainSlot.prototype.loadSpriteSheet=function(){if(window.MessageNodeSlot)MessageNodeSlot.getInstance().show("\u0110ang t\u1ea3i \u1ea3nh. Vui l\u00f2ng ch\u1edd");var loader=new PIXI.loaders.Loader;var tempResourceFile=[];var tempResourceSpin=[];switch(this.gameId){case SLOT_GAME_MINI.TAM_GIOI:tempResourceFile=LIST_RESOURCE_FILE_TAM_GIOI;break;case SLOT_GAME_MINI.KIM_CUONG:tempResourceFile=LIST_RESOURCE_FILE_KIM_CUONG;break;case SLOT_GAME_MINI.SPARTA:tempResourceFile=LIST_RESOURCE_FILE_SPARTA;break;
case SLOT_GAME_MINI.DAOCA:tempResourceFile=LIST_RESOURCE_FILE_DAOCA;break;case SLOT_GAME_MINI.THAN_DEN:tempResourceFile=LIST_RESOURCE_FILE_THANDEN;break;default:break}for(var i=0;i<tempResourceFile.length;i++)loader.add(tempResourceFile[i]);loader.once("complete",this.spriteSheetLoaded.bind(this));loader.load();var loaderSpine=new PIXI.loaders.Loader;switch(this.gameId){case SLOT_GAME_MINI.TAM_GIOI:tempResourceFile=LIST_RESOURCE_SPIN_FILE_TAM_GIOI;break;case SLOT_GAME_MINI.KIM_CUONG:tempResourceSpin=
LIST_RESOURCE_SPIN_FILE_KIM_CUONG;break;case SLOT_GAME_MINI.SPARTA:tempResourceSpin=LIST_RESOURCE_SPIN_FILE_SPARTA;break;case SLOT_GAME_MINI.DAOCA:tempResourceSpin=LIST_RESOURCE_SPIN_FILE_DAOCA;break;case SLOT_GAME_MINI.THAN_DEN:break;default:break}var length=tempResourceSpin.length;cc.log("length tempResourceSpin "+length);if(!length||length==0)this.onLoaded();for(var i=0;i<tempResourceSpin.length;i++)loaderSpine.add(tempResourceSpin[i]);loaderSpine.once("complete",onLoaded);loaderSpine.load()};
MainSlot.prototype.onLoaded=function(loader,resources){MyPixiSlot.loaderSpine=loader;this.loadedSpine=true;if(this.loadedSpriteSheet)this.initSlot()};MainSlot.prototype.spriteSheetLoaded=function(){this.loadedSpriteSheet=true;if(this.loadedSpine)this.initSlot()};
MainSlot.prototype.initSlot=function(){if(this.initSlotGame)return;if(window.MessageNodeSlot)MessageNodeSlot.getInstance().hide();this.initSlotGame=true;MyPixiSlot.isDestroy=false;this.lastUpdate=(new Date).getTime();var thiz=this;this.slotFactory=new SlotFactory(this.app,this.gameId);var smoothie=new Smoothie({engine:PIXI,renderer:MyPixiSlot.rendererGame,root:MyPixiSlot.stageGame,update:this.updateSmothie.bind(this),interpolate:false});smoothie.start();var updateFunc=function(){thiz.updateSmothie()};
hiepnh.hotfixFunction(updateFunc)};MainSlot.prototype.updateSmothie=function(){var _now=(new Date).getTime();var dt=(_now-this.lastUpdate)/1E3;this.lastUpdate=_now;if(MyPixiSlot.isDestroy)return;this.updateGame(dt)};
MainSlot.prototype.updateGame=function(dt){if(MyPixiSlot.isDestroy)return;if(this.app&&this.app.renderer){this.app.renderer.render(this.app.stage);PIXI.timerManager.update(dt);PIXI.actionManager.update();if(this.gameId==SLOT_GAME_MINI.TAM_GIOI)if(TamGioiGame&&TamGioiGame.emitter)TamGioiGame.emitter.update(dt);if(this.gameId==SLOT_GAME_MINI.KIM_CUONG)if(KimCuongGame&&KimCuongGame.emitter)KimCuongGame.emitter.update(dt)}};function VirtualButton(size){PIXI.Container.call(this);this.displayGroup=MyPixi.popupLayer;this.interactive=true;this.x=0;this.y=0;var thiz=this;thiz.buttonSize=size;this.canTouch=true;thiz.graphicsBg=new PIXI.Graphics;this.addChild(thiz.graphicsBg);thiz.graphicsBg.clear();thiz.graphicsBg.beginFill(0,0,3);thiz.graphicsBg.drawRect(0,0,thiz.buttonSize.width,thiz.buttonSize.height);thiz.graphicsBg.endFill();var onButtonMove=function(){};var onButtonUp=function(){};var onButtonOver=function(){};var onButtonOut=
function(){};this.interactive=true;this.buttonMode=true;this.on("pointerdown",this.onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut).on("pointermove",onButtonMove)}VirtualButton.prototype=Object.create(PIXI.Container.prototype);VirtualButton.prototype.setEnableOutSizeClose=function(enable){};
VirtualButton.prototype.setTouchEnabled=function(enable){this.canTouch=enable;this.buttonMode=enable;this.interactive=enable;if(TEST_MODE)this.showBlurBg(enable)};VirtualButton.prototype.clickHandler=function(){};VirtualButton.prototype.onButtonDown=function(event){var thiz=this;if(!thiz.canTouch)return;var dragPoint=event.data.getLocalPosition(thiz);var recBg=cc.rect(0,0,thiz.buttonSize.width,thiz.buttonSize.height);if(cc.rectContainsPoint(recBg,dragPoint))if(thiz.clickHandler)thiz.clickHandler()};
VirtualButton.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.buttonSize.width,this.buttonSize.height);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};function BettingXocDiaToggleItem(bg,selectBorder){PIXI.Sprite.call(this,PIXI.Texture.fromFrame(bg));this.position.x=0;this.position.y=0;var selectSprite=PIXI.Sprite.fromFrame(selectBorder);selectSprite.anchor.set(.5,.5);selectSprite.position.set(this.width/2-2,this.height/2-3);this.addChild(selectSprite);this.selectSprite=selectSprite;this.selectSprite.visible=false;this.onLabel=cc.LabelTTF("1",cc.res.font.Arial,25,null,"white");this.onLabel.anchor.set(.5,.5);this.onLabel.position.set(this.width/
2,this.height/2+60);this.addChild(this.onLabel);this.onSelect=null;this.onUnSelect=null}BettingXocDiaToggleItem.prototype=Object.create(PIXI.Sprite.prototype);BettingXocDiaToggleItem.prototype.setMoney=function(money){this.onLabel.text=cc.Global.NumberFormat2(money);this.betting=money};BettingXocDiaToggleItem.prototype.select=function(isForce){if(this.onSelect)this.onSelect(isForce);this.setTouchEnabled(false);this.selectSprite.visible=true};
BettingXocDiaToggleItem.prototype.unSelect=function(isForce){if(this.onUnSelect)this.onUnSelect(isForce);this.setTouchEnabled(true);this.selectSprite.visible=false};BettingXocDiaToggleItem.prototype.setTouchEnabled=function(enable){this.interactive=enable;this.buttonMode=enable;this.displayGroup=MyPixi.gameRootLayer};function ToggleNodeGroup(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.mItem=[];this.itemClicked=null}ToggleNodeGroup.prototype=Object.create(PIXI.Container.prototype);
ToggleNodeGroup.prototype.addItem=function(item,onSelectCb){this.mItem.push(item);this.addChild(item);var thiz=this;item.on("pointerdown",function(){thiz.onClickedItem(item)})};ToggleNodeGroup.prototype.onClickedItem=function(item){if(this.itemClicked){this.itemClicked.unSelect(false);this.itemClicked=null}this.itemClicked=item;this.itemClicked.select(false)};
ToggleNodeGroup.prototype.selectItem=function(index){var item=this.mItem[index];if(this.itemClicked){this.itemClicked.unSelect(true);this.itemClicked=null}this.itemClicked=item;this.itemClicked.select(true)};ToggleNodeGroup.prototype.onEnter=function(){this.itemClicked=null;for(var i=0;i<this.mItem.length;i++)this.mItem[i].unSelect(true)};var hiepnh=hiepnh||{};
hiepnh.ActionNumber=function(duration,targetNumber,currentNumber,label){this._startNumber=currentNumber;this._currentNumber=currentNumber;this._targetNumber=targetNumber;var thiz=this;var timeRemain=duration*1E3;var timer=PIXI.timerManager.createTimer(duration*1E3);timer.on("update",function(elapsedTime,dt){var number=Math.floor((thiz._targetNumber-thiz._startNumber)*elapsedTime/(duration*1E3)+thiz._startNumber);if(thiz._currentNumber==number)return;thiz._currentNumber=number;label.text=cc.Global.NumberFormat1(number)});
timer.start();return timer};hiepnh.ActionTimer=function(duration,callback){var thiz=this;thiz.callback=callback;var timeRemain=duration*1E3;var timer=PIXI.timerManager.createTimer(duration*1E3);timer.expire=true;timer._callbackHiepnh=callback;timer.on("update",function(elapsedTime,dt){if(MyPixi.isDestroy||MyPixiSlot.isDestroy)return;timer._callbackHiepnh(dt)});timer.start();return timer};
hiepnh.MoveRotate=function(duration,pivot,angle,target,callback){var thiz=this;this.angle=angle;this.pivot=pivot;this._target=target;this._originPosition=cc.p(target.x,target.y);thiz.callback=callback;var timeRemain=duration*1E3;var timer=PIXI.timerManager.createTimer(duration*1E3);timer.on("update",function(elapsedTime,dt){cc.log("elapsedTime"+elapsedTime+" dt "+dt);if(MyPixi.isDestroy)return;thiz.callback(elapsedTime)});timer.start();return timer};
hiepnh.updateGameSlotTimer=function(callback,duration,target){if(!duration)duration=60;var thiz=this;thiz.callback=callback;var timer=PIXI.timerManager.createTimer(duration*1E3);timer.expire=true;timer.loop=true;timer._callbackHiepnh=callback;timer.on("update",function(elapsedTime,dt){if(MyPixiSlot.isDestroy)return;timer._callbackHiepnh(dt,target)});timer.start();return timer};var CardAlign=CardAlign||{};CardAlign.LEFT=1;CardAlign.CENTER=2;CardAlign.RIGHT=3;var CardSuit=CardSuit||{};CardSuit.Spades=1;CardSuit.Clubs=2;CardSuit.Diamonds=3;CardSuit.Hearts=4;var state_card=state_card||{};state_card.NOTHING=0;state_card.ORANGE_BORDER=1;state_card.TRI_ANGLE=2;var s_card_suit=s_card_suit||[];s_card_suit[CardSuit.Hearts]="c";s_card_suit[CardSuit.Diamonds]="r";s_card_suit[CardSuit.Clubs]="t";s_card_suit[CardSuit.Spades]="b";
function Card(rank,suit,listener){this.animation=[];PIXI.Sprite.call(this,PIXI.Texture.fromFrame(rank+s_card_suit[suit]+".png"));this.displayGroup=MyPixi.cardLayer;this.canTouch=true;this.canMove=false;this.point=rank;this.suit=suit;this.listener=listener;this.widthContainer=this.width;this.heightContainer=this.height;var remainBg=PIXI.Sprite.fromFrame("button/elip_cards.png");remainBg.anchor.set(.5,.5);this.addChild(remainBg);this.remainBg=remainBg;this.remainBg.visible=false;this.remainCard=13;
if(cc.Global.gameId==Constant.GAME_ID.SAM)this.remainCard=10;this.lblRemain=cc.LabelTTF(""+this.remainCard,cc.res.font.Roboto_Condensed,30,null,"000000");this.lblRemain.anchor.set(.5,.5);remainBg.addChild(this.lblRemain);var blurBg=PIXI.Sprite.fromFrame("white_card.png");blurBg.alpha=.4;blurBg.anchor.set(.5,.5);this.blurBg=blurBg;this.addChild(this.blurBg);this.blurBg.visible=false;this.effectSprite=PIXI.Sprite.fromFrame("card_select1.png");this.effectSprite.anchor.set(.5,.5);this.addChild(this.effectSprite);
this.effectSprite.visible=false;this.touchRect=cc.rect(-this.widthContainer/2,-this.heightContainer/2,this.widthContainer,this.heightContainer);this.cardDistance=this.widthContainer;this.originState=state_card.NOTHING;this.originScale=this.scale.y;this.originVisible=true;this.originShowBack=false;this.origin=cc.p();this.isTouched=false;this._selected=false;this.interactive=true;this.buttonMode=true;var thiz=this;var onButtonDown=function(){cc.log("onButtonDown")};var onButtonMove=function(){thiz.onButtonMove()};
var onButtonUp=function(){cc.log("onButtonUp")};var onButtonOver=function(){};var onButtonOut=function(){};this.on("mousedown",this.onButtonDown).on("touchstart",this.onButtonDown).on("mouseup",this.onButtonUp).on("mouseupoutside",this.onButtonUp).on("touchend",this.onButtonUp).on("touchendoutside",this.onButtonUp).on("mousemove",onButtonMove).on("touchmove",onButtonMove)}Card.prototype=Object.create(PIXI.Sprite.prototype);Card.SELECT_MOVE_DISTANCE=20;Card.prototype.onEnter=function(){};
Card.prototype.onButtonDown=function(event){var thiz=this;thiz.oldGroup=thiz.displayGroup;thiz.isAcpetTouch=false;if(thiz.originState==state_card.TRI_ANGLE){LobbyClient.getInstance().postEvent(kCMD.PHOM_EARN_CARD,{});thiz.isAcpetTouch=false}else if(thiz.canTouch&&!thiz.isTouched){var p=event.data.getLocalPosition(thiz.parent);this.data=event.data;thiz.isTouched=true;thiz.isMoved=false;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isAcpetTouch=true}};
Card.prototype.onButtonUp=function(){var thiz=this;if(!thiz.isAcpetTouch)return;thiz.isTouched=false;if(thiz.isMoved){thiz.moveToOriginPosition();if(thiz.oldGroup)thiz.displayGroup=thiz.oldGroup}else{if(cc.Global.gameId===Constant.GAME_ID.TLMN||cc.Global.gameId===Constant.GAME_ID.SAM)SuggestCardMng.getInstance().onSuggestUpCard(thiz,!thiz.isSelected());thiz.setSelected(!thiz._selected);if(thiz.listener&&thiz.listener.onTouchCard)thiz.listener.onTouchCard(thiz)}};
Card.prototype.onButtonMove=function(){var thiz=this;if(!thiz.isAcpetTouch)return;if(!thiz.canMove)return;var p=this.data.getLocalPosition(thiz.parent);if(!this.isMoved)if(cc.pDistance(thiz.preTouchPoint,p)<5)return;else{if(thiz.oldGroup&&thiz.oldGroup!=MyPixi.cardDragLayer)thiz.displayGroup=MyPixi.cardDragLayer;thiz.isMoved=true}thiz.x+=p.x-thiz.preTouchPoint.x;thiz.y+=p.y-thiz.preTouchPoint.y;thiz.preTouchPoint=p};
Card.prototype.moveToOriginPosition=function(isUp){if(!this.isTouched){this._selected=false;this.stopAllActions();var thiz=this;var beforeMove=new PIXI.action.CallFunc(function(){thiz.displayGroup=MyPixi.cardDragLayer;thiz.reveal(!this.originShowBack);thiz.visible=thiz.originVisible;thiz.showEffectCard(thiz.originState)});var afterMove=new PIXI.action.CallFunc(function(){thiz.displayGroup=MyPixi.cardLayer;if(isUp)thiz.setSelected(true)});this.visible=thiz.originVisible;this.reveal(!this.originShowBack);
var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED;var move=cc.moveTo(animTime,cc.p(this.origin.x,this.origin.y));var scale=cc.scaleTo(animTime,this.originScale);var action=cc.sequence(beforeMove,cc.spawn(move,scale),afterMove);var animation=PIXI.actionManager.runAction(this,action);this.animation.push(animation)}};
Card.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};Card.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};
Card.prototype.setSelected=function(selected){this._selected=selected;if(selected)this.y=this.origin.y-Card.SELECT_MOVE_DISTANCE;else this.y=this.origin.y};Card.prototype.isSelected=function(){return this._selected};Card.prototype.enableMove=function(canMove){this.canMove=canMove};
Card.prototype.moveDown=function(checkSuggest){this.setSelected(false);if(checkSuggest)if(cc.Global.gameId===Constant.GAME_ID.TLMN||cc.Global.gameId===Constant.GAME_ID.SAM)SuggestCardMng.getInstance().onSuggestUpCard(this,this.isSelected())};
Card.prototype.flipCard=function(scaleDefault){var thiz=this;if(!scaleDefault)scaleDefault=thiz.originScale;var action1=cc.scaleTo(.2,cc.p(0,scaleDefault));var action2=cc.scaleTo(.2,scaleDefault);var callback=cc.callFunc(function(){thiz.reveal(true)});var action=cc.sequence(action1,callback,action2);var animation=PIXI.actionManager.runAction(thiz,action);this.animation.push(animation)};
Card.prototype.reveal=function(isShow){if(!isShow)this.texture=PIXI.Texture.fromFrame("card_face_down.png");else this.texture=PIXI.Texture.fromFrame(this.point+s_card_suit[this.suit]+".png")};Card.prototype.isCardMoveUp=function(isBlur){return this.isSelected()};
Card.prototype.showEffectCard=function(stateCard){this.originState=stateCard;this.effectSprite.visible=true;this.effectSprite.position.set(0,0);if(this.effectSpriteAction){PIXI.actionManager.cancelAction(this.effectSpriteAction);this.effectSpriteAction=null}if(stateCard==state_card.NOTHING)this.effectSprite.visible=false;else if(stateCard==state_card.ORANGE_BORDER)this.effectSprite.texture=PIXI.Texture.fromFrame("card_select1.png");else if(stateCard==state_card.TRI_ANGLE){this.effectSprite.texture=
PIXI.Texture.fromFrame("button/triangle.png");var size=cc.size(this.widthContainer,this.heightContainer);this.effectSprite.position.set(0,-90);var ac=cc.sequence(cc.moveTo(.5,cc.p(0,-110)),cc.moveTo(.5,cc.p(0,-90)));var repeat=cc.repeatForever(ac);this.effectSpriteAction=PIXI.actionManager.runAction(this.effectSprite,repeat)}};Card.prototype.revealBlur=function(isBlur){this.blurBg.visible=isBlur;this.blurBg.rotate=this.rotate;this.canTouch=!isBlur};Card.prototype.isBlur=function(){return this.blurBg.visible};
Card.prototype.getCardComboIdBitWise=function(){return this.comboId};Card.prototype.resetCardComboId=function(){this.comboId=CARD_COMBO.NORMAL};Card.prototype.setCardComboIdBitWise=function(id){this.comboId=this.comboId|id};
Card.prototype.showRemainCard=function(isShow,numRemain){if(cc.Global.gameId==Constant.GAME_ID.SAM)if(numRemain<0){var value=this.remainCard+numRemain;cc.log("reduce \x3d\x3e value "+value);if(value>1)isShow=false}else if(numRemain>1)isShow=false;this.remainBg.visible=isShow;if(numRemain){if(numRemain<0)this.remainCard+=numRemain;else this.remainCard=numRemain;var str=this.remainCard<=0?"":""+this.remainCard;this.lblRemain.text=str}this.remainBg.visible=isShow;var scale=this.scale.y;this.remainBg.position.set(scale*
this.widthContainer/2-this.remainBg.width/2-5,-15+scale*this.heightContainer/2-this.remainBg.height/2)};Card.prototype.getCardData=function(){var card=Types.Card(this.point,this.suit);return card};Card.prototype.onSuggestUp=function(forceUp){this.setSelected(true)};
function CardList(size,originScale,align){PIXI.Container.call(this);this.topLeftRoot=cc.p(0,0);this.canTouch=true;this.cardOrigiScale=originScale?originScale:1;this.oldCardOrigiScale=this.cardOrigiScale;this.originVisible=true;this.originShowBack=false;this.align=align?align:CardAlign.LEFT;this.cardList=[];this.size=size;this.widthContainer=size.width;this.heightContainer=size.height;this.deckPoint=cc.p(cc.winSize.width/2,cc.winSize.height/2)}CardList.prototype=Object.create(PIXI.Container.prototype);
CardList.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};CardList.prototype.resetOrigin=function(size){this.cardOrigiScale=this.oldCardOrigiScale;this.cardSize=null};
CardList.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.size.width,this.size.height);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("cardlist showBlurBg")};CardList.prototype.onTouchCard=function(card){if(cc.Global.gameId===Constant.GAME_ID.PHOM)for(var i=0,length=this.cardList.length;i<length;i++){var c=this.cardList[i];if(c.point===card.point&&c.suit==card.suit)continue;if(this.mutiSelect)continue;c.moveDown()}};CardList.prototype.reOrderByPoint=function(arrCodeCard){this.xepbai(arrCodeCard,CardAlign.CENTER)};
CardList.prototype.reOrder=function(){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;else;var dx=width/this.cardList.length;var x=dx/2;var shiftLeft=20;if(dx>=this.cardSize.width-10)dx-=shiftLeft;else shiftLeft=0;if(this.align==CardAlign.CENTER)x=this.widthContainer/2-width/2+this.cardList.length*shiftLeft/2+dx/2;var y=this.heightContainer/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=
cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;card.moveToOriginPosition();x+=dx}}};
CardList.prototype.reOrderWithoutAnimation=function(){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;var dx=width/this.cardList.length;var x=dx/2;if(dx>=this.cardSize.width-10)dx-=20;var y=this.heightContainer/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;card.position.set(x,y);x+=dx}}};CardList.prototype.onEnter=function(){};
CardList.prototype.xepbai=function(arrSuggest,align){if(this.cardList.length!=arrSuggest.length){console.log(this.getCodeCards().toString()+" fuckkkk xepbai");LobbyClient.getInstance().reConnect();return}var newList=[];if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;else;var dx=width/this.cardList.length;var x=dx/2;var shiftLeft=20;if(align==CardAlign.CENTER)x=this.widthContainer/2-width/2+this.cardList.length*shiftLeft/
2+dx/2;if(dx>=this.cardSize.width-10)dx-=20;var y=this.heightContainer/2;for(var i=0;i<arrSuggest.length;i++){var card=this.getCardByRank(arrSuggest[i].point,arrSuggest[i].suit);card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;card.moveToOriginPosition();x+=dx;newList.push(card)}this.cardList.length=0;this.cardList=newList}};CardList.prototype.setDeckPoint=function(deckPoint){var gloalPos=this.getGlobalPosition();this.deckPoint=cc.pSub(deckPoint,gloalPos)};
CardList.prototype.addNewCard=function(cardId,animation,pos,startScale){var arr=[];for(var i=0;i<cardId.length;i++){var card=new Card(cardId[i].point,cardId[i].suit,this);var startPos=pos?pos:this.deckPoint;this.addCard(card);card.anchor.set(.5,.5);card.position.set(startPos.x,startPos.y);var scale=startScale?startScale:this.cardOrigiScale;card.scale.set(scale,scale);arr.push(card)}if(animation)this.reOrder();else this.reOrderWithoutAnimation();return arr};
CardList.prototype.addNewCardWithEffectBorder=function(cardId,animation,moveUpAfterAnim,pos){var arr=this.addNewCard(cardId,animation,moveUpAfterAnim,pos);for(var i=0;i<arr.length;i++)arr[i].showEffectCard(state_card.ORANGE_BORDER)};
CardList.prototype.addCard=function(card){if(!this.cardSize){this.cardSize=cc.size(card.width,card.height);if(this.cardSize.height>this.heightContainer){cc.log("fuckkkk this.heightContainer "+this.heightContainer);var ratio=this.heightContainer/this.cardSize.height;this.cardSize.width*=ratio;this.cardSize.height*=ratio}}if(card.height>this.cardSize.height){this.cardOrigiScale=this.cardSize.height/card.height;card.scale.set(this.cardOrigiScale,this.cardOrigiScale)}card.cardIndex=this.cardList.length;
card.origin=cc.p(0,0);card.originScale=this.cardOrigiScale;card.originVisible=this.originVisible;card.originShowBack=this.originShowBack;card.canTouch=this.canTouch;card.isTouched=false;card.listener=this;var p=cc.p(card.x,card.y);card.position.set(p.x,p.y);this.addChild(card);this.cardList.push(card)};CardList.prototype.setMutiSelectEnable=function(value){this.mutiSelect=value};
CardList.prototype.setTouchEnable=function(touch){this.canTouch=touch;for(var i=0;i<this.cardList.length;i++)this.cardList[i].canTouch=this.canTouch};
CardList.prototype.dealBackCards=function(cards,animation,removeAfterAnim){var oldLength=0;if(this.cardList&&this.cardList.length)oldLength=this.cardList.length;for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit);this.addCard(card);card.anchor.set(.5,.5);card.position.set(this.deckPoint.x,this.deckPoint.y)}var width=this.cardSize.width;if(width>this.widthContainer)width=this.widthContainer;var dx=width;var x=this.widthContainer/2;var y=this.heightContainer/2;var numCardRemain=
13;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;card.reveal(false);var scaleTo=this.cardOrigiScale;if(animation){if(i>=oldLength){card.scale.set(.5,.5);card.visible=false}else;var delayAction=cc.delayTime(.04*i);var beforeAction=cc.callFunc(function(){card.visible=true});var afterAction=cc.callFunc(function(){if(cc.Global.gameId===Constant.GAME_ID.TLMN)card.showRemainCard(true,numCardRemain)});var animTime=cc.pDistance(cc.p(card.x,card.y),
cc.p(x,y))/SPEED;var scaleAction=cc.scaleTo(animTime,scaleTo);var moveAction=cc.moveTo(animTime,cc.p(x,y));var action=cc.sequence(delayAction,beforeAction,cc.spawn(moveAction,scaleAction),afterAction);if(!removeAfterAnim)card.runAction(card,action);else if(i>=oldLength)card.runAction(card,cc.sequence(action,cc.removeSelf(card)));else card.runAction(card,action)}else{card.scale.set(scaleTo,scaleTo);card.position.set(x,y);if(cc.Global.gameId===Constant.GAME_ID.TLMN)card.showRemainCard(true,numCardRemain)}}};
CardList.prototype.dealCards=function(cards,animation,align){this.removeAll();if(!cards||!cards.length)return;for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit,this);this.addCard(card);card.anchor.set(.5,.5);card.position.set(this.deckPoint.x,this.deckPoint.y)}var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;var dx=width/this.cardList.length;var x=dx/2;if(align===CardAlign.CENTER)x=this.widthContainer/2-width/2+
dx/2;else if(align===CardAlign.RIGHT)x=-width+dx/2;if(dx>=this.cardSize.width-10)dx-=20;var y=this.heightContainer/2;var thiz=this;for(var i=0;i<this.cardList.length;i++){var card=thiz.cardList[i];thiz.animChia(card,animation,x,y,dx,i);x+=dx}};
CardList.prototype.animChia=function(card,animation,x,y,dx,i){card.origin=cc.p(x,y);card.originScale=this.cardOrigiScale;card.originVisible=this.originVisible;card.originShowBack=this.originShowBack;card.cardDistance=dx;if(animation){card.reveal(false);card.scale.set(.5*card.originScale,.5*card.originScale);card.visible=false;var delayAction=cc.delayTime(.04*i);var beforeAction=cc.callFunc(function(){card.visible=true});var afterAction=cc.callFunc(function(){card.flipCard(card.originScale)});var animTime=
cc.pDistance(cc.p(card.x,card.y),cc.p(x,y))/SPEED;var scaleAction=cc.scaleTo(animTime,1*card.originScale);var moveAction=cc.moveTo(animTime,cc.p(x,y));var action=cc.sequence(delayAction,beforeAction,cc.spawn(moveAction,scaleAction),afterAction);var animation=PIXI.actionManager.runAction(card,action);card.animation.push(animation)}else card.position.set(x,y)};
CardList.prototype.dealCardsPhom=function(cards,animation,worldPos){if(!cards||!cards.length)return;if(!worldPos)worldPos=this.deckPoint;for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit,this);this.addCard(card);card.anchor.set(.5,.5);card.position.set(worldPos.x,worldPos.y)}if(animation)this.reOrder();else this.reOrderWithoutAnimation()};CardList.prototype.containsWithCard=function(card){cc.log("containsWithCard pending-----------------------");return null};
CardList.prototype.swapCardLeft=function(index){if(index>0){var cardMove=this.cardList[index];var cardSwap=this.cardList[index-1];this.swapCard(cardMove,cardSwap)}};CardList.prototype.swapCardRight=function(index){if(index<this.cardList.length-1){var cardMove=this.cardList[index];var cardSwap=this.cardList[index+1];this.swapCard(cardMove,cardSwap)}};
CardList.prototype.swapCard=function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;card1.origin=card2.origin;card1.cardIndex=card2.cardIndex;card2.origin=_origin;card2.cardIndex=_cardIndex;card1.moveToOriginPosition();card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2};
CardList.prototype.removeCard=function(cards){var arrCard=[];for(var i=0;i<cards.length;i++){var rank=cards[i].point;var suit=cards[i].suit;for(var j=0;j<this.cardList.length;j++){var card=this.cardList[j];if(card.point==rank&&card.suit==suit){arrCard.push(card);this.cardList.splice(j,1);break}}}return arrCard};CardList.prototype.removeAll=function(){this.setMutiSelectEnable(false);this.removeChildren();this.cardList=[]};CardList.prototype.getCardAtIndex=function(index){return this.cardList[index]};
CardList.prototype.getCardByRank=function(rank,suit){var _card;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(card.point==rank&&card.suit==suit){_card=card;break}}return _card};CardList.prototype.getCardSelected=function(){var cardSelected=[];for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].isSelected())cardSelected.push(this.cardList[i]);return cardSelected};
CardList.prototype.resetCardComboId=function(isBlurCardIfNeed){for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(!isBlurCardIfNeed)card.revealBlur(false);card.resetCardComboId()}};CardList.prototype.getCards=function(){return this.cardList};CardList.prototype.getCodeCards=function(){var _card=[];for(var i=0;i<this.cardList.length;i++)_card.push(this.cardList[i].getCardData().codeCard);return _card};
CardList.prototype.isAllBlur=function(){var allBlur=true;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(!card.isBlur()){allBlur=false;break}}return allBlur};CardList.prototype.showRemainCard=function(isShow,numRemain){if(this.cardList.length)this.cardList[0].showRemainCard(isShow,numRemain)};
CardList.prototype.onMoveUpCards=function(arrId){if(!arrId||!arrId.length)return;for(var i=0;i<this.cardList.length;i++){var codeCard=this.cardList[i].getCardData().codeCard;if(arrId.indexOf(codeCard)>-1)this.cardList[i].moveToOriginPosition(true)}};
CardList.prototype.onMoveUpCardPhom=function(arrPhom,arrNotChange){if(!arrNotChange)arrNotChange=[];if(!this.cardList||!this.cardList.length)return;for(var i=0;i<this.cardList.length;i++){var codeCard=this.cardList[i].getCardData().codeCard;if(arrNotChange&&arrNotChange.length&&arrNotChange.indexOf(codeCard)!==-1);else if(arrPhom.indexOf(codeCard)!==-1)this.cardList[i].setSelected(true);else this.cardList[i].setSelected(false)}};
function CardOnTable(_pos,cardOrigiScale){PIXI.Container.call(this);this.cardList=[];this.cardSize=null;this.canTouch=false;this.cardOrigiScale=cardOrigiScale?cardOrigiScale:.5;this.originVisible=true;this.originShowBack=false;this._pos=_pos;if(_pos)this.cardPosition=_pos;else this.cardPosition=cc.p(cc.winSize.width/2,cc.winSize.height/2)}CardOnTable.prototype=Object.create(PIXI.Container.prototype);
CardOnTable.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};
CardOnTable.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};CardOnTable.prototype.setDeckPoint=function(deckPoint){var gloalPos=this.getGlobalPosition();this.cardPosition=cc.pSub(deckPoint,gloalPos);cc.log("CardOnTable cardPosition "+this.cardPosition.x+" : "+this.cardPosition.y)};CardOnTable.prototype.onTouchBegan=function(card){var thiz=this;if(cc.Global.gameId===Constant.GAME_ID.PHOM)if(card.originState==state_card.TRI_ANGLE){var scene=cc.director.getRunningScene();if(scene.sendAnBai)scene.sendAnBai()}};
CardOnTable.prototype.setEarnCard=function(cb){this.cb=cb};CardOnTable.prototype.getCards=function(){return this.cardList};CardOnTable.prototype.getCardByRank=function(rank,suit){var _card;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(card.point==rank&&card.suit==suit){_card=card;break}}return _card};CardOnTable.prototype.onEnter=function(){};
CardOnTable.prototype.reOrder=function(){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;else;var dx=width/this.cardList.length;var x=dx/2;if(dx>=this.cardSize.width-10)dx-=20;var y=this.cardPosition.y;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;card.moveToOriginPosition();x+=dx}}};
CardOnTable.prototype.reOrderWithoutAnimation=function(){if(this.cardList.length>0){var width=this.cardSize.width*this.cardList.length;if(width>this.widthContainer)width=this.widthContainer;var dx=width/this.cardList.length;var x=dx/2;if(dx>=this.cardSize.width-10)dx-=20;var y=this.heightContainer/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dx;card.position.set(x,y);x+=dx}}};
CardOnTable.prototype.moveOldCard=function(){if(this.cardList.length==2){var arr=this.cardList[0];for(var i=0;i<arr.length;i++)if(arr[i].parent){arr[i].stopAllActions();arr[i].parent.removeChild(arr[i])}this.cardList.splice(0,1)}if(this.cardList.length==1){var arr=this.cardList[0];for(var i=0;i<arr.length;i++){arr[i].y-=40;arr[i].revealBlur(true);arr[i].scale.set(.4,.4)}}};
CardOnTable.prototype.addNewCardList=function(cards,startPosition){if(!startPosition)startPosition=this.cardPosition;var arrCard=[];for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit,this);card.canTouch=false;card.anchor.set(.5,.5);card.position.set(startPosition.x,startPosition.y);arrCard.push(card)}this.addCard(arrCard);return arrCard};
CardOnTable.prototype.addNewCardListPhomToTable=function(cards,startPosition,slotId,startScale,showTriAngle){if(!startPosition)startPosition=this.cardPosition;var arrCard=[];for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit,this);card.canTouch=false;if(showTriAngle){card.originState=state_card.TRI_ANGLE;card.showEffectCard(card.originState)}card.anchor.set(.5,.5);card.position.set(startPosition.x,startPosition.y);arrCard.push(card)}this.addCardPhomToTable(arrCard,slotId,
startScale);return arrCard};
CardOnTable.prototype.addCardPhomToTable=function(cards,sitId,startScale){var animationDuration=.3;var _scale=startScale?startScale:this.cardOrigiScale;if(!this.cardSize){var scale=this.cardOrigiScale;this.cardSize=cc.size(cards[0].width*scale,cards[0].height*scale)}var value=1;var oldLength=0;if(this.cardList&&this.cardList.length)oldLength=this.cardList.length;this.cardList=this.cardList.concat(cards);var dx=this.cardSize.width*this.cardOrigiScale;var width=this.cardList.length*dx;var x=this.cardPosition.x+
value*dx/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card._selected=false;if(i>=oldLength){var p=cc.convertToNodeSpace(this,cc.p(card.x,card.y));card.position.set(p.x,p.y);this.addChild(card);card.scale.set(_scale,_scale)}else card.scale.set(this.cardOrigiScale,this.cardOrigiScale);card.stopAllActions();card.reveal(true);card.canTouch=false;card.originScale=this.cardOrigiScale;card.originVisible=true;card.originShowBack=false;card.origin=cc.p(x,this.cardPosition.y);var animationDuration=
cc.pDistance(cc.p(card.x,card.y),card.origin)/SPEED;var moveAction=cc.moveTo(animationDuration,cc.p(x,this.cardPosition.y));var scaleAction=cc.scaleTo(animationDuration,card.originScale);var action=cc.spawn(moveAction,scaleAction);var animation=PIXI.actionManager.runAction(card,action);card.animation.push(animation);var rotate=0;card.rotation=rotate;x+=value*dx}};
CardOnTable.prototype.addCardReconnect=function(cards){var arrCard=[];for(var i=0;i<cards.length;i++){var card=PIXI.Sprite.fromFrame(""+cards[i].point+s_card_suit[cards[i].suit]+".png");arrCard.push(card)}this.addCardWithoutAnimation(arrCard);return arrCard};
CardOnTable.prototype.addCard=function(cards,startScale){var animationDuration=.3;var _scale=startScale?startScale:this.cardOrigiScale;if(!this.cardSize)this.cardSize=cc.size(cards[0].width,cards[0].height);this.cardList.push(cards);var dx=this.cardSize.width*this.cardOrigiScale-20;var width=cards.length*dx;var x=this.cardPosition.x-width/2+dx/2;var rotate=20-Math.random()*40;rotate=cc.Global.degreeToRadian(rotate);for(var i=0;i<cards.length;i++){var card=cards[i];cards._selected=false;var p=cc.p(card.x,
card.y);card.position.set(p.x,p.y);card.stopAllActions();card.cardIndex=i;card.origin=cc.p(x,this.cardPosition.y);card.originScale=this.cardOrigiScale;card.originVisible=this.originVisible;card.originShowBack=this.originShowBack;card.canTouch=this.canTouch;card.reveal(true);card.revealBlur(false);card.scale.set(_scale,_scale);card.rotation=rotate;this.addChild(card);card.moveToOriginPosition();x+=dx}};
CardOnTable.prototype.addCardWithoutAnimation=function(cards){if(!this.cardSize)this.cardSize=cc.size(cards[0].width,cards[0].height);this.cardList.push(cards);var dx=this.cardSize.width*this.cardOrigiScale;var width=cards.length*dx;var x=this.cardPosition.x-width/2+dx/2;for(var i=0;i<cards.length;i++){var card=cards[i];cards._selected=false;card.position.set(x,this.cardPosition.y);card.scale.set(.5,.5);var rotate=20-Math.random()*40;card.rotation=cc.Global.degreeToRadian(rotate);this.addChild(card);
x+=dx}};CardOnTable.prototype.removeCard=function(cards){var arrCard=[];for(var i=0;i<cards.length;i++){var rank=cards[i].point;var suit=cards[i].suit;for(var j=0;j<this.cardList.length;j++){var card=this.cardList[j];if(card.point==rank&&card.suit==suit){arrCard.push(card);this.cardList.splice(j,1);break}}}return arrCard};
CardOnTable.prototype.flipAndRemoveAll=function(){var cards=this.cardList;if(!cards)return;for(var k=0;k<cards.length;k++){var group=cards[k];for(var i=0;i<group.length;i++){var card=group[i];this.flip(card)}}};
CardOnTable.prototype.flip=function(card){var _scale=card.scale.y;var action1=cc.scaleTo(.2,cc.p(0,_scale));var action2=cc.scaleTo(.2,cc.p(_scale,_scale));var func=function(){card.reveal(false)};var callback=cc.callFunc(func);var rm=cc.removeSelf(card);var action=cc.sequence(action1,callback,action2,rm);card.runAction(card,action)};CardOnTable.prototype.removeAll=function(){this.cardList=[];this.removeChildren();cc.log("cardlist remove all")};
function CardEarnList(size,cardOrigiScale){CardList.call(this,size,cardOrigiScale);this.canTouch=false;this.cardOrigiScale=cardOrigiScale?cardOrigiScale:.6;this.originVisible=true;this.originShowBack=false}CardEarnList.prototype=Object.create(CardList.prototype);
CardEarnList.prototype.reOrder=function(){if(this.cardList.length>0){var height=this.cardSize.height*this.cardList.length;if(height>this.heightContainer)height=this.heightContainer;else;var dy=height/this.cardList.length;var y=30+this.cardSize.height/2;if(dy>=this.cardSize.height/4)dy=this.cardSize.height/4;dy+=10;var x=this.widthContainer/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dy;card.moveToOriginPosition();y+=
dy}}};
CardEarnList.prototype.reOrderWithoutAnimation=function(){if(this.cardList.length>0){var height=this.cardSize.height*this.cardList.length;if(height>this.heightContainer)height=this.heightContainer;var dy=height/this.cardList.length;var y=30+this.cardSize.height/2;if(dy>=this.cardSize.height/4)dy=this.cardSize.height/4;dy+=10;var x=this.widthContainer/2;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dy;card.position.set(x,y);
y+=dy}}};
CardEarnList.prototype.addCard=function(card){if(!this.cardSize){this.cardSize=cc.size(card.width,card.height);if(this.cardSize.width>this.widthContainer){var ratio=this.widthContainer/this.cardSize.width;this.cardSize.width*=ratio;this.cardSize.height*=ratio}}if(card.width>this.cardSize.width){var scale=this.cardSize.width/card.width;card.scale.set(scale,scale)}card.originState=state_card.ORANGE_BORDER;card.originScale=card.scale.y;card.cardIndex=this.cardList.length;card.origin=cc.p(0,0);card.originVisible=
this.originVisible;card.originShowBack=this.originShowBack;card.canTouch=this.canTouch;var p=cc.p(card.x,card.y);card.position.set(p.x,p.y);this.addChild(card);this.cardList.push(card)};CardEarnList.prototype.earnCardPhom=function(card){this.dealCards([card],true,CardAlign.CENTER,state_card.ORANGE_BORDER)};
CardEarnList.prototype.dealCards=function(cards,animation,align,stateCard,scale){if(!cards||!cards.length)return;if(!stateCard)stateCard=state_card.NOTHING;for(var i=0;i<cards.length;i++){var card=new Card(cards[i].point,cards[i].suit,this);card.originScale=scale?scale:this.cardOrigiScale;card.anchor.set(.5,.5);card.showEffectCard(stateCard);card.position.set(this.deckPoint.x,this.deckPoint.y);this.addCard(card)}this.reOrderWithoutAnimation()};
function PhomList(size,cardOrigiScale){CardList.call(this,size,cardOrigiScale);this.canTouch=false;this.cardOrigiScale=cardOrigiScale?cardOrigiScale:.6;this.originVisible=true;this.originShowBack=false;this.phomSize=cc.size(size.width,Math.floor(size.height/2));this.dY=size.height/4;this.phomList=[];this.meIds=[];var colorArr=[16711680,16776960,16777215];for(var i=1;i<4;i++){var cardList=new CardList(this.phomSize,cardOrigiScale,CardAlign.CENTER);cardList.canTouch=false;cardList.position.set(0,this.dY*
(i-1));this.addChild(cardList);this.phomList.push(cardList)}var height=this.phomSize.height;for(var i=0;i<3;i++){var deckPoint=cc.p(size.width/2,this.phomList[i].y);this.phomList[i].setDeckPoint(deckPoint)}}PhomList.prototype=Object.create(CardList.prototype);
PhomList.prototype.reOrder=function(){if(this.phomList.length>0){var height=this.phomSize.height*this.phomList.length;if(height>this.heightContainer)height=this.heightContainer;var dy=this.dY;var y=0;var x=0;for(var i=0;i<this.phomList.length;i++){var cardList=this.phomList[i];cardList._selected=false;cardList.x=x;cardList.y=y;y+=dy}}};
PhomList.prototype.reOrderWithoutAnimation=function(){if(this.phomList.length>0){var height=this.phomSize.height*this.phomList.length;if(height>this.heightContainer)height=this.heightContainer;var dy=this.dY;var y=0;var x=this.widthContainer/2;for(var i=0;i<this.phomList.length;i++){var card=this.phomList[i];card._selected=false;card.origin=cc.p(x,y);card.cardIndex=i;card.cardDistance=dy;card.position.set(x,y);y+=dy}}};
PhomList.prototype.getPhomLength=function(){if(!this.meIds||!this.meIds.length)return 0;return this.meIds.length};PhomList.prototype.findIdByMeId=function(meid){if(!this.meIds||!this.meIds.length)return 0;var kq=this.meIds.length;for(var i=0;i<this.meIds.length;i++)if(meid==this.meIds[i]){kq=i;break}return kq};
PhomList.prototype.dealPhoms=function(phoms,animation,worldPos){if(!phoms||!phoms.length)return;for(var i=0;i<phoms.length;i++){cc.log("onHaBaiResponse dealPhoms meid "+phoms[i].meid+" \x3d\x3e "+phoms[i].cs);var cardsArr=phoms[i].cs;var cards=[];for(var m=0;m<cardsArr.length;m++){var cardData=Utils.getCardFromServer(cardsArr[m]);cards.push(cardData)}var meid=phoms[i].meid;var id=this.findIdByMeId(meid);cc.log("onHaBaiResponse dealPhoms id "+id);var nodePos=cc.convertToNodeSpace(this.phomList[id],
cc.p(worldPos.x,worldPos.y));this.phomList[id].dealCardsPhom(cards,animation,nodePos);if(!this.meIds.length)this.meIds[0]=meid;else this.meIds[this.meIds.length]=meid}this.reOrder()};
PhomList.prototype.addPhom=function(phomId,cards,animation){var meid=phomId;var id=this.findIdByMeId(meid);for(var i=0;i<cards.length;i++){cards[i].canTouch=this.canTouch;cards[i].cardOrigiScale=this.cardOrigiScale?this.cardOrigiScale:.6;cards[i].originVisible=true;cards[i].originShowBack=false;cards[i]._selected=false;this.phomList[id].addCard(cards[i])}if(!this.meIds.length)this.meIds[0]=meid;else this.meIds[this.meIds.length]=meid;if(animation)this.phomList[id].reOrder();else this.phomList[id].reOrderWithoutAnimation();
this.reOrder()};PhomList.prototype.guiBai=function(phomId,cardsArr,animation,worldPos){var meid=phomId;var id=this.findIdByMeId(meid);var cards=[];for(var m=0;m<cardsArr.length;m++){var cardData=Utils.getCardFromServer(cardsArr[m]);cards.push(cardData)}this.phomList[id].dealCardsPhom(cards,animation,worldPos);this.reOrderByCodeCard(meid);this.reOrder()};PhomList.prototype.guiBaiMe=function(phomId,cards,animation){this.addPhom(phomId,cards,animation);this.reOrderByCodeCard(phomId)};
PhomList.prototype.reOrderByCodeCard=function(phomId){var meid=phomId;var id=this.findIdByMeId(meid);var arrCodeCard=this.phomList[id].getCodeCards();arrCodeCard.sort(function(a,b){return a-b});var cards=[];for(var m=0;m<arrCodeCard.length;m++){var cardData=Utils.getCardFromServer(arrCodeCard[m]);cards.push(cardData)}this.phomList[id].reOrderByPoint(cards)};PhomList.prototype.removeAll=function(phomId,cards){for(var i=0;i<this.phomList.length;i++)this.phomList[i].removeAll();this.meIds.length=0};var ChipType=ChipType||{};ChipType.WHITE=5;ChipType.GREEN=2;ChipType.BLUE=1;ChipType.VIOLET=4;ChipType.RED=3;var SPEED_CHIP=1500;function Chip(type,listener){this.type=type;this.listener=listener;PIXI.Sprite.call(this,PIXI.Texture.fromFrame("button/coin"+type+".png"));this.originScale=this.scale.y;this.origin=cc.p(0,0)}Chip.prototype=Object.create(PIXI.Sprite.prototype);
Chip.prototype.moveToOriginPosition=function(){if(this.animation){PIXI.actionManager.cancelAction(this.animation);this.animation=null}var thiz=this;var beforeMove=new PIXI.action.CallFunc(function(){});var afterMove=new PIXI.action.CallFunc(function(){});var animTime=1;var pos1=cc.p(Math.floor(this.position.x),Math.floor(this.position.y));animTime=cc.pDistance(pos1,this.origin)/SPEED_CHIP;var move=cc.moveTo(animTime,cc.p(this.origin.x,this.origin.y));var scale=cc.scaleTo(animTime,this.originScale);
var action=cc.sequence(beforeMove,cc.spawn(move,scale),afterMove);this.animation=PIXI.actionManager.runAction(this,action);return animTime};function ChipList(size,originScale){PIXI.Container.call(this);this.chipOrigiScale=originScale?originScale:1;this.originVisible=true;this.originShowBack=false;this.chipList=[];this.size=size;this.padding=80}ChipList.prototype=Object.create(PIXI.Container.prototype);
ChipList.prototype.reOrder=function(){var animTime=0;if(this.chipList.length>0)for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];if(!chip.origin){var dx=Math.floor(Math.random()*(this.size.width-this.padding)/2);dx*=Math.pow(-1,Math.floor(Math.random()*10));var dy=Math.floor(Math.random()*(this.size.height-this.padding)/2);dy*=Math.pow(-1,Math.floor(Math.random()*10));var endPoint=cc.p(this.size.width/2+dx,this.size.height/2+dy);chip.origin=endPoint}chip.chipIndex=i;animTime=chip.moveToOriginPosition()}return animTime};
ChipList.prototype.reOrderWithoutAnimation=function(){if(this.chipList.length>0)for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];if(!chip.origin){var dx=Math.floor(Math.random()*(this.size.width-this.padding)/2);dx*=Math.pow(-1,Math.floor(Math.random()*10));var dy=Math.floor(Math.random()*(this.size.height-this.padding)/2);dy*=Math.pow(-1,Math.floor(Math.random()*10));var endPoint=cc.p(this.size.width/2+dx,this.size.height/2+dy);chip.origin=endPoint}chip.chipIndex=i;chip.scale=this.chipOrigiScale;
chip.position.set(chip.origin)}};ChipList.prototype.setDeckPoint=function(deckPoint){this.deckPoint=deckPoint};
ChipList.prototype.addNewChip=function(chipId,animation,pos,startScale){var animTime=0;var arr=[];for(var i=0;i<chipId.length;i++){var chip=new Chip(chipId[i],this);var startPos=pos?pos:this.deckPoint;chip.position.set(startPos.x,startPos.y);this.addChip(chip);var _start=startScale?startScale:this.chipOrigiScale;if(animation)chip.scale.set(_start,_start);else chip.scale.set(this.chipOrigiScale,this.chipOrigiScale);arr.push(chip)}if(animation)animTime=this.reOrder();else this.reOrderWithoutAnimation();
return animTime};ChipList.prototype.addChip=function(chip){chip.chipIndex=this.chipList.length;chip.origin=null;chip.originScale=this.chipOrigiScale;chip.listener=this;var p=cc.p(chip.x-this.parent.x,chip.y-this.parent.y);var size=cc.Global.GameView;chip.position.set(p.x,p.y);this.addChildAt(chip,this.chipList.length);this.chipList.push(chip)};
ChipList.prototype.dealChips=function(chips,animation){this.removeAll();if(!chips||!chips.length)return;for(var i=0;i<chips.length;i++){var chip=new Chip(chips[i],this);this.addChip(chip);chip.position.set(this.deckPoint)}for(var i=0;i<this.chipList.length;i++){this.addChildAt(this.chipList[i],i);var chip=this.chipList[i];var x=1;var y=1;chip.origin=cc.p(x,y);chip.originScale=this.chipOrigiScale;if(animation){chip.scale=.5*chip.originScale;chip.visible=false;var delayAction=cc.delayTime(.04*i);var beforeAction=
new PIXI.action.CallFunc(function(){chip.visible=true});var afterAction=new PIXI.action.CallFunc(function(){});var animTime=cc.pDistance(chip.position,cc.p(x,y))/SPEED_CHIP;var scaleAction=cc.scaleTo(animTime,1*chip.originScale);var moveAction=cc.moveTo(animTime,cc.p(x,y));var action=cc.sequence(delayAction,beforeAction,cc.spawn(moveAction,scaleAction),afterAction);chip.animation=PIXI.actionManager.runAction(chip,action)}else chip.position.set(x,y)}};
ChipList.prototype.removeChipByIndex=function(chipIndex){for(var j=this.chipList.length-1;j>=0;j--){var chip=this.chipList[j];if(chip.chipIndex==chipIndex){this.removeChild(chip);this.chipList.splice(j,1);break}}};
ChipList.prototype.removeChip=function(chips){var arrChip=[];for(var i=0;i<chips.length;i++){var type=chips[i].type;for(var j=0;j<this.chipList.length;j++){var chip=this.chipList[j];if(chip.type==type){chip.retain();var p=chip.getGlobalPosition();if(chip.parent)chip.parent.removeChild(chip);chip.position.set(p);arrChip.push(chip);this.chipList.splice(j,1);break}}}return arrChip};ChipList.prototype.removeAll=function(){this.removeChildren();this.chipList=[]};ChipList.prototype.getChipAtIndex=function(index){return this.chipList[index]};
ChipList.prototype.getChips=function(){return this.chipList};var ChipToType=ChipToType||{};ChipToType.WHITE=5;ChipToType.GREEN=2;ChipToType.BLUE=1;ChipToType.VIOLET=4;ChipToType.RED=3;var SPEED_CHIP_TO=1E3;function ChipTo(type,listener){this.type=type;this.listener=listener;PIXI.Sprite.call(this,PIXI.Texture.fromFrame("button/coin"+type+".png"));this.displayGroup=MyPixi.chipLayer;this.originScale=this.scale.y;this.originVisible=true;this.origin=cc.p(0,0);this.animation=[]}ChipTo.prototype=Object.create(PIXI.Sprite.prototype);
ChipTo.prototype.moveToOriginPosition=function(callFunc){this.stopAllActions();var thiz=this;var beforeMove=new PIXI.action.CallFunc(function(){});var afterMove=new PIXI.action.CallFunc(function(){thiz.displayGroup=MyPixi.chipLayer});this.visible=thiz.originVisible;var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED_CHIP_TO;var move=cc.moveTo(animTime,cc.p(this.origin.x,this.origin.y));var scale=cc.scaleTo(animTime,this.originScale);var action;if(hiepnh.isUndefined(callFunc))action=
cc.sequence(beforeMove,cc.spawn(move,scale),afterMove);else action=cc.sequence(beforeMove,cc.spawn(move,scale),afterMove,callFunc);this.runAction(this,action);return animTime};ChipTo.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};
ChipTo.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};ChipTo.prototype.addOriginWinPot=function(originWinPot){this.originWinPot=originWinPot};
function ChipColumnList(size,originScale,align){if(hiepnh.isUndefined(align))align=ChipColumnList.LBL_RIGHT;PIXI.Container.call(this);this.canTouch=false;this.chipOriginScale=originScale?originScale:.3;this.oldChipOrigiScale=this.chipOriginScale;this.originVisible=true;this.originShowBack=false;this.chipList=[];this.align=align;this.size=size;this.setContentSize(size);this.deckPoint=cc.p(cc.winSize.width/2,cc.winSize.height/2);var bgLbl=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("bg_popup.png"),
10,10,10,10);bgLbl.width=70;bgLbl.height=30;bgLbl.y=this.heightContainer-bgLbl.height/2-5;if(this.align==ChipColumnList.LBL_RIGHT)bgLbl.x=this.widthContainer+10;else if(this.align==ChipColumnList.LBL_LEFT)bgLbl.x=-10-bgLbl.width;else{bgLbl.x=-bgLbl.width/2+this.widthContainer/2;bgLbl.y=this.heightContainer+bgLbl.height/2+5}this.addChild(bgLbl);this.bgLbl=bgLbl;this.moneyPot=0;var moneyPotLbl=cc.LabelTTF(this.moneyPot,cc.res.font.Arial,22,null,"white");moneyPotLbl.anchor.set(.5,.5);moneyPotLbl.position.set(bgLbl.width/
2,bgLbl.height/2);bgLbl.addChild(moneyPotLbl);this.moneyPotLbl=moneyPotLbl;this.bgLbl.visible=false}ChipColumnList.prototype=Object.create(PIXI.Container.prototype);ChipColumnList.LBL_RIGHT=0;ChipColumnList.LBL_LEFT=1;ChipColumnList.LBL_BOT=2;ChipColumnList.LBL_TOP=3;
ChipColumnList.prototype.updateMyMoney=function(bet){this.moneyPot+=bet;if(this.moneyPot>0)this.bgLbl.visible=true;this.moneyPotLbl.text=cc.Global.NumberFormat2(this.moneyPot,2);this.bgLbl.width=this.moneyPotLbl.width+10;if(this.align)this.bgLbl.x=this.widthContainer+5;else this.bgLbl.x=-5-this.bgLbl.width;if(this.align==ChipColumnList.LBL_RIGHT)this.bgLbl.x=this.widthContainer+5;else if(this.align==ChipColumnList.LBL_LEFT)this.bgLbl.x=-5-this.bgLbl.width;else if(this.align==ChipColumnList.LBL_TOP){this.bgLbl.x=
-this.bgLbl.width/2+this.widthContainer/2;this.bgLbl.y=-this.bgLbl.height/2-15}else{this.bgLbl.x=-this.bgLbl.width/2+this.widthContainer/2;this.bgLbl.y=this.heightContainer+this.bgLbl.height/2+5}this.moneyPotLbl.position.set(this.bgLbl.width/2,this.bgLbl.height/2)};
ChipColumnList.prototype.updateMyMoneyPot=function(potMoney){this.moneyPot=potMoney;if(this.moneyPot>0)this.bgLbl.visible=true;this.moneyPotLbl.text=cc.Global.NumberFormat2(this.moneyPot,2);this.bgLbl.width=this.moneyPotLbl.width+10;if(this.align)this.bgLbl.x=this.widthContainer+5;else this.bgLbl.x=-5-this.bgLbl.width;if(this.align==ChipColumnList.LBL_RIGHT)this.bgLbl.x=this.widthContainer+5;else if(this.align==ChipColumnList.LBL_LEFT)this.bgLbl.x=-5-this.bgLbl.width;else if(this.align==ChipColumnList.LBL_TOP){this.bgLbl.x=
-this.bgLbl.width/2+this.widthContainer/2;this.bgLbl.y=-this.bgLbl.height/2-15}else{this.bgLbl.x=-this.bgLbl.width/2+this.widthContainer/2;this.bgLbl.y=this.heightContainer+this.bgLbl.height/2+5}this.moneyPotLbl.position.set(this.bgLbl.width/2,this.bgLbl.height/2)};ChipColumnList.prototype.onReset=function(){this.hideMoneyLbl();this.removeAll()};ChipColumnList.prototype.hideMoneyLbl=function(){this.moneyPot=0;this.bgLbl.visible=false};
ChipColumnList.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};ChipColumnList.prototype.resetOrigin=function(size){this.chipOriginScale=this.oldChipOrigiScale;this.chipSize=null};ChipColumnList.prototype.show=function(isShow){};
ChipColumnList.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.size.width,this.size.height);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("chipCloumnlist showBlurBg")};
ChipColumnList.prototype.addSeqAfterMoveOrigin=function(chip){var thiz=this;var cb=cc.callFunc(function(){thiz.hideMoneyLbl();chip.originWinPot=null});var addTime=(this.chipList.length-chip.chipIndex)*.05;var animTime=cc.pDistance(cc.p(chip.originWinPot.x,chip.originWinPot.y),chip.origin)/SPEED_CHIP_TO;var move=cc.moveTo(animTime,cc.p(chip.originWinPot.x,chip.originWinPot.y));var delay=cc.delayTime(1+addTime);var spawn=cc.spawn(cb,move);var removeFun=cc.callFunc(function(){thiz.removeChipByIndex(chip.chipIndex)});
var seq=cc.sequence(delay,spawn,removeFun);return seq};
ChipColumnList.prototype.reOrder=function(){var anim=0;var thiz=this;if(this.chipList.length>0){var height=this.chipSize.height*this.chipList.length;if(height>this.heightContainer)height=this.heightContainer;else;var dy=height/this.chipList.length;var y=dy/2;if(dy>this.chipSize.height/4)dy=this.chipSize.height/4;y=this.heightContainer-dy/2;var x=this.widthContainer/2;for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];chip.anchor.set(.5,.5);chip.origin=cc.p(x,y);chip.cardIndex=i;chip.cardDistance=
dy;chip.originScale=this.chipOriginScale;if(chip.originBet){var cb=cc.callFunc(function(){thiz.updateMyMoney(chip.originBet);chip.originBet=0});anim=chip.moveToOriginPosition(cb)}else if(chip.originWinPot){var seq=thiz.addSeqAfterMoveOrigin(chip);anim=chip.moveToOriginPosition(seq)}else anim=chip.moveToOriginPosition();y-=dy}}return anim};
ChipColumnList.prototype.reOrderWithoutAnimation=function(){var thiz=this;var animTime=0;if(this.chipList.length>0){var height=this.chipSize.height*this.chipList.length;if(height>this.heightContainer)height=this.heightContainer;else;var dy=height/this.chipList.length;var y=dy/2;if(dy>this.chipSize.height/4)dy=this.chipSize.height/4;y=this.heightContainer-dy/2;var x=this.widthContainer/2;for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];chip.anchor.set(.5,.5);chip.origin=cc.p(x,y);
chip.cardIndex=i;chip.cardDistance=dy;chip.originScale=this.chipOriginScale;if(chip.originBet){thiz.updateMyMoney(chip.originBet);chip.originBet=0}chip.position.set(x,y);y-=dy}}return animTime};ChipColumnList.prototype.setDeckPoint=function(deckPoint){var gloalPos=this.getGlobalPosition();this.deckPoint=cc.pSub(deckPoint,gloalPos)};
ChipColumnList.prototype.addNewChip=function(chipIds,moneyBet,animation,pos,startScale){var arr=[];for(var i=0;i<chipIds.length;i++){var chip=new ChipTo(chipIds[i],this);var startPos=pos?pos:this.deckPoint;this.addChip(chip,moneyBet);chip.anchor.set(.5,.5);chip.position.set(startPos.x,startPos.y);var _start=startScale?startScale:this.chipOriginScale;if(animation)chip.scale.set(_start,_start);else chip.scale.set(this.chipOriginScale,this.chipOriginScale)}var animTime=0;if(animation)animTime=this.reOrder();
else this.reOrderWithoutAnimation();return animTime};
ChipColumnList.prototype.addChip=function(chip,moneyBet){if(hiepnh.isUndefined(moneyBet))moneyBet=0;if(!this.chipSize){this.chipSize=cc.size(chip.width*chip.scale.y,chip.height*chip.scale.y);if(this.chipSize.width>this.widthContainer){var ratio=this.widthContainer/this.chipSize.width;this.chipSize.width*=ratio;this.chipSize.height*=ratio}}if(chip.width*chip.scale.y>this.chipSize.width)chip.scale.set(this.chipOriginScale,this.chipOriginScale);chip.chipIndex=this.chipList.length;chip.origin=cc.p(0,
0);chip.originBet=moneyBet;chip.originScale=this.chipOriginScale;chip.canTouch=this.canTouch;chip.isTouched=false;chip.listener=this;var p=cc.p(chip.x,chip.y);chip.position.set(p.x,p.y);this.addChild(chip);this.chipList.push(chip)};
ChipColumnList.prototype.dealChips=function(chips,animation){this.removeAll();if(!chips||!chips.length)return;for(var i=0;i<chips.length;i++){var chip=new ChipTo(chips[i],this);this.addChip(chip);chip.anchor.set(.5,.5);chip.position.set(this.deckPoint.x,this.deckPoint.y)}var height=this.chipSize.height*this.chipList.length;if(height>this.heightContainer)height=this.heightContainer;var dy=height/this.chipList.length;var y=dy/2;if(dy>=this.chipSize.height-10)dy-=10;var x=this.widthContainer/2;var thiz=
this;for(var i=0;i<this.chipList.length;i++){var chip=thiz.chipList[i];thiz.animChia(chip,animation,x,y,dy,i);y-=dy}};
ChipColumnList.prototype.animChia=function(chip,animation,x,y,dx,i){chip.origin=cc.p(x,y);chip.originScale=this.chipOriginScale;chip.originVisible=this.originVisible;chip.chipDistance=dx;if(animation){chip.scale.set(chip.originScale,chip.originScale);chip.visible=false;var delayAction=cc.delayTime(.04*i);var beforeAction=cc.callFunc(function(){chip.visible=true});var afterAction=cc.callFunc(function(){});var animTime=cc.pDistance(cc.p(chip.x,chip.y),cc.p(x,y))/SPEED_CHIP_TO;var scaleAction=cc.scaleTo(animTime,
1*chip.originScale);var moveAction=cc.moveTo(animTime,cc.p(x,y));var action=cc.sequence(delayAction,beforeAction,cc.spawn(moveAction,scaleAction),afterAction);chip.runAction(chip,action)}else chip.position.set(x,y)};ChipColumnList.prototype.removeChipByIndex=function(chipIndex){for(var j=this.chipList.length-1;j>=0;j--){var chip=this.chipList[j];if(chip.chipIndex==chipIndex){this.removeChild(chip);this.chipList.splice(j,1);break}}};
ChipColumnList.prototype.removeChip=function(chips){var arrChip=[];for(var i=0;i<chips.length;i++){var type=chips[i].type;for(var j=0;j<this.chipList.length;j++){var chip=this.chipList[j];if(chip.type==type){var p=chip.getGlobalPosition();if(chip.parent)chip.parent.removeChild(chip);chip.position.set(p);arrChip.push(chip);this.chipList.splice(j,1);break}}}return arrChip};
ChipColumnList.prototype.removeAll=function(){if(!this.chipList||!this.chipList.length)return;for(var i=this.chipList.length-1;i>=0;i--)if(this.chipList[i].parent)this.chipList[i].parent.removeChild(this.chipList[i]);this.chipList=[]};ChipColumnList.prototype.getChipAtIndex=function(index){return this.chipList[index]};ChipColumnList.prototype.getChips=function(){return this.chipList};ChipColumnList.prototype.hideMucCuoc=function(){this.bgLbl.visible=false};
function ChipBaCayOnTable(size,originScale,align){if(hiepnh.isUndefined(align))align=ChipColumnList.LBL_RIGHT;ChipColumnList.call(this,size,originScale,align);this.padding=20}ChipBaCayOnTable.prototype=Object.create(ChipColumnList.prototype);
ChipBaCayOnTable.prototype.addNewChip=function(chipIds,moneyBet,animation,pos,startScale){var arr=[];for(var i=0;i<chipIds.length;i++){var chip=new ChipTo(chipIds[i],this);var startPos=pos?pos:this.deckPoint;this.addChip(chip,moneyBet);chip.origin=null;chip.anchor.set(.5,.5);chip.position.set(startPos.x,startPos.y);var _start=startScale?startScale:this.chipOriginScale;if(animation)chip.scale.set(_start,_start);else chip.scale.set(this.chipOriginScale,this.chipOriginScale)}var animTime=0;if(animation)animTime=
this.reOrder();else this.reOrderWithoutAnimation();return animTime};
ChipBaCayOnTable.prototype.reOrder=function(){var anim=0;var thiz=this;if(this.chipList.length>0)for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];if(!chip.origin){var dx=Math.floor(Math.random()*(this.size.width-this.padding)/2);dx*=Math.pow(-1,Math.floor(Math.random()*10));var dy=Math.floor(Math.random()*(this.size.height-this.padding)/2);dy*=Math.pow(-1,Math.floor(Math.random()*10));var endPoint=cc.p(this.size.width/2+dx,this.size.height/2+dy);chip.origin=endPoint}chip.cardIndex=
i;chip.originScale=this.chipOriginScale;if(chip.originBet){var cb=cc.callFunc(function(){thiz.updateMyMoney(chip.originBet);chip.originBet=0});anim=chip.moveToOriginPosition(cb)}else if(chip.originWinPot){var seq=thiz.addSeqAfterMoveOrigin(chip);anim=chip.moveToOriginPosition(seq)}else anim=chip.moveToOriginPosition()}return anim};
ChipBaCayOnTable.prototype.reOrderWithoutAnimation=function(){if(this.chipList.length>0)for(var i=0;i<this.chipList.length;i++){var chip=this.chipList[i];if(!chip.origin){var dx=Math.floor(Math.random()*(this.size.width-this.padding)/2);dx*=Math.pow(-1,Math.floor(Math.random()*10));var dy=Math.floor(Math.random()*(this.size.height-this.padding)/2);dy*=Math.pow(-1,Math.floor(Math.random()*10));var endPoint=cc.p(this.size.width/2+dx,this.size.height/2+dy);chip.origin=endPoint}chip.cardIndex=i;chip.scale.set(this.chipOrigiScale,
this.chipOrigiScale);chip.position.set(chip.origin)}};function AnimationXocDia(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var size=cc.Global.GameView;var originX=size.width/2;var originY=size.height/2;this.originX=originX;this.originY=originY;var alienImages=["xoc1.png","xoc2.png","xoc3.png","xoc4.png"];var textureArray=[];for(var i=0;i<4;i++){var texture=PIXI.Texture.fromFrame(alienImages[i]);textureArray.push(texture)}var anim=new PIXI.extras.AnimatedSprite(textureArray);anim.anchor.set(.5,1);anim.position.set(this.originX,this.originY);
anim.animationSpeed=.2;anim.stop();this.addChild(anim);this.anim=anim;this.clearAnim()}AnimationXocDia.prototype=Object.create(PIXI.Container.prototype);AnimationXocDia.prototype.startAnim=function(){this.clearAnim();this.anim.gotoAndPlay(0);this.visible=true};AnimationXocDia.prototype.clearAnim=function(){if(this.anim)this.anim.stop();this.visible=false};
function KhungStatistic(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var bg=PIXI.Sprite.fromFrame("khung.png");var size=cc.Global.GameView;var originX=0;var originY=size.height-bg.height;this.originX=originX;this.originY=originY;bg.anchor.set(0,0);bg.position.set(originX,originY);this.addChild(bg);var lblChan=new PIXI.Text("Ch\u1eb5n",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"black",align:"center"});lblChan.anchor.set(.5,.5);lblChan.position.set(bg.width/2-125,bg.height/2-
45);bg.addChild(lblChan);var lblLe=new PIXI.Text("L\u1ebb",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});lblLe.anchor.set(.5,.5);lblLe.position.set(130,-75);lblLe.position.set(bg.width/2-125,bg.height/2+16);bg.addChild(lblLe);this.lblChanCount=new PIXI.Text("0",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"black",align:"center"});this.lblChanCount.anchor.set(.5,.5);this.lblChanCount.position.set(bg.width/2-125,bg.height/2-20);bg.addChild(this.lblChanCount);this.lblLeCount=
new PIXI.Text("0",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});this.lblLeCount.anchor.set(.5,.5);this.lblLeCount.position.set(bg.width/2-125,bg.height/2+43);bg.addChild(this.lblLeCount);this.textures=[PIXI.Sprite.fromFrame("icon_chan.png").texture,PIXI.Sprite.fromFrame("icon_le.png").texture];this.statisticsMng=[];var _x=bg.width/2-83;var _y=bg.height/2+47;for(var i=0;i<8;i++)for(var j=0;j<4;j++){var icon=PIXI.Sprite.fromFrame("icon_chan.png");icon.anchor.set(.5,.5);icon.position.set(_x+
i*31,_y-j*30);bg.addChild(icon);this.statisticsMng.push(icon)}this.reset()}KhungStatistic.prototype=Object.create(PIXI.Container.prototype);KhungStatistic.prototype.reset=function(){if(this.animation){PIXI.actionManager.cancelAction(this.animation);this.animation=null}for(var i=0;i<this.statisticsMng.length;i++)this.statisticsMng[i].visible=false;this.lblChanCount.text="";this.lblLeCount.text=""};
KhungStatistic.prototype.updateStatisticDelay=function(timeDelay,tableResult){var thiz=this;var action_func=new PIXI.action.CallFunc(function(){thiz.updateStatistic(tableResult)});var action_delay=new PIXI.action.DelayTime(timeDelay);var action_seq=new PIXI.action.Sequence([action_delay,action_func]);this.animation=PIXI.actionManager.runAction(this,action_seq)};
KhungStatistic.prototype.updateStatistic=function(tableResult){var tr=tableResult;var totalChan=0;var totalLe=0;if(tr&&tr.length){var len=tr.length;for(var i=0;i<32;i++)if(i>=len)this.statisticsMng[i].visible=false;else if(tr[i]){totalChan++;this.statisticsMng[i].visible=true;this.statisticsMng[i].texture=this.textures[0]}else if(!tr[i]){totalLe++;this.statisticsMng[i].visible=true;this.statisticsMng[i].texture=this.textures[1]}}else for(var i=0;i<32;i++)this.statisticsMng[i].visible=false;this.lblChanCount.text=
""+totalChan;this.lblLeCount.text=""+totalLe};
function XocDiaCountDown(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var bg=PIXI.Sprite.fromFrame("dia.png");this.bg=bg;var size=cc.Global.GameView;var originX=size.width/2;var originY=size.height/2;this.originX=originX-bg.width/2;this.originY=originY-bg.height;bg.anchor.set(0,0);bg.position.set(this.originX,this.originY);this.addChild(bg);this.icons=[];for(var i=0;i<4;i++){var icon=PIXI.Sprite.fromFrame("icon_chan.png");if(i%2==0)icon=PIXI.Sprite.fromFrame("icon_le.png");icon.position.set(bg.width/
2,bg.height/2);bg.addChild(icon);this.icons.push(icon)}var bat=PIXI.Sprite.fromFrame("bat.png");this.originBatPos=cc.p(bg.width/2-bat.width/2,bg.height/2-bat.height/2);bat.position.set(this.originBatPos.x,this.originBatPos.y);this.bg.addChild(bat);this.bat=bat;var khungsobai=PIXI.Sprite.fromFrame("khung_sobai.png");khungsobai.anchor.set(.5,.5);khungsobai.position.set(bat.position.x+bat.width/2,bat.position.y+bat.height/2);this.bg.addChild(khungsobai);this.khungsobai=khungsobai;khungsobai.visible=
false;this.remainTime=new PIXI.Text("",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});this.remainTime.position.set(khungsobai.position.x-2,khungsobai.position.y-2);this.remainTime.anchor.set(.5,.5);this.bg.addChild(this.remainTime);this.posResult=[cc.p(-20,10),cc.p(20,10),cc.p(-20,-10),cc.p(20,-10)]}XocDiaCountDown.prototype=Object.create(PIXI.Container.prototype);XocDiaCountDown.prototype.show=function(visible){this.visible=visible};
XocDiaCountDown.prototype.showCountDown=function(visible){this.khungsobai.visible=visible;if(this.timer){this.timer.stop();this.timer=null}this.remainTime.visible=visible};
XocDiaCountDown.prototype.showTimeCountDown=function(timeInSeconds,maxTime){if(!maxTime)maxTime=timeInSeconds;var thiz=this;thiz.showCountDown(true);thiz.timeRemain=timeInSeconds*1E3;thiz.remainTime.text=""+Math.floor(this.timeRemain/1E3);var oldRemain=timeInSeconds;var startValue=timeInSeconds;var timer=PIXI.timerManager.createTimer(timeInSeconds*1E3);timer.on("update",function(elapsedTime,dt){thiz.timeRemain-=dt*1E3;if(thiz.timeRemain<0){thiz.timeRemain=0;thiz.showCountDown(false)}thiz.remainTime.text=
""+Math.floor(thiz.timeRemain/1E3)});timer.start();this.timer=timer};XocDiaCountDown.prototype.closeBat=function(){this.bat.visible=true;if(this.animationOpenBat){PIXI.actionManager.cancelAction(this.animationOpenBat);this.animationOpenBat=null}this.bat.position.set(this.originBatPos.x,this.originBatPos.y)};
XocDiaCountDown.prototype.openBat=function(numberRedResult,timeDelay){if(!timeDelay)timeDelay=0;var move=cc.moveTo(.3,cc.p(this.originBatPos.x,this.originBatPos.y-400));var seq=cc.sequence(cc.delayTime(timeDelay),move);this.animationOpenBat=PIXI.actionManager.runAction(this.bat,seq);var posBat=cc.p(this.bat.x+this.bat.width/2,this.bat.y+this.bat.height/2);for(var i=0;i<4;i++){if(i<numberRedResult)this.icons[i].texture=PIXI.Texture.fromFrame("icon_chan.png");else this.icons[i].texture=PIXI.Texture.fromFrame("icon_le.png");
var pos=this.posResult[i];var rdX=Math.pow(-1,Math.floor(Math.random()*5+0))*Math.floor(Math.random()*5+0);var rdY=Math.pow(-1,Math.floor(Math.random()*5+0))*Math.floor(Math.random()*5+0);this.icons[i].position.set(posBat.x+pos.x+rdX,posBat.y+pos.y+rdY)}};
function XocDiaGate(pos,size,title){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("khung_chanle.png"),60,60,60,60);if(!size)size=cc.size(298,184);bg.width=size.width;bg.height=size.height;var originX=pos.x-bg.width/2;var originY=pos.y-bg.height/2;this.originX=originX;this.originY=originY;bg.position.set(originX,originY);this.addChild(bg);this.bg=bg;var thiz=this;this.addChild(bg);var border=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("border_xocdia.png"),
30,30,30,30);border.width=size.width;border.height=size.height;border.position.set(0,0);bg.addChild(border);this.border=border;this.border.visible=false;var glowEff=PIXI.Sprite.fromFrame("button/glow2.png");glowEff.anchor.set(.5);glowEff.position.set(bg.width/2,bg.height/2);bg.addChild(glowEff);this.glowEff=glowEff;this.glowEff.visible=false;this.lblName=new PIXI.Text(title?title:"",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});this.lblName.anchor.set(.5,.5);this.lblName.position.set(bg.width/
2,bg.height/2);bg.addChild(this.lblName);this.chipContainer=new PIXI.Container;this.bg.addChild(this.chipContainer);this.lblTotalMoney=new PIXI.Text("",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});this.lblTotalMoney.anchor.set(.5,0);this.lblTotalMoney.position.set(bg.width/2,0);bg.addChild(this.lblTotalMoney);this.lblMyMoney=new PIXI.Text("",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"yellow",align:"center"});this.lblMyMoney.anchor.set(.5,1);this.lblMyMoney.position.set(bg.width/
2,bg.height);bg.addChild(this.lblMyMoney);bg.interactive=true;bg.buttonMode=true;var onButtonDown=function(){cc.log("gate ");if(thiz.onGateHandler)thiz.onGateHandler()};bg.on("pointerdown",onButtonDown);this.chipList=new ChipList(cc.size(bg.width,bg.height),.3);this.sellGate=MyHelper.createButton("button/btn_1.png",true,function(){if(thiz.onSellGate)thiz.onSellGate()},true,cc.size(100,40),[20,10,20,10]);this.sellGate.displayGroup=MyPixi.animationLayer;var titleSell=new PIXI.Text("B\u00e1n",{fontFamily:cc.res.font.Arial,
fontSize:20,fill:"white",align:"center"});titleSell.anchor.set(.5,.5);titleSell.position.set(this.sellGate.width/2,this.sellGate.height/2);this.sellGate.addChild(titleSell);this.sellGate.position.set(bg.width/2-this.sellGate.width/2,bg.height/2-this.sellGate.height/2);this.bg.addChild(this.sellGate);this.sellGate.visible=false;this.buyGate=MyHelper.createButton("button/btn_1.png",true,function(){if(thiz.onBuyGate)thiz.onBuyGate()},true,cc.size(100,40),[20,10,20,10]);this.buyGate.displayGroup=MyPixi.animationLayer;
var titleBuy=new PIXI.Text("Mua",{fontFamily:cc.res.font.Arial,fontSize:20,fill:"white",align:"center"});titleBuy.anchor.set(.5,.5);titleBuy.position.set(this.sellGate.width/2,this.sellGate.height/2);this.buyGate.addChild(titleBuy);this.buyGate.position.set(bg.width/2-this.sellGate.width/2,bg.height/2-this.sellGate.height/2);this.bg.addChild(this.buyGate);this.buyGate.visible=false;this.bg.addChild(this.chipList);this.money=0;this.myMoney=0}XocDiaGate.prototype=Object.create(PIXI.Container.prototype);
XocDiaGate.prototype.setListener=function(listener,eid){this.listener=listener;this.eid=eid};XocDiaGate.prototype.clearAllCuoc=function(){var arrayCoin=this.chipList.getChips();if(!arrayCoin||!arrayCoin.length)return;this.hideMucCuoc();this.chipList.removeAll()};
XocDiaGate.prototype.test=function(endPointPlayer,coin,delayTime){var thiz=this;endPointPlayer=cc.p(endPointPlayer.x-this.bg.x,endPointPlayer.y-this.bg.y);var timeAction=.5;timeAction=cc.pDistance(endPointPlayer,cc.p(coin.x,coin.y))/SPEED;var hide=new PIXI.action.CallFunc(function(){thiz.hideMucCuoc()});var move=cc.moveTo(timeAction,endPointPlayer);var indexRemove=coin.chipIndex;var rm=new PIXI.action.CallFunc(function(){thiz.hideMucCuoc();thiz.chipList.removeChipByIndex(coin.chipIndex)});var seq=
cc.sequence(cc.delayTime(delayTime),hide,move,rm);PIXI.actionManager.runAction(coin,seq)};
XocDiaGate.prototype.animChipToWinPlayer=function(posPlayerWinArr,delayTime){if(delayTime===undefined)delayTime=.01;var arrayCoin=this.chipList.getChips();if(!arrayCoin||!arrayCoin.length)return;var pos=this.bg.position;var indexPos=0;var thiz=this;for(var i=arrayCoin.length-1;i>=0;i--){var coin=arrayCoin[i];if(indexPos>posPlayerWinArr.length-1)indexPos=0;var endPointPlayer=posPlayerWinArr[indexPos];this.test(endPointPlayer,coin,delayTime);indexPos++}};
XocDiaGate.prototype.hideMucCuoc=function(){this.lblMyMoney.text="";this.lblTotalMoney.text=""};XocDiaGate.prototype.updateMyMoneyDelay=function(delay,myMoneyPots,isMyPlayer){var thiz=this;var cb=new PIXI.action.CallFunc(function(){thiz.updateMyMoney(myMoneyPots,isMyPlayer)});var seq=cc.sequence(cc.delayTime(delay),cb);this.updateMyMoneyDelayAction=PIXI.actionManager.runAction(this,seq)};
XocDiaGate.prototype.updateMyMoney=function(myMoneyPots,isMyPlayer){this.money+=myMoneyPots;if(isMyPlayer)this.myMoney+=myMoneyPots;if(this.myMoney>0)this.lblMyMoney.text=cc.Global.NumberFormat2(this.myMoney,2);else this.lblMyMoney.text="";if(this.money>0)this.lblTotalMoney.text=cc.Global.NumberFormat2(this.money,2);else this.lblTotalMoney.text=""};XocDiaGate.prototype.updateMoneyGate=function(moneyGate){this.money=moneyGate;this.lblTotalMoney.text=cc.Global.NumberFormat2(this.money,2)};
XocDiaGate.prototype.initReadCoin=function(num){var size=cc.size(this.bg.width,this.bg.height);for(var i=0;i<4;i++){var red=PIXI.Sprite.fromFrame("icon_chan.png");if(i>=num)red=PIXI.Sprite.fromFrame("icon_le.png");red.position.set(size.width/2-70,20*i+30);this.bg.addChild(red)}};XocDiaGate.prototype.onGateHandler=function(){};
XocDiaGate.prototype.onShowSellGate=function(isShow){if(this.money<=0)return;this.sellGate.visible=isShow;if(isShow){this.border.visible=isShow;this.runEffectBorder()}else{if(this.aninmEffectBorder){PIXI.actionManager.cancelAction(this.aninmEffectBorder);this.aninmEffectBorder=null}this.border.visible=isShow}};
XocDiaGate.prototype.onShowBuyGate=function(isShow){this.buyGate.visible=isShow;if(isShow){this.border.visible=isShow;this.runEffectBorder()}else{if(this.aninmEffectBorder){PIXI.actionManager.cancelAction(this.aninmEffectBorder);this.aninmEffectBorder=null}this.border.visible=isShow}};XocDiaGate.prototype.onBuyGate=function(){this.listener.getMaxMoneyCanBuy()};XocDiaGate.prototype.onSellGate=function(){this.listener.onSellGate(this.eid)};XocDiaGate.prototype.show=function(visible){this.visible=visible};
XocDiaGate.prototype.runEffectBorder=function(){if(this.aninmEffectBorder){PIXI.actionManager.cancelAction(this.aninmEffectBorder);this.aninmEffectBorder=null}var action1=cc.fadeIn(.2);var action2=cc.delayTime(.2);var action3=cc.fadeOut(.2);var action4=cc.delayTime(.2);var seq=cc.sequence(action1,action2,action3,action4);var repeat=cc.repeatForever(seq);this.aninmEffectBorder=PIXI.actionManager.runAction(this.border,repeat)};XocDiaGate.prototype.showGlowDelay=function(timeDelay,isShow){this.showGlow(isShow)};
XocDiaGate.prototype.showGlow=function(isShow){if(this.aninmglowEff){PIXI.actionManager.cancelAction(this.aninmglowEff);this.aninmglowEff=null}if(isShow){this.glowEff.visible=true;var rotate=cc.rotateBy(4,720);var repeat=cc.repeatForever(rotate);this.aninmglowEff=PIXI.actionManager.runAction(this.glowEff,repeat)}else this.glowEff.visible=false};
XocDiaGate.prototype.onReset=function(){this.money=0;this.myMoney=0;this.lblMyMoney.text="";this.lblTotalMoney.text="";this.showGlow(false);if(this.buyGate)this.buyGate.visible=false;if(this.sellGate)this.sellGate.visible=false;if(this.border)this.border.visible=false;if(this.glowEff)this.glowEff.visible=false;if(this.updateMyMoneyDelayAction){PIXI.actionManager.cancelAction(this.updateMyMoneyDelayAction);this.updateMyMoneyDelayAction=null}this.chipList.removeAll()};function DeckCards(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.numberRemain=0;var thiz=this;var size=cc.Global.GameView;var originX=size.width/2;var originY=size.height/2+50;this.originX=originX;this.originY=originY;this.deckCardBtn=PIXI.Sprite.fromFrame("card_face_down.png");this.deckCardBtn.position.set(originX,size.height/2);this.deckCardBtn.anchor.set(.5,.5);this.deckCardBtn.scale.set(.5,.5);this.addChild(this.deckCardBtn);this.deckCardBtn.visible=false;var text_bocbai=
PIXI.Sprite.fromFrame("button/text_bocbai.png");text_bocbai.anchor.set(.5,.5);text_bocbai.scale.set(.5,.5);text_bocbai.position.set(originX,originY-100);this.addChild(text_bocbai);this.text_bocbai=text_bocbai;this.text_bocbai.visible=false;this.deckCardBtn.interactive=true;this.deckCardBtn.buttonMode=true;var onButtonDown=function(){if(thiz.onBocBaiButtonHandler)thiz.onBocBaiButtonHandler()};this.deckCardBtn.on("pointerdown",onButtonDown);this.remainCard=new PIXI.Text("",{fontFamily:cc.res.font.Arial,
fontSize:40,fill:"yellow",stroke:"#4a1850",strokeThickness:5,align:"center"});this.remainCard.anchor.set(.5,.5);this.remainCard.position.set(0,0);this.deckCardBtn.addChild(this.remainCard)}DeckCards.prototype=Object.create(PIXI.Container.prototype);DeckCards.prototype.show=function(visible,num){if(num<=0)this.remainCard.text="";else this.remainCard.text=""+num;this.numberRemain=num;this.deckCardBtn.visible=visible};
DeckCards.prototype.reduceTotalCard=function(visible,reduce){this.numberRemain-=reduce;this.remainCard.text=""+this.numberRemain;if(this.numberRemain<=0)visible=false;this.deckCardBtn.visible=visible};
DeckCards.prototype.showBocBai=function(visible){this.text_bocbai.visible=visible;if(visible){if(this.bocbaiAnim){PIXI.actionManager.cancelAction(this.bocbaiAnim);this.bocbaiAnim=null}this.text_bocbai.position.set(this.originX,this.originY-100);var ac=cc.sequence(cc.moveTo(1,cc.p(this.originX,this.originY-120)),cc.moveTo(1,cc.p(this.originX,this.originY-100)));var repeat=cc.repeatForever(ac);this.bocbaiAnim=PIXI.actionManager.runAction(this.text_bocbai,repeat)}};
DeckCards.prototype.onBocBaiButtonHandler=function(){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.BOC_BAI}];LobbyClient.getInstance().send(sendObj)};function UserAvatar(size,circleImg){PIXI.Sprite.call(this);if(size)this.size=size;if(hiepnh.isUndefined(circleImg))circleImg=true;var avatarBg=PIXI.Sprite.fromFrame("khung_avatar.png");if(cc.Global.gameId===Constant.GAME_ID.CHAN&&circleImg){avatarBg.displayGroup=MyPixi.gamePlayerLayer;avatarBg=PIXI.Sprite.fromFrame("game/khung_avatar_chan.png");var radian=(avatarBg.width-20)/2;var maskAvatar=new MaskCircleLayer(radian);maskAvatar.displayGroup=MyPixi.gamePlayerLayer;maskAvatar.position.set(size.width/
2,size.height/2);this.addChild(maskAvatar);var avatarImg=new PIXI.Sprite;avatarImg.position.set(-size.width/2,-size.height/2);maskAvatar.addChild(avatarImg);this.avatarImg=avatarImg;this.maskAvatar=maskAvatar}else{var avatarImg=new PIXI.Sprite;this.addChild(avatarImg);this.avatarImg=avatarImg}if(this.size&&cc.Global.gameId!==Constant.GAME_ID.CHAN){var scaleX=this.size.width/avatarBg.width;var scaleY=this.size.height/avatarBg.height;var scale=scaleX<scaleY?scaleX:scaleY;avatarBg.scale.set(scale,scale)}avatarBg.visible=
false;this.addChild(avatarBg);this.avatarBg=avatarBg;this.interactive=true;this.buttonMode=true;var thiz=this;var onButtonDown=function(){cc.log("show info");if(thiz.showInfoHandler)thiz.showInfoHandler()};this.on("pointerdown",onButtonDown)}UserAvatar.prototype=Object.create(PIXI.Sprite.prototype);UserAvatar.prototype.setSizeAvatar=function(size){this.size=size};UserAvatar.prototype.setAvatarBg=function(avatarImg){this.avatarBg.texture=PIXI.Sprite.fromFrame(avatarImg)};
UserAvatar.prototype.setAvatar=function(avatarUrl){cc.log("setAvatar "+avatarUrl);if(avatarUrl.indexOf("http")!==-1)if(avatarUrl.indexOf("graph.facebook.com")!==-1){avatarUrl=avatarUrl.concat("\x26redirect\x3dfalse");if(avatarUrl.endsWith("?"))avatarUrl=avatarUrl.slice(0,-1);var thiz=this;HttpRequest.requestGETMethod_FB(avatarUrl,null,null,function(status,response){if(response&&response.data){var url=response.data.url;if(url)thiz.loadAvatarFromUrl(url)}})}else this.loadAvatarFromUrl(avatarUrl);else cc.log("user ko co avatar")};
UserAvatar.prototype.loadAvatarFromUrl=function(avatarUrl){var thiz=this;cc.log("avatar----load "+avatarUrl);var loaderAvatar=new PIXI.loaders.Loader;loaderAvatar.add(avatarUrl);loaderAvatar.once("complete",function(){var sprite=loaderAvatar.resources[avatarUrl];var scaleX=thiz.size.width/sprite.texture.width;var scaleY=thiz.size.height/sprite.texture.height;var scale=scaleX<scaleY?scaleX:scaleY;thiz.avatarImg.texture=sprite.texture;thiz.avatarImg.scale.set(scale,scale);cc.log("avatar----load done")});
loaderAvatar.load()};UserAvatar.prototype.createLobbyAvatar=function(){var avt=new UserAvatar;avt.setAvatarBg("bg_avatar_home.png");return avt};UserAvatar.prototype.createMe=function(){var avt=new UserAvatar;avt.setAvatarBg("bg_avatar_home.png");return avt};UserAvatar.prototype.createAvatar=function(){var avt=new UserAvatar;avt.setAvatarBg("bg_avatar_home.png");return avt};UserAvatar.createAvatarGame=function(size,circleImg){var avt=new UserAvatar(size,circleImg);return avt};function MyDialog(size,bgImg,force9Path){this.animation=[];PIXI.Container.call(this);this.displayGroup=MyPixi.popupLayer;this.interactive=true;this.size=size;var thiz=this;thiz.enableOutSizeClose=true;this.position.x=0;this.position.y=0;thiz.graphics=new PIXI.Graphics;this.addChild(thiz.graphics);thiz.graphics.clear();thiz.graphics.beginFill(0,.3);thiz.graphics.drawRect(0,0,MyPixi.rendererGame.width,MyPixi.rendererGame.height);thiz.graphics.endFill();this.bgHide=PIXI.Sprite.fromFrame("bg_popup.png");
this.bgHide.anchor.set(.5,.5);this.bgHide.position.set(cc.Global.GameView.width/2,cc.Global.GameView.height/2);this.addChild(this.bgHide);var bg=null;if(cc.Global.gameId!=Constant.GAME_ID.CHAN){var padding=[10,10,10,10];if(force9Path)bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromImage(bgImg),padding[0],padding[1],padding[2],padding[3]);else if(bgImg)bg=PIXI.Sprite.fromImage(bgImg);else bg=PIXI.Sprite.fromImage("res/bg/bg_dialog_large.png");bg.width=size.width;bg.height=size.height;bg.position.set(-bg.width/
2,-bg.height/2)}else{bg=PIXI.Sprite.fromImage("res/bg/bg_notice.png");bg.anchor.set(0,0);bg.position.set(-bg.width/2,-bg.height/2)}this.bgHide.addChild(bg);this.bg=bg;this.bg.interactive=true;var onButtonMove=function(){};var onButtonUp=function(){};var onButtonOver=function(){};var onButtonOut=function(){};this.on("pointerdown",this.onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut).on("pointermove",onButtonMove);
var margin=50;if(cc.Global.gameId==Constant.GAME_ID.CHAN){margin=30;this.okButton=MyHelper.createButton(["button/btn_ok.png","button/btn_ok_press.png"],true,function(){if(thiz.okButtonHandler)thiz.okButtonHandler()});this.okButton.anchor.set(0,0);this.okButton.position.set(bg.width/2-margin-this.okButton.width,bg.height-100)}else{this.okButton=MyHelper.createButton("button/btn_button1.png",true,function(){if(thiz.okButtonHandler)thiz.okButtonHandler()});this.okButton.position.set(bg.width/2-margin-
this.okButton.width,bg.height-60);MyHelper.addLblButton(this.okButton,"\u0110\u1ed3ng \u00fd",16)}this.okButton.displayGroup=null;bg.addChild(this.okButton);if(cc.Global.gameId==Constant.GAME_ID.CHAN){this.cancelButton=MyHelper.createButton(["button/btn_quit.png","button/btn_quit_press.png"],true,function(){if(thiz.cancelButtonHandler)thiz.cancelButtonHandler()});this.cancelButton.anchor.set(0,0);this.cancelButton.position.set(bg.width/2+margin,bg.height-100)}else{this.cancelButton=MyHelper.createButton("button/btn_button1.png",
true,function(){if(thiz.cancelButtonHandler)thiz.cancelButtonHandler()});this.cancelButton.displayGroup=null;MyHelper.addLblButton(this.cancelButton,"Tr\u1edf v\u1ec1",16);this.cancelButton.position.set(bg.width/2+margin,bg.height-60)}this.cancelButton.displayGroup=null;bg.addChild(this.cancelButton);this.closeButton=MyHelper.createButton("button/btn_button1.png",true,function(){});this.closeButton.displayGroup=null;this.closeButton.position.set(bg.width+margin,80);this.closeButton.visible=false;
bg.addChild(this.closeButton);var messageLabel=cc.LabelTTF("",cc.res.font.Arial,24,null,"white");messageLabel.anchor.set(.5,.5);messageLabel.style.wordWrap=true;messageLabel.style.wordWrapWidth=bg.width-100;messageLabel.style.align="top";if(cc.Global.gameId==Constant.GAME_ID.CHAN)messageLabel.position.set(bg.width/2,bg.height/2-10);else{messageLabel.anchor.set(.5,0);messageLabel.position.set(bg.width/2,bg.height/2-50)}bg.addChild(messageLabel);this.messageLabel=messageLabel;var labelTitle=cc.LabelTTF("",
cc.res.font.Arial,26,null,"white");labelTitle.anchor.set(.5,.5);labelTitle.position.set(this.bg.width/2,25);if(cc.Global.gameId==Constant.GAME_ID.CHAN)labelTitle.position.set(this.bg.width/2,60);this.bg.addChild(labelTitle);this.labelTitle=labelTitle}MyDialog.prototype=Object.create(PIXI.Container.prototype);MyDialog.prototype.setEnableOutSizeClose=function(enable){this.enableOutSizeClose=enable};
MyDialog.prototype.onButtonDown=function(event){var thiz=this;if(thiz.hideDialog)return;var dragPoint=event.data.getLocalPosition(thiz.parent);dragPoint=cc.convertToNodeSpace(thiz.bg,dragPoint);var recBg=cc.rect(0,0,thiz.bg.width,thiz.bg.height);if(!cc.rectContainsPoint(recBg,dragPoint)&&thiz.enableOutSizeClose)thiz.hide()};MyDialog.prototype.okButtonHandler=function(){this.hide()};MyDialog.prototype.cancelButtonHandler=function(){this.hideDialog=true;cc.log("hideDiloag");this.hide()};
MyDialog.prototype.hide=function(){if(this.parent){this.stopAllActions();var thiz=this;var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){if(thiz.parent)thiz.parent.removeChild(thiz)}));this.runAction(this.bgHide,ac)}};MyDialog.prototype.show=function(visible){if(hiepnh.isUndefined(visible))visible=true;this.visible=visible};
MyDialog.prototype.showWithAnimationScale=function(){this.bgHide.scale.set(0,0);var scaleAction=cc.scaleTo(.2,1);this.runAction(this.bgHide,scaleAction)};MyDialog.prototype.showWithAnimationScaleDelay=function(delay){this.bgHide.scale.set(0,0);var scaleAction=cc.scaleTo(.2,1);var ac=cc.sequence(cc.delayTime(delay),scaleAction);this.runAction(this.bgHide,ac)};MyDialog.prototype.showWithAnimationMove=function(){this.showWithAnimationScale()};MyDialog.prototype.setEnableOutSideClose=function(enable){};
MyDialog.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};MyDialog.prototype.stopAction=function(action){if(action)if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>0;i--)if(this.animation[i]==action){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1);action=null;break}};
MyDialog.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};MyDialog.prototype.setMessage=function(message){if(message)message=message.trim();this.messageLabel.text=message};
function MessageOkDialog(size){size=cc.size(500,344);MyDialog.call(this,size,"res/bg/bg_dialog_small.png");this.okButton.visible=true;this.closeButton.visible=false;this.cancelButton.visible=false;this.okButton.anchor.set(.5);this.okButton.x=this.bg.width/2;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this)}MessageOkDialog.prototype=Object.create(MyDialog.prototype);MessageOkDialog.prototype.okButtonHandler=function(){this.hide()};
MessageOkDialog.prototype.cancelButtonHandler=function(){this.hide()};function MessageConfirmDialog(size){size=cc.size(500,344);MyDialog.call(this,size,"res/bg/bg_dialog_small.png");this.okButton.anchor.set(.5);this.cancelButton.anchor.set(.5);this.okButton.visible=true;this.closeButton.visible=false;this.cancelButton.visible=true;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this);this.okButton.x=this.bg.width/2-100;this.cancelButton.x=this.bg.width/2+100}
MessageConfirmDialog.prototype=Object.create(MyDialog.prototype);MessageConfirmDialog.prototype.okButtonHandler=function(){this.hide()};MessageConfirmDialog.prototype.cancelButtonHandler=function(){this.hide()};
function DragBetDialog(listener,size){size=cc.size(700,460);MyDialog.call(this,size,"res/bg/bg_dialog_withdraw.png");this.listener=listener;this.displayGroup=MyPixi.popupLayer;this.interactive=true;this.width=cc.Global.GameView.width;this.height=cc.Global.GameView.height;this.messageLabel.text="";var labelMyMoney=cc.LabelTTF("0",cc.res.font.Arial,32,null,"yellow");labelMyMoney.anchor.set(.5,.5);labelMyMoney.position.set(this.bg.width/2,this.bg.height-190);this.bg.addChild(labelMyMoney);this.labelMyMoney=
labelMyMoney;var labelTitle=cc.LabelTTF("R\u00fat Ti\u1ec1n",cc.res.font.Arial,26,null,"yellow");labelTitle.anchor.set(.5,.5);labelTitle.position.set(this.bg.width/2,25);this.bg.addChild(labelTitle);this.labelTitle=labelTitle;this.okButton.anchor.set(.5);this.cancelButton.anchor.set(.5);this.okButton.x=this.bg.width/2-100;this.cancelButton.x=this.bg.width/2+100;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this)}DragBetDialog.prototype=Object.create(MyDialog.prototype);
DragBetDialog.prototype.showDialog=function(isShow){this.show(false)};DragBetDialog.prototype.okButtonHandler=function(){this.listener.onWithdrawMoney(this.moneyBet,this.isSitdown)};DragBetDialog.prototype.hide=function(){cc.log("DragBetDialog.prototype.hide");if(this.parent){this.stopAllActions();var thiz=this;var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.visible=false}));this.runAction(this.bgHide,ac)}};
DragBetDialog.prototype.cancelButtonHandler=function(){this.hideDialog=true;this.hide()};DragBetDialog.prototype._updateGoldLabel=function(){var x=this.gradianSlider.x-this.gradianSlider.width/2;x+=this.getPercent()/100*this.gradianSlider.width;this.bgMoney.x=x;var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);this.moneyLabel.text=cc.Global.NumberFormat2(this._allStep[idx],2);this.moneyBet=this._allStep[idx]};
DragBetDialog.prototype._initSlider=function(min,max,step){var thiz=this;this._allStep=step;if(this.initDone){thiz._updateGoldLabel();return}this.initDone=true;var subBt=MyHelper.createButton("tru.png",true,function(){if(thiz.subHander)thiz.subHander()},false,cc.size(150,60),[10,10,10,10]);subBt.position.set(50,this.bg.height/2-50);subBt.displayGroup=null;this.bg.addChild(subBt);var addBt=MyHelper.createButton("add.png",true,function(){if(thiz.addHander)thiz.addHander()},false,cc.size(150,60),[10,
10,10,10]);addBt.position.set(650,this.bg.height/2-50);addBt.displayGroup=null;this.bg.addChild(addBt);var bgSlider=PIXI.Sprite.fromFrame("bg-slider.png");bgSlider.anchor.set(.5,.5);bgSlider.position.set(this.bg.width/2,this.bg.height/2-50);this.bg.addChild(bgSlider);this.bgSlider=bgSlider;var gradianSlider=PIXI.Sprite.fromFrame("raise_load_hor.png");gradianSlider.anchor.set(.5,.5);gradianSlider.position.set(bgSlider.x,bgSlider.y);this.bg.addChild(gradianSlider);this.gradianSlider=gradianSlider;var goldSlider=
PIXI.Sprite.fromFrame("icon-slider.png");goldSlider.anchor.set(.5,.5);goldSlider.position.set(bgSlider.x,bgSlider.y);this.bg.addChild(goldSlider);this.goldSlider=goldSlider;var minLabel=cc.LabelTTF(cc.Global.NumberFormat2(min),cc.res.font.Arial,32,"null","yellow");minLabel.anchor.set(.5,.5);minLabel.position.set(bgSlider.x-bgSlider.width/2,bgSlider.y+70);this.bg.addChild(minLabel);var maxLabel=cc.LabelTTF(cc.Global.NumberFormat2(max),cc.res.font.Arial,32,"null","yellow");maxLabel.anchor.set(.5,.5);
maxLabel.position.set(bgSlider.x+bgSlider.width/2,bgSlider.y+70);this.bg.addChild(maxLabel);var bgMoney=PIXI.Sprite.fromFrame("bg_money.png");bgMoney.anchor.set(.5,.5);bgMoney.position.set(300,bgSlider.y-80);this.bg.addChild(bgMoney);this.bgMoney=bgMoney;var moneyLabel=cc.LabelTTF("100k",cc.res.font.Arial,24,null,"black");moneyLabel.anchor.set(.5,.5);moneyLabel.position.set(bgMoney.width/2-50,bgMoney.height/2-50);bgMoney.addChild(moneyLabel);this.moneyLabel=moneyLabel;this.goldSlider.interactive=
true;this.goldSlider.buttonMode=true;var onButtonDown=function(event){thiz.data=event.data;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isTouched=true;thiz.isMoved=false;thiz.isAcpetTouch=true;event.stopPropagation()};var onButtonMove=function(){if(!thiz.isAcpetTouch)return;var p=thiz.data.getLocalPosition(thiz.parent);if(!thiz.isMoved)if(cc.pDistance(thiz.preTouchPoint,p)<5)return;else thiz.isMoved=true;thiz.goldSlider.x+=p.x-thiz.preTouchPoint.x;var min=thiz.gradianSlider.x-
thiz.gradianSlider.width/2;var max=thiz.gradianSlider.x+thiz.gradianSlider.width/2;if(thiz.goldSlider.x>max)thiz.goldSlider.x=max;if(thiz.goldSlider.x<min)thiz.goldSlider.x=min;thiz._updateGoldLabel();thiz.preTouchPoint=p};var onButtonUp=function(){thiz.isTouched=false;thiz.isAcpetTouch=false};var onButtonOver=function(){};var onButtonOut=function(){};this.goldSlider.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",
onButtonOut).on("pointermove",onButtonMove);thiz._updateGoldLabel()};DragBetDialog.prototype.setPercent=function(percent){var x=this.gradianSlider.x-this.gradianSlider.width/2;x+=percent/100*this.gradianSlider.width;this.goldSlider.x=x};DragBetDialog.prototype.getPercent=function(){var x=this.gradianSlider.x-this.gradianSlider.width/2;var percent=100*(this.goldSlider.x-x)/this.gradianSlider.width;return percent};
DragBetDialog.prototype.subHander=function(){var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);if(idx>0){idx--;var rate=idx/(this._allStep.length-1);this.setPercent(rate*100);this._updateGoldLabel()}};DragBetDialog.prototype.addHander=function(){var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);if(idx<this._allStep.length-1){idx++;var rate=idx/(this._allStep.length-1);this.setPercent(rate*100);this._updateGoldLabel()}};
DragBetDialog.prototype._initSlotType1=function(slotCount){return};DragBetDialog.prototype._initSlotType2=function(slot1,slot2){return};DragBetDialog.prototype.setData=function(money,min,max,step,isSitdown){this.isSitdown=isSitdown;this.labelMyMoney.text=cc.Global.NumberFormat2(money,2);var b=[];b.push(min);var val=min;while(val<max){val+=step;if(val<=max)b.push(val);else b.push(max)}this.moneyBet=b[b.length-1];this._initSlider(b[0],b[b.length-1],b);this.setPercent(100);this._updateGoldLabel()};
function WithdrawMoneyDialog(listener,size){size=cc.size(700,460);DragBetDialog.call(this,listener,size)}WithdrawMoneyDialog.prototype=Object.create(DragBetDialog.prototype);
WithdrawMoneyDialog.prototype._initSlider=function(min,max,step){DragBetDialog.prototype._initSlider.call(this,min,max,step);var chbAutoRutTien=new ButtonToggle("solo_checked.png","solo_check.png");chbAutoRutTien.displayGroup=MyPixi.popupLayer;chbAutoRutTien.onLabel.style.fontSize=24;chbAutoRutTien.setText("T\u1ef1 \u0111\u1ed9ng mua v\u00e0o khi h\u1ebft ti\u1ec1n");chbAutoRutTien.onLabel.anchor.set(0,.5);chbAutoRutTien.onLabel.x=chbAutoRutTien.width+10;chbAutoRutTien.anchor.set(.5,.5);chbAutoRutTien.position.set(this.bg.width/
4,this.labelMyMoney.y+60);this.bg.addChild(chbAutoRutTien);var thiz=this;chbAutoRutTien.onSelect=function(selected){thiz.listener.onListenerAutoRutTien(true)};chbAutoRutTien.onUnSelect=function(selected){thiz.listener.onListenerAutoRutTien(false)};chbAutoRutTien.visible=true};function ShapeCard(rank,suit,listener){Card.call(this,rank,suit,listener)}ShapeCard.prototype=Object.create(Card.prototype);
ShapeCard.prototype.onButtonDown=function(event){if(this.isBlur()||this.listener.countUpSelected()===2&&!this.isSelected())return;this.setSelected(!this._selected)};ShapeCard.prototype.onButtonUp=function(){};ShapeCard.prototype.onButtonMove=function(){};function ChoseCard(rank,suit,listener){Card.call(this,rank,suit,listener)}ChoseCard.prototype=Object.create(Card.prototype);ChoseCard.prototype.onButtonDown=function(event){this.listener.onTouchCard(this.getCardData().codeCard)};
ChoseCard.prototype.onButtonUp=function(){};ChoseCard.prototype.onButtonMove=function(){};
function ShapeCardShow(listener,size,bgImg,force9path){if(hiepnh.isUndefined(size))size=cc.size(400,300);MyDialog.call(this,size,bgImg?bgImg:"bg_dialog_2.png",force9path?true:false);this.okButton.visible=true;this.closeButton.visible=false;this.cancelButton.visible=false;this.okButton.anchor.set(.5);this.okButton.x=this.bg.width/2;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this);this.spriteCards=[];this.listener=listener;this.labelTitle.text="Ch\u1ecdn c\u00e2y b\u00e0i l\u1eadt"}
ShapeCardShow.prototype=Object.create(MyDialog.prototype);ShapeCardShow.prototype.okButtonHandler=function(){var self=this;var cs=[];this.spriteCards.forEach(function(card,index){if(card.isSelected())self.cardState[index]=1;if(card.isSelected()&&!card.isBlur())cs.push(self.cardArr[index])});cc.log("ShapeCardShow.cardState\x3d\x3d\x3e "+this.cardState);this.listener.onSendLatBai(cs,this.cardState)};ShapeCardShow.prototype.cancelButtonHandler=function(){this.hide()};
ShapeCardShow.prototype.hide=function(){if(this.parent){this.stopAllActions();var thiz=this;var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.visible=false}));this.runAction(this.bgHide,ac)}};
ShapeCardShow.prototype.init=function(cardArr,cardState){this.listener.length=0;if(this.spriteCards.length)for(var i=0;i<this.spriteCards.length;i++)this.spriteCards[i].parent.removeChild(this.spriteCards[i]);this.spriteCards.length=0;this.cardState=cardState;this.cardArr=cardArr;var thiz=this;cardArr.forEach(function(card,index){var cardData=Utils.getCardFromServer(card);var newCard=new ShapeCard(cardData.point,cardData.suit,thiz);newCard.displayGroup=MyPixi.popupLayer;newCard.anchor.set(.5,.5);
newCard.canTouch=true;newCard.tag=index;thiz.bg.addChild(newCard);thiz.spriteCards.push(newCard);newCard.reveal(true);var startPos=cc.p(100+150*index,60+thiz.bg.height/2-newCard.height/2+0);newCard.origin=startPos;newCard.position.set(startPos.x,startPos.y);if(cardState[index]===1){newCard.revealBlur(true);newCard.setSelected(true)}else newCard.revealBlur(false)})};
ShapeCardShow.prototype.showDialog=function(isShow,cardArr,cardState){if(isShow){this.show(true);this.showWithAnimationScale();this.init(cardArr,cardState)}else this.show(false)};ShapeCardShow.prototype.countUp2AndBlur=function(){var count=0;for(var i=0;i<this.cardState.length;i++)if(this.cardState[i]===1&&this.spriteCards[i].isBlur())count++;return count};
ShapeCardShow.prototype.countUp2AndNotBlur=function(){var count=0;for(var i=0;i<this.cardState.length;i++)if(this.cardState[i]===1&&!this.spriteCards[i].isBlur())count++;return count};ShapeCardShow.prototype.countUp=function(){var count=0;for(var i=0;i<this.cardState.length;i++)if(this.cardState[i]===1)count++;return count};ShapeCardShow.prototype.countUpSelected=function(){var count=0;for(var i=0;i<this.spriteCards.length;i++)if(this.spriteCards[i].isSelected())count++;return count};
ShapeCardShow.prototype.move=function(node){if(node.isBlur())return;if(this.countUp2AndBlur()===2)return;var index=node.tag;if(this.countUp()===2&&this.cardState[index]===0)for(var i=0;i<this.spriteCards.length;i++){var actionDown=cc.moveBy(.1,cc.p(0,50));if(node!==this.spriteCards[i]&&!this.spriteCards[i].isBlur()){this.spriteCards[i].runAction(this.spriteCards[i],actionDown);this.cardState[i]=Math.abs(this.cardState[i]-1)}}var isUp=this.cardState[index]==1?true:false;var endP=cc.p(0,-50);if(isUp)endP=
cc.p(0,50);var moveAction=cc.moveBy(.1,endP);node.runAction(node,moveAction);this.cardState[index]=Math.abs(this.cardState[index]-1)};function ChoseCardShow(listener,size){if(hiepnh.isUndefined(size))size=cc.size(500,344);ShapeCardShow.call(this,listener,size,"res/bg/bg_dialog_small.png",false);this.labelTitle.text="Ch\u1ecdn c\u00e2y b\u00e0i l\u1eadt";this.okButton.visible=false;this.setEnableOutSizeClose(false)}ChoseCardShow.prototype=Object.create(ShapeCardShow.prototype);
ChoseCardShow.prototype.showDialog=function(isShow,cardArr){if(isShow){this.show(true);this.showWithAnimationScaleDelay(.5);this.init(cardArr)}else this.show(false)};ChoseCardShow.prototype.onTouchCard=function(codeCard){this.listener.onSendLatBai(codeCard)};
ChoseCardShow.prototype.init=function(cardArr,cardState){this.listener.length=0;if(this.spriteCards.length)for(var i=0;i<this.spriteCards.length;i++)this.spriteCards[i].parent.removeChild(this.spriteCards[i]);this.spriteCards.length=0;this.cardState=cardState;this.cardArr=cardArr;var thiz=this;cardArr.forEach(function(card,index){var cardData=Utils.getCardFromServer(card);var newCard=new ChoseCard(cardData.point,cardData.suit,thiz);newCard.displayGroup=MyPixi.popupLayer;newCard.anchor.set(.5,.5);
newCard.canTouch=true;newCard.tag=index;thiz.bg.addChild(newCard);thiz.spriteCards.push(newCard);newCard.reveal(true);var startPos=cc.p(150+200*index,60+thiz.bg.height/2-newCard.height/2+50);newCard.origin=startPos;newCard.position.set(startPos.x,startPos.y);newCard.revealBlur(false)})};
function ShapeCardShowBaCay(listener){ShapeCardShow.call(this,listener,cc.size(400,300),"bg_dialog_2.png",true);this.labelTitle.text="N\u1eb7n b\u00e0i";MyHelper.addLblButton(this.okButton,"M\u1edf lu\u00f4n",14);this.labelTitle.x=this.labelTitle.width/2+20;this.okButton.visible=true;this.okButton.anchor.set(.5);this.okButton.x=-20+this.bg.width-this.okButton.width/2;this.okButton.y=40;this.setEnableOutSizeClose(false)}ShapeCardShowBaCay.prototype=Object.create(ShapeCardShow.prototype);
ShapeCardShowBaCay.prototype.showDialog=function(isShow,cardArr){if(isShow){this.show(true);this.showWithAnimationScaleDelay(.5);this.init(cardArr)}else this.show(false)};ShapeCardShowBaCay.prototype.finishShapeCard=function(){this.listener.finishShapeCard(this.cardArr)};ShapeCardShowBaCay.prototype.okButtonHandler=function(){this.finishShapeCard()};
ShapeCardShowBaCay.prototype.init=function(cardArr,cardState){this.listener.length=0;if(this.spriteCards.length){var length=this.spriteCards.length;for(var i=length-1;i>=0;i--)this.spriteCards[i].parent.removeChild(this.spriteCards[i])}this.numberCardShow=0;this.spriteCards.length=0;this.cardState=cardState;this.cardArr=cardArr;var thiz=this;cardArr.forEach(function(card,index){var cardData=Utils.getCardFromServer(card);var newCard=new Card(cardData.point,cardData.suit,thiz);newCard.interactive=false;
newCard.canTouch=false;newCard.canMove=false;newCard.displayGroup=MyPixi.popupLayer;newCard.anchor.set(.5,.5);newCard.tag=index;thiz.bg.addChild(newCard);thiz.spriteCards.push(newCard);newCard.reveal(true);var startPos=cc.p(90+110*index,60+thiz.bg.height/2-newCard.height/2+50);newCard.origin=startPos;newCard.position.set(startPos.x,startPos.y);newCard.revealBlur(false);newCard.scale.set(1,1);var cardUp=new BaCayBackCard(thiz);cardUp.reveal(false);cardUp.displayGroup=newCard.displayGroup;cardUp.anchor.set(.5,
.5);cardUp.origin=cc.p(0,0);cardUp.scale.set(newCard.scale.x,newCard.scale.y);cardUp.position.set(0,0);newCard.addChild(cardUp)})};
function RaiseMoney(listener){var size=cc.size(600,300);MyDialog.call(this,size);this.okButton.visible=false;this.closeButton.visible=false;this.cancelButton.visible=false;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this);this.listener=listener;this.bgHide.visible=false;this.bg.parent.removeChild(this.bg);this.bg=PIXI.Sprite.fromFrame("bg-slider_up.png");this.bg.anchor.set(.5,.5);this.bg.position.set(cc.Global.GameView.width-this.bg.width/2-70,cc.Global.GameView.height/2-80);
this.addChild(this.bg);this.graphics.visible=false}RaiseMoney.prototype=Object.create(MyDialog.prototype);RaiseMoney.prototype.okButtonHandler=function(){this.hide()};RaiseMoney.prototype.cancelButtonHandler=function(){this.hide()};RaiseMoney.prototype.init=function(min,max,step){var b=[];b.push(min);var val=min;while(val<max){val+=step;if(val<=max)b.push(val);else b.push(max)}this.moneyBet=min;this._initSlider(b[0],b[b.length-1],b);this.setPercent(0);this._updateGoldLabel()};
RaiseMoney.prototype.showDialog=function(isShow,min,max,step){if(isShow){this.show(true);this.showWithAnimationScale();this.init(min,max,step)}else this.show(false)};RaiseMoney.prototype.getMoneyRaise=function(){return this.moneyBet};
RaiseMoney.prototype.hide=function(){if(this.parent){this.isAcpetTouch=false;this.isTouched=false;this.stopAllActions();var thiz=this;var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.visible=false}));this.runAction(this.bgHide,ac)}};
RaiseMoney.prototype._updateGoldLabel=function(){var y=this.gradianSlider.y+this.gradianSlider.height/2;y-=this.getPercent()/100*this.gradianSlider.height;this.bgMoney.y=y;var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);this.moneyLabel.text=cc.Global.NumberFormat2(this._allStep[idx],2);this.moneyBet=this._allStep[idx]};
RaiseMoney.prototype._initSlider=function(min,max,step){var thiz=this;this.bg.removeChildren();this._allStep=step;var widthBG=this.bg.width;var heightBG=this.bg.height;var subBt=MyHelper.createButton("tru.png",true,function(event){if(thiz.subHander)thiz.subHander()},false,cc.size(150,60),[10,10,10,10]);subBt.position.set(0,heightBG/2-subBt.height);subBt.displayGroup=null;this.bg.addChild(subBt);var addBt=MyHelper.createButton("add.png",true,function(event){if(thiz.addHander)thiz.addHander()},false,
cc.size(150,60),[10,10,10,10]);addBt.position.set(0,-heightBG/2+subBt.height);addBt.displayGroup=null;this.bg.addChild(addBt);var gradianSlider=PIXI.Sprite.fromFrame("raise_load_up.png");gradianSlider.anchor.set(.5,.5);gradianSlider.position.set(0,0);this.bg.addChild(gradianSlider);this.gradianSlider=gradianSlider;var goldSlider=PIXI.Sprite.fromFrame("icon-slider.png");goldSlider.anchor.set(.5,.5);goldSlider.position.set(0,0);this.bg.addChild(goldSlider);this.goldSlider=goldSlider;var bgMoney=PIXI.Sprite.fromFrame("poker_raise_info.png");
bgMoney.anchor.set(.5,.5);bgMoney.position.set(-110,0);this.bg.addChild(bgMoney);this.bgMoney=bgMoney;var moneyLabel=cc.LabelTTF("100k",cc.res.font.Arial,24,null,"black");moneyLabel.anchor.set(.5,.5);moneyLabel.position.set(bgMoney.width/2-90,bgMoney.height/2-50);bgMoney.addChild(moneyLabel);this.moneyLabel=moneyLabel;this.goldSlider.interactive=true;this.goldSlider.buttonMode=true;var onButtonDownSlider=function(event){event.stopPropagation();thiz.data=event.data;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);
thiz.isTouched=true;thiz.isMoved=false;thiz.isAcpetTouch=true};var onButtonMove=function(){if(!thiz.isAcpetTouch)return;if(!thiz.isTouched)return;var p=thiz.data.getLocalPosition(thiz.parent);if(!thiz.isMoved)if(cc.pDistance(thiz.preTouchPoint,p)<5)return;else thiz.isMoved=true;thiz.goldSlider.y+=p.y-thiz.preTouchPoint.y;var min=thiz.gradianSlider.y-thiz.gradianSlider.height/2;var max=thiz.gradianSlider.y+thiz.gradianSlider.height/2;if(thiz.goldSlider.y>max)thiz.goldSlider.y=max;if(thiz.goldSlider.y<
min)thiz.goldSlider.y=min;thiz._updateGoldLabel();thiz.preTouchPoint=p};var onButtonUp=function(){thiz.isTouched=false;thiz.isAcpetTouch=false};var onButtonOver=function(){};var onButtonOut=function(){};this.goldSlider.on("pointerdown",onButtonDownSlider).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut).on("pointermove",onButtonMove);thiz._updateGoldLabel()};
RaiseMoney.prototype.onButtonDown=function(event){event.stopPropagation();var thiz=this;if(thiz.hideDialog)return;var dragPoint=event.data.getLocalPosition(thiz.parent);dragPoint=cc.convertToNodeSpace(thiz.bg,dragPoint);var recBg=cc.rect(-thiz.bg.width/2,-thiz.bg.height/2,thiz.bg.width,thiz.bg.height);if(!cc.rectContainsPoint(recBg,dragPoint))thiz.hide()};
RaiseMoney.prototype.setPercent=function(percent){var y=this.gradianSlider.y+this.gradianSlider.height/2;y-=percent/100*this.gradianSlider.height;this.goldSlider.y=y};RaiseMoney.prototype.getPercent=function(){var y=this.gradianSlider.y+this.gradianSlider.height/2;var percent=100*Math.abs(y-this.goldSlider.y)/this.gradianSlider.height;return percent};
RaiseMoney.prototype.subHander=function(){cc.log("subHander");var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);if(idx>0){idx--;var rate=idx/(this._allStep.length-1);this.setPercent(rate*100);this._updateGoldLabel()}};RaiseMoney.prototype.addHander=function(){cc.log("addHander");var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);if(idx<this._allStep.length-1){idx++;var rate=idx/(this._allStep.length-1);this.setPercent(rate*100);this._updateGoldLabel()}};
function RaiseMoneyBaCay(listener,bgName,pos,colorText){var size=cc.size(600,300);MyDialog.call(this,size);this.bgName=bgName;this.colorText=colorText;this.okButton.visible=false;this.closeButton.visible=false;this.cancelButton.visible=false;this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this);this.listener=listener;this.bgHide.visible=false;this.bg.parent.removeChild(this.bg);this.bg=PIXI.Sprite.fromFrame(bgName);this.bg.anchor.set(.5,.5);this.bg.position.set(pos.x,pos.y);this.addChild(this.bg);
this.graphics.visible=false;this.setEnableOutSizeClose(false)}RaiseMoneyBaCay.prototype=Object.create(MyDialog.prototype);RaiseMoneyBaCay.prototype.init=function(min,max,step){var b=[];b.push(min);var val=min;while(val<max){val+=step;if(val<=max)b.push(val);else b.push(max)}this.stepBet=step;this.maxBet=max;this.moneyBet=min;this._initSlider(b[0],b[b.length-1],b);this.setPercent(0);this._updateGoldLabel()};
RaiseMoneyBaCay.prototype.showDialog=function(isShow,min,max,step){if(isShow){this.show(true);this.showWithAnimationScale();this.init(min,max,step)}else this.show(false)};RaiseMoneyBaCay.prototype.getMoneyRaise=function(){return this.moneyBet};
RaiseMoneyBaCay.prototype.hide=function(){if(this.parent){this.isAcpetTouch=false;this.isTouched=false;this.stopAllActions();var thiz=this;var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.visible=false}));this.runAction(this.bgHide,ac)}};RaiseMoneyBaCay.prototype._updateGoldLabel=function(){var idx=Math.floor(this.getPercent()/100*(this._allStep.length-1)+5E-5);this.moneyLabel.text=cc.Global.NumberFormat2(this._allStep[idx],2);this.moneyBet=this._allStep[idx]};
RaiseMoneyBaCay.prototype._initSlider=function(min,max,step){var thiz=this;this.bg.removeChildren();this._allStep=step;var widthBG=this.bg.width;var heightBG=this.bg.height;var gradianSlider=PIXI.Sprite.fromFrame(this.bgName);gradianSlider.anchor.set(.5,.5);gradianSlider.position.set(0,0);this.bg.addChild(gradianSlider);this.gradianSlider=gradianSlider;var goldSlider=PIXI.Sprite.fromFrame("drag_ico.png");goldSlider.anchor.set(.5,.5);goldSlider.position.set(10,0);this.bg.addChild(goldSlider);this.goldSlider=
goldSlider;var moneyLabel=cc.LabelTTF("999,999k",cc.res.font.Arial,16,null,this.colorText);moneyLabel.anchor.set(.5,.5);moneyLabel.position.set(0,-this.bg.height/2-10);this.bg.addChild(moneyLabel);this.moneyLabel=moneyLabel;this.goldSlider.interactive=true;this.goldSlider.buttonMode=true;var onButtonDownSlider=function(event){event.stopPropagation();thiz.data=event.data;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isTouched=true;thiz.isMoved=false;thiz.isAcpetTouch=true};var onButtonMove=
function(){if(!thiz.isAcpetTouch)return;if(!thiz.isTouched)return;var p=thiz.data.getLocalPosition(thiz.parent);if(!thiz.isMoved)if(cc.pDistance(thiz.preTouchPoint,p)<5)return;else thiz.isMoved=true;thiz.goldSlider.y+=p.y-thiz.preTouchPoint.y;var min=thiz.gradianSlider.y-thiz.gradianSlider.height/2;var max=thiz.gradianSlider.y+thiz.gradianSlider.height/2;if(thiz.goldSlider.y>max)thiz.goldSlider.y=max;if(thiz.goldSlider.y<min)thiz.goldSlider.y=min;thiz.preventMoveOutSlider();thiz._updateGoldLabel();
thiz.preTouchPoint=p};var onButtonUp=function(){thiz.isTouched=false;thiz.isAcpetTouch=false};var onButtonOver=function(){};var onButtonOut=function(){};this.goldSlider.on("pointerdown",onButtonDownSlider).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut).on("pointermove",onButtonMove);thiz._updateGoldLabel()};
RaiseMoneyBaCay.prototype.preventMoveOutSlider=function(){var thiz=this;var min=thiz.gradianSlider.y-thiz.gradianSlider.height/2;var max=thiz.gradianSlider.y+thiz.gradianSlider.height/2;if(thiz.goldSlider.y>max)thiz.goldSlider.y=max;if(thiz.goldSlider.y<min)thiz.goldSlider.y=min};RaiseMoneyBaCay.prototype.onButtonDown=function(event){event.stopPropagation();var thiz=this;if(thiz.hideDialog)return};
RaiseMoneyBaCay.prototype.setPercent=function(percent){var y=this.gradianSlider.y+this.gradianSlider.height/2;y-=percent/100*this.gradianSlider.height;this.goldSlider.y=y};RaiseMoneyBaCay.prototype.getPercent=function(){var y=this.gradianSlider.y+this.gradianSlider.height/2;var percent=100*Math.abs(y-this.goldSlider.y)/this.gradianSlider.height;return percent};RaiseMoneyBaCay.prototype.setPercentStart=function(){var percent=100*this.stepBet/this.maxBet;this.setPercent(percent);this._updateGoldLabel()};function MyProgressBar(type,img){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.type=type;if(!img)img="button/khung_avatar_thoigian.png";this.img=img;this.init();this.stopTimeRemain();this.MAX_TURN=2E4}MyProgressBar.prototype=Object.create(PIXI.Container.prototype);
MyProgressBar.prototype.init=function(){var timerBg=PIXI.Sprite.fromFrame(this.img);timerBg.x=-8;timerBg.y=-8;this.timerBg=timerBg;this.addChild(timerBg);var thing=new PIXI.Graphics;this.addChild(thing);thing.x=timerBg.x;thing.y=timerBg.y;thing.beginFill(16711680);thing.lineStyle(10,16777215);thing.arc(0,0,10,-Math.PI/2,-Math.PI/2);this.thing=thing;this.mask=thing;this.count=0;this.coldown=1E4;this.startColdown=false;this.lineWidth=180};
MyProgressBar.prototype.update=function(dt){this.count+=dt*2*Math.PI/this.coldown;if(this.count>2*Math.PI)this.count=2*Math.PI;this.thing.clear();this.thing.lineStyle(this.lineWidth,16777215);this.thing.arc(this.timerBg.width/2,this.timerBg.height/2,this.timerBg.width/2-20,-Math.PI/2,-Math.PI/2+this.count,false)};MyProgressBar.prototype.stop=function(){};MyProgressBar.prototype.start=function(){this.visible=true;this.startColdown=true};
MyProgressBar.prototype.showTimeRemain=function(currentTime,maxTime){if(!maxTime)maxTime=this.MAX_TURN;this.coldown=maxTime;var startValue=(maxTime-currentTime)*2*Math.PI/this.coldown;this.count=startValue;cc.log("showTimeRemain "+this.startColdown);var thiz=this;if(this.timerAction){this.timerAction.stop();this.timerAction.remove();this.timerAction=null}this.timerAction=new hiepnh.ActionTimer(currentTime/1E3,function(dt){thiz.update(dt*1E3)})};
MyProgressBar.prototype.stopTimeRemain=function(){if(this.timerAction){this.timerAction.stop();this.timerAction.remove();this.timerAction=null;this.thing.clear()}};MyProgressBar.prototype.stopAllActions=function(){this.stopTimeRemain()};function BaoSamTimer(type,timebao){MyProgressBar.call(this,type,"btn_baosam1.png");this.position.x=0;this.position.y=0;this.MAX_TURN=timebao;this.lineWidth=180}BaoSamTimer.prototype=Object.create(MyProgressBar.prototype);
function ProgressCircleTimer(type){MyProgressBar.call(this,type,"game/timebar.png");this.position.x=0;this.position.y=0;this.lineWidth=180}ProgressCircleTimer.prototype=Object.create(MyProgressBar.prototype);function MaskLayer(rec){PIXI.Container.call(this);this.recMask=rec;this.init()}MaskLayer.prototype=Object.create(PIXI.Container.prototype);
MaskLayer.prototype.init=function(){var thing=new PIXI.Graphics;this.addChild(thing);thing.x=0;thing.y=0;var thiz=this;var x=thiz.recMask.x;var y=thiz.recMask.y;var widthMask=thiz.recMask.width;var heightMask=thiz.recMask.height;thing.clear();thing.beginFill(9160191,.4);thing.moveTo(x,y);thing.lineTo(x+widthMask,y);thing.lineTo(x+widthMask,y+heightMask);thing.lineTo(x,y+heightMask);this.mask=thing;this.thing=thing};
MaskLayer.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(this.recMask.x,this.recMask.y,this.recMask.width,
this.recMask.height);this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};function MaskCircleLayer(radius){PIXI.Container.call(this);this.radius=radius;this.init()}MaskCircleLayer.prototype=Object.create(PIXI.Container.prototype);MaskCircleLayer.prototype.init=function(){var thing=new PIXI.Graphics;this.addChild(thing);thing.x=0;thing.y=0;var thiz=this;thing.clear();thing.beginFill(9160191,.4);thing.drawCircle(0,0,this.radius);this.mask=thing;this.thing=thing};
MaskCircleLayer.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawCircle(0,0,this.radius);this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};var whiteHandRank=["null","tuquy3","tuquy2","2tuquy","6doi","3doithong3bich","4doithong3bich","5doithong","6doithong","donghoa","sanhrong","sanhrongdonghoa"];var whiteHandRankSam=["null","donghoa","tuquy2","2xam","5doi","sanhrong","sanhrongdonghoa"];var samResult=["null","bibatsam","cong","den","thoi2","ansam","chansam"];var finishTypePhom=["MAUTHAU","thua","nhi","ba","bet","mom","ukhan","uden","udentron","utron","u","nhat","den_tala","xaokhan"];
var resultXiTo=["M\u1eadu th\u1ea7u","1 \u0111\u00f4i","Th\u00fa","X\u00e1m","S\u1ea3nh","Th\u00f9ng","C\u00f9 l\u0169","T\u1ee9 qu\u00fd","Th\u00f9ng ph\u00e1 s\u1ea3nh","Th\u00f9ng ph\u00e1 s\u1ea3nh th\u01b0\u1ee3ng"];var resultPoker=["M\u1eadu th\u1ea7u","1 \u0111\u00f4i","2 \u0111\u00f4i","X\u00e1m","S\u1ea3nh","Th\u00f9ng","C\u00f9 l\u0169","T\u1ee9 qu\u00fd","Th\u00f9ng ph\u00e1 s\u1ea3nh","Th\u00f9ng ph\u00e1 s\u1ea3nh th\u01b0\u1ee3ng"];
function ResultPoint(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.numberRemain=0;var size=cc.size(120,30);var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("button/dialog.png"),5,5,5,5);bg.width=size.width;bg.height=size.height;bg.position.set(0,0);this.addChild(bg);this.bg=bg;this.lblPointResult=cc.LabelTTF("","arial",18,null,"white");this.lblPointResult.position.set(bg.width/2,bg.height/2+5);bg.addChild(this.lblPointResult)}ResultPoint.prototype=Object.create(PIXI.Container.prototype);
ResultPoint.prototype.showText=function(isShow,str){if(str){this.lblPointResult.text=str;this.lblPointResult.position.set(this.bg.width/2-this.lblPointResult.width/2,this.bg.height/2-this.lblPointResult.height/2)}this.bg.visible=isShow};
ResultPoint.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.bg.width+10,this.bg.height+
10);this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("ResultPoint showBlurBg")};function GamePlayer(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.ctor()}GamePlayer.prototype=Object.create(PIXI.Container.prototype);
GamePlayer.prototype.ctor=function(){var thiz=this;var bg=new PIXI.Sprite.fromFrame("khung_avatar.png");if(cc.Global.gameId===Constant.GAME_ID.CHAN){bg=PIXI.Sprite.fromFrame("game/khung_avatar_chan.png");bg.displayGroup=MyPixi.gameContainerLayer}var padding=10;this.widthBG=bg.width;this.heightBG=bg.height;this.contentSize=cc.size(this.widthBG,this.heightBG);this._isChauRia=false;this.isMe=false;this.username="";this.loginName="";this.index=-1;this.sitId=-1;this.uid="";this.sfsUid="";this.gold=0;this.infoLayer=
new PIXI.Container;this.addChild(this.infoLayer);this.addCuocContainer();this.addCuocContainerLeft();bg.position.set(0,0);this.infoLayer.addChild(bg);var avt=UserAvatar.createAvatarGame(cc.size(this.widthBG-2*padding,this.heightBG-2*padding));avt.position.set(padding,padding-2);this.infoLayer.addChild(avt);this.avt=avt;this.avt.setSizeAvatar(cc.size(this.widthBG-2*padding,this.heightBG-2*padding));this.avt.showInfoHandler=function(){if(thiz.dataPlayer!=null){if(cc.Global.moneyType===MoneyType.Gold)thiz.dataPlayer.As.gold=
thiz.gold;else thiz.dataPlayer.As.chip=thiz.gold;var dialog=new UserDialog;if(cc.Global.gameId==Constant.GAME_ID.CHAN)dialog=new UserDialogChan(cc.size(1E3,530),thiz.dataPlayer);dialog.setInfo(thiz.dataPlayer);dialog.showWithAnimationScale();MyPixi.popupContainer.addChild(dialog)}};var readyChb=new PIXI.Sprite.fromFrame("solo_checked.png");readyChb.anchor.set(0,0);readyChb.position.set(8,4);this.infoLayer.addChild(readyChb);this.readyChb=readyChb;this.readyChb.visible=false;var btnRutTien=MyHelper.createButton("button/btn_ruttien.png",
true,function(){if(thiz.listener)thiz.listener.onSitdown(true)});btnRutTien.displayGroup=null;btnRutTien.anchor.set(0,.5);btnRutTien.position.set(this.contentSize.width,this.contentSize.height/2);this.infoLayer.addChild(btnRutTien);this.btnRutTien=btnRutTien;this.btnRutTien.visible=false;var dealerSprite=PIXI.Sprite.fromFrame("button/dealer_lb.png");dealerSprite.displayGroup=null;dealerSprite.position.set(this.contentSize.width,this.contentSize.height);this.infoLayer.addChild(dealerSprite);this.dealerSprite=
dealerSprite;this.dealerSprite.visible=false;var chuongSprite=PIXI.Sprite.fromFrame("bacay/chuong.png");chuongSprite.anchor.set(.5,1);chuongSprite.displayGroup=null;chuongSprite.position.set(this.contentSize.width/2,5);this.infoLayer.addChild(chuongSprite);this.chuongSprite=chuongSprite;this.chuongSprite.visible=false;var chickenSprite=PIXI.Sprite.fromFrame("bacay/icon_ga.png");chickenSprite.displayGroup=MyPixi.animationLayer;chickenSprite.position.set(this.contentSize.width,this.contentSize.height);
this.infoLayer.addChild(chickenSprite);this.chickenSprite=chickenSprite;this.chickenSprite.visible=false;this.timer=new MyProgressBar(0);if(cc.Global.gameId==Constant.GAME_ID.CHAN){this.timer=new ProgressCircleTimer(0);this.timer.displayGroup=bg.displayGroup;this.timer.position.set(-5,-3)}avt.addChild(this.timer);var roomMaster=new PIXI.Sprite.fromFrame("button/icon_key.png");roomMaster.anchor.set(.5,.5);roomMaster.position.set(this.contentSize.width-8,10);if(cc.Global.gameId==Constant.GAME_ID.CHAN){roomMaster=
new PIXI.Sprite.fromFrame("game/chuphong.png");roomMaster.position.set(this.contentSize.width-30,5);roomMaster.displayGroup=bg.displayGroup}this.roomMaster=roomMaster;this.infoLayer.addChild(roomMaster);this.setMasterRoom(false);var kickBt=MyHelper.createButton("button/icon_kick.png",true,function(){var dialog=new MessageConfirmDialog(cc.size(500,250));dialog.setMessage("B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n k\u00edch "+thiz.username+" ?");dialog.okButtonHandler=function(){var sendObj=[command.RoomPluginMessage,
Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.KICK_PLAYER,"uid":thiz.uid}];cc.log("sendObj "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj);dialog.hide()};dialog.showWithAnimationScale()});kickBt.displayGroup=null;kickBt.anchor.set(.5,0);kickBt.position.set(this.contentSize.width-22,5);this.infoLayer.addChild(kickBt);this.kickBt=kickBt;kickBt.visible=false;var _cardList=new CardList(cc.size(cc.Global.GameView.width/5,80));_cardList.canTouch=
false;_cardList.position.set(this.contentSize.width/2,this.contentSize.height/2);this.infoLayer.addChild(_cardList);this.cardListEndGame=_cardList;this.cardListEndGame.deckPoint=cc.p(this.avt.x+this.avt.size.width/2,this.avt.y+this.avt.size.height/2);var glowEff=new PIXI.Sprite.fromFrame("button/glow1.png");glowEff.displayGroup=MyPixi.animationLayer;glowEff.anchor.set(.5,.5);glowEff.position.set(this.contentSize.width/2,this.contentSize.height/2);this.infoLayer.addChild(glowEff);this.glowEff=glowEff;
this.glowEff.visible=false;var winLoseSprite=new PIXI.Sprite.fromFrame("thang.png");winLoseSprite.displayGroup=MyPixi.animationLayer;winLoseSprite.anchor.set(.5,.5);winLoseSprite.position.set(this.contentSize.width/2,this.contentSize.height/2);this.infoLayer.addChild(winLoseSprite);this.winLoseSprite=winLoseSprite;this.winLoseSprite.visible=false;var state=new PIXI.Sprite.fromFrame("solo_checked.png");state.displayGroup=MyPixi.animationLayer;state.anchor.set(.5,.5);state.position.set(this.contentSize.width/
2,this.contentSize.height/2);this.infoLayer.addChild(state);this.state=state;this.state.visible=false;this.stateId=state_player.NOTHING;var boLuotSprite=new PIXI.Sprite.fromFrame("boluot.png");boLuotSprite.anchor.set(.5,.5);boLuotSprite.position.set(this.contentSize.width/2,this.contentSize.height/2);this.infoLayer.addChild(boLuotSprite);this.boLuotSprite=boLuotSprite;this.boLuotSprite.visible=false;var baoSamSprite=new PIXI.Sprite.fromFrame("baosam.png");baoSamSprite.anchor.set(.5,.5);baoSamSprite.position.set(this.contentSize.width/
2,this.contentSize.height/2);this.infoLayer.addChild(baoSamSprite);baoSamSprite.displayGroup=MyPixi.animationLayer;this.baoSamSprite=baoSamSprite;this.baoSamSprite.visible=false;var thiz=this;var inviteImg="khung_avatar.png";if(cc.Global.gameId===Constant.GAME_ID.CHAN)inviteImg="button/btn_invite.png";var inviteBt=MyHelper.createButton(inviteImg,true,function(){thiz.showInviteDialog()});inviteBt.displayGroup=null;inviteBt.anchor.set(.5,.5);inviteBt.position.set(this.contentSize.width/2,this.contentSize.height/
2);this.addChild(inviteBt);if(cc.Global.gameId!==Constant.GAME_ID.CHAN){var _icon=new PIXI.Sprite.fromFrame("button/btn_moichoi_vuong.png");_icon.anchor.set(.5,.5);_icon.position.set(0,0);inviteBt.addChild(_icon)}var sitBt=MyHelper.createButton("khung_avatar.png",true,function(){thiz.showSitDialog()});sitBt.displayGroup=null;sitBt.anchor.set(.5,.5);sitBt.position.set(this.contentSize.width/2,this.contentSize.height/2);this.addChild(sitBt);sitBt.visible=false;var arrow=new PIXI.Sprite.fromFrame("button/btn_muiten.png");
arrow.anchor.set(.5,.5);arrow.position.set(0,-20);sitBt.addChild(arrow);var delay=cc.delayTime(.2);var originArrow=cc.p(arrow.x,arrow.y);var repeat=cc.repeatForever(cc.sequence(delay,cc.moveTo(.5,cc.p(originArrow.x,originArrow.y-10)),delay,cc.moveTo(.5,cc.p(originArrow.x,originArrow.y))));PIXI.actionManager.runAction(arrow,repeat);var lblSit=cc.LabelTTF("Ng\u1ed3i xu\u1ed1ng",cc.res.font.Arial,18,null,"white");lblSit.anchor.set(.5,.5);lblSit.position.set(0,30);sitBt.addChild(lblSit);var infoNode=
new PIXI.Sprite.fromFrame("button/bg_username.png");infoNode.anchor.set(.5,0);infoNode.position.set(this.contentSize.width/2,this.contentSize.height-5);this.infoNode=infoNode;this.infoLayer.addChild(infoNode);if(cc.Global.gameId===Constant.GAME_ID.PHOM||cc.Global.gameId===Constant.GAME_ID.LIENG||cc.Global.gameId===Constant.GAME_ID.XITO||cc.Global.gameId===Constant.GAME_ID.POKER||cc.Global.gameId===Constant.GAME_ID.BACAY){this.resultPoint=new ResultPoint;this.resultPoint.position.set(this.contentSize.width/
2-this.resultPoint.bg.width/2,this.contentSize.height+42);this.infoLayer.addChild(this.resultPoint)}var userLabel=cc.LabelTTF("Player",cc.res.font.Arial,16,cc.size(this.infoNode.width,30),"white");userLabel.position.set(0,infoNode.height/2);userLabel.anchor.set(.5,.5);this.infoNode.addChild(userLabel);var goldLabel=cc.LabelOrange("1k");goldLabel.anchor.set(.5,.5);goldLabel.position.set(0,infoNode.height+10);this.infoNode.addChild(goldLabel);this.chauRiaLbl=new PIXI.Sprite.fromFrame("button/dangxem.png");
this.chauRiaLbl.anchor.set(.5,.5);this.chauRiaLbl.position.set(this.contentSize.width/2,this.contentSize.height/2);this.infoLayer.addChild(this.chauRiaLbl);this.userLabel=userLabel;this.goldLabel=goldLabel;this.inviteBt=inviteBt;this.sitBt=sitBt;this.avt=avt;var infoBt=new PIXI.Sprite;infoBt.width=avt.width;infoBt.height=avt.height;infoBt.interactive=true;infoBt.buttonMode=true;infoBt.anchor.set(avt.anchor.x,avt.anchor.y);infoBt.position.set(avt.x,avt.y);this.infoLayer.addChild(infoBt);infoBt.on("pointerdown",
function(){thiz.showInfoDialog()});var spriteChat=new PIXI.Sprite.fromFrame("e_1.png");spriteChat.position.set(avt.x,avt.y);this.infoLayer.addChild(spriteChat);this.spriteChat=spriteChat;this.spriteChat.alpha=0;this.setEnable(true)};GamePlayer.prototype.showTimeRemain=function(currentTime,maxTime){this.timer.showTimeRemain(currentTime,maxTime)};GamePlayer.prototype.stopTimeRemain=function(){this.timer.stopTimeRemain()};GamePlayer.prototype.hideCardEndGame=function(){if(this.cardListEndGame)this.cardListEndGame.removeAll()};
GamePlayer.prototype.changeCardAndShow=function(faceCard,a,b){};
GamePlayer.prototype.showCardEndGame=function(cards,anim,_deckPoint){var scale=1;this.cardListEndGame.setContentSize(cc.size(cc.Global.GameView.width/4-100,90));var align=CardAlign.CENTER;if(this.sitId==0)if(this.isMe){align=CardAlign.LEFT;this.cardListEndGame.setContentSize(cc.size(cc.Global.GameView.width-this.contentSize.width-50,150));this.cardListEndGame.position.set(this.contentSize.width+10,0)}else{this.cardListEndGame.setContentSize(cc.size(cc.Global.GameView.width/4-100,90));this.cardListEndGame.position.set(this.contentSize.width/
2-this.cardListEndGame.widthContainer/2,10)}else if(this.sitId==1){align=CardAlign.RIGHT;this.cardListEndGame.position.set(this.contentSize.width,-this.contentSize.height+40)}else if(this.sitId==2){align=CardAlign.CENTER;this.cardListEndGame.position.set(this.contentSize.width/2-this.cardListEndGame.widthContainer/2,-20)}else if(this.sitId==3){align=CardAlign.LEFT;this.cardListEndGame.position.set(0,-this.contentSize.height+40)}if(cc.Global.gameId==Constant.GAME_ID.SAM)if(this.sitId==3){align=CardAlign.CENTER;
this.cardListEndGame.position.set(this.contentSize.width/2-this.cardListEndGame.widthContainer/2,-20)}else if(this.sitId==4){align=CardAlign.LEFT;this.cardListEndGame.position.set(0,-this.contentSize.height+20)}var deckPoint=_deckPoint;if(!_deckPoint)this.cardListEndGame.deckPoint=cc.p(this.avt.x+this.avt.size.width/2,this.avt.y+this.avt.size.height/2);else this.cardListEndGame.setDeckPoint(deckPoint);this.cardListEndGame.canTouch=false;this.cardListEndGame.resetOrigin();this.cardListEndGame.dealCards(cards,
anim,align)};GamePlayer.prototype.isChauRia=function(){return this._isChauRia};GamePlayer.prototype.showChauRia=function(isShow){this._isChauRia=isShow;this.chauRiaLbl.visible=isShow};GamePlayer.prototype.showChatMessage=function(message){};GamePlayer.prototype.setDataPlayer=function(data){this.dataPlayer=data};GamePlayer.prototype.isRoomMaster=function(){return this.isMaster};GamePlayer.prototype.setIndex=function(index){this.index=index};
GamePlayer.prototype.setGold=function(gold){this.goldLabel.text=cc.Global.NumberFormat1(gold);this.gold=gold};GamePlayer.prototype.setSfsUid=function(sfsUid){this.sfsUid=sfsUid};GamePlayer.prototype.setUserLoginName=function(loginName){this.loginName=loginName};GamePlayer.prototype.setUid=function(uid){this.uid=uid};GamePlayer.prototype.setUsername=function(name){this.username=name;if(name.length>10)name=name.substring(0,10)+"...";this.userLabel.text=name};
GamePlayer.prototype.setEnable=function(enable){if(enable){this.infoLayer.visible=true;this.inviteBt.visible=false;this.showNgoiXuong(false)}else{this.username="";this.infoLayer.visible=false;this.inviteBt.visible=true}};GamePlayer.prototype.showNgoiXuong=function(visible){this.sitBt.visible=visible;this.username="";this.infoLayer.visible=!visible};GamePlayer.prototype.showInfoLayer=function(visible){this.infoLayer.visible=visible};GamePlayer.prototype.changeToSmallBg=function(meSitDown){this.showNgoiXuong(!meSitDown)};
GamePlayer.prototype.reset=function(){this._isChauRia=false;this.isMe=false;this.username="";this.loginName="";this.index=-1;this.uid="";this.sfsUid="";this.gold=0;this.winLoseSprite.visible=false;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.visible=false;this.clearAnimMoney();if(this.cardListEndGame)this.cardListEndGame.removeAll();this.showBoLuot(false);this.setState(state_player.NOTHING);this.stateId=state_player.NOTHING;
this.showBaoSam(false);this.showChauRia(false);if(this.resultPoint)this.resultPoint.showText(false)};GamePlayer.prototype.resetEndGame=function(){this.winLoseSprite.visible=false;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.visible=false;this.clearAnimMoney();this.showBoLuot(false);this.setState(state_player.NOTHING);this.showBaoSam(false);this.stopTimeRemain(false);if(this.resultPoint)this.resultPoint.showText(false);if(this.cardListEndGame)this.cardListEndGame.removeAll()};
GamePlayer.prototype.clearAnimMoney=function(){if(this.labelMoneyEff&&this.labelEffectAnimation){PIXI.actionManager.cancelAction(this.labelEffectAnimation);if(this.labelMoneyEff.parent)this.labelMoneyEff.parent.removeChild(this.labelMoneyEff);this.labelMoneyEff=null;this.labelEffectAnimation=null}};
GamePlayer.prototype.showBoLuot=function(isShow){var oldState=this.boLuotSprite.visible;if(this.boLuotSpriteAnim){PIXI.actionManager.cancelAction(this.boLuotSpriteAnim);this.boLuotSpriteAnim=null}var thiz=this;if(isShow){this.boLuotSprite.visible=isShow;thiz.boLuotSprite.alpha=1;var delay=cc.delayTime(1);var repeat=cc.repeatForever(cc.sequence(delay,cc.fadeOut(2),delay,cc.fadeIn(2)));this.boLuotSpriteAnim=PIXI.actionManager.runAction(this.boLuotSprite,repeat)}if(oldState&&!isShow){var fun=function(){thiz.boLuotSprite.visible=
false};thiz.boLuotSprite.alpha=1;var cb=new PIXI.action.CallFunc(fun);var repeat=cc.sequence(cc.fadeOut(1),cb);this.boLuotSpriteAnim=PIXI.actionManager.runAction(this.boLuotSprite,repeat)}};GamePlayer.prototype.showBaoSam=function(isShow){var thiz=this;this.baoSamSprite.visible=isShow};GamePlayer.prototype.getStatePlayer=function(){return this.stateId};
GamePlayer.prototype.setStateChan=function(stateId){if(state_player.NOTHING===stateId)this.state.visible=false;else this.state.visible=true;this.state.displayGroup=MyPixi.gamePlayerLayer;if(state_player_chan.CHON_CAI===stateId)this.state.texture=PIXI.Texture.fromFrame("game/cc.png");else if(state_player_chan.BAT_BAO===stateId)this.state.texture=PIXI.Texture.fromFrame("game/bb.png");else if(state_player_chan.CHON_NOC===stateId)this.state.texture=PIXI.Texture.fromFrame("game/cn.png");else if(state_player_chan.READY===
stateId)this.state.texture=PIXI.Texture.fromFrame("game/ss.png");this.stateId=stateId};
GamePlayer.prototype.setStateLieng=function(stateId){if(state_player.NOTHING===stateId){this.state.visible=false;this.readyChb.visible=false;this.showKick(false)}else this.state.visible=true;if(state_lieng.UP_BAI===stateId)this.state.texture=PIXI.Texture.fromFrame("up.png");else if(state_lieng.THEO===stateId)this.state.texture=PIXI.Texture.fromFrame("theo.png");else if(state_lieng.XEM===stateId)this.state.texture=PIXI.Texture.fromFrame("xem.png");else if(state_lieng.TO===stateId)this.state.texture=
PIXI.Texture.fromFrame("to.png");else if(state_lieng.XA_LANG===stateId)this.state.texture=PIXI.Texture.fromFrame("xalang.png");this.stateId=stateId};
GamePlayer.prototype.setStateBinhResult=function(stateId){cc.log("wtffff setStateBinhResult "+stateId);if(state_binh.NOTHING===stateId){this.state.visible=false;this.readyChb.visible=false;this.showKick(false)}else this.state.visible=true;if(state_binh.BINH_LUNG===stateId)this.state.texture=PIXI.Texture.fromFrame("binhlung.png");else if(state_binh.BA_SANH===stateId)this.state.texture=PIXI.Texture.fromFrame("3sanh.png");else if(state_binh.BA_THUNG===stateId)this.state.texture=PIXI.Texture.fromFrame("3thung.png");
else if(state_binh.SAU_DOI===stateId)this.state.texture=PIXI.Texture.fromFrame("6doi.png");else if(state_binh.NAM_DOI_1_XAM===stateId)this.state.texture=PIXI.Texture.fromFrame("5doi1xam.png");else if(state_binh.DONG_HOA===stateId)this.state.texture=PIXI.Texture.fromFrame("donghoa.png");else if(state_binh.DONG_HOA_1===stateId)this.state.texture=PIXI.Texture.fromFrame("donghoa.png");else if(state_binh.SANH_RONG===stateId)this.state.texture=PIXI.Texture.fromFrame("sanhrong.png");else if(state_binh.SANH_RONG_DONG_HOA===
stateId)this.state.texture=PIXI.Texture.fromFrame("sanhrongdonghoa.png");else if(state_binh.THANG_SAP_HAM===stateId)this.state.texture=PIXI.Texture.fromFrame("thangsapham.png");else if(state_binh.THANG_SAP_LANG===stateId)this.state.texture=PIXI.Texture.fromFrame("thangsaplang.png");else if(state_binh.THUA_SAP_HAM===stateId)this.state.texture=PIXI.Texture.fromFrame("thuasapham.png");else if(state_binh.THUA_SAP_LANG===stateId)this.state.texture=PIXI.Texture.fromFrame("thuasaplang.png");this.stateId=
stateId};
GamePlayer.prototype.setState=function(stateId){if(state_player.READY===stateId){this.readyChb.visible=true;return}if(state_player.BO_LUOT===stateId){this.showBoLuot(true);return}else if(state_player.BAO_SAM===stateId){this.showBaoSam(true);return}if(this.stateAnim){PIXI.actionManager.cancelAction(this.stateAnim);this.stateAnim=null}this.state.position.set(this.contentSize.width/2,this.contentSize.height/2);if(state_player.NOTHING===stateId){this.state.visible=false;this.readyChb.visible=false;this.showKick(false)}else this.state.visible=
true;if(state_player.HUY_BAO===stateId)this.state.texture=PIXI.Texture.fromFrame("huybao.png");else if(state_player.MOM===stateId)this.state.texture=PIXI.Texture.fromFrame("mom.png");else if(state_player.DANG_XEM===stateId){this.state.texture=PIXI.Texture.fromFrame("button/dangxem.png");this.readyChb.visible=false}else if(state_player.AN_CAY_CHOT===stateId){this.state.texture=PIXI.Texture.fromFrame("ancaychot.png");if(this.sitId==0&&this.isMe||this.sitId==3)this.state.x=this.contentSize.width/2+50;
else if(this.sitId==1)this.state.x=this.contentSize.width/2-50}else if(state_player.DANG_XEP_BINH===stateId)this.state.texture=PIXI.Texture.fromFrame("dangxep.png");else if(state_player.XEP_XONG_BINH===stateId)this.state.texture=PIXI.Texture.fromFrame("xepxong.png");if(state_player.BO_LUOT===stateId){var delay=cc.delayTime(1);var repeat=cc.repeatForever(cc.sequence(delay,cc.fadeOut(2),delay,cc.fadeIn(2)));this.stateAnim=PIXI.actionManager.runAction(this.state,repeat)}this.stateId=stateId};
GamePlayer.prototype.setAvatar=function(avatar){this.avt.setAvatar(avatar)};GamePlayer.prototype.showEmoticon=function(emo){if(this.spriteChatAnimation){PIXI.actionManager.cancelAction(this.spriteChatAnimation);this.spriteChatAnimation=null}this.spriteChat.texture=PIXI.Texture.fromFrame(""+emo+".png");this.spriteChat.alpha=255;var action=cc.sequence(cc.delayTime(2),cc.fadeOut(2));this.spriteChatAnimation=PIXI.actionManager.runAction(this.spriteChat,action)};GamePlayer.prototype.showGameNotice=function(text){cc.log("pending..... GamePlayer::showGameNotice")};
GamePlayer.prototype.showSitDialog=function(){if(this.onSitdown)this.onSitdown()};GamePlayer.prototype.showInviteDialog=function(){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":Constant.CMD_RESULT.LIST_INVITE,"rid":LobbyClient.getInstance().getCurrentRoomId()}];LobbyClient.getInstance().send(sendObj);LoadingDialog.getInstance().show("\u0110ang t\u1ea3i danh s\u00e1ch m\u1eddi")};
GamePlayer.prototype.setMasterRoom=function(isMaster){this.isMaster=isMaster;this.roomMaster.visible=isMaster};GamePlayer.prototype.showKick=function(isShow){this.kickBt.visible=isShow};GamePlayer.prototype.showInfoDialog=function(){MH.createPopup({title:"",content:[{tag:"p",text:"tinh n\u0103ng \u0111ang ph\u00e1t tri\u1ec3n"}]})};
GamePlayer.prototype.showChiExchange=function(chiEarn,isSapHam,isSapLang){this.runChangeGoldEffect(chiEarn,null,null,true," Chi");if(chiEarn===0){this.setStateBinhResult(state_card.NOTHING);return}if(isSapHam)if(chiEarn>=0)this.setStateBinhResult(state_binh.THANG_SAP_HAM);else{if(chiEarn<0)this.setStateBinhResult(state_binh.THUA_SAP_HAM)}else if(isSapLang)if(chiEarn>=0)this.setStateBinhResult(state_binh.THANG_SAP_LANG);else if(chiEarn<0)this.setStateBinhResult(state_binh.THUA_SAP_LANG)};
GamePlayer.prototype.showAllChi=function(chiEarn,moneyEarn,totalMoney,ignoreShowAll){cc.log("showAllChi "+chiEarn);var pos=cc.p(this.avt.x,this.avt.y);if(this.sitId==0)if(this.isMe)pos=cc.p(pos.x,this.avt.y-120);else pos=cc.p(pos.x,this.avt.y-120);else if(this.sitId==1)pos=cc.p(pos.x-200,this.avt.y);else if(this.sitId==2)pos=cc.p(pos.x,80);else if(this.sitId==3)pos=cc.p(pos.x+200,this.avt.y);this.runChangeGoldEffect(chiEarn,null,pos,true," Chi");if(!ignoreShowAll&&this.cardList)this.cardList.revealAll(true)};
GamePlayer.prototype.showResultForChi=function(chiId,delayTime,chiEarn){if(!chiEarn)chiEarn=0;this.runChangeGoldEffect(chiEarn,null,null,true," Chi")};GamePlayer.prototype.reduceMoney=function(gold){var gold=this.gold+gold;this.setTotalGoldWithEffect(gold)};
GamePlayer.prototype.setTotalGoldWithEffect=function(gold){if(this.gold==gold)return;var oldGold=this.gold;this.gold=gold;if(this.timerGoldEffect){this.timerGoldEffect.stop();this.timerGoldEffect.remove();this.timerGoldEffect=null}this.timerGoldEffect=new hiepnh.ActionNumber(1,this.gold,oldGold,this.goldLabel)};
GamePlayer.prototype.runChangeGoldEffect=function(gold,fontList,_startPos,igNoreAnim,suffix,anchor){var goldNumber=gold;if(typeof gold==="string")goldNumber=parseInt(gold);if(!fontList)fontList=[cc.res.font.font_so_xanh,cc.res.font.font_so_do];var strGold=cc.Global.NumberFormat1(Math.abs(goldNumber));if(Math.abs(goldNumber)>=1E3)strGold=cc.Global.NumberFormat2(Math.abs(goldNumber),2);if(goldNumber>=0)strGold="+"+strGold;else strGold="-"+strGold;if(suffix)strGold+=suffix;this.clearAnimMoney();var labelEffect=
cc.LabelBmtFont(strGold,"48px font_xanh");if(gold>=0);else labelEffect=cc.LabelBmtFont(strGold,"48px font_do");if(anchor)labelEffect.anchor.set(anchor.x,anchor.y);labelEffect.displayGroup=MyPixi.animationLayer;this.labelMoneyEff=labelEffect;var contentSize=this.contentSize;var startPos=_startPos?_startPos:cc.p(this.avt.x+this.avt.width/2,this.avt.y+this.avt.height/2-50);if(this.sitId===1||this.sitId===2&&cc.Global.gameId==Constant.GAME_ID.XOCDIA){labelEffect.align="left";startPos.x=startPos.x+contentSize.width/
2-labelEffect.width}else if(this.sitId===3){labelEffect.align="left";startPos.x=startPos.x-contentSize.width/2+labelEffect.width/2}labelEffect.position.set(startPos.x,startPos.y);this.infoLayer.addChild(labelEffect);if(!igNoreAnim){var effectDuration=4;var moveAction=cc.moveBy(effectDuration,cc.p(0,-80));var finishedAction=new PIXI.action.CallFunc(function(){if(labelEffect.parent)labelEffect.parent.removeChild(labelEffect)});this.labelEffectAnimation=PIXI.actionManager.runAction(labelEffect,cc.sequence(moveAction,
finishedAction))}else{var effectDuration=4;var moveAction=cc.delayTime(effectDuration);var finishedAction=new PIXI.action.CallFunc(function(){if(labelEffect.parent)labelEffect.parent.removeChild(labelEffect)});this.labelEffectAnimation=PIXI.actionManager.runAction(labelEffect,cc.sequence(moveAction,finishedAction))}return labelEffect};
GamePlayer.prototype.showEffectEndGame=function(gold,fontList,_startPos,igNoreAnim){var goldNumber=gold;if(typeof gold==="string")goldNumber=parseInt(gold);if(!fontList)fontList=[cc.res.font.font_so_xanh,cc.res.font.font_so_do];var strGold=cc.Global.NumberFormat1(Math.abs(goldNumber));if(goldNumber>=0)strGold="+"+strGold;else strGold="-"+strGold;this.clearAnimMoney();var labelEffect=cc.LabelTTF(strGold,cc.res.font.Arial,25,null,"#ffde00");if(gold>=0);else labelEffect=cc.LabelTTF(strGold,cc.res.font.Arial,
25,null,"#ff0000");var contentSize=this.contentSize;var startPos=_startPos?_startPos:cc.p(this.avt.x,this.avt.y);labelEffect.position.set(startPos);if(this.sitId===1){labelEffect.anchor.set(1,.5);labelEffect.style.align="right";labelEffect.position.set(startPos.x+contentSize.width/2,startPos.y)}else if(this.sitId===3){labelEffect.anchor.set(0,.5);labelEffect.style.align="left";labelEffect.position.set(startPos.x-contentSize.width/2,startPos.y)}this.infoLayer.addChild(labelEffect);if(!igNoreAnim){var effectDuration=
2;var moveAction=cc.moveBy(effectDuration,cc.p(0,80));var finishedAction=new PIXI.action.CallFunc(function(){if(labelEffect.parent)labelEffect.parent.removeChild(labelEffect)});PIXI.actionManager.runAction(labelEffect,cc.sequence(moveAction,finishedAction))}else{var effectDuration=2;var moveAction=cc.delayTime(effectDuration);var finishedAction=new PIXI.action.CallFunc(function(){if(labelEffect.parent)labelEffect.parent.removeChild(labelEffect)});PIXI.actionManager.runAction(labelEffect,cc.sequence(moveAction,
finishedAction))}};
GamePlayer.prototype.showResultMauBinh=function(totalMoney,moneyChange){this.clearAnimMoney();this.setState(state_binh.NOTHING);this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.winLoseSprite.visible=true;this.glowEff.visible=true;this.glowEff.x=this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}var posX=this.avt.x+this.avt.size.width/2;var posY=this.avt.y+this.avt.size.height/2;if(this.sitId==0)if(this.isMe)this.runChangeGoldEffect(moneyChange,
null,cc.p(posX,posY-120),true);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX,posY-120),true);else if(this.sitId==1)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-200,posY),true);else if(this.sitId==2)this.runChangeGoldEffect(moneyChange,null,cc.p(this.avt.x,this.avt.size.height),true);else if(this.sitId==3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,posY),true);this.runEffectGlow();if(moneyChange>0){this.winLoseSprite.texture=PIXI.Texture.fromFrame("glow2.png");this.winLoseSprite.texture=
PIXI.Texture.fromFrame("thang.png")}else if(moneyChange<0){this.winLoseSprite.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png")}else{this.winLoseSprite.texture=PIXI.Texture.fromFrame("glow2.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("hoa.png")}this.gold=totalMoney;this.setTotalGoldWithEffect(totalMoney)};
GamePlayer.prototype.runEffectGlow=function(){var rotate=cc.rotateBy(4,720);var repeat=cc.repeatForever(rotate);this.glowEffAnimation=PIXI.actionManager.runAction(this.glowEff,repeat)};
GamePlayer.prototype.showResultPhom=function(totalMoney,moneyChange,sitId,point,wHr){if(!wHr)wHr=-1;this.setState(state_player.NOTHING);var posX=this.avt.x;this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.glowEff.visible=true;this.glowEff.x=this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.winLoseSprite.visible=true;if(sitId==0)if(this.isMe){this.runChangeGoldEffect(moneyChange,null,cc.p(600,this.avt.y-80),
true);this.winLoseSprite.x=600+this.winLoseSprite.width/2;this.glowEff.x=600+this.glowEff.width/2}else this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y-50),true);else if(sitId==2)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+80),true);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX+this.avt.size.width/2,this.avt.y-35),true);this.winLoseSprite.texture=PIXI.Texture.fromFrame(finishTypePhom[wHr]+".png");if(wHr>=6&&wHr<=11||wHr===13)this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");
else this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");if(point>0&&this.resultPoint){point=point+" \u0110i\u1ec3m";if(sitId!=2)this.resultPoint.y=this.contentSize.height+42;else this.resultPoint.y=this.contentSize.height+25;this.resultPoint.showText(true,point)}if(moneyChange>0){this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");this.runEffectGlow()}else if(moneyChange<0)this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");else{this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");
if(wHr===1)this.winLoseSprite.texture=PIXI.Texture.fromFrame("hoa.png");if(wHr>=5&&wHr!==11&&this.resultPoint)this.resultPoint.showText(false,point)}this.gold=totalMoney;this.setTotalGoldWithEffect(totalMoney)};GamePlayer.prototype.moveAndShowAllOponentCard=function(){if(this.cardList)this.cardList.moveAndShowAllOponentCard()};
GamePlayer.prototype.showResultLieng=function(totalMoney,moneyChange,pointResult,isUp,isWin){if(!isUp){this.setState(state_player.NOTHING);this.moveAndShowAllOponentCard();if(pointResult>=0){if(pointResult<=9)pointResult=pointResult+" \u0110i\u1ec3m";else if(pointResult===10)pointResult="B\u1ed9 \u0110\u1ed9i";else if(pointResult===11)pointResult="Li\u00eang";else if(pointResult===12)pointResult="S\u00e1p";this.resultPoint.showText(true,pointResult)}}var posX=this.avt.x;var posY=this.avt.y;this.winLoseSprite.x=
this.avt.x+this.avt.size.width/2;this.glowEff.visible=false;this.glowEff.x=this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.winLoseSprite.visible=false;var heighAvatar=this.avt.height;if(moneyChange!==0)if(this.sitId==0||this.sitId==1||this.sitId==8)if(this.isMe)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y-70),true);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y-70),true);else if(this.sitId==
2||this.sitId===3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-200,this.avt.y+heighAvatar/2),true);else if(this.sitId==4||this.sitId===5)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+200),true);else if(this.sitId==6||this.sitId===7)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,this.avt.y+heighAvatar/2),true);if(moneyChange>0){this.glowEff.visible=true;this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thang.png");
this.runEffectGlow();this.winLoseSprite.visible=true}else if(moneyChange<0){if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png");if(isUp)this.winLoseSprite.visible=false;else this.winLoseSprite.visible=true}if(moneyChange>0||!isUp){if(this.state)this.setState(state_player.NOTHING)}else if(isUp)this.setStateLieng(state_lieng.UP_BAI);
this.setTotalGoldWithEffect(totalMoney)};
GamePlayer.prototype.showResultXiTo=function(totalMoney,moneyChange,pointResult,isUp,isWin){if(!isUp){this.setState(state_player.NOTHING);this.cardList.revealAll(true);if(pointResult>=0)this.resultPoint.showText(true,resultXiTo[pointResult])}var posX=this.avt.x;var posY=this.avt.y;this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.glowEff.visible=false;this.glowEff.x=this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=
null}this.winLoseSprite.visible=false;var heighAvatar=this.avt.height;if(moneyChange!==0)if(this.sitId==0)if(this.isMe)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,posY-70),true);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,posY-70),true);else if(this.sitId==1||this.sitId===2)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-200,this.avt.y-75),true);else if(this.sitId==3||this.sitId===4)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,this.avt.y-75),true);if(moneyChange>
0&&isWin){this.glowEff.visible=true;this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thang.png");this.runEffectGlow();this.winLoseSprite.visible=true}else{if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png");if(isUp)this.winLoseSprite.visible=false;else this.winLoseSprite.visible=
true}if(moneyChange>0||!isUp){if(this.state)this.setState(state_player.NOTHING)}else if(isUp)this.setStateLieng(state_lieng.UP_BAI);this.setTotalGoldWithEffect(totalMoney)};
GamePlayer.prototype.showResultPoker=function(totalMoney,moneyChange,pointResult,isUp,isWin,cardEndGame,pokerHand){if(!isUp)if(cardEndGame&&cardEndGame.length>0){this.cardList.revealAll(true);this.cardList.showOrrangeEffect(pokerHand);if(pointResult>=0)this.resultPoint.showText(true,resultPoker[pointResult])}var posX=this.avt.x+this.avt.size.width/2;var posY=this.avt.y+this.avt.size.height/2;this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.glowEff.visible=false;this.glowEff.x=this.winLoseSprite.x;
if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.winLoseSprite.visible=false;var heighAvatar=this.avt.height;var anchor=cc.p(.5,.5);if(moneyChange!==0)if(this.sitId==0)if(this.isMe)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,posY-120),true,false,anchor);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX,posY-120),true,false,anchor);else if(this.sitId==1||this.sitId===8)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,
posY-120),true,false,anchor);else if(this.sitId==2||this.sitId===3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-150,this.avt.y-30),true,false,anchor);else if(this.sitId==4||this.sitId===5)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+120),true,false,anchor);else if(this.sitId==6||this.sitId===7)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+150,this.avt.y-30),true,false,anchor);if(moneyChange>0&&isWin){this.glowEff.visible=true;this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");
this.winLoseSprite.texture=PIXI.Texture.fromFrame("thang.png");this.runEffectGlow();this.winLoseSprite.visible=true}else if(moneyChange>0&&!isWin){if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}}else{if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png");if(isUp||!cardEndGame.length)this.winLoseSprite.visible=
false;else this.winLoseSprite.visible=true}if((!cardEndGame||!cardEndGame.length)&&!isWin)this.setStateLieng(state_lieng.UP_BAI);this.setTotalGoldWithEffect(totalMoney)};
GamePlayer.prototype.showResultXocDia=function(totalMoney,moneyChange,timeDelay){var pos=cc.p(this.avt.x+this.avt.width/2,this.avt.y+this.avt.height/2);this.runChangeGoldEffect(moneyChange,null,cc.p(pos.x,pos.y),true);if(timeDelay===0){if(this.timerGoldEffect){this.timerGoldEffect.stop();this.timerGoldEffect.remove();this.timerGoldEffect=null}this.gold=totalMoney;this.goldLabel.text=cc.Global.NumberFormat1(totalMoney)}else this.setTotalGoldWithEffect(totalMoney)};
GamePlayer.prototype.showResult=function(isWin,totalMoney,moneyChange,sitId,wHr,isCong,samLoseType){if(!wHr)wHr=-1;if(!isCong)isCong=false;if(!samLoseType)samLoseType=-1;cc.log("-----whr"+wHr+"--"+isCong+"--"+samLoseType);if(samLoseType===0&&moneyChange>0)isWin=true;if(moneyChange>0)isWin=true;this.setState(state_player.NOTHING);this.showBaoSam(false);var visibleSize=cc.Global.GameView;var posX=this.avt.x;this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.glowEff.visible=true;this.glowEff.x=
this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.winLoseSprite.visible=true;if(sitId==0)if(this.isMe){this.runChangeGoldEffect(moneyChange,null,cc.p(550,-100),true);this.winLoseSprite.x=550+this.winLoseSprite.width/2;this.glowEff.x=this.winLoseSprite.x}else if(cc.Global.gameId==Constant.GAME_ID.SAM||cc.Global.gameId==Constant.GAME_ID.TLMN)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,-100),true);else this.runChangeGoldEffect(moneyChange,
null,cc.p(posX,this.winLoseSprite.y),true);else if(sitId==1)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-100,this.avt.y),true);else if(sitId==2)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+80),true);else if(sitId==3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,this.avt.y),true);if(cc.Global.gameId==Constant.GAME_ID.SAM)if(sitId==3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+80),true);else if(sitId==4)this.runChangeGoldEffect(moneyChange,null,
cc.p(posX+200,this.avt.y),true);if(isWin){this.runEffectGlow();if(wHr>0)if(cc.Global.gameId==Constant.GAME_ID.SAM)this.winLoseSprite.texture=PIXI.Texture.fromFrame(whiteHandRankSam[wHr]+".png");else this.winLoseSprite.texture=PIXI.Texture.fromFrame(whiteHandRank[wHr]+".png");else if(cc.Global.gameId==Constant.GAME_ID.SAM&&samLoseType>0)this.winLoseSprite.texture=PIXI.Texture.fromFrame(samResult[samLoseType]+".png");else this.winLoseSprite.texture=PIXI.Texture.fromFrame("thang.png")}else if(cc.Global.gameId==
Constant.GAME_ID.SAM&&samLoseType>0)this.winLoseSprite.texture=PIXI.Texture.fromFrame(samResult[samLoseType]+".png");else if(isCong)this.winLoseSprite.texture=PIXI.Texture.fromFrame("cong.png");else this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png");if(moneyChange>0)this.glowEff.texture=PIXI.Texture.fromFrame("glow2.png");else if(moneyChange<0)this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");else{this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=
PIXI.Texture.fromFrame("hoa.png")}this.gold=totalMoney;this.setTotalGoldWithEffect(totalMoney)};GamePlayer.prototype.showRutTienBtn=function(visible){if(!this.isMe){this.btnRutTien.visible=false;return}this.btnRutTien.visible=visible};
GamePlayer.prototype.showDealer=function(visible){cc.log("show dealer");this.dealerSprite.visible=visible;if(this.sitId==2||this.sitId==3)this.dealerSprite.position.set(-35,this.contentSize.height-15);else this.dealerSprite.position.set(this.contentSize.width,this.contentSize.height-15)};GamePlayer.prototype.showChuong=function(visible){this.chuongSprite.visible=visible};GamePlayer.prototype.showDiDem=function(visible,showBet,arrCuoc,betValue){};
GamePlayer.prototype.showGa=function(visible){cc.log("showGa");this.chickenSprite.visible=visible;if(this.sitId>0&&this.sitId<=4){this.chickenSprite.position.set(this.contentSize.width+20,this.contentSize.height);this.chickenSprite.scale.x=-1}else this.chickenSprite.position.set(-35,this.contentSize.height)};GamePlayer.prototype.addMoneyBien=function(bettingDidem){};GamePlayer.prototype.addCuocContainer=function(){};GamePlayer.prototype.addCuocContainerLeft=function(){};
function GamePlayerChan(listener){GamePlayer.call(this);this.listener=listener}GamePlayerChan.prototype=Object.create(GamePlayer.prototype);
GamePlayerChan.prototype.ctor=function(){GamePlayer.prototype.ctor.call(this);this.bg.texture=PIXI.Sprite.fromFrame("button/btn_avatar.png");var padding=10;this.widthBG=this.bg.width;this.heightBG=this.bg.height;this.contentSize=cc.size(this.widthBG,this.heightBG);var avt=UserAvatar.createAvatarGame(cc.size(this.widthBG-2*padding,this.heightBG-2*padding));avt.position.set(padding,padding-2);this.infoLayer.addChild(avt);this.avt=avt;var maskAvatar=new MaskCircleLayer(45);maskAvatar.position.set(140,
160);this.bg.addChild(maskAvatar);this.maskAvatar=maskAvatar;var sizeAvatar=cc.size(100,100);var avt=UserAvatar.createAvatarGame(sizeAvatar);avt.interactive=false;avt.position.set(-50,-50);maskAvatar.addChild(avt);maskAvatar.displayGroup=avt.displayGroup;this.avt=avt;this.avt.setSizeAvatar(sizeAvatar)};
function GamePlayerBaCay(listener){GamePlayer.call(this);this.listener=listener;this.position.x=0;this.position.y=0;this.moneyBien=0;this.bgdidem=[PIXI.Sprite.fromFrame("bg_vang.png").texture,PIXI.Sprite.fromFrame("bg_xanh.png").texture];var anGaSprite=PIXI.Sprite.fromFrame("bacay/anga.png");anGaSprite.displayGroup=MyPixi.animationLayer;anGaSprite.anchor.set(.5);anGaSprite.position.set(this.contentSize.width/2,this.contentSize.height/2+10);this.infoLayer.addChild(anGaSprite);this.anGaSprite=anGaSprite;
this.anGaSprite.visible=false}GamePlayerBaCay.prototype=Object.create(GamePlayer.prototype);GamePlayerBaCay.prototype.addMoneyBien=function(moneyAdd){this.moneyBien+=moneyAdd;var text="Bi\u00ean "+cc.Global.NumberFormat2(this.moneyBien);if(this.sitId===5||this.sitId===6||this.sitId===7)this.lblMoneyBienLeft.text=text;else this.lblMoneyBien.text=text};
GamePlayerBaCay.prototype.showDiDem=function(visible,showBet,arrCuoc,betValue){if(hiepnh.isUndefined(showBet))showBet=false;if(hiepnh.isUndefined(arrCuoc))arrCuoc=null;if(hiepnh.isUndefined(betValue))betValue=0;this.contanerDiDemLeft.visible=false;this.contanerDiDem.visible=false;this.betValue=betValue;this.multBien=1;this.multKeCua=1;if(this.sitId>=1&&this.sitId<=4){this.contanerDiDemLeft.visible=visible;if(betValue>0){var min=betValue,max=betValue*4;this.slideKeCuaLeft.init(min,max,betValue);this.slideBienLeft.init(min,
max,betValue);this.slideKeCuaLeft.setPercentStart();this.slideBienLeft.setPercentStart()}}else{this.contanerDiDem.visible=visible;if(betValue>0){var min=betValue,max=betValue*4;this.slideKeCua.init(min,max,betValue);this.slideBien.init(min,max,betValue);this.slideKeCua.setPercentStart();this.slideBien.setPercentStart()}}if(this.isMe){this.contanerDiDem.texture=this.bgdidem[0];this.showDiDemKeCua(this.rightUI,false);this.showBtnBet(this.btnCuoc,showBet);if(arrCuoc){var thiz=this;for(var i=0;i<4;i++)MyHelper.addLblButton(thiz.btnCuoc[i],
arrCuoc[i],12)}}};
GamePlayerBaCay.prototype.addCuocContainer=function(){var thiz=this;var containerCuoc=PIXI.Sprite.fromFrame("bg_xanh.png");containerCuoc.anchor.set(0,0);containerCuoc.displayGroup=null;containerCuoc.position.set(-5,-10);this.infoLayer.addChild(containerCuoc);this.contanerDiDem=containerCuoc;this.contanerDiDem.visible=false;var sizeCuoc=cc.size(containerCuoc.width,containerCuoc.height);var bg_tiencuoc=PIXI.Sprite.fromFrame("bg_tiencuoc.png");bg_tiencuoc.anchor.set(.5,.5);bg_tiencuoc.displayGroup=null;
bg_tiencuoc.position.set(sizeCuoc.width-bg_tiencuoc.width/2-15,sizeCuoc.height-bg_tiencuoc.height/2-10);containerCuoc.addChild(bg_tiencuoc);var btnKeCua=MyHelper.createButton("btn_kecua.png",true,function(){if(thiz.listener)thiz.listener.onKeCua(thiz.slideKeCua.getMoneyRaise(),thiz.uid)});btnKeCua.displayGroup=null;btnKeCua.anchor.set(.5,.5);btnKeCua.position.set(155,135);this.contanerDiDem.addChild(btnKeCua);this.btnKeCua=btnKeCua;var btnnDanhBien=MyHelper.createButton("btn_danhbien.png",true,function(){if(thiz.listener)thiz.listener.onDiDem(thiz.slideBien.getMoneyRaise(),
thiz.uid)});btnnDanhBien.displayGroup=null;btnnDanhBien.anchor.set(.5,.5);btnnDanhBien.position.set(205,135);this.contanerDiDem.addChild(btnnDanhBien);this.btnnDanhBien=btnnDanhBien;this.slideKeCua=new RaiseMoneyBaCay(this,"bg_kecua.png",cc.p(155,70),"#63CD00");var min=100,max=1E3,betValue=100;this.slideKeCua.showDialog(true,min,max,betValue);containerCuoc.addChild(this.slideKeCua);this.slideBien=new RaiseMoneyBaCay(this,"bg_danhbien.png",cc.p(205,70),"#00B19A");var min=100,max=1E3,betValue=100;this.slideBien.showDialog(true,
min,max,betValue);containerCuoc.addChild(this.slideBien);var lblMoneyBien=cc.LabelTTF("999,999k",cc.res.font.Arial,16,null,"white");lblMoneyBien.anchor.set(.5,.5);lblMoneyBien.position.set(0,0);bg_tiencuoc.addChild(lblMoneyBien);this.lblMoneyBien=lblMoneyBien;this.btnCuoc=[];for(var i=0;i<4;i++)thiz.addBtnCuoc(i);this.showBtnBet(this.btnCuoc,false);this.rightUI=[this.btnnDanhBien,this.btnKeCua,this.slideBien,this.slideKeCua]};
GamePlayerBaCay.prototype.addBtnCuoc=function(i,show){var thiz=this;var strName=["btn_pink.png","btn_cygan.png","btn_blue.png","btn_orange.png"];var btn=MyHelper.createButton(strName[i],true,function(){thiz.listener.onTo(i+1)});btn.displayGroup=null;btn.anchor.set(.5,.5);btn.position.set(180,135-i*35);MyHelper.addLblButton(btn,i.toString(),12);this.contanerDiDem.addChild(btn);this.btnCuoc.push(btn)};GamePlayerBaCay.prototype.showBtnBet=function(btns,show){for(var i=0;i<4;i++)btns[i].visible=show};
GamePlayerBaCay.prototype.showDiDemKeCua=function(btns,show){for(var i=0;i<4;i++)btns[i].visible=show};
GamePlayerBaCay.prototype.addCuocContainerLeft=function(){var thiz=this;var containerCuoc=PIXI.Sprite.fromFrame("bg_xanh.png");containerCuoc.anchor.set(0,0);containerCuoc.displayGroup=null;var dx=containerCuoc.width/2-20;containerCuoc.position.set(-5-dx,-10);this.infoLayer.addChild(containerCuoc);this.contanerDiDemLeft=containerCuoc;this.contanerDiDemLeft.visible=false;var shiftX=dx+16;var sizeCuoc=cc.size(containerCuoc.width,containerCuoc.height);var bg_tiencuoc=PIXI.Sprite.fromFrame("bg_tiencuoc.png");
bg_tiencuoc.anchor.set(.5,.5);bg_tiencuoc.displayGroup=null;bg_tiencuoc.position.set(-shiftX+sizeCuoc.width-bg_tiencuoc.width/2-15,sizeCuoc.height-bg_tiencuoc.height/2-10);containerCuoc.addChild(bg_tiencuoc);var btnKeCua=MyHelper.createButton("btn_kecua.png",true,function(){if(thiz.listener)thiz.listener.onKeCua(thiz.slideKeCuaLeft.getMoneyRaise(),thiz.uid)});btnKeCua.displayGroup=null;btnKeCua.anchor.set(.5,.5);btnKeCua.position.set(-shiftX+155,135);this.contanerDiDemLeft.addChild(btnKeCua);this.btnKeCuaLeft=
btnKeCua;var btnnDanhBien=MyHelper.createButton("btn_danhbien.png",true,function(){if(thiz.listener)thiz.listener.onDiDem(thiz.slideBienLeft.getMoneyRaise(),thiz.uid)});btnnDanhBien.displayGroup=null;btnnDanhBien.anchor.set(.5,.5);btnnDanhBien.position.set(-shiftX+205,135);this.contanerDiDemLeft.addChild(btnnDanhBien);this.btnnDanhBienLeft=btnnDanhBien;this.slideKeCuaLeft=new RaiseMoneyBaCay(this,"bg_kecua.png",cc.p(-shiftX+155,70),"#63CD00");var min=100,max=1E3,betValue=100;this.slideKeCuaLeft.showDialog(true,
min,max,betValue);containerCuoc.addChild(this.slideKeCuaLeft);this.slideBienLeft=new RaiseMoneyBaCay(this,"bg_danhbien.png",cc.p(-shiftX+205,70),"#00B19A");var min=100,max=1E3,betValue=100;this.slideBienLeft.showDialog(true,min,max,betValue);containerCuoc.addChild(this.slideBienLeft);var lblMoneyBien=cc.LabelTTF("999,999k",cc.res.font.Arial,16,null,"white");lblMoneyBien.anchor.set(.5,.5);lblMoneyBien.position.set(0,0);bg_tiencuoc.addChild(lblMoneyBien);this.lblMoneyBienLeft=lblMoneyBien;this.btnCuocLeft=
[];var strName=["btn_pink.png","btn_cygan.png","btn_blue.png","btn_orange.png"];for(var i=0;i<4;i++){var btn=MyHelper.createButton(strName[i],true,function(){});btn.displayGroup=null;btn.anchor.set(.5,.5);btn.position.set(-shiftX+180,135-i*35);MyHelper.addLblButton(btn,i.toString(),12);this.contanerDiDemLeft.addChild(btn);this.btnCuocLeft.push(btn)}this.showBtnBet(this.btnCuocLeft,false);this.leftUI=[this.btnnDanhBienLeft,this.btnKeCuaLeft,this.slideBienLeft,this.slideKeCuaLeft]};
GamePlayerBaCay.prototype.resetEndGame=function(){this.moneyBien=0;this.lblMoneyBienLeft.text="";this.lblMoneyBien.text="";if(this.anGaSprite)this.anGaSprite.visible=false;this.chickenSprite.visible=false;GamePlayer.prototype.resetEndGame.call(this)};
GamePlayerBaCay.prototype.showResultBaCay=function(totalMoney,moneyChange,pointResult,cs,isAnGa){if(isAnGa)this.anGaSprite.visible=isAnGa;this.cardList.revealAll(true);if(pointResult>=0){if(pointResult<=10)pointResult=pointResult+" \u0110i\u1ec3m";else if(pointResult===11)pointResult="S\u00e1p";else if(pointResult===12)pointResult="V\u00e2y";this.resultPoint.showText(true,pointResult.toString())}var posX=this.avt.x;var posY=this.avt.y;this.winLoseSprite.x=this.avt.x+this.avt.size.width/2;this.glowEff.visible=
false;this.glowEff.x=this.winLoseSprite.x;if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.winLoseSprite.visible=false;var heighAvatar=this.avt.height;if(moneyChange!==0)if(this.sitId==0||this.sitId==1||this.sitId==8)if(this.isMe)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,posY-125),true);else this.runChangeGoldEffect(moneyChange,null,cc.p(posX,posY-125),true);else if(this.sitId==2)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-
200,this.avt.y-70),true);else if(this.sitId===3)this.runChangeGoldEffect(moneyChange,null,cc.p(posX-200,this.avt.y-10),true);else if(this.sitId==4||this.sitId===5)this.runChangeGoldEffect(moneyChange,null,cc.p(posX,this.avt.y+180),true);else if(this.sitId==6)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,this.avt.y-10),true);else if(this.sitId===7)this.runChangeGoldEffect(moneyChange,null,cc.p(posX+200,this.avt.y-70),true);if(moneyChange>0){this.glowEff.visible=true;this.glowEff.texture=
PIXI.Texture.fromFrame("glow2.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thang.png");this.runEffectGlow();if(isAnGa)this.winLoseSprite.visible=false;else this.winLoseSprite.visible=true}else{if(this.glowEffAnimation){PIXI.actionManager.cancelAction(this.glowEffAnimation);this.glowEffAnimation=null}this.glowEff.texture=PIXI.Texture.fromFrame("glow1.png");this.winLoseSprite.texture=PIXI.Texture.fromFrame("thua.png");if(isAnGa)this.winLoseSprite.visible=false;else this.winLoseSprite.visible=
true}this.setTotalGoldWithEffect(totalMoney)};function MauBinhCard(rank,suit,listener){Card.call(this,rank,suit,listener);this.canMove=true}MauBinhCard.prototype=Object.create(Card.prototype);MauBinhCard.prototype.setSelected=function(select){};MauBinhCard.prototype.isSelected=function(){};MauBinhCard.prototype.updateCard=function(rank,suit){this.point=rank;this.suit=suit;this.texture=PIXI.Texture.fromFrame(rank+s_card_suit[suit]+".png")};
MauBinhCard.prototype.onButtonUp=function(event){this.isTouched=false;if(this.isMoved&&this.data){this.parent.performSwapCardInPoint(this,this.data.global);this.moveToOriginPosition();if(this.oldGroup)this.displayGroup=this.oldGroup;this.data=null}else;};
MauBinhCard.prototype.onButtonMove=function(event){var thiz=this;if(!thiz.isTouched)return;if(!thiz.isAcpetTouch)return;if(!thiz.canMove)return;var p=this.data.getLocalPosition(this.parent);p=cc.p(p.x,p.y);if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,p)<5)return;else{if(thiz.oldGroup&&thiz.oldGroup!=MyPixi.cardDragLayer)thiz.displayGroup=MyPixi.cardDragLayer;this.isMoved=true}thiz.x+=p.x-thiz.preTouchPoint.x;thiz.y+=p.y-thiz.preTouchPoint.y;this.preTouchPoint=cc.p(p.x,p.y)};
MauBinhCard.prototype.moveToOriginPosition=function(isUp){if(!this.isTouched){this._selected=false;this.stopAllActions();var thiz=this;var beforeMove=cc.callFunc(function(){thiz.reveal(!this.originShowBack);thiz.visible=thiz.originVisible;thiz.showEffectCard(thiz.originState)});var afterMove=cc.callFunc(function(){});this.visible=thiz.originVisible;this.reveal(!this.originShowBack);var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED;var move=cc.moveTo(animTime,cc.p(this.origin.x,
this.origin.y));var scale=cc.scaleTo(animTime,this.originScale);var action=cc.sequence(beforeMove,cc.spawn(move,scale),afterMove);this.runAction(this,action)}};function MauBinhCardList(pos,displayResultRight){PIXI.Container.call(this);this.setContentSize(cc.size(110*5,149*3));this.cardList=[];this.position.set(pos.x-this.widthContainer/2,pos.y-this.heightContainer/2);this.arrangeEnable=false;this.displayResultRight=displayResultRight;this.resultLabels=[]}MauBinhCardList.prototype=Object.create(PIXI.Container.prototype);
MauBinhCardList.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("MauBinhCardList showBlurBg")};MauBinhCardList.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};MauBinhCardList.prototype.reorderAllChild=function(){cc.log("MauBinhCardList reoder - ko dung nua vi pixiJS use layer for sort card zorder")};
MauBinhCardList.prototype.addCard=function(card){if(!this.deckPoint){this.deckPoint=cc.convertToNodeSpace(this,cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));cc.log("this.deckPoint "+this.deckPoint.x+" \x3d\x3e "+this.deckPoint.y)}card.position.set(this.deckPoint.x-card.width/2,this.deckPoint.y-card.height/2);this.addChild(card)};
MauBinhCardList.prototype.arrangeCard=function(){var rows=[];var cards=this.cardList;if(cards&&cards.length==13)for(var i=0;i<3;i++){rows.push(cards.slice(i*5,i*5+5));this.sortChi(rows[i])}};
MauBinhCardList.prototype.dealCards=function(cards,isMe,animation){this.removeAll();this.isMe=isMe;if(isMe){this.scale.set(MB_SCALE_ME,MB_SCALE_ME);this.arrangeEnable=true}var rows=[];if(cards&&cards.length==13)for(var i=0;i<3;i++)rows.push(cards.slice(i*5,i*5+5));var index=0;var padding=isMe?5:50;var paddingY=isMe?5:80;var dx=110-padding;var dy=149-paddingY;if(!isMe&&this.isSlotMe)dy+=50;var maxOrder=cards.length;var thiz=this;for(var i=0;i<rows.length;i++){var order=(rows.length-1-i)*5;var basex=
0;var basey=2*dy-dy*i;if(!isMe&&i==rows.length-1)basex+=2*dx;for(var j=0;j<rows[i].length;j++){var cardObj=new MauBinhCard(rows[i][j].point,rows[i][j].suit);cardObj.anchor.set(.5,.5);cardObj.cardIndex=index;thiz.animChia(cardObj,animation,basex+j*dx,basey,index,isMe);index++;order++}}if(isMe)this.refreshChiType()};
MauBinhCardList.prototype.animChia=function(cardObj,animation,x,y,index,isMe){cardObj.origin=cc.p(x,y);cardObj.canTouch=isMe;cardObj.originShowBack=false;if(!isMe){cardObj.originShowBack=true;cardObj.reveal(!cardObj.originShowBack)}this.cardList.push(cardObj);this.addCard(cardObj);if(animation){cardObj.visible=false;var delayAction=cc.delayTime(.02*index);var beforeAction=cc.callFunc(function(){cardObj.visible=true});var moveAction=cc.moveTo(.3,cardObj.origin);var soundAction=cc.callFunc(function(){});
cardObj.runAction(cardObj,cc.sequence(delayAction,soundAction,beforeAction,moveAction))}else cardObj.position.set(cardObj.origin.x,cardObj.origin.y)};MauBinhCardList.prototype.getChiFreq=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(var i=0;i<cards.length;i++)rankFreq[cards[i].point]=1;rankFreq[14]=rankFreq[1];return rankFreq};
MauBinhCardList.prototype.getChiFreqCount=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(var i=0;i<cards.length;i++)rankFreq[cards[i].point]++;rankFreq[14]=rankFreq[1];return rankFreq};
MauBinhCardList.prototype.getSanhRank=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0];var isSanh=false,isThung=false;var sanhRank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;suitFreq[cards[i].suit]++}isThung=suitFreq.indexOf(cards.length)!=-1;rankFreq[14]=rankFreq[1];if(cards.length==5)for(var i=0;i<=10;i++)if(rankFreq[i]&&rankFreq[i+1]&&rankFreq[i+2]&&rankFreq[i+3]&&rankFreq[i+4]){sanhRank=i;isSanh=true;break}if(sanhRank==1&&isThung)sanhRank=9.5;
return sanhRank};
MauBinhCardList.prototype.getChiType=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0,0];var isSanh=false,isThung=false;var sanhRank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;suitFreq[cards[i].suit]++}isThung=suitFreq.indexOf(cards.length)!=-1;if(cards.length===3)isThung=false;rankFreq[14]=rankFreq[1];if(cards.length==5)for(var i=0;i<=10;i++)if(rankFreq[i]&&rankFreq[i+1]&&rankFreq[i+2]&&rankFreq[i+3]&&rankFreq[i+4]){sanhRank=i;isSanh=true;break}rankFreq.splice(14,
1);if(isSanh&&isThung&&sanhRank==10&&cards.length==5)return 10;if(isSanh&&isThung&&cards.length==5)return 9;if(rankFreq.indexOf(4)!=-1)return 8;if(rankFreq.indexOf(3)!=-1&&rankFreq.indexOf(2)!=-1)return 7;if(isThung)return 6;if(isSanh)return 5;if(rankFreq.indexOf(3)!=-1)return 4;var index=rankFreq.indexOf(2);if(index!=-1){if(rankFreq.indexOf(2,index+1)!=-1)return 3;return 2}return 1};MauBinhCardList.prototype.onEnter=function(){};
MauBinhCardList.prototype.getCardsId=function(){var _card=[];for(var i=0;i<this.cardList.length;i++)_card.push(this.cardList[i].getCardData().codeCard);return _card};MauBinhCardList.prototype.removeAll=function(){this.removeChildren();this.cardList=[]};
MauBinhCardList.prototype.showResultChi=function(index,rankChi,duration){if(this.resultLabels[index]){this.resultLabels[index].stopAllActions();PIXI.actionManager.cancelAction(this.resultLabels[index].animationAction);if(this.resultLabels[index].parent)this.resultLabels[index].parent.removeChild(this.resultLabels[index]);this.resultLabels[index]=undefined}cc.log("rankChi "+rankChi+" \x3d\x3e "+maubinh_sprite[rankChi]+".png");var resultLabel=PIXI.Sprite.fromFrame(maubinh_sprite[rankChi]+".png");resultLabel.anchor.set(.5,
.5);resultLabel.scale.set(1/this.scale.y,1/this.scale.y);if(this.isMe)resultLabel.position.set(80,180-index*70);else if(this.isSlotMe)resultLabel.position.set(130,60-index*85);else resultLabel.position.set(130,20-index*85);resultLabel.displayGroup=MyPixi.animationLayer;this.addChild(resultLabel);if(duration){var delayAction=cc.delayTime(duration);var removeAction=cc.callFunc(function(){if(resultLabel&&resultLabel.parent)resultLabel.parent.removeChild(resultLabel)});resultLabel.animationAction=PIXI.actionManager.runAction(resultLabel,
cc.sequence(delayAction,removeAction))}else this.resultLabels[index]=resultLabel};MauBinhCardList.prototype.showThangTrang=function(winType,duration){var thangTrangLabel=cc.LabelBmtFont(maubinh_wintypes[winType],"48px font_xanh");this.addChild(thangTrangLabel);if(duration){var delayAction=cc.delayTime(duration);var removeAction=cc.callFunc(function(){thangTrangLabel.parent.removeChild(thangTrangLabel)})}};
MauBinhCardList.prototype.sortChi=function(cardChiList){var rankChi=this.getChiType(cardChiList);var rankFreq=this.getChiFreqCount(cardChiList);var sanhRank=this.getSanhRank(cardChiList);cc.log(rankChi+" sanhRank "+sanhRank);if(rankChi==10||rankChi==9||rankChi==5){if(rankChi==10)rankFreq[1]=0;if(rankChi==9)rankFreq.splice(14,1);if(rankChi==5)if(sanhRank==10)rankFreq[1]=0;else if(sanhRank===9.5)rankFreq.splice(14,1);else rankFreq.splice(14,1);var _start=0;if(rankChi==10||rankChi==9)this.sortAsc(rankFreq,
cardChiList,0,_start);else this.sortAsc(rankFreq,cardChiList,0,_start)}else if(rankChi==8){rankFreq[1]=0;var _start=0;var index=rankFreq.indexOf(4);var point=index==14?1:index;var cards=this.getCardByPointMb(point,cardChiList);for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);_start++}this.sortDescending(rankFreq,cardChiList,4,_start)}else if(rankChi==7){rankFreq[1]=0;var _start=0;var index=rankFreq.indexOf(3);var point=index==14?1:index;var cards=this.getCardByPointMb(point,
cardChiList);for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);_start++}index=rankFreq.indexOf(2);point=index==14?1:index;cards=this.getCardByPointMb(point,cardChiList);for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);_start++}}if(rankChi==6){rankFreq[1]=0;var _start=0;this.sortDescending(rankFreq,cardChiList,0,_start)}else if(rankChi==4){rankFreq[1]=0;var _start=0;var index=rankFreq.indexOf(3);var point=index==14?
1:index;var cards=this.getCardByPointMb(point,cardChiList);for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);_start++}this.sortDescending(rankFreq,cardChiList,3,_start)}else if(rankChi==3){rankFreq[1]=0;var _start=0;for(var i=rankFreq.length;i>=0;i--)if(rankFreq[i]==2){var point=i==14?1:i;var cards=this.getCardByPointMb(point,cardChiList);if(!cards||!cards.length)continue;for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);
_start++}}this.sortDescending(rankFreq,cardChiList,2,_start)}else if(rankChi==2){rankFreq[1]=0;cc.log("rankFreq "+rankFreq.toString());var _start=0;var index=rankFreq.indexOf(2);var point=index==14?1:index;var cards=this.getCardByPointMb(point,cardChiList);for(var j=0;j<cards.length;j++){this.swapCardSort(cardChiList[_start],cards[j],cardChiList);_start++}this.sortDescending(rankFreq,cardChiList,2,_start)}else if(rankChi==1){rankFreq[1]=0;this.sortDescending(rankFreq,cardChiList,0,0)}};
MauBinhCardList.prototype.sortAsc=function(rankFreq,cardChiList,ignorePoint,start){cc.log("------ rankFreq  "+rankFreq);var _start=start;for(var i=0;i<rankFreq.length;i++)if(rankFreq[i]>0&&rankFreq[i]!=ignorePoint){var point=i==14?1:i;var cards=this.getCardByPointMb(point,cardChiList);if(!cards||!cards.length)continue;for(var j=0;j<cards.length;j++){cc.log(point+" sortAsc swap  _start "+_start);cc.log(point+" sortAsc swap "+cardChiList[_start].getCardData().point);this.swapCardSort(cardChiList[_start],
cards[j],cardChiList);_start++}}};
MauBinhCardList.prototype.sortDescending=function(rankFreq,cardChiList,ignorePoint,start){cc.log("rankFreq "+rankFreq.toString());var _start=start;for(var i=rankFreq.length;i>=0;i--)if(rankFreq[i]>0&&rankFreq[i]!=ignorePoint){var point=i==14?1:i;var cards=this.getCardByPointMb(point,cardChiList);if(!cards||!cards.length)continue;cc.log("rankFreq "+rankFreq.toString());for(var j=0;j<cards.length;j++){cc.log(_start+" aaa swap ");cc.log(point+" aaa swap "+cardChiList[_start].getCardData().point);this.swapCardSort(cardChiList[_start],
cards[j],cardChiList);_start++}}};MauBinhCardList.prototype.getCardByPointMb=function(point,listCards){var _card=[];for(var i=0;i<listCards.length;i++){var card=listCards[i];if(card.point==point)_card.push(card)}return _card};MauBinhCardList.prototype.swapCardSort=function(card1,card2,cardList){var point1=card1.point;var suit1=card1.suit;card1.updateCard(card2.point,card2.suit);card2.updateCard(point1,suit1)};
MauBinhCardList.prototype.swapCard=function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;var _originOrder=card1.originOrder;cc.log("_originOrder1 "+_originOrder);cc.log("_originOrder2 "+card2.originOrder);card1.origin=card2.origin;card1.cardIndex=card2.cardIndex;card1.originOrder=card2.originOrder;card2.origin=_origin;card2.cardIndex=_cardIndex;card2.originOrder=_originOrder;card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2};
MauBinhCardList.prototype.performSwapCardInPoint=function(card,touchPoint){for(var i=0;i<this.cardList.length;i++){var destCard=this.cardList[i];cc.log(cc.convertToNodeSpace(destCard,touchPoint));cc.log(destCard.touchRect);cc.log("performSwapCardInPoint ");if(cc.rectContainsPoint(destCard.touchRect,cc.convertToNodeSpace(destCard,touchPoint))){if(destCard===card)continue;this.swapCard(card,destCard);break}}this.refreshChiType()};
MauBinhCardList.prototype.refreshChiType=function(){var str=[];var rankChiArr=[];var subCardsArr=[];for(var i=0;i<3;i++){var subCards=this.cardList.slice(i*5,i*5+5);var rankChi=this.getChiType(subCards);cc.log(i+" refresh chiiiii rankChi "+rankChi);if(i==1&&(rankChi==9||rankChi==8||rankChi==7))str.push(maubinh_chitypes[rankChi]+" chi 2");else if(i==2&&rankChi==4)str.push(maubinh_chitypes[rankChi]+" 3");else str.push(maubinh_chitypes[rankChi]);rankChiArr.push(rankChi);subCardsArr.push(subCards)}var binhlung=
this.checkBinhLung(rankChiArr,subCardsArr);cc.log("binhlung "+binhlung);if(this.onUpdateResultChi)this.onUpdateResultChi(str,binhlung)};MauBinhCardList.prototype.revealAll=function(visible){for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.reveal(visible)}};
MauBinhCardList.prototype.revealCards=function(cardArray){for(var i=0;i<this.cardList.length;i++){var card=cardArray[i];if(!this.cardList[i])continue;this.cardList[i].texture=PIXI.Texture.fromFrame(""+card.point+s_card_suit[card.suit]+".png")}};MauBinhCardList.prototype.showCardAll=function(visible,isMe){for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(isMe){card.visible=visible;card.revealBlur(!visible)}else card.visible=visible}};
MauBinhCardList.prototype.showCardChi=function(visible,isMe){for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];if(isMe)card.visible=visible;else card.visible=visible}};
MauBinhCardList.prototype.revealChi=function(index,isMe,timeRemove){if(isMe)this.showCardChi(false,isMe);else this.showCardAll(false,isMe);var length=5;if(index==2)length=3;for(var i=0;i<length;i++){var c=this.cardList[index*5+i];c.visible=true;if(!isMe){c.reveal(false);c.flipCard()}else{c.reveal(true);c.revealBlur(false)}}var subCards=this.cardList.slice(index*5,index*5+5);var rankChi=this.getChiType(subCards);this.sortChi(subCards);this.showResultChi(index,rankChi,timeRemove)};
MauBinhCardList.prototype.getArrangeEnable=function(){return this.arrangeEnable};MauBinhCardList.prototype.setArrangeEnable=function(enabled,animation){this.arrangeEnable=enabled;for(var i=0;i<this.cardList.length;i++){this.cardList[i].canTouch=enabled;this.cardList[i].canMove=enabled}this.xepxong(enabled?1:.5,animation)};
MauBinhCardList.prototype.xepxong=function(multi,animation){var rows=[];var cards=this.cardList;if(cards&&cards.length==13)for(var i=0;i<3;i++){rows.push(cards.slice(i*5,i*5+5));this.sortChi(rows[i])}var index=0;var padding=5;var dx=(110-padding)*multi;var dy=(149-padding)*multi;for(var i=0;i<rows.length;i++){var basex=0;var basey=2*dy/multi-dy*i;for(var j=0;j<rows[i].length;j++){var cardObj=rows[i][j];cardObj.stopAllActions();cardObj.visible=true;cardObj.originXepXong=cc.p(basex+j*dx,basey);if(animation){var moveAction=
cc.moveTo(.2,cardObj.originXepXong);var soundAction=cc.callFunc(function(){});cardObj.runAction(cardObj,cc.sequence(soundAction,moveAction))}else cardObj.position.set(cardObj.originXepXong.x,cardObj.originXepXong.y);index++}}};MauBinhCardList.prototype.flipAndShowAllCard=function(isMe){if(isMe)return;for(var i=0;i<this.cardList.length;i++){this.cardList[i].reveal(false);this.cardList[i].flipCard()}};
MauBinhCardList.prototype.checkBinhLung=function(rankChiArr,subCardsArr){var binhLung=false;if(rankChiArr[0]<rankChiArr[1]||rankChiArr[1]<rankChiArr[2]){cc.log("checkBinhLung "+true);return true}binhLung=this.isLung2Chi(rankChiArr[0],rankChiArr[1],subCardsArr[0],subCardsArr[1]);cc.log("checkBinhLung 1 "+binhLung);if(!binhLung)binhLung=this.isLung2Chi(rankChiArr[1],rankChiArr[2],subCardsArr[1],subCardsArr[2]);cc.log("checkBinhLung 2 "+binhLung);return binhLung};
MauBinhCardList.prototype.isLung2Chi=function(rank1,rank2,chi1,chi2){cc.log(rank1+" BinhLung rank "+rank2);if(rank1<rank2)return true;if(rank1===rank2){var rankFreq1=this.getChiFreqCount(chi1);var rankFreq2=this.getChiFreqCount(chi2);rankFreq1[1]=0;rankFreq2[1]=0;var length=rankFreq1.length;if(rank1===10)return false;else if(rank1===9){var sanh1=this.getSanhRank(chi1);var sanh2=this.getSanhRank(chi2);if(sanh1<sanh2)return true}else if(rank1===8){if(rankFreq1.indexOf(4)<rankFreq2.indexOf(4))return true}else if(rank1===
7){if(rankFreq1.indexOf(3)<rankFreq2.indexOf(3))return true}else if(rank1===6)for(var i=length;i>=0;i--)if(rankFreq1[i]>rankFreq2[i])return false;else{if(rankFreq1[i]<rankFreq2[i])return true}else if(rank1===5){var sanh1=this.getSanhRank(chi1);var sanh2=this.getSanhRank(chi2);if(sanh1<sanh2)return true}else if(rank1===4){if(rankFreq1.indexOf(3)<rankFreq2.indexOf(3))return true}else if(rank1===3){for(var i=length;i>=0;i--)if(rankFreq1[i]==2)if(rankFreq2[i]!==2)return false;else;else if(rankFreq2[i]==
2)if(rankFreq1[i]!==2)return true;else;for(var i=length;i>=0;i--)if(rankFreq1[i]>rankFreq2[i])return false;else if(rankFreq1[i]<rankFreq2[i])return true}else if(rank1===2){if(rankFreq1.indexOf(2)<rankFreq2.indexOf(2))return true;else if(rankFreq1.indexOf(2)>rankFreq2.indexOf(2))return false;for(var i=length;i>=0;i--)if(rankFreq1[i]>rankFreq2[i])return false;else if(rankFreq1[i]<rankFreq2[i])return true}else if(rank1===1)for(var i=length;i>=0;i--)if(rankFreq1[i]>rankFreq2[i])return false;else if(rankFreq1[i]<
rankFreq2[i]){cc.log(i+" \x3d\x3e "+rankFreq1.toString()+" binhlung ");cc.log(i+" \x3d\x3e "+rankFreq2.toString()+" binhlung ");return true}}return false};
function CountDownNode(size){PIXI.Container.call(this);this.position.x=0;this.position.y=0;if(!size)size=cc.size(550,60);this.size=size;this.numberRemain=0;var originX=size.width/2;var originY=size.height/2;this.originX=originX;this.originY=originY;var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("button/dialog.png"),5,5,5,5);bg.width=size.width;bg.height=size.height;bg.position.set(cc.Global.GameView.width/2-bg.width/2,-bg.height/2+cc.Global.GameView.height/2);this.addChild(bg);this.bg=
bg;this.lblPointResult=cc.LabelTTF("V\u00e1n ch\u01a1i b\u1eaft \u0111\u1ea7u sau           gi\u00e2y",cc.res.font.Arial,32,cc.size(550,60),"white");this.lblPointResult.anchor.set(.5,.5);this.lblPointResult.position.set(size.width/2,bg.height/2+0);bg.addChild(this.lblPointResult);this.numRemain=cc.LabelBmtFont("5","font_do");this.numRemain.position.set(size.width/2+110,size.height/2-45);bg.addChild(this.numRemain)}CountDownNode.prototype=Object.create(PIXI.Container.prototype);
CountDownNode.prototype.hide=function(){this.visible=false};CountDownNode.prototype.showWithTime=function(time){this.visible=true;this.showTimeCountDown(time)};
CountDownNode.prototype.showTimeCountDown=function(timeInSeconds,maxTime){if(!maxTime)maxTime=timeInSeconds;var thiz=this;thiz.timeRemain=timeInSeconds;thiz.numRemain.text=""+Math.floor(this.timeRemain);var timeRemain=timeInSeconds*(timeInSeconds/maxTime);if(this.timerAction){this.timerAction.stop();this.timerAction.remove();this.timerAction=null}this.timerAction=new hiepnh.ActionTimer(timeInSeconds,function(dt){timeRemain-=dt;if(timeRemain<=0)thiz.visible=false;thiz.numRemain.text=""+Math.floor(timeRemain)})};
function KhungChi(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;this.timeRemain=0;var size=cc.Global.GameView;var originX=size.width/2-443;var originY=size.height/2+234;this.originX=originX;this.originY=originY;var bg=PIXI.Sprite.fromImage("res/bg/khung_cacchi.png");bg.anchor.set(.5,.5);bg.position.set(originX,originY);cc.log(bg.x+"----- "+bg.y);this.addChild(bg);this.bg=bg;this.resultLabels=[];for(var i=0;i<3;i++){var resultLabel=cc.LabelTTF("",cc.res.font.Roboto_Condensed,20,null,
"white");resultLabel.style.align="left";resultLabel.anchor.set(0,.5);resultLabel.position.set(-120+10,-70+(3-i)*35);this.bg.addChild(resultLabel);this.resultLabels[i]=resultLabel}this.widthContainer=size.width;this.heightContainer=size.height}KhungChi.prototype=Object.create(PIXI.Container.prototype);
KhungChi.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("MauBinhCardList showBlurBg")};KhungChi.prototype.showResultChi=function(resultArr){for(var i=0;i<3;i++)this.resultLabels[i].text=i+1+". "+resultArr[i]};KhungChi.prototype.reset=function(){for(var i=0;i<3;i++)this.resultLabels[i].text=""};
function BinhlungAnim(){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var size=cc.Global.GameView;var originX=size.width/2+217;var originY=size.height/2+45;this.originX=originX;this.originY=originY;var binhlung=PIXI.Sprite.fromFrame("binhlung.png");binhlung.anchor.set(.5,.5);binhlung.position.set(originX,originY);this.addChild(binhlung);this.binhlung=binhlung;var action=cc.sequence(cc.scaleTo(.1,1.3),cc.scaleTo(.1,1),cc.delayTime(.5),cc.rotateBy(.1,60),cc.rotateBy(.05,-120),cc.rotateBy(.1,
60),cc.delayTime(2));var rp=cc.repeatForever(action);PIXI.actionManager.runAction(this.binhlung,rp);this.show(false)}BinhlungAnim.prototype=Object.create(PIXI.Container.prototype);BinhlungAnim.prototype.show=function(isShow){this.binhlung.visible=isShow};
function ClockBinh(){PIXI.Container.call(this);this.position.set(0,0);this.timeRemain=0;var size=cc.Global.GameView;var originX=size.width/4-5;var originY=size.height/2-150;this.originX=originX;this.originY=originY;var thiz=this;var spineClock=new PIXI.spine.Spine(MyPixi.loaderSpine.resources["res/spine/skeleton.json"].spineData);spineClock.skeleton.setToSetupPose();spineClock.position.set(originX,originY);thiz.addChild(spineClock);thiz.spineClock=spineClock;thiz.remainTime=cc.LabelTTF("5",cc.res.font.Arial,
25,null,"white");thiz.remainTime.anchor.set(.5,.5);thiz.remainTime.position.set(originX,originY-55);thiz.addChild(thiz.remainTime);thiz.showClock(false)}ClockBinh.prototype=Object.create(PIXI.Container.prototype);ClockBinh.prototype.showClock=function(visible){this.spineClock.visible=visible;this.remainTime.visible=visible;if(visible);else{this.spineClock.state.setAnimation(1,"animation",false);if(this.timerAction){this.timerAction.stop();this.timerAction.remove();this.timerAction=null}}};
ClockBinh.prototype.startClockAnim=function(show){if(this.startAnimClock==show)return;this.startAnimClock=show;if(show)this.spineClock.state.setAnimation(1,"animation",true);else this.spineClock.state.setAnimation(1,"animation",false)};
ClockBinh.prototype.showTimeCountDown=function(timeInSeconds,maxTime){if(!maxTime)maxTime=timeInSeconds;var thiz=this;thiz.showClock(true);thiz.timeRemain=timeInSeconds;thiz.remainTime.text=""+Math.floor(this.timeRemain);var oldRemain=timeInSeconds;var startValue=timeInSeconds;if(this.timerAction){this.timerAction.stop();this.timerAction.remove();this.timerAction=null}this.timerAction=new hiepnh.ActionTimer(timeInSeconds,function(dt){thiz.timeRemain-=dt;if(thiz.timeRemain<0){thiz.timeRemain=0;thiz.showClock(false)}thiz.remainTime.text=
""+Math.floor(thiz.timeRemain);if(oldRemain-thiz.timeRemain>=1){oldRemain=thiz.timeRemain;if(thiz.timeRemain>20)cc.playSound("clockTick");else if(thiz.timeRemain>0){thiz.startClockAnim(true);cc.playSound("clockhurry")}}})};function Narrative(size,textContents){PIXI.Container.call(this);this.position.x=0;this.position.y=0;if(!size)size=cc.size(220,53);this.textContents=textContents;var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("button/dialog.png"),5,5,5,5);bg.width=size.width;bg.height=size.height;bg.position.set(cc.Global.GameView.width/2-bg.width/2,-bg.height/2+cc.Global.GameView.height/2);this.addChild(bg);this.bg=bg;this.label=cc.LabelTTF("",cc.res.font.Arial,32,null,"white");this.label.anchor.set(.5,
.5);this.label.position.set(size.width/2,size.height/2);bg.addChild(this.label)}Narrative.prototype=Object.create(PIXI.Container.prototype);Narrative.prototype.hideLine=function(){this.visible=false};Narrative.prototype.showLine=function(lineId){this.visible=true;this.label.text=this.textContents[lineId]};Narrative.prototype.showText=function(text){this.visible=true;this.label.text=text};Narrative.prototype.showTextKeCua=function(text,opacity){if(!opacity)opacity=255};
Narrative.prototype.showTextRich=function(text,opacity){if(!opacity)opacity=255};var TurnButtonUI=function(btnList,btnListAuto){this.btnList=btnList;this.btnListAuto=btnListAuto;this.showAll(false);this.showAllAuto(false);this.isXem=false};TurnButtonUI.prototype.showTo=function(isShow){if(this.btnList&&this.btnList.length){var size=this.btnList.length;var index=3;if(size===3)index=2;this.btnList[index].visible=isShow;this.btnList[index].scale.set(1,1)}};
TurnButtonUI.prototype.showAll=function(isShow){if(this.btnList&&this.btnList.length)this.btnList.forEach(function(btn,i){btn.visible=isShow;btn.scale.set(1,1)})};TurnButtonUI.prototype.showAllAuto=function(isShow){if(this.btnListAuto&&this.btnListAuto.length)this.btnListAuto.forEach(function(btn,i){btn.visible=isShow;btn.scale.set(1,1)})};
TurnButtonUI.prototype.checkAllAuto=function(isCheck){if(this.btnListAuto&&this.btnListAuto.length)this.btnListAuto.forEach(function(btn,i){if(isCheck)btn.select();else btn.unSelect()})};TurnButtonUI.prototype.check=function(isCheck,index){if(this.btnListAuto&&this.btnListAuto.length)if(isCheck)this.btnListAuto[index].select();else this.btnListAuto[index].unSelect()};
TurnButtonUI.prototype.onShowLatBai=function(isShow){if(this.btnList&&this.btnList.length){this.btnList[1].visible=isShow;this.btnList[1].scale.set(1,1)}};TurnButtonUI.prototype.showTextXem=function(isXem){this.isXem=isXem;var size=this.btnList.length;var index=2;if(size===3)index=1;if(isXem)MyHelper.addLblButton(this.btnList[index],"Xem",16);else MyHelper.addLblButton(this.btnList[index],"Theo",16)};TurnButtonUI.prototype.isXemShow=function(){return this.isXem};function ButtonToggle(bgSelected,bgUnSelect){PIXI.Sprite.call(this,PIXI.Texture.fromFrame(bgUnSelect));this.position.x=0;this.position.y=0;this.anchor.set(.5,.5);this.bgSelected=bgSelected;this.bgUnSelect=bgUnSelect;this.onLabel=cc.LabelTTF("1",cc.res.font.Arial,16,null,"white");this.onLabel.anchor.set(.5,.5);this.onLabel.position.set(0,0);this.addChild(this.onLabel);this.onLabel.visible=false;this.setTouchEnabled(true);this.onSelect=null;this.onUnSelect=null;this.selected=false;var thiz=this;var onButtonDown=
function(event){if(thiz.selected)thiz.unSelect();else thiz.select()};var onButtonMove=function(){};var onButtonUp=function(){};var onButtonOver=function(){};var onButtonOut=function(){};this.on("pointerdown",onButtonDown).on("pointerup",onButtonUp).on("pointerupoutside",onButtonUp).on("pointerover",onButtonOver).on("pointerout",onButtonOut).on("pointermove",onButtonMove)}ButtonToggle.prototype=Object.create(PIXI.Sprite.prototype);
ButtonToggle.prototype.setText=function(txt){this.onLabel.visible=true;this.onLabel.text=txt};ButtonToggle.prototype.select=function(){this.selected=true;if(this.onSelect)this.onSelect();this.texture=PIXI.Texture.fromFrame(this.bgSelected)};ButtonToggle.prototype.unSelect=function(){this.selected=false;if(this.onUnSelect)this.onUnSelect();this.texture=PIXI.Texture.fromFrame(this.bgUnSelect)};
ButtonToggle.prototype.setTouchEnabled=function(enable){this.interactive=enable;this.buttonMode=enable;this.displayGroup=MyPixi.gameRootLayer};function BaCayBackCard(listener){Card.call(this,1,1,listener);this.canTouch=true;this.canMove=true;this.diffY=0;this.displayGroup=MyPixi.animationLayer}BaCayBackCard.prototype=Object.create(Card.prototype);
BaCayBackCard.prototype.onButtonDown=function(event){var thiz=this;thiz.oldGroup=thiz.displayGroup;thiz.isAcpetTouch=false;if(thiz.canTouch&&!thiz.isTouched){var p=event.data.getLocalPosition(thiz.parent);this.data=event.data;thiz.isTouched=true;thiz.isMoved=false;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isAcpetTouch=true}};
BaCayBackCard.prototype.onButtonMove=function(event){var thiz=this;if(!thiz.isTouched)return;if(!thiz.isAcpetTouch)return;if(!thiz.canMove)return;var p=this.data.getLocalPosition(this.parent);p=cc.p(p.x,p.y);if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,p)<5)return;else this.isMoved=true;thiz.diffY+=p.y-thiz.preTouchPoint.y;thiz.y+=p.y-thiz.preTouchPoint.y;this.preTouchPoint=cc.p(p.x,p.y);if(thiz.alpha==1&&Math.abs(thiz.diffY)>=thiz.height/2){thiz.interactive=false;thiz.isMoved=false;thiz.runAction(thiz,
cc.fadeOut(.5));thiz.listener.numberCardShow++;if(thiz.listener.numberCardShow===3)thiz.listener.finishShapeCard()}};BaCayBackCard.prototype.onButtonUp=function(){var thiz=this;if(!thiz.isAcpetTouch)return;thiz.isTouched=false;if(thiz.isMoved){if(thiz.alpha==1&&Math.abs(thiz.diffY)<thiz.height/2)thiz.moveToOriginPosition();thiz.diffY=0;if(thiz.oldGroup)thiz.displayGroup=thiz.oldGroup}};
BaCayBackCard.prototype.moveToOriginPosition=function(){if(!this.isTouched){this._selected=false;this.stopAllActions();var thiz=this;var beforeMove=cc.callFunc(function(){});var afterMove=cc.callFunc(function(){});var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED;var move=cc.moveTo(animTime,cc.p(this.origin.x,this.origin.y));var action=cc.sequence(beforeMove,move,afterMove);this.runAction(this,action)}};
function LiengBackCard(listener){Card.call(this,1,1,listener);this.canMove=true;this.diffY=0;this.displayGroup=MyPixi.animationLayer}LiengBackCard.prototype=Object.create(Card.prototype);LiengCardList.IS_BODOI=11;LiengCardList.IS_LIENG=12;LiengCardList.IS_SAP=13;
LiengBackCard.prototype.onButtonDown=function(event){var thiz=this;thiz.oldGroup=thiz.displayGroup;thiz.isAcpetTouch=false;if(thiz.canTouch&&!thiz.isTouched){var p=event.data.getLocalPosition(thiz.parent);this.data=event.data;thiz.isTouched=true;thiz.isMoved=false;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isAcpetTouch=true}};
LiengBackCard.prototype.onButtonMove=function(event){var thiz=this;if(!thiz.isTouched)return;if(!thiz.isAcpetTouch)return;if(!thiz.canMove)return;var p=this.data.getLocalPosition(this.parent);p=cc.p(p.x,p.y);if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,p)<5)return;else{if(thiz.oldGroup&&thiz.oldGroup!=MyPixi.cardDragLayer)thiz.displayGroup=MyPixi.cardDragLayer;this.isMoved=true}thiz.diffY+=p.y-thiz.preTouchPoint.y;thiz.y+=p.y-thiz.preTouchPoint.y;this.preTouchPoint=cc.p(p.x,p.y);if(thiz.alpha==
1&&Math.abs(thiz.diffY)>=thiz.height/2){thiz.interactive=false;thiz.isMoved=false;thiz.runAction(thiz,cc.fadeOut(.5));thiz.listener.numberCardShow++;if(thiz.listener.numberCardShow===3)thiz.listener.finishShapeCard()}};LiengBackCard.prototype.onButtonUp=function(){var thiz=this;if(!thiz.isAcpetTouch)return;thiz.isTouched=false;if(thiz.isMoved){if(thiz.alpha==1&&Math.abs(thiz.diffY)<thiz.height/2)thiz.moveToOriginPosition();thiz.diffY=0;if(thiz.oldGroup)thiz.displayGroup=thiz.oldGroup}};
LiengBackCard.prototype.moveToOriginPosition=function(){if(!this.isTouched){this._selected=false;this.stopAllActions();var thiz=this;var beforeMove=cc.callFunc(function(){});var afterMove=cc.callFunc(function(){});var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED;var move=cc.moveTo(animTime,cc.p(this.origin.x,this.origin.y));var action=cc.sequence(beforeMove,move,afterMove);this.runAction(this,action)}};
function LiengCard(rank,suit,listener){Card.call(this,rank,suit,listener);this.canMove=true}LiengCard.prototype=Object.create(Card.prototype);LiengCard.LIENG_SCALE_ME=1;LiengCard.prototype.setSelected=function(select){};LiengCard.prototype.isSelected=function(){};LiengCard.prototype.updateCard=function(rank,suit){this.isCardShow=true;this.point=rank;this.suit=suit;this.texture=PIXI.Texture.fromFrame(rank+s_card_suit[suit]+".png")};
LiengCard.prototype.onButtonUp=function(event){this.isTouched=false;this.alpha=1;if(this.isMoved&&this.data){this.parent.performSwapCardInPoint(this,this.data.global);this.moveToOriginPosition();if(this.oldGroup)this.displayGroup=this.oldGroup;this.data=null}};
LiengCard.prototype.onButtonMove=function(event){var thiz=this;if(!thiz.isTouched)return;if(!thiz.isAcpetTouch)return;if(!thiz.canMove)return;var p=this.data.getLocalPosition(this.parent);p=cc.p(p.x,p.y);if(!this.isMoved)if(cc.pDistance(this.preTouchPoint,p)<5)return;else{if(thiz.oldGroup&&thiz.oldGroup!=MyPixi.cardDragLayer)thiz.displayGroup=MyPixi.cardDragLayer;this.isMoved=true}thiz.x+=p.x-thiz.preTouchPoint.x;thiz.y+=p.y-thiz.preTouchPoint.y;this.preTouchPoint=cc.p(p.x,p.y);this.alpha=.7};
LiengCard.prototype.moveToOriginPosition=function(isUp){if(!this.isTouched){this._selected=false;this.stopAllActions();var thiz=this;var beforeMove=cc.callFunc(function(){thiz.reveal(!this.originShowBack);thiz.visible=thiz.originVisible;thiz.showEffectCard(thiz.originState)});var afterMove=cc.callFunc(function(){});this.visible=thiz.originVisible;this.reveal(!this.originShowBack);var animTime=cc.pDistance(cc.p(this.position.x,this.position.y),this.origin)/SPEED;var move=cc.moveTo(animTime,cc.p(this.origin.x,
this.origin.y));var scale=cc.scaleTo(animTime,this.originScale);var action=cc.sequence(beforeMove,cc.spawn(move,scale),afterMove);this.runAction(this,action)}};
function LiengCardList(pos,size,originScale,isVertical,cardAlign){if(hiepnh.isUndefined(cardAlign))cardAlign=LiengCardList.ALIGN_CENTER;PIXI.Container.call(this);this.setContentSize(size);this.cardList=[];this.position.set(pos.x-this.widthContainer/2,pos.y-this.heightContainer/2);this.arrangeEnable=false;this.cardOrigiScale=originScale?originScale:1;this.oldCardOrigiScale=this.cardOrigiScale;this.isVertical=isVertical?isVertical:false;this.resultLabels=[];this.cardAlign=cardAlign;this.numberCardShow=
0}LiengCardList.prototype=Object.create(PIXI.Container.prototype);LiengCardList.ALIGN_LEFT=1;LiengCardList.ALIGN_RIGHT=-1;LiengCardList.ALIGN_CENTER=0;
LiengCardList.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};LiengCardList.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};LiengCardList.prototype.reorderAllChild=function(){cc.log("LiengCardList reoder - ko dung nua vi pixiJS use layer for sort card zorder")};LiengCardList.prototype.setDeckPoint=function(deckPoint){var gloalPos=this.getGlobalPosition();this.deckPoint=cc.pSub(deckPoint,gloalPos)};
LiengCardList.prototype.addCard=function(card){if(!this.deckPoint)this.deckPoint=cc.convertToNodeSpace(this,cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));card.position.set(this.deckPoint.x-card.width/2,this.deckPoint.y-card.height/2);this.addChild(card)};LiengCardList.prototype.changeCard=function(arr){for(var i=0;i<this.cardList.length;i++)if(arr[i]){var card=Utils.getCardFromServer(arr[i]);this.cardList[i].updateCard(card.point,card.suit);if(!this.isMe)this.cardList[i].reveal(false)}this.caculateResult()};
LiengCardList.prototype.caculateResult=function(){};LiengCardList.prototype.changeCardAndShow=function(arr){var idx=0;for(var i=0;i<this.cardList.length;i++){if(this.cardList[i].isCardShow)continue;if(arr[idx]){var card=Utils.getCardFromServer(arr[idx]);this.cardList[i].updateCard(card.point,card.suit);idx++}}};
LiengCardList.prototype.moveCardShow=function(arr){for(var i=0;i<this.cardList.length;i++){var _card=this.cardList[i];for(var j=0;j<arr.length;j++){var card=Utils.getCardFromServer(arr[j]);if(card.point==_card.point&&card.suit==_card.suit){_card.y=_card.origin.y-Card.SELECT_MOVE_DISTANCE;break}}}};
LiengCardList.prototype.dealCards=function(cards,isMe,animation,originShowBack,originScale,remove){if(originShowBack==undefined)originShowBack=false;if(originScale==undefined)originScale=.5;if(remove==undefined)remove=true;var start=0;if(remove)this.removeAll();else start=this.cardList.length;this.isMe=isMe;if(isMe);else;var index=0;var padding=isMe?5:50;var paddingY=isMe?5:100;var dx=originScale*(110-padding);var dy=originScale*(149-paddingY);var maxOrder=cards.length;for(var i=start;i<start+cards.length;i++){this.moveCard(dx,
dy,isMe,cards,i,index,originShowBack,originScale,animation);index++}if(isMe)for(var i=0;i<this.cardList.length;i++){var cardUp=new LiengBackCard(this);cardUp.reveal(false);cardUp.anchor.set(.5,.5);cardUp.origin=cc.p(0,0);cardUp.scale.set(1,1);cardUp.position.set(0,0);this.cardList[i].addChild(cardUp);this.cardList[i].cardUp=cardUp}};
LiengCardList.prototype.moveCard=function(dx,dy,isMe,cards,i,index,originShowBack,originScale,animation){var basex=0;var basey=0;if(this.sitId===0)cc.log("this.cardAlign "+this.cardAlign);var director=this.cardAlign;var cardObj=new LiengCard(cards[index].point,cards[index].suit);cardObj.anchor.set(.5,.5);basex=cardObj.width*originScale/2;basey=cardObj.height*originScale/2;if(this.isVertical){dx=0;basex=this.widthContainer/2}else{dy=0;basey=this.heightContainer/2;if(this.cardAlign==LiengCardList.ALIGN_RIGHT)basex=
this.widthContainer-basex;if(this.cardAlign==LiengCardList.ALIGN_CENTER&&!this.isMe)basex=this.widthContainer/2-basex}cardObj.cardIndex=index;cardObj.origin=cc.p(basex+this.cardAlign*i*dx,basey+i*dy);if(this.cardAlign==LiengCardList.ALIGN_CENTER)cardObj.origin=cc.p(basex+i*dx,basey+i*dy);cardObj.cardDistance=i;cardObj.canTouch=false;cardObj.originShowBack=originShowBack;cardObj.originScale=originScale;cardObj.displayGroup=MyPixi.cardLayer;if(!isMe){cardObj.originShowBack=true;cardObj.reveal(!cardObj.originShowBack)}else{cardObj.originShowBack=
false;cardObj.reveal(!cardObj.originShowBack)}this.cardList.push(cardObj);this.addCard(cardObj);if(animation){cardObj.visible=false;var delayAction=cc.delayTime(.02*index);var beforeAction=cc.callFunc(function(){cardObj.visible=true});var moveAction=cc.moveTo(.2,cardObj.origin);var scaleAction=cc.scaleTo(.2,cardObj.originScale);var soundAction=cc.callFunc(function(){});cardObj.runAction(cardObj,cc.sequence(delayAction,soundAction,beforeAction,cc.spawn(moveAction,scaleAction)))}else{cardObj.scale.set(cardObj.originScale,
cardObj.originScale);cardObj.position.set(cardObj.origin.x,cardObj.origin.y)}return cardObj};LiengCardList.prototype.setListener=function(listener){this.listener=listener};LiengCardList.prototype.setSitId=function(sitId){this.sitId=sitId};
LiengCardList.prototype.showResult=function(text){var style=new PIXI.TextStyle({fontFamily:"Arial",fontSize:40,align:"center",fontStyle:"italic",fontWeight:"bold",fill:["#ffffff","#00ff99"],stroke:"#4a1850",strokeThickness:5,dropShadow:true,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:true,wordWrapWidth:440});var richText=new PIXI.Text(text,style);richText.x=150;richText.y=100;richText.anchor.set(.5);richText.displayGroup=MyPixi.animationLayer;
this.addChild(richText);var action=cc.sequence(cc.fadeIn(.05),cc.delayTime(2),cc.fadeOut(.5));if(this.rankCardsAction){PIXI.actionManager.cancelAction(this.rankCardsAction);this.rankCardsAction=null}this.rankCardsAction=PIXI.actionManager.runAction(richText,action)};
LiengCardList.prototype.finishShapeCard=function(){if(this.isFinishShapeCard)return;for(var i=0;i<this.cardList.length;i++){this.cardList[i].cardUp.visible=false;this.cardList[i].cardUp.interactive=false}this.isFinishShapeCard=true;var rankCards=this.getRankCard(this.cardList);var kq="";switch(rankCards){case LiengCardList.IS_BODOI:kq="B\u1ed9 \u0111\u1ed9i";break;case LiengCardList.IS_LIENG:kq="Li\u00eang";break;case LiengCardList.IS_SAP:kq="S\u00e1p";break;default:kq=""+rankCards+" \u0110i\u1ec3m";
break}this.showResult(kq);if(this.listener)this.listener.stopTimeRemain();if(this.onShowLatBai)this.onShowLatBai(true)};
LiengCardList.prototype.getRankCard=function(cards,is3cay){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var isLieng=false,isSap=false,isBoDoi=false;var rank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;if(cards[i].point<10)rank+=cards[i].point}rank=rank%10;if(is3cay&&rank==0)rank=10;if(rankFreq.indexOf(3)!=-1){isSap=true;rank=LiengCardList.IS_SAP;return rank}var count=rankFreq[10]+rankFreq[11]+rankFreq[12]+rankFreq[13];if(count===3){isBoDoi=true;rank=LiengCardList.IS_BODOI;return rank}for(var i=
1;i<=7;i++)if(rankFreq[i]&&rankFreq[i+1]&&rankFreq[i+2]){isLieng=true;rank=LiengCardList.IS_LIENG;break}return rank};LiengCardList.prototype.onEnter=function(){this._super();this.deckPoint=Utils.getDeckPointCentre(this)};LiengCardList.prototype.getCardsId=function(){var _card=[];for(var i=0;i<this.cardList.length;i++)_card.push(this.cardList[i].getCardData().codeCard);return _card};
LiengCardList.prototype.removeAll=function(){this.isFinishShapeCard=false;this.numberCardShow=0;this.removeChildren();this.cardList=[]};
LiengCardList.prototype.refreshChiType=function(){return;var str=[];var rankChiArr=[];var subCardsArr=[];for(var i=0;i<3;i++){var subCards=this.cardList.slice(i*5,i*5+5);var rankChi=this.getChiType(subCards);cc.log(i+" refresh chiiiii rankChi "+rankChi);if(i==1&&(rankChi==9||rankChi==8||rankChi==7))str.push(maubinh_chitypes[rankChi]+" chi 2");else if(i==2&&rankChi==4)str.push(maubinh_chitypes[rankChi]+" 3");else str.push(maubinh_chitypes[rankChi]);rankChiArr.push(rankChi);subCardsArr.push(subCards)}var binhlung=
this.checkBinhLung(rankChiArr,subCardsArr);cc.log("binhlung "+binhlung);if(this.onUpdateResultChi)this.onUpdateResultChi(str,binhlung)};LiengCardList.prototype.revealAll=function(visible){for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];card.reveal(visible)}};LiengCardList.prototype.revealCards=function(cardArray){for(var i=0;i<this.cardList.length;i++){var card=cardArray[i];if(!this.cardList[i])continue;this.cardList[i].setSpriteFrame(""+card.point+s_card_suit[card.suit]+".png")}};
LiengCardList.prototype.flipAndShowAllCard=function(){if(this.isMe)return;for(var i=0;i<this.cardList.length;i++){this.cardList[i].reveal(false);this.cardList[i].flipCard()}};LiengCardList.prototype.moveAndShowAllOponentCard=function(){cc.log("pending LiengCardList.prototype.moveAndShowAllOponentCard")};LiengCardList.prototype.getCards=function(){return this.cardList};
LiengCardList.prototype.swapCard=function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;card1.origin=card2.origin;card1.cardIndex=card2.cardIndex;card2.origin=_origin;card2.cardIndex=_cardIndex;card1.moveToOriginPosition();card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2};function XiToCardList(pos,size,originScale,isVertical,cardAlign){LiengCardList.call(this,pos,size,originScale,isVertical,cardAlign)}
XiToCardList.prototype=Object.create(LiengCardList.prototype);
XiToCardList.prototype.dealCards=function(cards,isMe,animation,originShowBack,originScale,remove,isChiaBai){LiengCardList.prototype.dealCards.call(this,cards,isMe,animation,originShowBack,originScale,remove);if(isMe)for(var i=0;i<this.cardList.length;i++){var cardUp=this.cardList[i].cardUp;if(cardUp&&cardUp.parent){cardUp.parent.removeChild(cardUp);this.cardList[i].cardUp=null}if(i===0&&isChiaBai||i===4)this.cardList[i].revealBlur(true)}else for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];
if(i>1&&i<4)card.reveal(true);else if(i>=4)card.reveal(false)}if(isMe){var rankCards=this.getRankCards(this.cardList);var resultLabel=PIXI.Sprite.fromFrame(maubinh_sprite[rankCards]+".png");resultLabel.anchor.set(.5,.5);resultLabel.position.set(170,-70);resultLabel.displayGroup=MyPixi.animationLayer;this.addChild(resultLabel);var cb=cc.removeSelf(resultLabel);var timeChiabai=.2;var action=cc.sequence(cc.delayTime(timeChiabai),cc.fadeIn(.05),cc.delayTime(2),cc.fadeOut(.5),cb);PIXI.actionManager.runAction(resultLabel,
action)}};
XiToCardList.prototype.getRankCards=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0,0];var isSanh=false,isThung=false;var sanhRank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;suitFreq[cards[i].suit]++}if(cards.length>=5)isThung=suitFreq.indexOf(cards.length)!=-1;rankFreq[14]=rankFreq[1];if(cards.length==5)for(var i=0;i<=10;i++)if(rankFreq[i]&&rankFreq[i+1]&&rankFreq[i+2]&&rankFreq[i+3]&&rankFreq[i+4]){sanhRank=i;isSanh=true;break}rankFreq.splice(14,1);
if(isSanh&&isThung&&cards.length==5)return 9;if(rankFreq.indexOf(4)!=-1)return 8;if(rankFreq.indexOf(3)!=-1&&rankFreq.indexOf(2)!=-1)return 7;if(isThung)return 6;if(isSanh)return 5;if(rankFreq.indexOf(3)!=-1)return 4;var index=rankFreq.indexOf(2);if(index!=-1){if(rankFreq.indexOf(2,index+1)!=-1)return 3;return 2}return 1};
XiToCardList.prototype.onAddCardArray=function(slot,cards,cbt,isReveal){if(hiepnh.isUndefined(cbt))cbt=null;if(hiepnh.isUndefined(isReveal))isReveal=true;var index=-1;if(cbt)cards.indexOf(cbt);if(index>0){var b=cards[index];cards[index]=cards[0];cards[0]=b}var _cards=[];for(var k=0;k<cards.length;k++)_cards.push(Utils.getCardFromServer(cards[k]));var animation=false;var isMe=slot.uid==PlayerMe.uid;var showBackCard=true;var originScale=isMe?1:.7;slot.cardList.dealCards(_cards,isMe,animation,showBackCard,
originScale);var cardsObj=slot.cardList.getCards();for(var i=0;i<cardsObj.length;i++){var newCard=cardsObj[i];if(slot.sitId==0){if(isReveal)newCard.reveal(true);else newCard.reveal(false);if(!isMe)if(i===0||i===4)newCard.reveal(false);if(i===0||i===4)newCard.revealBlur(true)}else if(i>0&&i<4)if(isReveal)newCard.reveal(true);else newCard.reveal(false);else newCard.reveal(false)}};
XiToCardList.prototype.changeCardAndShow=function(cardArrInt,isMe){var cardComptHide=this.cardList[0];var cardComptShow=this.cardList[1];var cInt=cardArrInt[0];var cardShowData=Utils.getCardFromServer(cInt);if(isMe)if(cardComptHide.getCardData().id===cardShowData.id){var firstCardData=cardComptHide.getCardData();cardComptHide.updateCard(cardComptShow.getCardData().point,cardComptShow.getCardData().suit);cardComptHide.reveal(true);cardComptHide.revealBlur(true);cardComptShow.updateCard(cardShowData.point,
cardShowData.suit);cardComptShow.reveal(true)}else{cardComptHide.reveal(true);cardComptHide.revealBlur(true)}else{cardComptShow.updateCard(cardShowData.point,cardShowData.suit);cardComptShow.reveal(true)}};
XiToCardList.prototype.showCardEndGame=function(arr,isMe){for(var i=0;i<arr.length;i++)if(i<this.cardList.length){var card=Utils.getCardFromServer(arr[i]);this.cardList[i].updateCard(card.point,card.suit);if(!this.isMe)this.cardList[i].reveal(false)}if(arr.length>this.cardList.length){var cardArray=arr.slice(this.cardList.length);var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var showBackCard=false;var originScale=isMe?1:.7;this.dealCards(cards,isMe,
false,showBackCard,originScale,false)}this.caculateResult()};function PokerCardList(pos,size,originScale,isVertical,cardAlign){XiToCardList.call(this,pos,size,originScale,isVertical,cardAlign)}PokerCardList.prototype=Object.create(XiToCardList.prototype);
PokerCardList.prototype.showOrrangeEffect=function(pokerHandArr){if(!pokerHandArr||!pokerHandArr.length)return;for(var i=0;i<this.cardList.length;i++){var card=this.cardList[i];var codeCard=card.getCardData().codeCard;if(pokerHandArr.indexOf(codeCard)!==-1){card.showEffectCard(state_card.ORANGE_BORDER);card.revealBlur(false)}else{card.showEffectCard(state_card.NOTHING);card.revealBlur(true)}}};
PokerCardList.prototype.onAddCardArray=function(slot,cards,cbt,isReveal){if(hiepnh.isUndefined(cbt))cbt=null;if(hiepnh.isUndefined(isReveal))isReveal=true;var index=-1;if(cbt)cards.indexOf(cbt);if(index>0){var b=cards[index];cards[index]=cards[0];cards[0]=b}var _cards=[];for(var k=0;k<cards.length;k++)_cards.push(Utils.getCardFromServer(cards[k]));var animation=false;var isMe=slot.uid==PlayerMe.uid;var showBackCard=true;var originScale=isMe?1:.7;slot.cardList.dealCards(_cards,isMe,animation,showBackCard,
originScale);var cardsObj=slot.cardList.getCards();for(var i=0;i<cardsObj.length;i++){var newCard=cardsObj[i];if(slot.sitId==0)if(isReveal)newCard.reveal(true);else newCard.reveal(false);else if(isReveal)newCard.reveal(true);else newCard.reveal(false)}};
PokerCardList.prototype.dealCardsOnTable=function(cards,isMe,animation,originShowBack,originScale,remove){if(originShowBack==undefined)originShowBack=false;if(originScale==undefined)originScale=.5;if(remove==undefined)remove=true;var start=0;if(remove)this.removeAll();else start=this.cardList.length;this.isMe=isMe;var index=0;var padding=isMe?5:0;var paddingY=isMe?5:100;var dx=originScale*(110-padding);var dy=originScale*(149-paddingY);var maxOrder=cards.length;for(var i=start;i<start+cards.length;i++){this.moveCard(dx,
dy,isMe,cards,i,index,originShowBack,originScale,animation);index++}for(var i=0;i<this.cardList.length;i++){var c=this.cardList[i];c.reveal(true)}};
PokerCardList.prototype.checkPokerRank=function(cardOntable){var allCards=this.cardList.concat(cardOntable);var rankCards=this.getRankCards(allCards);var resultLabel=PIXI.Sprite.fromFrame(maubinh_sprite[rankCards]+".png");resultLabel.anchor.set(.5,.5);resultLabel.position.set(100,-70);resultLabel.displayGroup=MyPixi.animationLayer;this.addChild(resultLabel);var cb=cc.removeSelf(resultLabel);var timeChiabai=.2;var action=cc.sequence(cc.delayTime(timeChiabai),cc.fadeIn(.05),cc.delayTime(2),cc.fadeOut(.5),
cb);PIXI.actionManager.runAction(resultLabel,action)};
PokerCardList.prototype.getRankCards=function(cards){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0,0];var isSanh=false,isThung=false;var sanhRank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;suitFreq[cards[i].suit]++}if(cards.length>=5)isThung=suitFreq.indexOf(cards.length)!=-1;rankFreq[14]=rankFreq[1];if(cards.length>=5)for(var i=0;i<=10;i++)if(rankFreq[i]&&rankFreq[i+1]&&rankFreq[i+2]&&rankFreq[i+3]&&rankFreq[i+4]){sanhRank=i;isSanh=true;break}rankFreq.splice(14,
1);if(isSanh&&isThung&&cards.length>=5)return 9;if(rankFreq.indexOf(4)!=-1)return 8;if(rankFreq.indexOf(3)!=-1&&rankFreq.indexOf(2)!=-1)return 7;if(isThung)return 6;if(isSanh)return 5;if(rankFreq.indexOf(3)!=-1)return 4;var index=rankFreq.indexOf(2);if(index!=-1){if(rankFreq.indexOf(2,index+1)!=-1)return 3;return 2}return 1};
PokerCardList.prototype.dealCards=function(cards,isMe,animation,originShowBack,originScale,remove,isChiaBai){LiengCardList.prototype.dealCards.call(this,cards,isMe,animation,originShowBack,originScale,remove);if(isMe)for(var i=0;i<this.cardList.length;i++){var cardUp=this.cardList[i].cardUp;if(cardUp&&cardUp.parent){cardUp.parent.removeChild(cardUp);this.cardList[i].cardUp=null}}};
function BaCayCardList(pos,size,originScale,isVertical,cardAlign){PokerCardList.call(this,pos,size,originScale,isVertical,cardAlign)}BaCayCardList.prototype=Object.create(PokerCardList.prototype);BaCayCardList.IS_SAP=11;BaCayCardList.IS_VAY=12;
BaCayCardList.prototype.dealCards=function(cards,isMe,animation,originShowBack,originScale,remove,isChiaBai){if(originShowBack==undefined)originShowBack=false;if(originScale==undefined)originScale=.5;if(remove==undefined)remove=true;var start=0;this.removeAll();this.isMe=isMe;if(isMe);else;var index=0;var padding=isMe?50:50;var paddingY=isMe?100:100;var dx=originScale*(110-padding);var dy=originScale*(149-paddingY);var maxOrder=cards.length;for(var i=start;i<start+cards.length;i++){this.moveCard(dx,
dy,isMe,cards,i,index,originShowBack,originScale,animation);index++}if(isMe&&animation)for(var i=0;i<this.cardList.length;i++){var cardUp=new LiengBackCard(this);cardUp.reveal(false);cardUp.interactive=false;cardUp.anchor.set(.5,.5);cardUp.origin=cc.p(0,0);cardUp.scale.set(1,1);cardUp.position.set(0,0);this.cardList[i].addChild(cardUp);this.cardList[i].cardUp=cardUp}};
BaCayCardList.prototype.getRankCard=function(cards,is3cay){var rankFreq=[0,0,0,0,0,0,0,0,0,0,0,0,0,0];var suitFreq=[0,0,0,0,0];var isLieng=false,isSap=false,isBoDoi=false;var rank=0;for(var i=0;i<cards.length;i++){rankFreq[cards[i].point]++;suitFreq[cards[i].suit]++;if(cards[i].point<10)rank+=cards[i].point}rank=rank%10;if(is3cay&&rank==0)rank=10;if(rankFreq.indexOf(3)!=-1){isSap=true;rank=BaCayCardList.IS_SAP;return rank}if(suitFreq.indexOf(3)!=-1)for(var i=1;i<=7;i++)if(rankFreq[i]&&rankFreq[i+
1]&&rankFreq[i+2]){isLieng=true;rank=BaCayCardList.IS_VAY;break}return rank};BaCayCardList.prototype.showRankCard=function(){for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].cardUp){this.cardList[i].cardUp.visible=false;this.cardList[i].cardUp.interactive=false}var rankCards=this.getRankCard(this.cardList,true);var kq="";switch(rankCards){case BaCayCardList.IS_VAY:kq="V\u00e2y";break;case BaCayCardList.IS_SAP:kq="S\u00e1p";break;default:kq=""+rankCards+" \u0110i\u1ec3m";break}this.showResult(kq)};
BaCayCardList.prototype.showResult=function(text){var style=new PIXI.TextStyle({fontFamily:"Arial",fontSize:40,align:"center",fontStyle:"italic",fontWeight:"bold",fill:["#ffffff","#00ff99"],stroke:"#4a1850",strokeThickness:5,dropShadow:true,dropShadowColor:"#000000",dropShadowBlur:4,dropShadowAngle:Math.PI/6,dropShadowDistance:6,wordWrap:true,wordWrapWidth:440});var richText=new PIXI.Text(text,style);richText.x=75;richText.y=-100;richText.anchor.set(.5);richText.displayGroup=MyPixi.animationLayer;
this.addChild(richText);var action=cc.sequence(cc.fadeIn(.05),cc.delayTime(2.5),cc.fadeOut(.5));if(this.rankCardsAction){PIXI.actionManager.cancelAction(this.rankCardsAction);this.rankCardsAction=null}this.rankCardsAction=PIXI.actionManager.runAction(richText,action)};BaCayCardList.prototype.changeCard=function(arr){for(var i=0;i<this.cardList.length;i++)if(arr[i]){var card=Utils.getCardFromServer(arr[i]);this.cardList[i].updateCard(card.point,card.suit)}};var SOUND_CHAN={"-1":"chichi",0:"nhivanj",1:"nhivan",2:"nhisach",3:"tamvanj",4:"tamvan",5:"tamsach",6:"tuvanj",7:"tuvan",8:"tusach",9:"nguvanj",10:"nguvan",11:"ngusach",12:"lucvanj",13:"lucvan",14:"lucsach",15:"thatvanj",16:"thatvan",17:"thatsach",18:"batvanj",19:"batvan",20:"batsach",21:"cuuvanj",22:"cuuvan",23:"cuusach",100:"anchoso",101:"anluon",102:"caulai",103:"hetbatroi",104:"hetcuuroi",105:"hetlucroi",106:"hetnguroi",107:"hettamroi",108:"hetthatroi",109:"hetturoi",110:"unhanhnao",111:"duoian",
112:"duoidung",113:"duoiluon",114:"dayroi",115:"nhoxacaybat",116:"nhoxacaycuu",117:"duoinhoxacayluc",118:"nhoxacayngu",119:"nhoxacaythat",120:"nhoxacaytunhe",121:"nhoxacaynhi",122:"nhoxacaytam",123:"uluon",124:"uroi",125:"nhairoi",126:"chiuchiu",127:"bottom",128:"botomomleo",129:"phatom",130:"phatom1",131:"angidanhnay",132:"angidanhnaychangmaymau",133:"bomdo",134:"taydo",136:"baovecheocanh",137:"cudida",138:"nhatdinhiu",139:"chayrothoi",140:"chuachiroi",141:"danhcacaluon",145:"danhcailayaimau",146:"danhchingoichochidung",
147:"nguvangoichichi",148:"rarongthoi",149:"cakheo",150:"chonggay",151:"nguchua",152:"nhidao",153:"quocdat",154:"tubung",155:"tuxebo",156:"thatvong"};var XUONG_CHAN=XUONG_CHAN||{};XUONG_CHAN["1"]="xuong";XUONG_CHAN["2"]="thong";XUONG_CHAN["3"]="chi";XUONG_CHAN["4"]="thienu";XUONG_CHAN["5"]="diau";XUONG_CHAN["26"]="tom";XUONG_CHAN["27"]="haitom";XUONG_CHAN["28"]="batom";XUONG_CHAN["29"]="bontom";XUONG_CHAN["30"]="leo";XUONG_CHAN["31"]="haileo";XUONG_CHAN["32"]="baleo";XUONG_CHAN["33"]="bonleo";
XUONG_CHAN["11"]="bachthu";XUONG_CHAN["13"]="bachthuchi";XUONG_CHAN["25"]="chiuu";XUONG_CHAN["17"]="thapthanh";XUONG_CHAN["34"]="cochiu";XUONG_CHAN["35"]="haichiu";XUONG_CHAN["36"]="bachiu";XUONG_CHAN["37"]="bonchiu";XUONG_CHAN["15"]="tamdo";XUONG_CHAN["14"]="bachdinh";XUONG_CHAN["16"]="kinhtuchi";XUONG_CHAN["38"]="cothienkhai";XUONG_CHAN["39"]="haithienkhai";XUONG_CHAN["40"]="bathienkhai";XUONG_CHAN["41"]="bonthienkhai";XUONG_CHAN["42"]="namthienkhai";XUONG_CHAN["9"]="ubon";XUONG_CHAN["43"]="cobon";
XUONG_CHAN["44"]="haibon";XUONG_CHAN["45"]="babon";XUONG_CHAN["46"]="bonbon";XUONG_CHAN["19"]="nhalauxehoihoaroicuaphat";XUONG_CHAN["18"]="hoaroicuaphat";XUONG_CHAN["22"]="canhaydauthuyen";XUONG_CHAN["24"]="thieny";XUONG_CHAN["23"]="chuadonathoa";XUONG_CHAN["20"]="caloisandinh";XUONG_CHAN["21"]="nguongbatca";function ClockKickChan(size){PIXI.Container.call(this);this.position.x=0;this.position.y=0;if(!size)size=cc.Global.designGame;this.size=size;this.numberRemain=0;var originX=size.width/2+150;var originY=size.height/2;this.numRemain=cc.LabelBmtFont("30","font_do");this.numRemain.position.set(originX-this.numRemain.width/2,originY-this.numRemain.height/2);this.addChild(this.numRemain);this.show(false)}ClockKickChan.prototype=Object.create(PIXI.Container.prototype);
ClockKickChan.prototype.show=function(visible){this.visible=visible;if(!visible){if(this.timerAction){this.timerAction.stop();this.timerAction.reset();this.timerAction.remove();this.timerAction=null}this.startCountDown=false}};ClockKickChan.prototype.hide=function(){this.show(false)};ClockKickChan.prototype.showWithTime=function(time){this.visible=true;this.showTimeCountDown(time)};
ClockKickChan.prototype.showTimeCountDown=function(timeInSeconds,maxTime){if(timeInSeconds<=0)return;if(!maxTime)maxTime=timeInSeconds;var thiz=this;this.show(true);thiz.timeRemain=timeInSeconds;thiz.numRemain.text=""+Math.floor(this.timeRemain);var timeRemain=timeInSeconds;if(this.timerAction){this.timerAction.stop();this.timerAction.reset();this.timerAction.remove();this.timerAction=null}this.timerAction=new hiepnh.ActionTimer(timeInSeconds,function(dt){timeRemain-=dt;if(timeRemain<=0)thiz.visible=
false;thiz.numRemain.text=""+Math.floor(timeRemain)})};
function NocChan(bocBaiHandler){PIXI.Container.call(this);this.position.set(cc.winSize.width/2,cc.winSize.height/2-70);var thiz=this;var bg=MyHelper.createButton("game/bg_dianoc.png",true,function(){if(bocBaiHandler)bocBaiHandler()});var bgSize=cc.size(bg.width,bg.height);this.setContentSize(bgSize);bg.position.set(0,0);this.addChild(bg);var noc=PIXI.Sprite.fromFrame("game/bg_card_up.png");noc.anchor.set(.5);noc.position.set(25,-15);noc.rotation=cc.Global.degreeToRadian(-20);bg.addChild(noc);this.noc=
noc;var nocLbl=cc.LabelTTF("23","Arial",20,null,"white");nocLbl.anchor.set(1,.5);nocLbl.position.set(noc.width/2-10,noc.height/2-15);noc.addChild(nocLbl);this.nocLbl=nocLbl;var lastCardDraw=PIXI.Sprite.fromFrame("game/bg_card_up.png");lastCardDraw.anchor.set(.5);lastCardDraw.position.set(-bgSize.width-25,-15);bg.addChild(lastCardDraw);this.lastCardDraw=lastCardDraw;lastCardDraw.visible=false;lastCardDraw.scale.set(.7);this.refreshView()}NocChan.prototype=Object.create(PIXI.Container.prototype);
NocChan.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};NocChan.prototype.getContentSize=function(){return cc.size(this.widthContainer,this.heightContainer)};NocChan.prototype.getPosition=function(){return cc.p(this.x+this.widthContainer/2,this.y+this.heightContainer/2)};NocChan.prototype.refreshView=function(){};
NocChan.prototype.resetNewGame=function(){this.noc.texture=PIXI.Texture.fromFrame("game/bg_card_up.png");this.nocLbl.text="23";this.noc.visible=true;this.lastCardDraw.visible=false};NocChan.prototype.updateTotalNoc=function(remain){this.nocLbl.text=""+remain;if(remain<=0){this.noc.visible=false;this.nocLbl.text=""}else this.noc.visible=true};
NocChan.prototype.addCardRemainEndGme=function(cardID){this.lastCardDraw.visible=true;if(cardID===-1)cardID=24;this.lastCardDraw.texture=PIXI.Texture.fromFrame("card/"+cardID+".png")};var StartGameData=StartGameData||{};StartGameData.canU=false;StartGameData.cardStilt=-1;StartGameData.uidChonCai=-1;StartGameData.turnID=-1;StartGameData.listCards=[];var s_height=cc.winSize.height;var s_chiabai_slot_1=[cc.p(879,s_height-325),cc.p(833,s_height-426),cc.p(788,s_height-523),cc.p(976,s_height-565),cc.p(1016,s_height-470)];var s_chiabai_slot_2=[cc.p(525,s_height-254),cc.p(347,s_height-204),cc.p(298,s_height-298),cc.p(439,s_height-424),cc.p(482,s_height-340)];
var s_chiabai_slot_move_target=[cc.p(640,s_height-232),cc.p(515,s_height-320),cc.p(563,s_height-465),cc.p(716,s_height-465),cc.p(764,s_height-320)];var s_chiabai_delay=.1;var s_chiabai_StiltPos=cc.p(640,360);var s_chiabai_userSlot=[cc.p(640,s_height-232),cc.p(512,s_height-360),cc.p(640,s_height-488),cc.p(768,s_height-360)];var s_chiabai_userSlotCenter=cc.p(640,360);
function ChiaBai(listener){BaseGame.call(this);this.position.x=0;this.position.y=0;MyPixi.chiabai=this.containerRotate;var thiz=this;this._group=[];this._isHost=false;this._groupToStilt=-1;this._groupIdx=-1;this.listener=listener;var containerRotate=new PIXI.Container;this.addChild(containerRotate);this.containerRotate=containerRotate;var containerNotRotate=new PIXI.Container;this.addChild(containerNotRotate);this.containerNotRotate=containerNotRotate;containerRotate.x=cc.winSize.width/2;containerRotate.y=
cc.winSize.height/2;var cardNode=new PIXI.Container;cardNode.position.set(-cc.winSize.width/2,-cc.winSize.height/2);this.containerRotate.addChild(cardNode);this.cardNode=cardNode;this.contentSize=cc.winSize;var stiltTouch=[];for(var i=0;i<s_chiabai_slot_move_target.length;i++)(function(){var sizeTouch=cc.size(100,100);var virtualButton=new VirtualButton(sizeTouch);virtualButton.position.set(s_chiabai_slot_move_target[i].x-sizeTouch.width/2,s_chiabai_slot_move_target[i].y-sizeTouch.height/2);virtualButton.displayGroup=
MyPixi.noticeLayer;MyPixi.popupContainer.addChild(virtualButton);if(TEST_MODE)virtualButton.showBlurBg(true);var idx=i;virtualButton.clickHandler=function(){thiz._groupToStilt=idx;thiz._setStiltTouch(false);if(TEST_MODE)thiz.onChooseStilt();else thiz.listener.sendChoseStitlRequest()};stiltTouch.push(virtualButton)})();this.stiltTouch=stiltTouch;var hostTouch=[];for(var i=0;i<s_chiabai_userSlot.length;i++)(function(){var sizeTouch=cc.size(100,100);var virtualButton=new VirtualButton(sizeTouch);virtualButton.position.set(s_chiabai_userSlot[i].x-
sizeTouch.width/2,s_chiabai_userSlot[i].y-sizeTouch.height/2);virtualButton.displayGroup=MyPixi.noticeLayer;MyPixi.popupContainer.addChild(virtualButton);if(TEST_MODE)virtualButton.showBlurBg(true);var idx=i;virtualButton.clickHandler=function(){thiz._groupIdx=idx;thiz._setHostTouch(false);if(TEST_MODE)thiz.onChooseHost();else thiz.listener.sendChoseHostRequest()};hostTouch.push(virtualButton)})();this.hostTouch=hostTouch;this._setHostTouch(false);this._setStiltTouch(false)}ChiaBai.prototype=Object.create(BaseGame.prototype);
ChiaBai.prototype._chiabai=function(cardRemaning,slotPosition,zindex){var thiz=this;var action=[];for(var i=0;i<cardRemaning;i++)(function(){var idx=(i+3)%5;if(i!=0)action.push(cc.delayTime(s_chiabai_delay));action.push(cc.callFunc(function(){thiz._chiaBaiAction(idx,slotPosition,zindex)}))})();this.runAction(this,new PIXI.action.Sequence(action))};
ChiaBai.prototype._chiaBaiAction=function(idx,slotPosition,zindex){var card=new CardChan(100,null);card.anchor.set(.5);card.canTouch=false;var p=slotPosition[idx];var p2=cc.pAdd(p,cc.p(-50,50));var rotate=60+10-Math.random()*20;card.position.set(p2.x,p2.y);card.runAction(card,cc.moveTo(.1,p));card.scale.set(.6);card.rotation=cc.Global.degreeToRadian(rotate);card.idx=idx;this.cardNode.addChild(card);if(!this._group[idx])this._group[idx]=[];this._group[idx].push(card)};
ChiaBai.prototype._moveAction=function(){for(var i=0;i<s_chiabai_slot_move_target.length;i++){var p=s_chiabai_slot_move_target[i];var cards=this._group[i];for(var j=0;j<cards.length;j++){cards[j].stopAllActions();cards[j].runAction(cards[j],cc.moveTo(.5,p))}}var card=new CardChan(100,null);card.displayGroup=MyPixi.animationLayer;card.anchor.set(.5);card.canTouch=false;card.position.set(s_chiabai_userSlotCenter.x,s_chiabai_userSlotCenter.y);var rotate=60+10-Math.random()*20;card.scale.set(.6);card.rotation=
cc.Global.degreeToRadian(rotate);this.cardNode.addChild(card);this.cardStilt=card;this.cardStilt.visible=false};
ChiaBai.prototype._moveGroupToStilt=function(groupIdx){var thiz=this;cc.log("_moveGroupToStilt "+groupIdx);var cards=this._group[groupIdx];if(!cards||!cards.length){cc.log(this._group.length+"groupIdx undefine "+groupIdx);return}for(var j=0;j<cards.length;j++){this.containerNotRotate.addChild(cards[j]);cards[j].runAction(cards[j],cc.moveTo(.5,s_chiabai_StiltPos))}this._group.splice(groupIdx,1);for(var i=0;i<s_chiabai_userSlot.length;i++){var p=s_chiabai_userSlot[i];var cards=this._group[i];cc.log("_moveGroupToStilt _group "+
i);for(var j=0;j<cards.length;j++){cards[j].stopAllActions();cards[j].runAction(cards[j],cc.moveTo(.5,p))}}if(this._isHost)this.runAction(this,cc.sequence(cc.delayTime(.6),cc.callFunc(function(){thiz._setHostTouch(true);thiz.listener.setStatePlayerChan(StartGameData.uidChonCai,state_player_chan.CHON_CAI);thiz.listener.onUpdateTurnNoc(StartGameData.uidChonCai,thiz.timeChooseHost,thiz.timeChooseHost)})))};
ChiaBai.prototype._moveGroupToHost=function(groupId,hostId){var thiz=this;hostId=this.listener.getSlotByUid(StartGameData.turnID).sitId;if(hostId==1)hostId=3;else if(hostId==3)hostId=1;var p1=s_chiabai_userSlot[groupId];var p2=s_chiabai_userSlot[hostId];var angle=cc.pAngleSigned(cc.pSub(p1,s_chiabai_userSlotCenter),cc.pSub(p2,s_chiabai_userSlotCenter));var cardId=StartGameData.cardStilt;if(cardId===-1)cardId=24;thiz.cardStilt.texture=PIXI.Texture.fromFrame("card/"+cardId+".png");this.cardStilt.visible=
true;thiz.cardStilt.runAction(thiz.cardStilt,cc.sequence(cc.moveTo(.2,p1),cc.delayTime(.1),cc.callFunc(function(){})));thiz.animGroup(thiz.containerRotate,angle);this.runAction(this,cc.sequence(cc.delayTime(1.1),cc.callFunc(function(){thiz._showMyCards();thiz.visible=false})))};ChiaBai.prototype.hide=function(){this._clearAll();this.visible=false};
ChiaBai.prototype.animGroup=function(cards,angle){var thiz=this;cc.log(cards.width+":"+cards.height);cards.pivot.x=0;cards.pivot.y=0;this.runAction(cards,cc.sequence(cc.delayTime(.3),cc.rotateTo(.7,cc.Global.radianToDegree(angle))))};
ChiaBai.prototype.actionMoveRotate=function(timeInSec,s_chiabai_userSlotCenter,angle,card){var _originPosition=cc.p(card.x,card.y);var pivot=s_chiabai_userSlotCenter;var moveRotate=new hiepnh.MoveRotate(timeInSec,s_chiabai_userSlotCenter,angle,card,function(dtElapsedTime){var a=angle*dtElapsedTime/(timeInSec*1E3);var p=cc.pRotateByAngle(_originPosition,pivot,a);cc.log(" test-- "+p.x+":"+p.y);card.position.set(p.x,p.y)})};ChiaBai.prototype._setStiltTouch=function(enable){for(var i=0;i<this.stiltTouch.length;i++)this.stiltTouch[i].setTouchEnabled(enable)};
ChiaBai.prototype._setHostTouch=function(enable){for(var i=0;i<this.hostTouch.length;i++)this.hostTouch[i].setTouchEnabled(enable)};ChiaBai.prototype._clearAll=function(){this.cardStilt=null;this.isChoseStilt=false;this.stopAllActions();this.cardNode.removeChildren();this._setHostTouch(false);this._setStiltTouch(false);this._isHost=false;this._groupToStilt=-1;this._groupIdx=-1;this.containerRotate.rotation=0;this.containerNotRotate.removeChildren()};ChiaBai.prototype._showMyCards=function(){this.listener.showMyCards()};
ChiaBai.prototype.start=function(data){var thiz=this;this._clearAll();this.timeChooseHost=data.timeChooseHost;var timeAminCards=data.timeAminCards/1E3;var totoalCard=25;s_chiabai_delay=(timeAminCards-1)/totoalCard;cc.log("s_chiabai_delay "+s_chiabai_delay);if(StartGameData.uidChonCai===PlayerMe.uid)this._isHost=true;this.visible=true;this._chiabai(totoalCard,s_chiabai_slot_1,0);this.runAction(this,cc.sequence(cc.delayTime(s_chiabai_delay*5),cc.callFunc(function(){thiz._chiabai(totoalCard-5,s_chiabai_slot_2,
1)})));this.runAction(this,cc.sequence(cc.delayTime(s_chiabai_delay*totoalCard+1.2),cc.callFunc(function(){thiz._moveAction()})));var delay=cc.delayTime(timeAminCards);this.runAction(this,cc.sequence(delay,cc.callFunc(function(){if(thiz._isHost)thiz._setStiltTouch(true);thiz.listener.setStatePlayerChan(StartGameData.uidChonCai,state_player_chan.CHON_NOC);thiz.listener.onUpdateTurnNoc(StartGameData.uidChonCai,thiz.timeChooseHost,thiz.timeChooseHost)})))};
ChiaBai.prototype.onChooseStilt=function(){if(!this.cardNode.children||this.cardNode.children.length===0)return;var thiz=this;if(thiz.isChoseStilt)return;thiz.isChoseStilt=true;if(this._groupToStilt==-1)this._groupToStilt=Math.floor(Math.random()*5);var stiltIdx=this._isHost?this._groupToStilt:Math.floor(Math.random()*5);cc.log(" _groupToStilt"+this._groupToStilt);cc.log(" stiltIdx"+stiltIdx);this.runAction(this,cc.callFunc(function(){thiz._moveGroupToStilt(stiltIdx)}))};
ChiaBai.prototype.onChooseHost=function(){if(!this.cardNode.children||this.cardNode.children.length===0)return;var thiz=this;var delay=.1;cc.log("onChooseHost");if(!thiz.isChoseStilt){this.onChooseStilt();delay=.6}if(this._groupIdx==-1)this._groupIdx=Math.floor(Math.random()*4);var groupIdx=this._isHost?this._groupIdx:Math.floor(Math.random()*4);var hostIdx=groupIdx+Math.floor(Math.random()*2)+1;this.runAction(this,cc.sequence(cc.delayTime(delay),cc.callFunc(function(){thiz._moveGroupToHost(groupIdx,
hostIdx%4)})))};cc.Global.sortChan=function(cards){var sortedList=[];var singleIndices=[];var chanList=[];cc.Global.classfifyChanAndSingleIndices(cards,chanList,singleIndices);singleIndices=cc.Global.sortByCa(singleIndices);sortedList=sortedList.concat(chanList);sortedList=sortedList.concat(singleIndices);return sortedList};cc.Global.pushSort=function(list,idCard){if(idCard==-1)list.unshift(idCard);else list.push(idCard)};
cc.Global.classfifyChanAndSingleIndices=function(cards,chanList,singleIndices){var groups=cards.reduce(function(acc,e){if(e===-1)e=24;acc[e]=e in acc?acc[e]+1:1;return acc},{});for(var i=0;i<=24;i++){var a=groups[i];if(a!==undefined){var idCard=i==24?-1:i;if(a===4){cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(chanList,idCard)}else if(a==2){cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(chanList,idCard)}else if(a===
3){cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(chanList,idCard);cc.Global.pushSort(singleIndices,idCard)}else if(a===1)cc.Global.pushSort(singleIndices,idCard);else alert("Global: B\u1ed9 b\u00e0i chia b\u1ecb sai "+cards.toString())}}};
cc.Global.sortByCa=function(cards){var sortedList=[];var caList=[];var badauList=[];var singleIndices=[];var groups=cards.reduce(function(acc,e){if(e===-1)e=24;var point=Math.floor(e/3)+2;acc[point]=point in acc?acc[point]+1:1;return acc},{});for(var i=2;i<=10;i++){var a=groups[i];if(a!==undefined)if(a===1){var arr1=cc.Global.getAllCardByPoint(cards,i);if(i==10){var arr1=cc.Global.getAllCardByPoint(cards,-1);singleIndices=arr1.concat(singleIndices)}else singleIndices=singleIndices.concat(arr1)}else if(a===
2){var arr1=cc.Global.getAllCardByPoint(cards,i);caList=caList.concat(arr1)}else if(a===3){var arr1=cc.Global.getAllCardByPoint(cards,i);badauList=badauList.concat(arr1)}}sortedList=sortedList.concat(caList);sortedList=sortedList.concat(badauList);sortedList=sortedList.concat(singleIndices);return sortedList};var CardChanSelect=CardChanSelect||{};CardChanSelect.UP=cc.p(.5,1.35);CardChanSelect.NORMAL=cc.p(.5,1.2);var CardChanScale=CardChanScale||{};CardChanScale.DEAL_TABLE_ME=1;
CardChanScale.DEAL_TABLE_OTHER=.8;CardChanScale.LAST_CARD=.05;var TIME_ANIMATION=.5;var SHOW_NUMBER=false;
function CardChan(data,listener){this.animation=[];PIXI.Sprite.call(this,PIXI.Texture.fromFrame("card/100.png"));this.displayGroup=MyPixi.cardLayer;this.anchor.set(.5,.5);this.canTouch=true;this.index=-1;this.listener=listener;this.widthContainer=this.width;this.heightContainer=this.height;this.numlbl=cc.LabelTTF("",cc.res.font.Arial,30,null,"yellow");this.numlbl.style.stroke="black";this.numlbl.style.strokeThickness=4;this.numlbl.displayGroup=MyPixi.animationLayer;this.numlbl.anchor.set(.5,0);this.addChild(this.numlbl);
this.numlbl.position.set(0,-this.height);var shadow=PIXI.Sprite.fromFrame("card/shadow.png");shadow.displayGroup=MyPixi.cardDragLayer;shadow.alpha=.4;shadow.anchor.set(.5,.5);this.shadow=shadow;this.shadow.displayGroup=this.cardDragLayer;this.addChild(this.shadow);this.shadow.visible=false;var hightLight=PIXI.Sprite.fromFrame("card/card_effect.png");hightLight.displayGroup=MyPixi.gameContainerLayer;hightLight.anchor.set(.5,.5);this.hightLight=hightLight;this.addChild(this.hightLight);this.hightLight.visible=
false;this.origin=cc.p();this.isTouched=false;this.updateCardChan(data);this.interactive=true;this.buttonMode=true;this.on("mousedown",this.onButtonDown).on("touchstart",this.onButtonDown).on("mouseup",this.onButtonUp).on("mouseupoutside",this.onButtonUp).on("touchend",this.onButtonUp).on("touchendoutside",this.onButtonUp).on("mousemove",this.onButtonMove).on("touchmove",this.onButtonMove)}CardChan.prototype=Object.create(PIXI.Sprite.prototype);
CardChan.prototype.getContentSize=function(){return cc.size(52,188)};CardChan.prototype.onButtonDown=function(event){var thiz=this;thiz.oldGroup=thiz.displayGroup;thiz.isAcpetTouch=false;if(thiz.canTouch&&!thiz.isTouched){var p=event.data.getLocalPosition(thiz.parent);this.data=event.data;thiz.isTouched=true;thiz.isMoved=false;thiz.preTouchPoint=event.data.getLocalPosition(thiz.parent);thiz.isAcpetTouch=true}};
CardChan.prototype.onButtonUp=function(){var thiz=this;if(!thiz.isAcpetTouch)return;thiz.isTouched=false;if(!this.listener)return;cc.log(" this.index "+this.index);if(this.listener.chosenCardId>=0&&this.listener.chosenCardId<this.listener.cardList.length){var anchor=CardChanSelect.NORMAL;this.listener.cardList[this.listener.chosenCardId].anchor.set(anchor.x,anchor.y)}if(this.listener.chosenCardId!=this.index){this.listener.chosenCardId=this.index;var c=this.listener.cardList[this.listener.chosenCardId];
if(c){var anchor=CardChanSelect.UP;c.anchor.set(anchor.x,anchor.y)}}else this.listener.chosenCardId=-1;cc.log(" this.listener.chosenCardId "+this.listener.chosenCardId)};CardChan.prototype.onButtonMove=function(){};CardChan.prototype.setName=function(_name){this.name=_name};CardChan.prototype.getName=function(_name){return this.name};
CardChan.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};CardChan.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};
CardChan.prototype.updateCardChan=function(idCard){this.idCard=idCard;var png="card/"+(idCard==-1?24:idCard)+".png";this.texture=PIXI.Texture.fromFrame(png);this.setName(this.idCard.toString());if(SHOW_NUMBER){var num=idCard==-1?0:Math.floor(idCard/3)+2;this.numlbl.text=""+num;if(this.anchor.y==.5)this.numlbl.position.set(0,-this.height/2);else this.numlbl.position.set(0,-this.height)}};
CardChan.prototype.updateCardNumber=function(idCard){if(SHOW_NUMBER){var num=idCard==-1?0:Math.floor(idCard/3)+2;this.numlbl.text=""+num;if(this.anchor.y==.5)this.numlbl.position.set(0,-this.height/2);else this.numlbl.position.set(0,-this.height)}};CardChan.prototype.showHighLight=function(visible){this.originHighLight=visible;this.hightLight.visible=visible};CardChan.prototype.showBlur=function(isShow){this.shadow.visible=isShow};
CardChan.prototype.moveToOriginPosition=function(){if(!this.isTouched){this.stopAllActions();var thiz=this;var beforeMove=cc.callFunc(function(){thiz.displayGroup=MyPixi.cardDragLayer;thiz.reveal(!this.originShowBack)});var afterMove=cc.callFunc(function(){thiz.displayGroup=MyPixi.cardLayer;thiz.hightLight.visible=thiz.originHighLight});var move=cc.moveTo(.1,cc.p(this.origin.x,this.origin.y));this.runAction(this,cc.sequence(beforeMove,move,afterMove))}};
CardChan.prototype.setSelected=function(selected){if(selected)this.y=this.origin.y-50;else this.y=this.origin.y};CardChan.prototype.isSelected=function(){return cc.pointEqualToPoint(cc.p(this.anchor.x,this.anchor.y),CardChanSelect.UP)};CardChan.prototype.setDealing=function(isDealing){this.isDealing=isDealing};
CardChan.prototype.onTouchBegan=function(touch,event){if(this.canTouch&&!this.isTouched){var p=this.convertToNodeSpace(touch.getLocation());if(cc.rectContainsPoint(this.touchRect,p)){this.isTouched=true;this.isMoved=false;this.preTouchPoint=touch.getLocation();return true}}return false};
CardChan.prototype.onTouchEnded=function(touch,event){this.isTouched=false;if(!this.listener)return;cc.log(" this.index "+this.index);if(this.listener.chosenCardChanId>=0&&this.listener.chosenCardChanId<this.listener.cardList.length){var anchor=CardChanSelect.NORMAL;this.listener.cardList[this.listener.chosenCardChanId].anchor.set(anchor.x,anchor.y)}if(this.listener.chosenCardChanId!=this.index){this.listener.chosenCardChanId=this.index;var c=this.listener.cardList[this.listener.chosenCardChanId];
if(c){var anchor=CardChanSelect.UP;c.anchor.set(anchor.x,anchor.y)}}else this.listener.chosenCardChanId=-1;cc.log(" this.listener.chosenCardChanId "+this.listener.chosenCardChanId)};CardChan.prototype.onTouchMoved=function(touch,event){};function CardChanList(size){PIXI.Container.call(this);this.canTouch=true;this.deckPoint=cc.p(cc.winSize.width/2,cc.winSize.height-115);this.size=size;this.chosenCardChanId=-1;this.cardList=[];this.setContentSize(size)}CardChanList.prototype=Object.create(PIXI.Container.prototype);
CardChanList.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};CardChanList.prototype.getContentSize=function(){return cc.size(this.widthContainer,this.heightContainer)};CardChanList.prototype.resetChoseCard=function(){this.chosenCardChanId=-1};CardChanList.prototype.reIndex=function(){if(this.cardList.length>0)for(var i=0;i<this.cardList.length;i++)this.cardList[i].index=i};CardChanList.prototype.refreshNumber=function(){for(var j=0;j<this.cardList.length;j++)this.cardList[j].updateCardNumber(this.cardList[j].idCard)};
CardChanList.prototype.updateNewListCards=function(cards,animation){this.reOrderWithoutAnimation(animation);this.reIndex();var arrId=[];for(var j=0;j<this.cardList.length;j++){var card=this.cardList[j];arrId.push(card.idCard)}cc.log("old card 1\x3d\x3e "+arrId.toString());var arrNew=cc.Global.sortChan(arrId);cc.log("old card 2\x3d\x3e "+arrNew.toString());for(var i=0;i<arrNew.length;i++)this.cardList[i].updateCardChan(arrNew[i])};
CardChanList.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.size.width,this.size.height);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("cardChanlist showBlurBg")};CardChanList.prototype.reOrder=function(animation){if(this.cardList.length>0){var rot=11;var startRot=-(rot*this.cardList.length/2)+rot/2;for(var i=0;i<this.cardList.length;i++)this.rotate(animation,startRot,i)}};
CardChanList.prototype.rotate=function(animation,startRot,i){var rot=11;if(animation){this.cardList[i].rotation=cc.Global.degreeToRadian(startRot);var rotate=cc.rotateTo(i*.1,startRot+i*rot);this.cardList[i].runAction(this.cardList[i],rotate)}else this.cardList[i].rotation=cc.Global.degreeToRadian(startRot+i*rot)};
CardChanList.prototype.reOrderWithoutAnimation=function(animation){if(this.cardList.length>0){var rot=11;var startRot=-(rot*this.cardList.length/2)+rot/2;for(var i=0;i<this.cardList.length;i++){this.cardList[i].index=i;var endRotate=startRot+i*rot;if(animation){var rotate=cc.rotateTo(.1,endRotate);this.cardList[i].runAction(this.cardList[i],rotate)}else this.cardList[i].rotation=cc.Global.degreeToRadian(endRotate)}}};
CardChanList.prototype.addNewCard=function(cardId){for(var i=0;i<cardId.length;i++){var card=new CardChan(cardId[i],this);this.addCard(card)}this.reOrderWithoutAnimation()};
CardChanList.prototype.addCard=function(card){if(!this.cardSize){this.cardSize=card.getContentSize();if(this.cardSize.height>this.getContentSize().height){var ratio=this.getContentSize().height/this.cardSize.height;this.cardSize.width*=ratio;this.cardSize.height*=ratio}}if(card.getContentSize().height>this.cardSize.height)card.scale.set(this.cardSize.height/card.getContentSize().height);card.cardIndex=this.cardList.length;card.origin=cc.p(0,0);card.canTouch=this.canTouch;this.addChild(card);this.cardList.push(card)};
CardChanList.prototype.setTouchEnable=function(touch){this.canTouch=touch;for(var i=0;i<this.cardList.length;i++)this.cardList[i].canTouch=this.canTouch};
CardChanList.prototype.dealCards=function(cards,animation){this.removeAll();for(var i=0;i<cards.length;i++){var card=new CardChan(cards[i],this);card.position.set(this.deckPoint.x,this.deckPoint.y);this.addCard(card)}var width=this.cardSize.width*this.cardList.length;if(width>this.getContentSize().width)width=this.getContentSize().width;var dx=width/this.cardList.length;var x=this.getContentSize().width/2-width/2+dx/2;var y=this.getContentSize().height/2;for(var i=0;i<this.cardList.length;i++){var card=
this.cardList[i];card.origin=cc.p(x,y);card.cardDistance=dx;if(animation){card.visible=false;var delayAction=cc.delayTime(.02*i);var beforeAction=cc.callFunc(function(){card.visible=true});var moveAction=cc.moveTo(TIME_ANIMATION,cc.p(x,y));card.runAction(card,cc.sequence(delayAction,beforeAction,moveAction))}else card.position.set(x,y);x+=dx}};
CardChanList.prototype.dealCardsChan=function(cards,animation){this.removeAll();for(var i=0;i<cards.length;i++){var card=new CardChan(cards[i],this);card.displayGroup=MyPixi.gameRootLayer;card.scale.set(1.1,1.1);card.index=i;var anchor=CardChanSelect.NORMAL;card.anchor.set(anchor.x,anchor.y);card.position.set(this.deckPoint.x,this.deckPoint.y);this.addCard(card)}this.reOrder(animation)};
CardChanList.prototype.addCardsReconnect=function(cards,animation){this.removeAll();for(var i=0;i<cards.length;i++){var card=new CardChan(cards[i],this);card.displayGroup=MyPixi.gameRootLayer;card.scale.set(1.1);var anchor=CardChanSelect.NORMAL;card.anchor.set(anchor.x,anchor.y);card.position.set(this.deckPoint.x,this.deckPoint.y);this.addCard(card)}this.reOrder(animation);this.reIndex()};
CardChanList.prototype.swapCardLeft=function(index){if(index>0){var cardMove=this.cardList[index];var cardSwap=this.cardList[index-1];this.swapCard(cardMove,cardSwap)}};CardChanList.prototype.swapCardRight=function(index){if(index<this.cardList.length-1){var cardMove=this.cardList[index];var cardSwap=this.cardList[index+1];this.swapCard(cardMove,cardSwap)}};
CardChanList.prototype.swapCard=function(card1,card2){var _origin=card1.origin;var _cardIndex=card1.cardIndex;card1.origin=card2.origin;card1.cardIndex=card2.cardIndex;card2.origin=_origin;card2.cardIndex=_cardIndex;card1.moveToOriginPosition();card2.moveToOriginPosition();this.cardList[card1.cardIndex]=card1;this.cardList[card2.cardIndex]=card2};
CardChanList.prototype.removeCard=function(cards){var arrCardChan=[];for(var i=0;i<cards.length;i++){var cardIdDeal=cards[i];var dealOk=false;cc.log("LENGH  \x3d\x3e "+this.cardList.length);for(var j=this.cardList.length-1;j>=0;j--){var card=this.cardList[j];cc.log(j+" \x3d\x3e "+card.isSelected()+" ID \x3d "+card.idCard);if(card.idCard===cardIdDeal)if(card.isSelected()){card.canTouch=false;arrCardChan.push(card);this.cardList.splice(j,1);dealOk=true;break}}if(!dealOk){if(this.chosenCardChanId>=0){cc.log("wtf---------------- "+
this.chosenCardChanId);var anchor=CardChanSelect.NORMAL;this.cardList[this.chosenCardChanId].anchor.set(anchor.x,anchor.y)}for(var j=this.cardList.length-1;j>=0;j--){var card2=this.cardList[j];if(card2.idCard===cardIdDeal){arrCardChan.push(card2);this.cardList.splice(j,1);break}}}}return arrCardChan};
CardChanList.prototype.getAllCardsWithId=function(cards){var arrCardChan=[];for(var i=0;i<cards.length;i++){var cardIdDeal=cards[i];var dealOk=false;for(var j=this.cardList.length-1;j>=0;j--){var card=this.cardList[j];var idCardHand=card.idCard;if(idCardHand===cardIdDeal){card.canTouch=false;arrCardChan.push(card);this.cardList.splice(j,1)}}}return arrCardChan};
CardChanList.prototype.getCard=function(cards){var arrCardChan=[];for(var i=0;i<cards.length;i++){var cardIdDeal=cards[i];var dealOk=false;for(var j=0;j<this.cardList.length;j++){var card=this.cardList[j];var idCardHand=card.idCard;if(idCardHand===cardIdDeal)if(card.isSelected()){card.canTouch=false;arrCardChan.push(card);this.cardList.splice(j,1);dealOk=true;break}}if(!dealOk){if(this.chosenCardChanId>=0){var anchor=CardChanSelect.NORMAL;this.cardList[this.chosenCardChanId].anchor.set(anchor.x,anchor.y)}for(var j=
this.cardList.length-1;j>=0;j--){var card2=this.cardList[j];if(card.idCard===cardIdDeal){card2.retain();arrCardChan.push(card2);this.cardList.splice(j,1);break}}}}return arrCardChan};CardChanList.prototype.removeAll=function(){var childs=this.children;if(childs&&childs.length)for(var i=childs.length-1;i>=0;i--){var seq=cc.sequence(cc.fadeOut(.2),cc.removeSelf(childs[i]));childs[i].runAction(childs[i],seq)}this.cardList=[]};CardChanList.prototype.getCardAtIndex=function(index){return this.cardList[index]};
CardChanList.prototype.getCardByRank=function(idCard,idGroup){};CardChanList.prototype.getCardSelected=function(){var cardSelected=null;for(var i=0;i<this.cardList.length;i++)if(this.cardList[i].isSelected()){cardSelected=this.cardList[i];break}if(TEST_MODE&&cardSelected==null)cardSelected=this.cardList[0];return cardSelected};CardChanList.prototype.getCards=function(){return this.cardList};
function CardChanOnTable(){BaseGame.call(this);var avatarSize=cc.size(115,163);this.cardEarnSize=[];this.cardEarnListBot=[];this.cardEarnListTop=[];this.cardSize=[];this.cardList=[];for(var i=0;i<4;i++){this.cardList[i]=[];this.cardSize[i]=cc.size(50,188);this.cardEarnSize[i]=cc.size(50,228);this.cardEarnListBot[i]=[];this.cardEarnListTop[i]=[]}var design=cc.Global.designGame;var height=avatarSize.height;var startX=[930,1100,530,170];this.cardScale=.8;this.cardPosition=[];this.cardPosition.push(cc.p(startX[0],
cc.winSize.height-150));this.cardPosition.push(cc.p(startX[1],cc.winSize.height/2+10));this.cardPosition.push(cc.p(startX[2],90));this.cardPosition.push(cc.p(startX[3],cc.winSize.height/2+10));var marginCentre=200;var marginLeft=280;this.maxSize=[];this.maxSize.push(cc.size(design.width-startX[0],height));this.maxSize.push(cc.size(startX[1]-(design.width/2+marginCentre),height));this.maxSize.push(cc.size(startX[2]-marginLeft,height));this.maxSize.push(cc.size(design.width/2-marginCentre-startX[3],
height));var coupleHeight=this.cardEarnSize[0].height}CardChanOnTable.prototype=Object.create(BaseGame.prototype);CardChanOnTable.prototype.moveOldCard=function(){};CardChanOnTable.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};
CardChanOnTable.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear()};CardChanOnTable.prototype.getCardEarnChiu=function(cardID){for(var i=0;i<4;i++){if(!this.cardList[i]||!this.cardList[i].length)continue;var lastIndex=this.cardList[i].length-1;var cardNode=this.cardList[i][lastIndex];if(cardNode.idCard===cardID){this.cardList[i].splice(lastIndex,1);return[cardNode]}}return[]};
CardChanOnTable.prototype.getCardEarn=function(earnIdList){var lastIndex=this.cardList[earnIdList].length-1;var cardNode=this.cardList[earnIdList][lastIndex];var arrCardChan=[];arrCardChan.push(cardNode);this.cardList[earnIdList].splice(lastIndex,1);return arrCardChan};
CardChanOnTable.prototype.removeCardEarn=function(earnIdList){var lastIndex=this.cardList[earnIdList].length-1;var cardNode=this.cardList[earnIdList][lastIndex];var arrCardChan=[];arrCardChan.push(cardNode);this.cardList[earnIdList].splice(lastIndex,1);return arrCardChan};CardChanOnTable.prototype.removeHightLightAll=function(sitIndex){var list=this.cardList[sitIndex];for(var i=0;i<list.length;i++){var card=list[i];card.showHighLight(false)}};
CardChanOnTable.prototype.reSizeCardList=function(sitIndex,animation,scale){var width=this.cardSize[sitIndex].width*this.cardScale*this.cardList[sitIndex].length;if(width>this.maxSize[sitIndex].width)width=this.maxSize[sitIndex].width;var list=this.cardList[sitIndex];var dx=Math.floor(width/this.cardList[sitIndex].length);var x=this.cardPosition[sitIndex].x;var y=this.cardPosition[sitIndex].y;for(var i=0;i<list.length;i++){var card=list[i];card.stopAllActions();if(animation){var rotate=cc.rotateTo(TIME_ANIMATION,
0);var moveAction=cc.moveTo(TIME_ANIMATION,cc.p(x,y));var action=cc.spawn(rotate,moveAction);if(scale)action=cc.spawn(rotate,moveAction,cc.scaleTo(TIME_ANIMATION,this.cardScale));card.runAction(card,action)}else{if(scale)card.scale.set(this.cardScale,this.cardScale);card.position.set(x,y)}if(sitIndex===0||sitIndex===3)x+=dx;else x-=dx}};
CardChanOnTable.prototype.addCard=function(card,sitIndex){var cardSize=this.cardSize;var maxSize=this.maxSize;var cardList=this.cardList;cardSize[sitIndex]=card.getContentSize();card.displayGroup=MyPixi.cardDragLayer;this.addChild(card);cardList[sitIndex].push(card)};
CardChanOnTable.prototype.addCardsOponent=function(cards,sitIndex,startPos,isBoc,animation,scale){var arr=[];for(var i=0;i<cards.length;i++){var cardData=cards[i];var card=new CardChan(cardData,this);card.displayGroup=MyPixi.cardDragLayer;card.canTouch=false;card.setName(cards[i].toString());card.showBlur(isBoc);if(isBoc&&animation)card.rotation=cc.Global.degreeToRadian(70);card.scale.set(this.cardScale+CardChanScale.LAST_CARD);card.position.set(startPos.x,startPos.y);this.addCard(card,sitIndex);
arr.push(card)}this.reSizeCardList(sitIndex,animation,scale);return arr};CardChanOnTable.prototype.addCardReconnect=function(cards){cc.log("pending-----")};
CardChanOnTable.prototype.addCardsMe=function(cards,sitIndex,pos,animation,isMe){var animationDuration=TIME_ANIMATION;if(!this.cardSize[sitIndex])this.cardSize[sitIndex]=cards[0].getContentSize();var dx=this.cardSize[sitIndex].width*this.cardScale;var width=cards.length*dx;var widthBeforeAdd=this.cardSize[sitIndex].width*this.cardScale*this.cardList[sitIndex].length;var widthAfterAdd=width+widthBeforeAdd;if(widthAfterAdd>this.maxSize[sitIndex].width){widthAfterAdd=this.maxSize[sitIndex].width;dx=
Math.floor(widthAfterAdd/(this.cardList[sitIndex].length+cards.length))}var x=this.cardPosition[sitIndex].x+this.cardList[sitIndex].length*dx;if(sitIndex===1||sitIndex===2)x=this.cardPosition[sitIndex].x-this.cardList[sitIndex].length*dx;for(var i=0;i<cards.length;i++){var card=cards[i];var rot=card.rotation;var starX=pos.x;var startY=pos.y;if(isMe){var ___dx=Math.sin(rot)*.85*card.getContentSize().height;var ___dy=Math.cos(rot)*.85*card.getContentSize().height;starX=Math.sin(rot)*.85*card.getContentSize().height+
pos.x;startY=-Math.cos(rot)*.85*card.getContentSize().height+pos.y}card.displayGroup=MyPixi.cardDragLayer;card.anchor.set(.5,.5);card.position.set(starX,startY);var rotate=cc.rotateTo(animationDuration,0);this.addChild(card);card.updateCardNumber(card.idCard);var move=cc.moveTo(animationDuration,cc.p(x,this.cardPosition[sitIndex].y));var scaleTo=cc.scaleTo(animationDuration,this.cardScale+CardChanScale.LAST_CARD);card.runAction(card,cc.spawn(move,scaleTo,rotate));if(sitIndex===1||sitIndex===2)x-=
dx;else x+=dx}this.cardList[sitIndex]=this.cardList[sitIndex].concat(cards);var thiz=this;var resizeAction=cc.callFunc(function(){thiz.reSizeCardList(sitIndex,animation)});this.runAction(this,cc.sequence(cc.delayTime(animationDuration),resizeAction))};
CardChanOnTable.prototype.addCardBocMe=function(cards,sitIndex,pos,isBoc,animation){var animationDuration=TIME_ANIMATION;if(!this.cardSize[sitIndex])this.cardSize[sitIndex]=cards[0].getContentSize();var dx=this.cardSize[sitIndex].width*this.cardScale;var width=cards.length*dx;var widthBeforeAdd=this.cardSize[sitIndex].width*this.cardScale*this.cardList[sitIndex].length;var widthAfterAdd=width+widthBeforeAdd;if(widthAfterAdd>this.maxSize[sitIndex].width){widthAfterAdd=this.maxSize[sitIndex].width;
dx=Math.floor(widthAfterAdd/(this.cardList[sitIndex].length+cards.length))}var x=this.cardPosition[sitIndex].x+this.cardList[sitIndex].length*dx;var i=0;var cardData=cards[i];var card=new CardChan(cardData,null);card.displayGroup=MyPixi.cardDragLayer;card.scale.set(this.cardScale+CardChanScale.LAST_CARD);card.rotation=cc.Global.degreeToRadian(70);card.position.set(pos.x,pos.y);card.showBlur(isBoc);this.addChild(card);var move=cc.moveTo(animationDuration,cc.p(x,this.cardPosition[sitIndex].y));var roatate=
cc.rotateTo(animationDuration,0);x+=dx;this.cardList[sitIndex].push(card);var thiz=this;var resizeAction=cc.callFunc(function(){thiz.reSizeCardList(sitIndex,animation)});card.runAction(card,cc.sequence(cc.spawn(move,roatate),resizeAction));return card};
CardChanOnTable.prototype.findCardNodeByCardId=function(cardId,sitIndex,isBoc){var cardNode=null;var arr=[3,2,1,0];if(sitIndex===0)arr=[3,2,1,0];else if(sitIndex===1)arr=[0,3,2,1];else if(sitIndex===2)arr=[1,0,3,2];else if(sitIndex===3)arr=[2,1,0,3];if(isBoc){var rd=Math.floor(Math.random()*4);var list=this.cardList[rd];cardNode=list[list.length-1]}else for(var i=0;i<arr.length;i++){var list=this.cardList[arr[i]];for(var j=list.length-1;j>0;j--){var card=list[j];var idCard=card.idCard;if(idCard===
cardId){cardNode=card;break}}}return cardNode};CardChanOnTable.prototype.addCardWithoutAnimation=function(cards){};CardChanOnTable.prototype.addCardRemainEndGme=function(cardID){var card=PIXI.Sprite.fromFrame(""+cardID+".png");card.scale.set(this.cardScale);card.position.set(cc.winSize.width/2-100,cc.winSize.height/2-50);this.addChild(card)};
CardChanOnTable.prototype.removeAll=function(){for(var i=0;i<this.cardList.length;i++)this.cardList[i]=[];for(var i=0;i<this.cardEarnListBot.length;i++)this.cardEarnListBot[i]=[];for(var i=0;i<this.cardEarnListTop.length;i++)this.cardEarnListTop[i]=[];var childs=this.children;if(childs&&childs.length)for(var i=childs.length-1;i>=0;i--){var seq=cc.sequence(cc.fadeOut(.2),cc.removeSelf(childs[i]));childs[i].runAction(childs[i],seq)}};function CardEarnNode(maxSize){PIXI.Container.call(this);this.maxSize=cc.size(maxSize.width,maxSize.height);this.setContentSize(this.maxSize);this.cardGroups=[];this.itemSize=cc.size(50*.8,188*.8);this.maxDy=this.itemSize.height}CardEarnNode.prototype=Object.create(PIXI.Container.prototype);CardEarnNode.prototype.getContentSize=function(){return cc.size(this.widthContainer,this.heightContainer)};
CardEarnNode.prototype.setContentSize=function(size){this.widthContainer=size.width;this.heightContainer=size.height};
CardEarnNode.prototype.showBlurBg=function(isShow,colorHexa){if(isShow){if(!this.graphics){this.graphics=new PIXI.Graphics;this.graphics.displayGroup=this.displayGroup}var colorArr=[8594922,16711680,14964271,7139696,7013262];var color=colorArr[Math.floor(Math.random()*colorArr.length)];if(colorHexa)color=colorHexa;this.parent.addChild(this.graphics);this.graphics.position.set(this.x,this.y);this.graphics.clear();this.graphics.beginFill(color,.5);this.graphics.drawRect(0,0,this.widthContainer,this.heightContainer);
this.graphics.endFill()}else if(this.graphics)this.graphics.clear();cc.log("cardChanlist showBlurBg")};CardEarnNode.prototype.setItemSize=function(itemSize){this.itemSize=cc.size(itemSize.width*.83,itemSize.height*.83);this.maxDy=this.itemSize.height};
CardEarnNode.prototype.addCardGroup=function(cards,deckPosMe){if(!this.itemSize){var size=cards[0].getContentSize();this.itemSize=cc.size(size.width,size.height);this.maxDy=this.itemSize.height}var arr=[];for(var i=0;i<cards.length;i++){cards[i].displayGroup=this.displayGroup;this.changeGlobalPos(cards[i],i,arr,deckPosMe)}this.cardGroups.push(arr)};
CardEarnNode.prototype.changeGlobalPos=function(card,i,arr,deckPosMe){card.showHighLight(false);if(!card);var cardParent=card.parent;if(cardParent){var centerPos=cc.p(card.getContentSize().width/2,card.getContentSize().height/2);var globalPos=cc.convertToWorldSpace(card);globalPos=cc.pAdd(globalPos,centerPos);var p=globalPos;var p2=cc.convertToNodeSpace(this,p);this.addChild(card);card.position.set(p2.x,p2.y);arr.push(card)}else{this.addChild(card);cc.log("cha co nhe posittion");arr.push(card)}if(card.rotation!=
0){var anchorY=card.anchor.y;var anchorCenter=.5;var rot=card.rotation;var ___dx=Math.sin(rot)*(anchorY-anchorCenter)*card.getContentSize().height;var ___dy=Math.cos(rot)*(anchorY-anchorCenter)*card.getContentSize().height;var starX=Math.sin(rot)*(anchorY-anchorCenter)*card.getContentSize().height+deckPosMe.x;var startY=-Math.cos(rot)*(anchorY-anchorCenter)*card.getContentSize().height+deckPosMe.y;var p2=cc.convertToNodeSpace(this,cc.p(starX,startY));card.anchor.set(.5,.5);card.position.set(p2.x,
p2.y)}card.anchor.set(.5,.5)};CardEarnNode.prototype.removeAll=function(){var childs=this.children;if(childs&&childs.length)for(var i=childs.length-1;i>=0;i--){var seq=cc.sequence(cc.fadeOut(.2),cc.removeSelf(childs[i]));childs[i].runAction(childs[i],seq)}this.cardGroups=[]};
CardEarnNode.prototype.reOrder=function(animation){if(this.cardGroups.length<=0)return;var groupWidth=this.maxSize.width/this.cardGroups.length;if(groupWidth>this.itemSize.width)groupWidth=this.itemSize.width;var zIndex=0;for(var i=0;i<this.cardGroups.length;i++){if(this.isReverse)var x=this.maxSize.width-(groupWidth/2+groupWidth*i);else var x=groupWidth/2+groupWidth*i;var arr=this.cardGroups[i];for(var j=arr.length-1;j>=0;j--){var card=arr[j];if(arr.length>1){var dy=(this.maxSize.height-this.itemSize.height)/
(arr.length-1);if(dy>this.maxDy)dy=this.maxDy}else var dy=0;card.cardOriginPosition=cc.p(x,this.maxSize.height-this.itemSize.height/2-dy*j);zIndex++}}this._moveCardToOriginPosition(animation)};
CardEarnNode.prototype._moveCardToOriginPosition=function(animation){for(var i=0;i<this.cardGroups.length;i++){var arr=this.cardGroups[i];for(var j=0;j<arr.length;j++){var card=arr[j];card.stopAllActions();if(animation){var moveAction=cc.moveTo(.5,card.cardOriginPosition);var rotateAction=cc.rotateTo(.5,0);var scaleAction=cc.scaleTo(.5,.8);card.runAction(card,cc.spawn(moveAction,rotateAction,scaleAction))}else{card.rotate=0;card.scale.set(.8);card.position.set(card.cardOriginPosition.x,card.cardOriginPosition.y)}}}};function ResultTable(){BaseGame.call(this);var scale=1;var bg=PIXI.Sprite.fromImage("res/bg/bg_result.png");this.bg=bg;var bgSize=cc.size(bg.width*scale,bg.height*scale);this.bgSize=bgSize;bg.anchor.set(.5,.5);bg.position.set(cc.winSize.width-10-bg.width/2,cc.winSize.height/2);this.addChild(bg);this.position.set(0,0);var _width=bgSize.width-80;this._width=_width;var title=cc.LabelTTF("T\u1ed5ng k\u1ebft",cc.res.font.Netmuc,35,null,"#2C2B28");title.anchor.set(.5,.8);title.position.set(0,-280);bg.addChild(title);
var xuongBg=PIXI.Sprite.fromImage("res/bg/bg_cuoc.png");xuongBg.anchor.set(.5);xuongBg.position.set(cc.winSize.width/2,cc.winSize.height-610);this.addChild(xuongBg);lbChonCuoc=cc.LabelTTF("DSHSDHSD",cc.res.font.Netmuc,20,null,"yellow");lbChonCuoc.style.wordWrap=true;lbChonCuoc.style.wordWrapWidth=400;lbChonCuoc.style.align="top";lbChonCuoc.anchor.set(.5,.5);lbChonCuoc.position.set(cc.winSize.width/2,cc.winSize.height-610);this.addChild(lbChonCuoc);this.lbChonCuoc=lbChonCuoc;this.visible=false;this.audioMng=
new AudioDevice}ResultTable.prototype=Object.create(BaseGame.prototype);ResultTable.prototype.showKQDraw=function(){};ResultTable.prototype.setXuongCuoc=function(str){var total=0;var nameXuong=str;if(nameXuong&&nameXuong.length>100)nameXuong=nameXuong.slice(0,100)+"...";this.lbChonCuoc.text=nameXuong};
ResultTable.prototype.showKQLabel=function(strWin,strPoint,cuocSaiStr,strCuocLoi,strCuocthieu,denlangStr,messAnGa,cuocHo,ps,listener){this.show();var textMesasge=cc.LabelTTF("",cc.res.font.Roboto_Condensed,22,null,"#2C2B28");textMesasge.style.wordWrap=true;textMesasge.style.wordWrapWidth=210;textMesasge.style.align="top";textMesasge.anchor.set(.5,0);var msg=strWin+" "+strPoint;if(messAnGa&&messAnGa.length)msg+="\n\n"+messAnGa;if(strCuocLoi&&strCuocLoi.length)msg+="\n\n"+strCuocLoi;if(cuocSaiStr&&
cuocSaiStr.length)msg+="\n\n"+cuocSaiStr;if(strCuocthieu&&strCuocthieu.length)msg+="\n\n"+strCuocthieu;if(denlangStr&&denlangStr.length)msg+="\n\n"+denlangStr;if(ps&&ps.length){ps.sort(function(a,b){return b.mX-a.mX});msg+="\n";for(var j=0;j<ps.length;j++){var mx=ps[j].mX;var text="";if(mx>0)text=ps[j].dn+" : +"+cc.Global.NumberFormat1(ps[j].mX);else text=ps[j].dn+" : "+cc.Global.NumberFormat1(ps[j].mX);msg+="\n"+text}}textMesasge.text=msg;textMesasge.position.set(0,-250);if(this.textMesasge&&this.textMesasge.parent)this.textMesasge.parent.removeChild(this.textMesasge);
this.bg.addChild(textMesasge);this.textMesasge=textMesasge;if(cuocHo){for(var i=0;i<cuocHo.length;i++)cuocHo[i]="./sound/sound_chan/"+cuocHo[i]+".mp3";this.audioMng.play(cuocHo)}};ResultTable.prototype.show=function(){this.stopAllActions();var thiz=this;thiz.visible=true;this.bg.scale.set(0,0);var seq=cc.sequence(cc.scaleTo(.5,1),cc.callFunc(function(){thiz.visible=true}));this.runAction(this.bg,seq)};
ResultTable.prototype.hide=function(){this.stopAllActions();var thiz=this;var seq=cc.sequence(cc.scaleTo(.5,0),cc.callFunc(function(){thiz.visible=false}));this.runAction(this.bg,seq)};var order_xuong=[1,2,3,26,30,34,11,13,14,15,16,17,43,4,5,9,25,38,18,20,21,22,23,19];var s_xuong_u_content=s_xuong_u_content||{};s_xuong_u_content["1"]="Xu\u00f4ng";s_xuong_u_content["2"]="Th\u00f4ng";s_xuong_u_content["3"]="Ch\u00ec";s_xuong_u_content["26"]="T\u00f4m";s_xuong_u_content["30"]="L\u00e8o";s_xuong_u_content["11"]="B\u1ea1ch th\u1ee7";s_xuong_u_content["13"]="B\u1ea1ch th\u1ee7 chi";s_xuong_u_content["5"]="\u0110\u1ecba \u00d9";s_xuong_u_content["25"]="Ch\u00edu \u00d9";
s_xuong_u_content["17"]="Th\u1eadp th\u00e0nh";s_xuong_u_content["34"]="Ch\u00edu";s_xuong_u_content["4"]="Thi\u00ean \u00d9";s_xuong_u_content["15"]="T\u00e1m \u0111\u1ecf";s_xuong_u_content["14"]="B\u1ea1ch \u0111\u1ecbnh";s_xuong_u_content["16"]="K\u00ednh t\u1ee9 chi";s_xuong_u_content["38"]="Thi\u00ean khai";s_xuong_u_content["9"]="\u00d9 b\u00f2n";s_xuong_u_content["43"]="\u0103n b\u00f2n";s_xuong_u_content["19"]="Nh\u00e0 l\u1ea7u xe h\u01a1i";s_xuong_u_content["18"]="Hoa r\u01a1i c\u1eeda ph\u1eadt";
s_xuong_u_content["22"]="C\u00e1 nh\u1ea3y \u0111\u1ea7u thuy\u1ec1n";s_xuong_u_content["24"]="Thi\u00ean \u00fd";s_xuong_u_content["23"]="Ch\u00f9a \u0111\u1ed5 n\u00e1t hoa";s_xuong_u_content["20"]="C\u00e1 l\u1ed9i s\u00e2n \u0111\u00ecnh";s_xuong_u_content["21"]="Ng\u01b0 \u00f4ng b\u1eaft c\u00e1";var keyXuong4state=keyXuong4state||["30","26","38","43","34"];var s_xuong_4_state=s_xuong_4_state||{};s_xuong_u_content["30"]="L\u00e8o";s_xuong_u_content["26"]="T\u00f4m";s_xuong_u_content["38"]="Thi\u00ean khai";
s_xuong_u_content["43"]="\u0103n b\u00f2n";s_xuong_u_content["34"]="Ch\u00edu";var s_xuong_u_content_repsonse=s_xuong_u_content_repsonse||{};s_xuong_u_content_repsonse["31"]="2 L\u00e8o";s_xuong_u_content_repsonse["32"]="3 L\u00e8o";s_xuong_u_content_repsonse["33"]="4 L\u00e8o";s_xuong_u_content_repsonse["27"]="2 T\u00f4m";s_xuong_u_content_repsonse["28"]="3 T\u00f4m";s_xuong_u_content_repsonse["29"]="4 T\u00f4m";s_xuong_u_content_repsonse["35"]="2 Ch\u00edu";s_xuong_u_content_repsonse["36"]="3 Ch\u00edu";
s_xuong_u_content_repsonse["37"]="4 Ch\u00edu";s_xuong_u_content_repsonse["44"]="2 \u0103n b\u00f2n";s_xuong_u_content_repsonse["45"]="3 \u0103n b\u00f2n";s_xuong_u_content_repsonse["46"]="4 \u0103n b\u00f2n";s_xuong_u_content_repsonse["39"]="2 Thi\u00ean khai";s_xuong_u_content_repsonse["40"]="3 Thi\u00ean khai";s_xuong_u_content_repsonse["41"]="4 Thi\u00ean khai";s_xuong_u_content_repsonse["42"]="5 Thi\u00ean khai";
function XuongUdialog(_timeXuong){MyDialog.call(this,cc.winSize);this.displayGroup=MyPixi.popupLayer;MyPixi.gameContainer.addChild(this);this.setEnableOutSizeClose(false);this.position.x=0;this.position.y=0;if(!_timeXuong)_timeXuong=30;var thiz=this;this.bgHide.visible=false;this.mainLayer=new PIXI.Container;this.addChild(this.mainLayer);var left=PIXI.Sprite.fromImage("res/bg/cuoc_bg.png");left.anchor.set(.5,.5);var dx=220;left.position.set(dx,cc.winSize.height/2);this.mainLayer.addChild(left);var right=
PIXI.Sprite.fromImage("res/bg/cuoc_bg.png");right.anchor.set(.5,.5);right.position.set(cc.winSize.width-dx,cc.winSize.height/2);this.mainLayer.addChild(right);var light=PIXI.Sprite.fromImage("res/bg/bg_cuoc.png");light.anchor.set(.5);light.position.set(cc.winSize.width/2,cc.winSize.height-580);this.mainLayer.addChild(light);lbChonCuoc=cc.LabelTTF("",cc.res.font.Netmuc,22,null,"yellow");lbChonCuoc.style.wordWrap=true;lbChonCuoc.style.wordWrapWidth=400;lbChonCuoc.style.align="top";lbChonCuoc.anchor.set(.5,
.5);lbChonCuoc.position.set(cc.winSize.width/2,cc.winSize.height-610);this.mainLayer.addChild(lbChonCuoc);this.lbChonCuoc=lbChonCuoc;var __y=cc.winSize.height-440;var xuongBt=MyHelper.createButton("button/btn_xuongu.png",true,function(){thiz.showXuong(false);thiz.hideXuongTable();var xuongIds=[];for(var key in thiz.keyXuong)(function(){var mKey=key;var value=thiz.keyXuong[key];if(value>0)xuongIds.push(Number(mKey)+(value-1))})();cc.log(xuongIds);var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,
LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.XUONG_CUOC,"lC":xuongIds}];LobbyClient.getInstance().send(msg)});xuongBt.position.set(cc.winSize.width/2+180,__y);xuongBt.displayGroup=this.displayGroup;this.mainLayer.addChild(xuongBt);this.xuongBt=xuongBt;var xemNocBt=MyHelper.createButton("button/btn_xemnoc.png",true,function(){thiz.closeNocBt.visible=true;thiz.xemNocBt.visible=false;thiz.cardNocContainer.visible=true;thiz.cardUContainer.visible=false});xemNocBt.position.set(cc.winSize.width/
2-180,__y);xemNocBt.displayGroup=this.displayGroup;thiz.xemNocBt=xemNocBt;this.addChild(xemNocBt);var closeNocBt=MyHelper.createButton("button/btn_dongnoc.png",true,function(){thiz.xemNocBt.visible=true;thiz.closeNocBt.visible=false;thiz.cardNocContainer.visible=false;thiz.cardUContainer.visible=true});closeNocBt.position.set(xemNocBt.x,xemNocBt.y);closeNocBt.visible=false;this.closeNocBt=closeNocBt;closeNocBt.displayGroup=this.displayGroup;this.addChild(closeNocBt);this.timeXuongLbl=cc.LabelBmtFont("",
cc.res.font.font_thuaa);this.timeXuongLbl.anchor.set(.5);this.timeXuongLbl.displayGroup=this.displayGroup;this.timeXuongLbl.position.set(cc.winSize.width/2,xemNocBt.y-15);this.timeXuong=_timeXuong;if(this.timeXuong>0){var thiz=this;var callfun=cc.callFunc(function(){var timeRemain=thiz.timeXuong--;if(timeRemain<=0){if(thiz.timeXuongLblAction){thiz.stopAction(this.timeXuongLblAction);thiz.timeXuongLblAction=null}thiz.timeXuongLbl.text=""}else thiz.timeXuongLbl.text=""+timeRemain});var repeat=cc.repeatForever(cc.sequence(cc.delayTime(1),
callfun));this.timeXuongLblAction=this.runAction(this.timeXuongLbl,repeat)}this.addChild(this.timeXuongLbl);this.keyXuong={};var idx=0;for(var i in order_xuong){var key=order_xuong[i].toString();(function(){var height=left.height==1?679:left.height;var mKey=key;var mContent=s_xuong_u_content[key];thiz.keyXuong[mKey]=0;var table=i>11?right:left;if(idx>11)idx-=11+1;var clickHandler=function(){thiz._onChonCuoc(mKey,button)};var button=thiz.addXuongButton(mContent,table,clickHandler);var newY=-height/
2+40+idx*40;button.position.set(0,newY);idx++})()}this.cardUContainer=new PIXI.Container;this.cardUContainer.displayGroup=this.displayGroup;this.addChild(this.cardUContainer);this.cardNocContainer=new PIXI.Container;this.cardNocContainer.displayGroup=this.displayGroup;this.cardNocContainer.visible=false;this.addChild(this.cardNocContainer)}XuongUdialog.prototype=Object.create(MyDialog.prototype);
XuongUdialog.prototype.addXuongButton=function(message,table,clickHander){var width=140;var button=cc.LabelTTF(message,cc.res.font.Arial,18,null,"white");button.style.wordWrap=true;button.style.wordWrapWidth=140;button.style.align="center";button.anchor.set(.5);MyHelper.addClickListenerToLabel(button,clickHander);button.displayGroup=this.displayGroup;table.addChild(button);return button};
XuongUdialog.prototype.hide=function(){this.stopAllActions();var seq=cc.sequence(cc.fadeOut(.5),cc.removeSelf(this));this.runAction(this,seq)};XuongUdialog.prototype.hideXuongTable=function(){this.mainLayer.visible=false;if(this.timeXuongLblAction){this.stopAction(this.timeXuongLblAction);this.timeXuongLblAction=null}this.timeXuongLbl.visible=false};
XuongUdialog.prototype._onChonCuoc=function(mKey,button){cc.log("_onChonCuoc: "+mKey);var max=1;var value=this.keyXuong[mKey];value++;var index2=keyXuong4state.indexOf(mKey);if(index2!==-1){max=4;if(mKey==38)max=5}if(value>max)value=0;if(value>0){button.style.fill="#ffff00";this.keyXuong[mKey]=value;var text=button.text;if(max===4)text=value+" "+s_xuong_u_content[mKey];else text=s_xuong_u_content[mKey];button.text="";button.text=text}else{button.style.fill="#ffffff";this.keyXuong[mKey]=0;var text=
s_xuong_u_content[mKey];button.text="";button.text=text}var nameXuong="";var xuongIds=[];var thiz=this;for(var key in this.keyXuong)(function(){var mKey=key;var value=thiz.keyXuong[key];if(value>0){var id=Number(mKey)+(value-1);xuongIds.push(id)}})();var total=0;for(var _key in order_xuong)(function(){var mKey=order_xuong[_key];var value=thiz.keyXuong[mKey.toString()];if(value>0){var id=Number(mKey)+(value-1);var nameCuoc=s_xuong_u_content[id.toString()];if(!nameCuoc)nameCuoc=s_xuong_u_content_repsonse[id.toString()];
total++;if(total>3){total=0;nameXuong+=nameCuoc+", "}else nameXuong+=nameCuoc+", "}})();cc.log(xuongIds);nameXuong=nameXuong.substring(0,nameXuong.length-2);if(nameXuong.length>100)nameXuong=nameXuong.substring(0,100)+"...";this.lbChonCuoc.text=nameXuong};XuongUdialog.prototype.showXuong=function(show){this.mainLayer.visible=show;if(!show){this.xemNocBt.x=cc.winSize.width/2;this.closeNocBt.x=this.xemNocBt.x;this.timeXuongLbl.x=cc.winSize.width/2+180}};
XuongUdialog.prototype.swap=function(arr,i,j){var temp=arr[i];arr[i]=arr[j];arr[j]=temp};
XuongUdialog.prototype.showResult=function(data){this.cardUContainer.removeChildren();this.cardNocContainer.removeChildren();var listCards=data.listCards;var listNoc=data.listNoc;if(listCards&&listCards.length){var totalRow=2;var length=listCards.length;var caList=[];var chanList=[];var lastId=listCards[length-1];var lastEarnList=[listCards[length-2],lastId];if(lastId===listCards[length-2]&&lastId==listCards[length-3]&&lastId==listCards[length-4]){lastEarnList.unshift(listCards[length-3]);lastEarnList.unshift(listCards[length-
4])}else{var c1=listCards[length-1];var c2=listCards[length-2];var c3=listCards[length-3];var c4=listCards[length-4];var p1=Math.floor(c1/3)+2;var p2=Math.floor(c2/3)+2;var p3=Math.floor(c3/3)+2;var p4=Math.floor(c4/3)+2;if(p1==p2&&p2==p3&&p3==p4&&(c2!=c3&&c3!=c4&&c4!=c2))if(c1==c3){this.swap(listCards,length-3,length-2);lastEarnList=[listCards[length-2],lastId]}else if(c1==c4){this.swap(listCards,length-4,length-2);lastEarnList=[listCards[length-2],lastId]}}var size=length-lastEarnList.length;for(var i=
0;i<size-1;i+=2){var _id1=listCards[i];var _id2=listCards[i+1];if(_id1===_id2)chanList.push(_id1,_id2);else{caList.push(_id1,_id2);totalRow=3}}var arrRow1=chanList;var startY=cc.winSize.height-230;if(totalRow==3)startY=cc.winSize.height-300;this.arrangeNoc(arrRow1,startY,false,chanList.length>16?.7:.8);if(caList.length){var arrRow2=caList;startY+=94;this.arrangeNoc(arrRow2,startY,false)}startY+=94;this.arrangeNoc(lastEarnList,startY,false);var _list=this.cardUContainer.children;if(_list&&_list.length){var lastCard=
_list[_list.length-1];lastCard.showHighLight(true);lastCard.hightLight.displayGroup=this.displayGroup;lastCard.hightLight.anchor.set(lastCard.anchor.x,lastCard.anchor.y)}}if(listNoc&&listNoc.length){var maxLengthRow1=13;var arrRow1=listNoc.slice(0,maxLengthRow1);var startY=cc.winSize.height-205;if(listNoc.length>maxLengthRow1)startY=cc.winSize.height-130;this.arrangeNoc(arrRow1,startY,true);if(listNoc.length>=maxLengthRow1){var arrRow2=listNoc.slice(maxLengthRow1);startY-=150;this.arrangeNoc(arrRow2,
startY,true)}}};
XuongUdialog.prototype.arrangeNoc=function(listNoc,startY,isNoc,scale){if(!scale)scale=.8;if(listNoc&&listNoc.length){var sizeCardsNoc=cc.size(52*scale,188*scale);if(listNoc.length>=16)sizeCardsNoc=cc.size(45*scale,180*scale);if(isNoc)sizeCardsNoc=cc.size(52*scale,188*scale);var startX=cc.winSize.width/2-listNoc.length/2*sizeCardsNoc.width;var arr=[];for(var i=0;i<listNoc.length;i++){var cardData=listNoc[i];var card=new CardChan(cardData);card.displayGroup=this.displayGroup;card.canTouch=false;card.anchor.set(.5);
card.scale.set(scale);card.position.set(startX+sizeCardsNoc.width/2+i*sizeCardsNoc.width,startY);if(isNoc)this.cardNocContainer.addChild(card);else this.cardUContainer.addChild(card)}}};cc.Global.getLevelByExp=function(exp){var level="D\u00e2n \u0111en";if(exp>=25E4)level="V\u01b0\u01a1ng gia";else if(exp>=1E5)level="T\u1ec3 t\u01b0\u1edbng";else if(exp>=5E4)level="Th\u1eeba t\u01b0\u1edbng";else if(exp>=13200)level="Th\u00e1i s\u01b0";else if(exp>=9800)level="\u0110\u00f4 \u0111\u1ed1c";else if(exp>=7200)level="Th\u01b0\u1ee3ng th\u01b0";else if(exp>=4800)level="\u0110\u1ec1 \u0111\u1ed1c";else if(exp>=2800)level="T\u1ed5ng \u0110\u1ed1c";else if(exp>=1800)level="Tu\u1ea7n Ph\u1ee7";
else if(exp>=1200)level="Tri ph\u1ee7";else if(exp>=1E3)level="Tri huy\u1ec7n";else if(exp>=850)level="L\u00fd tr\u01b0\u1edfng";else if(exp>=700)level="H\u01b0\u01a1ng tr\u01b0\u1edfng";else if(exp>=550)level="\u0110\u1ecba ch\u1ee7";else if(exp>=400)level="Ph\u00fa \u00f4ng";else if(exp>=250)level="Cai \u0111\u1ed9i";else if(exp>=130)level="Ti\u1ec3u nh\u1ecb";else if(exp>=50)level="Ph\u1ee5 h\u1ed3";return level};
function UserDialog(size){if(!size)size=cc.size(600,407);MyDialog.call(this,size,"res/bg/bg_dialog_info.png");this.okButton.visible=true;this.closeButton.visible=false;this.cancelButton.visible=false;this.messageLabel.text="";this.okButton.anchor.set(.5);this.okButton.x=this.bg.width/2;MyHelper.addLblButton(this.okButton,"\u0110\u00f3ng",16);this.updateInfo()}UserDialog.prototype=Object.create(MyDialog.prototype);UserDialog.prototype.okButtonHandler=function(){this.hide()};
UserDialog.prototype.createRoundBg=function(size,x,y){var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("bg_profile.png"),21,21,21,21);bg.width=size.width;bg.height=size.height;bg.position.set(x,y);this.bg.addChild(bg);return bg};
UserDialog.prototype.updateInfo=function(){this.bg1=this.createRoundBg(cc.size(230,160),30,80);this.bgMoney=this.createRoundBg(cc.size(230,60),30,240);this.bgName=this.createRoundBg(cc.size(300,225),270,80);var maskAvatar=new MaskCircleLayer(45);maskAvatar.position.set(140,160);this.bg.addChild(maskAvatar);this.maskAvatar=maskAvatar;var sizeAvatar=cc.size(100,100);var avt=UserAvatar.createAvatarGame(sizeAvatar);avt.interactive=false;avt.position.set(-50,-50);maskAvatar.addChild(avt);maskAvatar.displayGroup=
avt.displayGroup;this.avt=avt;this.avt.setSizeAvatar(sizeAvatar);var userName=cc.LabelTTF(PlayerMe.displayName,cc.res.font.Arial,24,null,"white");userName.position.set(340,140);userName.anchor.set(0,.5);this.bg.addChild(userName);this.userName=userName;var vipLbl=cc.LabelTTF("Vip: ",cc.res.font.Arial,24,null,"#0BF3A0");vipLbl.position.set(userName.x,userName.y+60);vipLbl.anchor.set(0,.5);this.vipLbl=vipLbl;this.bg.addChild(vipLbl);var size=this.size;var valueQuan=cc.LabelTTF(cc.Global.NumberFormat1(PlayerMe.gold),
cc.res.font.Arial,24,null,"yellow");valueQuan.position.set(100,270);valueQuan.anchor.set(0,.5);this.bg.addChild(valueQuan);var iconGold=PIXI.Sprite.fromFrame("button/icon_vang_small.png");iconGold.anchor.set(.5,.5);iconGold.position.set(valueQuan.x-30,valueQuan.y);this.bg.addChild(iconGold);var friendBtn=cc.LabelTTF("K\u1ebft b\u1ea1n",cc.res.font.Arial,24,null,"white");this.friendBtn=friendBtn;friendBtn.position.set(340,70);friendBtn.anchor.set(0,.5);MyPixi.friend=friendBtn;this.bg.addChild(friendBtn);
var thiz=this;MyHelper.addClickListenerToLabel(friendBtn,function(){FriendPlugin.getInstance().sendRequestFriend(thiz.dataUser.dn)});friendBtn.displayGroup=null;friendBtn.visible=false;this.valueQuan=valueQuan;this.userName=userName};
UserDialog.prototype.setInfo=function(data){this.dataUser=data;cc.log("aaa"+JSON.stringify(data));this.userName.text=data.dn;this.setGold(data.As.gold);this.setXu(data.As.chip);this.avt.setAvatar(data.a);var idVip=data.As.vip;if(idVip>=Constant.VIP_LVL.length)idVip=Constant.VIP_LVL.length-1;this.vipLbl.text="Vip : "+Constant.VIP_LVL[idVip];cc.log("aaaaaaa vip "+data.As.vip);var thiz=this};UserDialog.prototype.setGold=function(quan){this.valueQuan.text=cc.Global.NumberFormat1(Math.floor(quan))};
UserDialog.prototype.setXu=function(xu){};
function UserDialogChan(size,data){if(!size)size=cc.size(1E3,530);MyDialog.call(this,size);this.dataPlayer=data;this.bg.parent.removeChild(this.bg);var bg=PIXI.Sprite.fromImage("res/bg/bg_rank.png");bg.anchor.set(0,0);bg.scale.set(size.width/1245);bg.position.set(-bg.width/2,-bg.height/2);this.bgHide.addChild(bg);this.bg=bg;this.bg.interactive=true;var title=PIXI.Sprite.fromFrame("button/home_thongtin.png");title.position.set(size.width/2-75,bg.height-565);this.bg.addChild(title);var sizeAvatar=cc.size(100,
100);var avt=UserAvatar.createAvatarGame(sizeAvatar,false);avt.anchor.set(.5,0);avt.interactive=false;avt.position.set(71,120);this.bg.addChild(avt);this.avt=avt;this.avt.setSizeAvatar(sizeAvatar);this.avt.setAvatar(this.dataPlayer.a);avt.scale.set(1.5,1.5);var thiz=this;var closeButton=MyHelper.createButton(["button/home_x.png","button/home_x1.png"],true,function(){thiz.hide()});closeButton.displayGroup=null;closeButton.position.set(size.width+150,this.bg.height-510);this.bg.addChild(closeButton);
var historyBtn=MyHelper.createButton(["button/history2.png","button/history1.png"],true,function(){jQuery("#popup-lichsuGiaoDich").data("mhPopup").open()});historyBtn.displayGroup=null;historyBtn.position.set(142,this.bg.height-200);this.bg.addChild(historyBtn);var kichHoatBtn=MyHelper.createButton(["button/kichhoat_01.png","button/kichhoat_02.png"],true,function(){LobbyClient.getInstance()._showKichHoatSuggest()});kichHoatBtn.position.set(142,this.bg.height-130);this.bg.addChild(kichHoatBtn);kichHoatBtn.displayGroup=
null;var changePass=MyHelper.createButton(["button/btn_changepass.png","button/btn_changepass1.png"],true,function(){jQuery("#popup-changePass").data("mhPopup").open()});changePass.displayGroup=null;changePass.position.set(142,this.bg.height-60);this.bg.addChild(changePass);this.historyBtn=historyBtn;this.kichHoatBtn=kichHoatBtn;this.changePass=changePass;if(PlayerMe.phoneVerify){changePass.position.set(kichHoatBtn.x,kichHoatBtn.y);kichHoatBtn.visible=false}this._initAllLabel();if(PlayerMe.uid!==
this.dataPlayer.uid){this.historyBtn.visible=false;this.kichHoatBtn.visible=false;this.changePass.visible=false}}UserDialogChan.prototype=Object.create(MyDialog.prototype);UserDialogChan.prototype.hideAllBtn=function(){this.historyBtn.visible=false;this.kichHoatBtn.visible=false;this.changePass.visible=false};UserDialogChan.prototype.setInfo=function(data){this.dataPlayer=data};
UserDialogChan.prototype._initAllLabel=function(){var dy=-40;var _font=cc.res.font.Roboto_Condensed;var _fontSize=30;var userName=cc.LabelTTF("T\u00ean \u0111\u0103ng nh\u1eadp: ",_font,_fontSize,null,"white");userName.anchor.set(0,.5);userName.position.set(300,this.bg.height-420);this.bg.addChild(userName);userName.visible=false;var displayName=cc.LabelTTF("T\u00ean hi\u1ec3n th\u1ecb: ",_font,_fontSize,null,"white");displayName.anchor.set(0,.5);displayName.position.set(userName.x,userName.y-dy);
this.bg.addChild(displayName);var gold1=cc.LabelTTF("Quan: ",_font,_fontSize,null,"white");gold1.anchor.set(0,.5);gold1.position.set(userName.x,displayName.y-dy);this.bg.addChild(gold1);var id=cc.LabelTTF("User ID: ",_font,_fontSize,null,"white");id.anchor.set(0,.5);id.position.set(userName.x,gold1.y-dy);this.bg.addChild(id);var level=cc.LabelTTF("C\u1ea5p \u0111\u1ed9: ",_font,_fontSize,null,"white");level.anchor.set(0,.5);level.position.set(userName.x,id.y-dy);this.bg.addChild(level);var win=cc.LabelTTF("V\u00e1n th\u1eafng: ",
_font,_fontSize,null,"white");win.anchor.set(0,.5);win.position.set(userName.x,level.y-dy);this.bg.addChild(win);var totalWin=cc.LabelTTF("T\u1ed5ng v\u00e1n \u0111\u00e1nh: ",_font,_fontSize,null,"white");totalWin.anchor.set(0,.5);totalWin.position.set(userName.x,win.y-dy);this.bg.addChild(totalWin);var bestWin=cc.LabelTTF("Ti\u1ec1n Quan th\u1eafng l\u1edbn nh\u1ea5t: ",_font,_fontSize,null,"white");bestWin.anchor.set(0,.5);bestWin.position.set(userName.x,totalWin.y-dy);this.bg.addChild(bestWin);
var username=this.dataPlayer?"*******":PlayerMe.username;var dnName=this.dataPlayer?this.dataPlayer.dn:PlayerMe.displayName;var quan=this.dataPlayer?this.dataPlayer.As.gold:PlayerMe.gold;var xu=this.dataPlayer?this.dataPlayer.As.chip:PlayerMe.chip;var idStr=this.dataPlayer?"******":PlayerMe.id;var levelStr=this.dataPlayer?this.dataPlayer.As.exp:PlayerMe.level;var totalVanStr=this.dataPlayer?this.dataPlayer.As.winTime+this.dataPlayer.As.looseTime:PlayerMe.totalWin;if(!totalVanStr)totalVanStr="";var bestWinNum=
this.dataPlayer?this.dataPlayer.As.win:PlayerMe.bestWin;var winNum=this.dataPlayer?this.dataPlayer.As.winTime:PlayerMe.win;if(!winNum)winNum="";var userNameLabel=cc.LabelTTF(username,_font,_fontSize);userNameLabel.anchor.set(0,.5);userNameLabel.position.set(userName.x+userName.width,userName.y);this.bg.addChild(userNameLabel);var displayNameLabel=cc.LabelTTF(dnName,_font,_fontSize,null,"white");displayNameLabel.anchor.set(0,.5);displayNameLabel.position.set(displayName.x+displayName.width,displayName.y);
this.bg.addChild(displayNameLabel);var gold1Label=cc.LabelTTF(cc.Global.NumberFormat1(quan),_font,_fontSize,null,"#eedb02");gold1Label.anchor.set(0,.5);gold1Label.position.set(gold1.x+gold1.width,gold1.y);this.bg.addChild(gold1Label);var idLabel=cc.LabelTTF(idStr,_font,_fontSize,null,"white");idLabel.anchor.set(0,.5);idLabel.position.set(id.x+id.width,id.y);this.bg.addChild(idLabel);var levelLabel=cc.LabelTTF(cc.Global.getLevelByExp(levelStr),_font,_fontSize,null,"white");levelLabel.anchor.set(0,
.5);levelLabel.position.set(level.x+level.width,level.y);this.bg.addChild(levelLabel);var winLabel=cc.LabelTTF(""+winNum.toString(),_font,_fontSize,"#26d4a3");winLabel.anchor.set(0,.5);winLabel.position.set(win.x+win.width,win.y);this.bg.addChild(winLabel);var totalWinLabel=cc.LabelTTF(totalVanStr.toString(),_font,_fontSize,null,"#fe6c7a");totalWinLabel.anchor.set(0,.5);totalWinLabel.position.set(totalWin.x+totalWin.width,totalWin.y);this.bg.addChild(totalWinLabel);var bestWinLabel=cc.LabelTTF(cc.Global.NumberFormat1(bestWinNum),
_font,_fontSize,null,"#eedb02");bestWinLabel.anchor.set(0,.5);bestWinLabel.position.set(bestWin.x+bestWin.width,bestWin.y);this.bg.addChild(bestWinLabel)};LobbyClient.getInstance().loadDistributor();console.log("-------loading resouce begin-------");var loader=new PIXI.loaders.Loader;for(var i=0;i<LIST_RESOURCE_FILE.length;i++)loader.add(LIST_RESOURCE_FILE[i]);loader.once("complete",spriteSheetLoaded);loader.load();function spriteSheetLoaded(loader,resources){console.log("-------loading resouce done-------");LobbyClient.getInstance().loadResource=true}var loaderSpine=new PIXI.loaders.Loader;for(var i=0;i<LIST_RESOURCE_SPIN_FILE.length;i++)loaderSpine.add(LIST_RESOURCE_SPIN_FILE[i]);
loaderSpine.once("complete",onLoaded);loaderSpine.load();function onLoaded(loader,resources){MyPixi.loaderSpine=loaderSpine}function handleProgress(event){}function handleFileComplete(event){console.log("jsFile load complete");LobbyClient.getInstance().loadDistributor();initGame()}function initGame(){console.log("Loading view: initGame - load config")};var GA_MODE=GA_MODE||{};GA_MODE.NORMAL=1;GA_MODE.GA=2;var SPEED_MODE=SPEED_MODE||{};SPEED_MODE.NORMAL=1;SPEED_MODE.FAST=2;var GAME_MODE=GAME_MODE||{};GAME_MODE.FREE=1;GAME_MODE.IS_411=2;function GameTopBar(listener,displayAutoReady){PIXI.Container.call(this);this.position.x=0;this.position.y=0;var roomID=LobbyClient.getInstance().getCurrentRoomId();this._roomID=roomID;this.listener=listener;this.displayAutoReady=displayAutoReady;this.data=listener.data;this.init()}GameTopBar.prototype=Object.create(PIXI.Container.prototype);
GameTopBar.DELTA_X=.064;
GameTopBar.prototype.init=function(){var roomID=LobbyClient.getInstance().getCurrentRoomId();var sid=HostConfig.currentServer.id-1;var str="ABCDEFGHIJKLMNOUPQRS";var roomName="B\u00e0n: "+roomID+str[sid];var cuoc="C\u01b0\u1ee3c: "+cc.Global.NumberFormat2(this.data.b);var roomLbl=new PIXI.Text(roomName,{fontFamily:cc.res.font.Arial,fontSize:21,fill:16777215,align:"left"});roomLbl.anchor.set(.5,.5);roomLbl.position.set(170,30);roomLbl.displayGroup=MyPixi.gameRootLayer;this.addChild(roomLbl);this.roomLbl=
roomLbl;var iconMoney=PIXI.Sprite.fromFrame("button/icon_xu_small.png");if(cc.Global.moneyType===MoneyType.Gold)iconMoney=PIXI.Sprite.fromFrame("button/icon_vang_small.png");iconMoney.position.set(90,55);iconMoney.displayGroup=MyPixi.gameRootLayer;this.addChild(iconMoney);this.iconMoney=iconMoney;var cuocLbl=new PIXI.Text(cuoc,{fontFamily:cc.res.font.Arial,fontSize:21,fill:16777215,align:"left"});cuocLbl.anchor.set(0,.5);cuocLbl.position.set(130,75);cuocLbl.displayGroup=MyPixi.gameRootLayer;this.addChild(cuocLbl);
this.cuocLbl=cuocLbl;if(cc.Global.gameId===Constant.GAME_ID.CHAN){var uLbl=new PIXI.Text("",{fontFamily:cc.res.font.Arial,fontSize:21,fill:16777215,align:"left"});uLbl.anchor.set(0,.5);uLbl.position.set(100,120);uLbl.displayGroup=MyPixi.gameRootLayer;this.addChild(uLbl);this.uLbl=uLbl;roomLbl.anchor.set(0,.5);roomLbl.position.set(100,30);roomLbl.text=roomName+", "+cuoc;cuocLbl.visible=false;uLbl.y=cuocLbl.y}var iconWifi=PIXI.Sprite.fromFrame("button/signal_1.png");iconWifi.anchor.set(0,1);iconWifi.position.set(20,
150);iconWifi.displayGroup=MyPixi.gameRootLayer;this.addChild(iconWifi);this.iconWifi=iconWifi;this.initButtons();this.refreshView()};
GameTopBar.prototype.initButtons=function(){var thiz=this;var onButtonDown=function(){cc.log("GameTopBar: click back btn");if(thiz.listener.backButtonClickHandler)thiz.listener.backButtonClickHandler()};var button=MyHelper.createButton("button/btn_back.png",true,onButtonDown);this.backBtn=button;this.addChild(button);var clickHandler=function(){if(thiz.onSettingButtonHandler)thiz.onSettingButtonHandler()};this.settingBt=MyHelper.createButton("button/btn_caidat.png",true,clickHandler);this.settingBt.position.set(cc.Global.GameView.width-
50,50);this.addChild(this.settingBt);this.pingTexture=[PIXI.Texture.fromFrame("button/signal_0.png"),PIXI.Texture.fromFrame("button/signal_1.png"),PIXI.Texture.fromFrame("button/signal_2.png"),PIXI.Texture.fromFrame("button/signal_3.png")];if(cc.Global.gameId===Constant.GAME_ID.CHAN){var onChickenDown=function(){if(thiz.chickenHandler)thiz.chickenHandler()};var chickenBt=MyHelper.createButton("button/res_ga_off.png",true,onChickenDown);this.addChild(chickenBt);this.chickenBt=chickenBt;this.chickenBt.position.set(cc.Global.GameView.width-
150,40);this.gaMoney=cc.LabelTTF("0",cc.res.font.Arial,21,null,"white");this.gaMoney.anchor.set(.5);this.gaMoney.position.set(this.chickenBt.x,this.chickenBt.y+45);this.gaMoney.displayGroup=this.chickenBt.displayGroup;this.addChild(this.gaMoney)}};
GameTopBar.prototype.notifiPing=function(command,data){if(!this.iconWifi)return;var pingNum=data.latency;if(pingNum<100)this.iconWifi.texture=this.pingTexture[0];else if(pingNum<200)this.iconWifi.texture=this.pingTexture[1];else if(pingNum<300)this.iconWifi.texture=this.pingTexture[2];else this.iconWifi.texture=this.pingTexture[3]};GameTopBar.prototype.onSettingButtonHandler=function(){MH.openSetting(this.displayAutoReady)};
GameTopBar.prototype.refreshView=function(){var roomID=this._roomID;var sid=HostConfig.currentServer.id-1;var str="ABCDEFGHIJKLMNOUPQRS";var roomName="B\u00e0n: "+roomID+str[sid];this.roomLbl.text=roomName;var cuoc="C\u01b0\u1ee3c: "+cc.Global.NumberFormat2(this.data.b);this.cuocLbl.text=cuoc;if(cc.Global.gameId==Constant.GAME_ID.CHAN){this.roomLbl.text=roomName+", "+cuoc;var times=this.data.tft/1E3;var is411=this.data.gM==GAME_MODE.IS_411;var u=is411?"4-11":"\u00d9 t\u1ef1 do";this.uLbl.text=u+", "+
times+" s";this.updateChicken()}};GameTopBar.prototype.chickenHandler=function(){};GameTopBar.prototype.updateChicken=function(){if(cc.Global.gameId!=Constant.GAME_ID.CHAN)return;var isGa=this.data.cKM===GA_MODE.GA;this.isGa=isGa;if(!this.data.tCkP)this.data.tCkP=0;if(isGa){this.gaMoney.text=cc.Global.NumberFormat1(this.data.tCkP*this.data.b);this.chickenBt.texture=PIXI.Texture.fromFrame("button/res_ga_on.png")}else{this.gaMoney.text="";this.chickenBt.texture=PIXI.Texture.fromFrame("button/res_ga_off.png")}};function Main(gameID){if(hiepnh.isUndefined(gameID))gameID=-1;this.gameId=gameID;this.app=new PIXI.Application(1280,720,{view:mainCanvas,backgroundColor:0,antialias:false,transparent:true,resolution:1});var zorder=0;this.app.stage.displayList=new PIXI.DisplayList;MyPixi.gameRootLayer=new PIXI.DisplayGroup(zorder,function(sprite){});zorder++;MyPixi.gamePlayerLayer=new PIXI.DisplayGroup(zorder,function(sprite){});zorder++;MyPixi.gameContainerLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixi.cardLayer=
new PIXI.DisplayGroup(zorder,function(sprite){if(sprite._selected)sprite.zOrder=-((cc.convertToWorldSpace(sprite).y+Card.SELECT_MOVE_DISTANCE)*1280+sprite.x);else sprite.zOrder=-(cc.convertToWorldSpace(sprite).y*1280+sprite.x)});zorder++;MyPixi.cardDragLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixi.chipLayer=new PIXI.DisplayGroup(zorder,function(sprite){sprite.zOrder=sprite.x});zorder++;MyPixi.animationLayer=new PIXI.DisplayGroup(zorder,false);zorder++;MyPixi.noticeLayer=new PIXI.DisplayGroup(zorder,
false);zorder++;MyPixi.popupLayer=new PIXI.DisplayGroup(zorder,false);MyPixi.topLayer=new PIXI.DisplayGroup(zorder,false);var gameContainer=new PIXI.Container;var popupContainer=new PIXI.Container;MyPixi.gameScale=1;gameContainer.scale.set(MyPixi.gameScale,MyPixi.gameScale);popupContainer.scale.set(MyPixi.gameScale,MyPixi.gameScale);var x=(1-MyPixi.gameScale)*this.app.renderer.width/2;cc.log("-------x "+x);gameContainer.position.x=x;popupContainer.position.x=x;this.app.stage.addChild(gameContainer);
this.app.stage.addChild(popupContainer);MyPixi.rendererGame=this.app.renderer;MyPixi.stageGame=this.app.stage;MyPixi.gameContainer=gameContainer;MyPixi.popupContainer=popupContainer;MyPixi.app=this.app;MessageNode.getInstance().show("\u0110ang v\u00e0o game");if(!LobbyClient.getInstance().loadResource){cc.log("-------loading resouce because loadfail startgame");this.loadSpriteSheet()}else{cc.log("-------loading resouce ignore aready load");this.spriteSheetLoaded()}}Main.MIN_SCROLL_SPEED=5;
Main.MAX_SCROLL_SPEED=15;Main.SCROLL_ACCELERATION=.005;Main.prototype.update=function(){var _now=(new Date).getTime();var dt=(_now-this.lastUpdate)/1E3;this.lastUpdate=_now;if(MyPixi.isDestroy)return;this.updateGame(dt);requestAnimationFrame(this.update.bind(this))};Main.prototype.updateGame=function(dt){if(MyPixi.isDestroy)return;if(this.app&&this.app.renderer){TWEEN.update();this.app.renderer.render(this.app.stage);PIXI.timerManager.update(dt);PIXI.actionManager.update()}};
Main.prototype.loadSpriteSheet=function(){var loader=new PIXI.loaders.Loader;for(var i=0;i<LIST_RESOURCE_FILE.length;i++)loader.add(LIST_RESOURCE_FILE[i]);loader.once("complete",this.spriteSheetLoaded.bind(this));loader.load();var loaderSpine=new PIXI.loaders.Loader;for(var i=0;i<LIST_RESOURCE_SPIN_FILE.length;i++)loaderSpine.add(LIST_RESOURCE_SPIN_FILE[i]);loaderSpine.once("complete",onLoaded);loaderSpine.load()};Main.prototype.onLoaded=function(loader,resources){MyPixi.loaderSpine=loader};
Main.prototype.spriteSheetLoaded=function(){MessageNode.getInstance().hide();MyPixi.isDestroy=false;this.lastUpdate=(new Date).getTime();var thiz=this;this.gameFactory=new GameFactory(this.app,this.gameId);var smoothie=new Smoothie({engine:PIXI,renderer:MyPixi.rendererGame,root:MyPixi.stageGame,update:this.updateSmothie.bind(this),interpolate:false});smoothie.start();var updateFunc=function(){thiz.updateSmothie()};hiepnh.hotfixFunction(updateFunc)};
Main.prototype.updateSmothie=function(){var _now=(new Date).getTime();var dt=(_now-this.lastUpdate)/1E3;this.lastUpdate=_now;if(MyPixi.isDestroy)return;this.updateGame(dt)};function GameFactory(app,gameId){this.gameLayer=null;switch(gameId){case Constant.GAME_ID.XOCDIA:this.gameLayer=new GameXocDia(cc.Global.dataGame);break;case Constant.GAME_ID.PHOM:this.gameLayer=new GamePhom(cc.Global.dataGame);break;case Constant.GAME_ID.MAUBINH:this.gameLayer=new GameMauBinh(cc.Global.dataGame);break;case Constant.GAME_ID.TLMN:this.gameLayer=new GameTLMN(cc.Global.dataGame);break;case Constant.GAME_ID.SAM:this.gameLayer=new GameSam(cc.Global.dataGame);break;case Constant.GAME_ID.LIENG:this.gameLayer=
new GameLieng(cc.Global.dataGame);break;case Constant.GAME_ID.XITO:this.gameLayer=new GameXiTo(cc.Global.dataGame);break;case Constant.GAME_ID.POKER:this.gameLayer=new GamePoker(cc.Global.dataGame);break;case Constant.GAME_ID.BACAY:this.gameLayer=new GameBaCay(cc.Global.dataGame);break;case Constant.GAME_ID.CHAN:this.gameLayer=new GameChan(cc.Global.dataGame);break}if(this.gameLayer)MyPixi.gameContainer.addChild(this.gameLayer)}
function SlotFactory(app,gameId){var data={};this.gameLayer=null;switch(gameId){case SLOT_GAME_MINI.TAM_GIOI:this.gameLayer=new TamGioi(data);break;case SLOT_GAME_MINI.KIM_CUONG:this.gameLayer=new KimCuong(data);break;case SLOT_GAME_MINI.SPARTA:this.gameLayer=new Sparta(data);break;case SLOT_GAME_MINI.DAOCA:this.gameLayer=new Daoca(data);break;case SLOT_GAME_MINI.THAN_DEN:this.gameLayer=new ThanDen(data);break}if(this.gameLayer)MyPixiSlot.gameContainer.addChild(this.gameLayer)};function GameScene(dataGame){cc.log("initgame with data GameScene "+JSON.stringify(dataGame));PIXI.Container.call(this);this.animation=[];this.position.x=0;this.position.y=0;this.data=dataGame;this.type="GameScene";this.meGotPunish=false;this.isOwnerMe=false;this.ideGameNumber=0;LobbyClient.getInstance().addListener(kCMD.CHAT,this.onRecvChatMessage,this);LobbyClient.getInstance().addListener(kCMD.DESTROY_GAME,this.onRecvDestroyGame,this);LobbyClient.getInstance().addListener(kCMD.RECONNECT_INGAME,
this.onRecconnectGame,this);this.initGameScene();this.chatLayer=new chatLayer;this.chatLayer.listener=this}GameScene.prototype=Object.create(PIXI.Container.prototype);GameScene.CONSTANT_VALUE=.064;
GameScene.prototype.showInviteDialog=function(listUser){MH.invite(listUser,function(userSelected){console.log(userSelected);if(userSelected&&userSelected.length>0){var arrName=[];for(var i=0;i<userSelected.length;i++)arrName.push(userSelected[i].u);var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":Constant.CMD_RESULT.SEND_INVITE,"us":arrName,"rid":LobbyClient.getInstance().getCurrentRoomId()}];cc.log("invite "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}})};
GameScene.prototype.initGameScene=function(){var displayAutoReady=false;var gameId=cc.Global.gameId;switch(gameId){case Constant.GAME_ID.TLMN:displayAutoReady=true;break;case Constant.GAME_ID.SAM:displayAutoReady=true;break;case Constant.GAME_ID.PHOM:displayAutoReady=true;break}this.addBg();this.hudLayer=new GameTopBar(this,displayAutoReady);MyPixi.gameContainer.addChild(this.hudLayer);LobbyClient.getInstance().addListener("ping",this.hudLayer.notifiPing,this)};
GameScene.prototype.runAction=function(target,action){var animation=PIXI.actionManager.runAction(target,action);this.animation.push(animation);return animation};GameScene.prototype.stopAction=function(action){if(action)if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>0;i--)if(this.animation[i]==action){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1);action=null;break}};
GameScene.prototype.stopAllActions=function(){if(this.animation&&this.animation.length)for(var i=this.animation.length-1;i>=0;i--){PIXI.actionManager.cancelAction(this.animation[i]);this.animation.splice(i,1)}};
GameScene.prototype.addBg=function(){var sprite;if(cc.Global.gameId===Constant.GAME_ID.CHAN)sprite=PIXI.Sprite.fromImage("res/bg/bg_chan.png");else sprite=PIXI.Sprite.fromImage("res/bg/bg_game.jpg");sprite.anchor.set(.5,.5);sprite.x=MyPixi.rendererGame.width/2;sprite.y=MyPixi.rendererGame.height/2;sprite.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(sprite);if(cc.Global.gameId===Constant.GAME_ID.LIENG||cc.Global.gameId===Constant.GAME_ID.XITO||cc.Global.gameId===Constant.GAME_ID.POKER){var table=
PIXI.Sprite.fromImage("res/bg/table.png");table.anchor.set(.5);table.x=MyPixi.rendererGame.width/2;table.y=MyPixi.rendererGame.height/2;table.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(table)}};GameScene.prototype.addLogo=function(pngName){var table=PIXI.Sprite.fromImage(pngName);table.anchor.set(.5);table.x=MyPixi.rendererGame.width/2;table.y=MyPixi.rendererGame.height/2;table.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(table)};
GameScene.prototype.onReconnectDone=function(data){};GameScene.prototype.onLoginDone=function(data){};GameScene.prototype.stopTurnTime=function(uid){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid===uid){this.allSlot[i].stopTimeRemain();break}};GameScene.prototype.stopTurnTimeAll=function(){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].stopTimeRemain()};GameScene.prototype.resetStateAllPlayer=function(){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].stopTimeRemain()};
GameScene.prototype.stopAllSlotTimeTurn=function(){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].stopTimeRemain()};GameScene.prototype.backButtonClickHandler=function(){};
GameScene.prototype.updateOwner=function(playerData){if(!playerData||!playerData.uid)return;var isShowKick=false;if(this.data.gS<GAME_STATE.PLAYING&&PlayerMe.uid===playerData.uid)isShowKick=true;for(var i=0;i<this.allSlot.length;i++){if(!this.allSlot[i])continue;if(cc.Global.gameId===Constant.GAME_ID.XOCDIA||cc.Global.gameId===Constant.GAME_ID.CHAN)isShowKick=false;this.allSlot[i].showKick(isShowKick);if(this.allSlot[i].uid===playerData.uid){this.allSlot[i].setMasterRoom(true);if(PlayerMe.uid===playerData.uid)this.allSlot[i].showKick(false);
cc.log("master la "+this.allSlot[i].dn)}else this.allSlot[i].setMasterRoom(false)}if(PlayerMe.uid==playerData.uid)this.isOwnerMe=true;else this.isOwnerMe=false};GameScene.prototype.setStatePlayerLieng=function(uid,state){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].setStateLieng(state);return}};GameScene.prototype.setStatePlayerGameTo=function(uid,state){this.setStatePlayerLieng(uid,state)};
GameScene.prototype.setStatePlayerBinh=function(uid,state){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].setStateBinhResult(state);return}};GameScene.prototype.setStatePlayer=function(uid,state){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].setState(state);return}};
GameScene.prototype.setStatePlayerChan=function(uid,state){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].setStateChan(state);return}};GameScene.prototype.clearStatePlayer=function(){for(var i=0;i<this.allSlot.length;i++)if(cc.Global.gameId==Constant.GAME_ID.CHAN)this.allSlot[i].setStateChan(state_player.NOTHING);else this.allSlot[i].setState(state_player.NOTHING)};GameScene.prototype.startGame=function(){this.gameState=GAME_STATE.PLAYING;for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].setState(state_player.NOTHING)};
GameScene.prototype.updateGold=function(username,gold){var goldNumber=gold;if(typeof gold==="string")goldNumber=parseInt(gold);for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].username==username){this.allSlot[i].setGold(goldNumber);return}};
GameScene.prototype.getSlotBeforeByIndexId=function(indexId){var slotKq=null;var slot=this.getSlotByIndex(indexId);if(!slot)return null;var indexTurn=slot.index;if(indexTurn===0){indexTurn=4;cc.log("aaaa testtt");while(!slotKq&&indexTurn>0){indexTurn--;slotKq=this.getSlotByIndex(indexTurn)}}else{indexTurn-=1;slotKq=this.getSlotByIndex(indexTurn)}return slotKq};GameScene.prototype.getIdRoomMaster=function(){var ps=this.data.ps;for(var i=0;i<ps.length;i++){var value=ps[i];if(value.C)return i}return-1};
GameScene.prototype.getDataPlayerByUid=function(uid){var ps=this.data.ps;for(var i=0;i<ps.length;i++){var value=ps[i];if(value.uid===uid)return value}return null};
GameScene.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){var listPlayer=[];var listChauRia=[];var totalPlayer=0;var isShowKick=false;cc.log("processPlayerPosition "+gameState);if(gameState<GAME_STATE.PLAYING||gameState>GAME_STATE.SHOW_KQ){listPlayer=players;totalPlayer=players.length}else for(var i=0;i<players.length;i++){var p=players[i];if(p.pi){totalPlayer++;listPlayer.push(p);cc.log("player "+p.dn)}else{listChauRia.push(p);cc.log("chau ria "+p.dn)}}if(listPlayer&&
listPlayer.length>0&&!arrangeChauRiaOnly){var userList=listPlayer;this.setPlayerWithPosition(userList);for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i]){this.allSlot[i].setEnable(false);this.allSlot[i].reset()}var ownerPlayer=null;for(var i=0;i<userList.length;i++){if(i>=this.allSlot.length)break;var idx=userList[i].sit;this.allSlot[idx].setDataPlayer(userList[i]);this.allSlot[idx].setEnable(true);this.allSlot[idx].setIndex(idx);this.allSlot[idx].setUid(userList[i].uid);this.allSlot[idx].setUsername(userList[i].dn);
this.allSlot[idx].setGold(Math.floor(userList[i].m));this.allSlot[idx].setAvatar(userList[i].a);if(gameState<4)this.allSlot[idx].setState(userList[i].r?state_player.READY:state_player.NOTHING);if(userList[i].ib)this.allSlot[idx].setState(state_player.BAO_SAM);this.allSlot[idx].stopTimeRemain();this.allSlot[idx].showChauRia(false);if(this.allSlot[idx].uid===PlayerMe.uid)this.allSlot[idx].isMe=true;else this.allSlot[idx].isMe=false;if(userList[i].C)ownerPlayer=userList[i]}this.updateOwner(ownerPlayer)}if(this.allSlot&&
this.allSlot.length)for(var j=0;j<this.allSlot.length;j++){var slot=this.allSlot[j];if(slot&&slot.index===-1&&slot.isChauRia()){slot.setEnable(false);slot.reset();slot.showChauRia(false)}}if(listChauRia&&listChauRia.length>0){var userList=listChauRia;var _index=0;for(var i=0;i<listChauRia.length;i++){var user=listChauRia[i];for(var j=_index;j<this.allSlot.length;j++){var slot=this.allSlot[j];if(slot&&slot.visible&&slot.index===-1&&!slot.isChauRia()){cc.log(slot.sitId+" \x3d\x3e "+userList[i].dn);
_index=j+1;slot.setDataPlayer(user);slot.setEnable(true);slot.setIndex(-1);slot.setUid(user.uid);slot.setUsername(user.dn);slot.setGold(Math.floor(user.m));slot.setAvatar(user.a);slot.setState(state_player.NOTHING);slot.stopTimeRemain();slot.showChauRia(true);if(slot.uid===PlayerMe.uid)slot.isMe=true;else slot.isMe=false;break}}}}};GameScene.prototype.getPlayerDataByUid=function(uid,player){for(var i=0;i<player.length;i++)if(player[i].uid==uid)return player[i];return null};
GameScene.prototype.getSlotByLoginName=function(loginName){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].loginName==loginName)return this.allSlot[i];return null};GameScene.prototype.getSlotByIndex=function(index){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].index==index&&this.allSlot[i].index>=0)return this.allSlot[i];return null};
GameScene.prototype.getSlotByUid=function(uid){if(!this.playerView||!this.playerView.length)return null;for(var i=0;i<this.playerView.length;i++){var slot=this.playerView[i];if(slot&&uid===slot.uid)return slot}return null};GameScene.prototype.getSlotMaster=function(){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].C)return this.allSlot[i];return null};GameScene.prototype.hideAllBoLuot=function(){for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].showBoLuot(false)};
GameScene.prototype.getMaxPlayer=function(){var maxPlayer=4;var gId=cc.Global.gameId;if(gId==Constant.GAME_ID.TLMN)maxPlayer=4;else if(gId==Constant.GAME_ID.SAM)maxPlayer=5;else if(gId==Constant.GAME_ID.MAUBINH)maxPlayer=4;else if(gId==Constant.GAME_ID.LIENG)maxPlayer=9;else if(gId==Constant.GAME_ID.XITO)maxPlayer=5;else if(gId==Constant.GAME_ID.POKER)maxPlayer=9;else if(gId==Constant.GAME_ID.PHOM)maxPlayer=4;else if(gId==Constant.GAME_ID.CHAN)maxPlayer=4;else if(gId==Constant.GAME_ID.BACAY)maxPlayer=
9;else if(gId==Constant.GAME_ID.XOCDIA)maxPlayer=9;return maxPlayer};GameScene.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[2];else if(totalPlayer===3)this.sitdownPlayerNext=[1,2];else if(totalPlayer===4)this.sitdownPlayerNext=[1,2,3];else if(totalPlayer===5)this.sitdownPlayerNext=[1,2,3,4];else{this.sitdownPlayerNext=[];for(var i=1;i<=totalPlayer-1;i++)this.sitdownPlayerNext.push(i)}return this.sitdownPlayerNext};
GameScene.prototype.setPlayerWithPosition=function(players){var idx=-1;for(var i=0;i<players.length;i++)if(players[i].uid==PlayerMe.uid){idx=players[i].sit;break}var allSlot=[];var maxPlayer=this.getMaxPlayer();for(var i=0;i<maxPlayer;i++)allSlot[i]=null;if(idx>=0){allSlot[idx]=this.playerView[0];cc.log("PLAYERRR ME ngoi` sitId \x3d 0 sit_server \x3d "+idx)}var totalPlayer=players.length;cc.log("totalPlayer "+totalPlayer);if(totalPlayer>=2){this.sitdownPlayerNext=this.getSitPosArr(totalPlayer);if(idx==
-1)this.sitdownPlayerNext.unshift(0);var thiz=this;var start=idx+1;for(var i=start;i<maxPlayer;i++)players.forEach(function(p,index){if(p.sit===i){var sitId=thiz.sitdownPlayerNext[0];allSlot[i]=thiz.playerView[sitId];cc.log("PLAYERRR "+p.dn+"  ngoi` sitId \x3d "+sitId+" sit_server \x3d "+i);thiz.sitdownPlayerNext.shift()}});start=idx-1;for(i=start;i>=0;i--)players.forEach(function(p,index){if(p.sit===i){var sitId=thiz.sitdownPlayerNext[thiz.sitdownPlayerNext.length-1];allSlot[i]=thiz.playerView[sitId];
cc.log("PLAYERRR "+p.dn+"  ngoi` sitId \x3d "+sitId+" sit_server \x3d "+i);thiz.sitdownPlayerNext.pop()}})}else{if(idx==-1){idx=0;if(cc.Global.gameId==Constant.GAME_ID.LIENG||cc.Global.gameId==Constant.GAME_ID.XITO||cc.Global.gameId==Constant.GAME_ID.BACAY||cc.Global.gameId==Constant.GAME_ID.POKER)idx=4}for(var i=0;i<this.playerView.length;i++){allSlot[idx]=this.playerView[i];idx++;if(idx>=this.playerView.length)idx=0}}var start=allSlot.length;for(var k=0;k<this.playerView.length;k++)if(!allSlot[k])for(var i=
this.playerView.length-1;i>=0;i--)if(allSlot.indexOf(this.playerView[i])===-1){allSlot[k]=this.playerView[i];break}this.allSlot=allSlot};GameScene.prototype.playSoundAction=function(nameSound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;cc.playSound(nameSound)};GameScene.prototype.resetNewGame=function(){};
GameScene.prototype.showStartIfCan=function(){var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){var allReady=true;var haveReady=false;this.data.ps.forEach(function(value,index){if(value.uid!==idMaster&&!value.r)allReady=false;if(value.uid!==idMaster&&value.r)haveReady=true});if(haveReady)this.showReady(true)}};
GameScene.prototype.getNumberPlayerNotReadyIgnoreMaster=function(){var players=this.data.ps;var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;var num=0;var idMaster=this.getIdRoomMaster();for(var i=0;i<players.length;i++)if(players[i].uid!==this.data.ps[idMaster].uid)if(!players[i].r)num++;return num};GameScene.prototype.showReadyIfCan=function(){};GameScene.prototype.showReady=function(visible){};GameScene.prototype.hideStartAndReady=function(hide){};
GameScene.prototype.updateRealMoneyPlayer=function(data){if(!data)return;var self=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.rM=data.m;break}}};GameScene.prototype.updateMoneyPlayer=function(data){if(!data)return;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid)if(data.m){el.m=data.m;break}}};GameScene.prototype.quitRoom=function(isIdeKick){LobbyClient.getInstance().quitRoom(isIdeKick)};
GameScene.prototype.onUserInOut=function(dataObj){var newPlayer=null;var isJoin=true;var isPlayingPlayerQuit=false;if(dataObj[1].t==1){newPlayer=dataObj[1].p;newPlayer["r"]=false;newPlayer["pS"]=0;newPlayer["pi"]=false;newPlayer["rmC"]=0;var length=this.data.ps.length;var isUpdate=false;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===newPlayer.uid){el=newPlayer;isUpdate=true;break}}if(!isUpdate)this.data.ps.push(newPlayer)}else if(dataObj[1].t==2){cc.log("out room"+dataObj[1].p.uid+" "+
dataObj[1].p.dn);newPlayer=dataObj[1].p;isJoin=false;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.pi&&el.uid===dataObj[1].p.uid)isPlayingPlayerQuit=true;if(el.uid===dataObj[1].p.uid){this.data.ps.splice(j,1);cc.log("size new players "+this.data.ps.length);break}}}if(!isPlayingPlayerQuit&&(this.gameState===4||this.gameState===5))this.arrangePlayerInGame(true);else this.arrangePlayerInGame();if(this.data.ps.length===1)this.hideStartAndReady(false)};
GameScene.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){};GameScene.prototype.onRecvChatMessage=function(cmd,dataObj){var mgs=dataObj[1].mgs;var uid=dataObj[1].uid;var slot=this.getSlotByUid(uid);if(slot)if(mgs.indexOf("e_")!=-1&&mgs.length>=3&&mgs.length<=4)slot.showEmoticon(mgs);else{this.showMsgInSlot(slot.uid,mgs);this.chatLayer.receiveMessage(mgs,slot.username)}};
GameScene.prototype.onRecvDestroyGame=function(cmd,dataObj){cc.log("onRecvDestroyGame "+JSON.stringify(dataObj));LobbyClient.getInstance().removeListener(this);LobbyClient.getInstance().onUpdateMoney();this.stopAllActions();if(this.onDestroyGame)this.onDestroyGame();var allAction=PIXI.actionManager.actions;if(allAction)for(var key in allAction)PIXI.actionManager.cancelAction(allAction[key]);var timersAction=PIXI.timerManager.timers;if(timersAction&&timersAction.length)for(var i=0;i<timersAction.length;i++)PIXI.timerManager.removeTimer(timersAction[i])};
GameScene.prototype.onRecconnectGame=function(cmd,dataObj){cc.log("GameScene onRecconnectGame");this.stopAllActions();this.resetNewGame(true);this.updateGame(dataObj);this.recconnectGame()};GameScene.prototype.updateGame=function(data){};GameScene.prototype.recconnectGame=function(){};GameScene.prototype.showMsgInSlot=function(uid,mgs){var slot=this.getSlotByUid(uid);if(slot)this.showToast(mgs,cc.p(slot.x+slot.widthBG/2,slot.y),2)};
GameScene.prototype.onShowNotice=function(msg,timeShowInMilisec){if(hiepnh.isUndefined(timeShowInMilisec))timeShowInMilisec=2E3;MessageNode.getInstance().show(msg,timeShowInMilisec/1E3)};GameScene.prototype.showSystemNotice=function(msg,timeShowInSec){if(!timeShowInSec)timeShowInSec=2;if(cc.Global.gameId==Constant.GAME_ID.CHAN)this.showToast(msg,cc.p(cc.Global.designGame.width/2,320),2);else MessageNode.getInstance().show(msg,timeShowInSec)};
GameScene.prototype.showToast=function(msg,pos,timeShow){if(!timeShow)timeShow=2;var lb=cc.LabelTTF(msg,cc.res.font.Arial,25,null,"white");var sizeContent=cc.size(lb.width,lb.height);var padding=[12,12,12,12];var bg=new PIXI.mesh.NineSlicePlane(PIXI.Texture.fromFrame("bubble_chat.png"),padding[0],padding[1],padding[2],padding[3]);bg.width=sizeContent.width+20;bg.height=sizeContent.height+30;bg.alpha=.85;bg.displayGroup=MyPixi.topLayer;MyPixi.gameContainer.addChild(bg);lb.anchor.set(.5,.5);lb.position.set(bg.width/
2,bg.height/2);bg.addChild(lb);var w=cc.Global.GameView.width;bg.position.set(pos.x-bg.width*.5,pos.y-bg.height/2);var cb=cc.callFunc(function(){if(bg&&bg.parent)bg.parent.removeChild(bg)});var seq=cc.sequence(cc.delayTime(timeShow),cb);PIXI.actionManager.runAction(bg,seq)};var MAX_SLOT=9;var CMD_XOC_DIA=CMD_XOC_DIA||{};CMD_XOC_DIA.CHIABAI=850;CMD_XOC_DIA.CHANGE_TURN=851;CMD_XOC_DIA.BOC_BAI=852;CMD_XOC_DIA.AN_BAI=853;CMD_XOC_DIA.HA_PHOM=854;CMD_XOC_DIA.END_GAME=855;CMD_XOC_DIA.DEAL_CARD=857;CMD_XOC_DIA.U=858;CMD_XOC_DIA.GUI_BAI=856;var XOCDIA_PLAYER_STATE={NONE:0,WAIT_PLAYER:1,WAIT_PLAYER_READY:2,PREPARE_START:3,BETTING:4,MASTER_BUY_OR_SELL_GATE:5,BUY_GATE:6,OPEN_BAT:7,END_GAME:8};
var XOCDIA_CMD={CMD_BETTING:900,CMD_BETTING_UPDATE:901,CMD_XIN_CAI:902,CMD_BAN_CUA:903,CMD_BEGIN_XOC:904,CMD_USER_BUY_GATE:905,CMD_BEGIN_SELL_OR_DUOI_GATE:906,CMD_END_GAME:907,CMD_DUOI_CUA:908,CMD_DAT_LAI:909,CMD_HUY_CAI:910,CMD_GET_MAX_BUY_GATE:911,CMD_CAN_TAT:912};var XD_ENTRY_ID={FOUR_WHITE:0,THREE_WHITE:1,EVENT:2,THREE_RED:3,FOUR_RED:4,ODD:5};var GATE_NAME=["","","Ch\u1eb5n","","","L\u1ebb"];
function GameXocDia(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GameXocDia";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.initGameUI()}GameXocDia.prototype=Object.create(GameScene.prototype);GameXocDia.CONSTANT_VALUE=.064;GameXocDia.prototype.onEnter=function(){};
GameXocDia.prototype.initGameUI=function(){this.animXocDia=new AnimationXocDia;this.animXocDia.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(this.animXocDia);this.khungStatistic=new KhungStatistic;this.khungStatistic.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(this.khungStatistic);this.xocdiaContainer=new XocDiaCountDown;this.xocdiaContainer.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(this.xocdiaContainer);var size=cc.Global.GameView;var gateChan=
new XocDiaGate(cc.p(size.width/2-220,size.height/2-90),cc.size(260,160),"Ch\u1eb5n");gateChan.lblName.style.fill="#FFFF00";MyPixi.gameContainer.addChild(gateChan);var gateLe=new XocDiaGate(cc.p(size.width/2+220,size.height/2-90),cc.size(260,160),"L\u1ebb");MyPixi.gameContainer.addChild(gateLe);var gate4Do=new XocDiaGate(cc.p(size.width/2-270,size.height/2+72),cc.size(160,130),"(1x15)");MyPixi.gameContainer.addChild(gate4Do);gate4Do.initReadCoin(4);var gate4Den=new XocDiaGate(cc.p(size.width/2-90,
size.height/2+72),cc.size(160,130),"(1x15)");MyPixi.gameContainer.addChild(gate4Den);gate4Den.initReadCoin(0);var gate3Do=new XocDiaGate(cc.p(size.width/2+90,size.height/2+72),cc.size(160,130),"(1x3)");MyPixi.gameContainer.addChild(gate3Do);gate3Do.initReadCoin(3);var gate3Den=new XocDiaGate(cc.p(size.width/2+270,size.height/2+72),cc.size(160,130),"(1x3)");MyPixi.gameContainer.addChild(gate3Den);gate3Den.initReadCoin(1);var thiz=this;gateChan.onGateHandler=function(){if(thiz.onBettingEvent)thiz.onBettingEvent()};
gateLe.onGateHandler=function(){if(thiz.onBettingOdd)thiz.onBettingOdd()};gate4Do.onGateHandler=function(){if(thiz.onBettingFourRed)thiz.onBettingFourRed()};gate4Den.onGateHandler=function(){if(thiz.onBettingFourWhite)thiz.onBettingFourWhite()};gate3Do.onGateHandler=function(){if(thiz.onBetting3Red)thiz.onBetting3Red()};gate3Den.onGateHandler=function(){if(thiz.onBetting3White)thiz.onBetting3White()};this.gateContainer=[gate4Den,gate3Den,gateChan,gate3Do,gate4Do,gateLe];for(var i in this.gateContainer){this.gateContainer[i].setListener(this,
i);this.gateContainer[i].displayGroup=MyPixi.animationLayer}this.init();this.initGame()};GameXocDia.prototype.updatePlayerNotSit=function(){var totalPlayer=this.data.ps.length;var num=totalPlayer>MAX_SLOT?totalPlayer-MAX_SLOT:0;this.lblTotalPlayer.text=num.toString();this.lblTotalPlayer.x=-this.lblTotalPlayer.width/2};
GameXocDia.prototype.init=function(){this.totalGamePlay=0;this.bettingTime=false;this.gameState=0;this.banker_user_Id=null;this.sellingGate=-1;this.lastBet=0;this.lastGateBet=-1;this.myBetting=[0,0,0,0,0,0];this.tableResult=[];var thiz=this;this.ets=[0,0,0,0,0,0];thiz.saveBetArr=[0,0,0,0,0,0];thiz.currentBetArr=[0,0,0,0,0,0];thiz.showResultTotalTime=0;thiz.showResultBegin=0;thiz.dataResult="";thiz.isShowingResult=false;thiz.registerQuit=false;this.xepxong=false;this.currentTurn=0;this.ideGameNumber=
0;this.IDE_GAME_KICK=6};GameXocDia.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.tfeg=data.tfeg/1E3;this.timeBaoSam=data.tfbs/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initButton();this.initPlayer();this.updateGame(this.data)};
GameXocDia.prototype.initPlayer=function(){var center=cc.Global.GameView;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(center.width/2-290,center.height/2+180);var player1=new GamePlayer;player1.sitId=1;player1.position.set(center.width/2+500,center.height/2+40);var player2=new GamePlayer;player2.sitId=2;player2.position.set(center.width/2+500,center.height/2-160);var player3=new GamePlayer;player3.sitId=3;player3.position.set(center.width/2+250,center.height/2-350);var player4=
new GamePlayer;player4.sitId=4;player4.position.set(center.width/2+70,center.height/2-350);var player5=new GamePlayer;player5.sitId=5;player5.position.set(center.width/2-200,center.height/2-350);var player6=new GamePlayer;player6.sitId=6;player6.position.set(center.width/2-360,center.height/2-350);var player7=new GamePlayer;player7.sitId=7;player7.position.set(center.width/2-620,center.height/2-160);var player8=new GamePlayer;player8.sitId=8;player8.position.set(center.width/2-620,center.height/2+
40);this.playerView=[playerMe,player1,player2,player3,player4,player5,player6,player7,player8];for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GameXocDia.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1){var totalPlayer=20+Math.floor(Math.random()*8);cc.log("totalPlayer "+totalPlayer);for(var i=1;i<=totalPlayer;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+i;newPlayer.C=false;
newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}}this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);this.updatePlayerNotSit()};
GameXocDia.prototype.updateGame=function(data){var thiz=this;var registerBanker=data.rB;var banker_user_Id=data.B;var tr=data.tr;this.tableResult=tr;if(data.ets&&data.ets.length)this.ets=data.ets;this.khungStatistic.updateStatistic(this.tableResult);if(banker_user_Id){this.banker_user_Id=banker_user_Id;if(banker_user_Id===PlayerMe.uid){this.btnHuyCai.visible=true;this.btnXinCai.visible=false}else{this.btnHuyCai.visible=false;this.btnXinCai.visible=false}}else{this.btnHuyCai.visible=false;this.btnXinCai.visible=
true}if(registerBanker){this.registerBanker=registerBanker;this.btnHuyCai.visible=false;this.btnXinCai.visible=false;if(registerBanker===PlayerMe.uid)this.btnHuyCai.visible=true}this.meSitDown=true;this.maxUser=data.Mu;this.betValue=data.b;this.coinsBet=data.coins;this.lastBet=this.coinsBet[0];for(var i in this.bettingContainer){var bettingItem=this.bettingContainer[i];var bet=this.coinsBet[i];bettingItem.setMoney(bet)}var gameState=data.gS;this.gameState=gameState;this.bettingTime=true;if(gameState<=
3){this.bettingTime=false;this.onShowNotice("V\u00e1n ch\u01a1i ch\u01b0a b\u1eaft \u0111\u1ea7u",2E3)}else if(gameState===4){this.bettingTime=true;this.onShowNotice("\u0110ang \u0111\u1eb7t c\u01b0\u1ee3c",2E3)}else if(gameState===5)this.onShowNotice("Th\u1eddi gian nh\u00e0 c\u00e1i b\u00e1n c\u1eeda \u0111u\u1ed5i c\u1eeda",2E3);else if(gameState===6)this.onShowNotice("Th\u1eddi gian mua c\u1eeda",2E3);var thiz=this;var remainTime=data.rmT/1E3;if(gameState===4||gameState===5)thiz.onCountDownBetting(remainTime);
this.players=data.ps;this.players.forEach(function(value,index){value.C=false;if(thiz.banker_user_Id&&thiz.banker_user_Id===value.uid){value.C=true;thiz.idRoomMaster=index;cc.log("idRoomMaster "+thiz.idRoomMaster)}});this.arrangePlayerInGame();this.onReconnect(data);if(data.re)this.isPlaying=true;else this.currentBet=0};GameXocDia.prototype.onReconnect=function(data){this.onBettingUpdate(data,false,true)};
GameXocDia.prototype.handlePendingBack=function(){this.isPlaying=false;this.isShowingResult=false;if(this.registerQuit){this.quitRoom();return false}this.resetNewGame();if(this.ideGameNumber>=this.IDE_GAME_KICK){this.ideGameNumber++;this.quitRoom(true);this.idleKick=true;return false}return true};
GameXocDia.prototype.resetNewGame=function(igNoreCheckReady){this.bettingTime=false;this.gameState=0;if(this.ets&&this.ets.length)this.ets.length=0;this.sellingGate=-1;if(this.players)this.players.forEach(function(p,i){p.pi=false;if(p.betArr&&p.betArr.length)p.betArr.length=0;p.betArr=[0,0,0,0,0,0]});for(var i=0;i<this.allSlot.length;i++)this.allSlot[i].resetEndGame();this.gateContainer.forEach(function(gate,index){if(gate)gate.onReset()});this.arrangePlayerInGame()};
GameXocDia.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);
else if(cmd==XOCDIA_CMD.CMD_BEGIN_XOC)this.onBeginXoc(dataObj);else if(cmd===XOCDIA_CMD.CMD_BETTING)this.onBetting(dataObj[1]);else if(cmd===XOCDIA_CMD.CMD_BETTING_UPDATE)this.onBettingUpdate(dataObj[1]);else if(cmd==XOCDIA_CMD.CMD_USER_BUY_GATE)this.onBuyGateResponse(dataObj[1]);else if(cmd==XOCDIA_CMD.CMD_BEGIN_SELL_OR_DUOI_GATE)this.onSellOrDuoiGateResponse(dataObj[1]);else if(cmd==XOCDIA_CMD.CMD_END_GAME){this.btnCanTat.visible=false;this.onEndGame(dataObj[1])}else if(cmd==XOCDIA_CMD.CMD_XIN_CAI)this.onLamCaiResponse(dataObj[1]);
else if(cmd==XOCDIA_CMD.CMD_BAN_CUA)this.onBanCua(dataObj);else if(cmd==XOCDIA_CMD.CMD_HUY_CAI)this.onHuyCaiResponse(dataObj[1]);else if(cmd==XOCDIA_CMD.CMD_GET_MAX_BUY_GATE){var thiz=this;var totalMoney=this.getMoneyPlayer(PlayerMe.uid);var maxBet=dataObj[1].v<totalMoney?dataObj[1].v:totalMoney;var stepB=[];var v=this.betValue;stepB.push(v);while(v<maxBet){v+=this.betValue;if(v<=maxBet)stepB.push(v);else stepB.push(maxBet)}MH.createTable({type:"inner",current:maxBet,min:this.betValue,max:maxBet,
step:stepB,create:function(data){var moneyBet=data.moneyBet;thiz.onBuyGate(moneyBet)}})}};
GameXocDia.prototype.onBanCua=function(dataObj){cc.log("nha cai ban cua "+dataObj[1].eid);if(this.banker_user_Id===PlayerMe.uid){this.onShowNotice("B\u00e1n c\u1eeda "+GATE_NAME[dataObj[1].eid],3E3);this.gateContainer[2].onShowSellGate(false);this.gateContainer[5].onShowSellGate(false);this.btnCanTat.visible=false}else{this.onShowNotice("Nh\u00e0 c\u00e1i b\u00e1n c\u1eeda "+GATE_NAME[dataObj[1].eid],3E3);this.sellingGate=dataObj[1].eid;this.gateContainer[dataObj[1].eid].onShowBuyGate(true)}this.xocdiaContainer.visible=
true;this.xocdiaContainer.showTimeCountDown(10)};
GameXocDia.prototype.onBeginXoc=function(dataObj){var banker_user_Id=dataObj[1].B;if(banker_user_Id)this.banker_user_Id=banker_user_Id;else this.banker_user_Id=null;this.registerBanker=null;this.btnHuyCai.visible=false;this.btnXinCai.visible=false;var thiz=this;this.players.forEach(function(value,index){value.C=false;if(thiz.banker_user_Id&&thiz.banker_user_Id===value.uid){value.C=true;thiz.idRoomMaster=index}});if(this.banker_user_Id&&this.banker_user_Id===PlayerMe.uid){this.btnHuyCai.visible=true;
this.btnXinCai.visible=false}if(!this.banker_user_Id){this.btnHuyCai.visible=false;this.btnXinCai.visible=true}this.arrangePlayerInGame();this.xocdia();var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===actor.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameXocDia.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};GameXocDia.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=dataObj[1].mgs;if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";MessageNode.getInstance().show(errorStr)};
GameXocDia.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GameXocDia.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(uid==PlayerMe.uid)this.showReady(false);if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING);var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);
this.showStartIfCan()}else this.showReadyIfCan()};GameXocDia.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameXocDia.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameXocDia.prototype.initButton=function(){var thiz=this;var inviteBt=MyHelper.createButton("moichoi.png",true,function(){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME,"channelPlugin",{"cmd":Constant.CMD_RESULT.LIST_INVITE,"rid":LobbyClient.getInstance().getCurrentRoomId()}];LobbyClient.getInstance().send(sendObj);LoadingDialog.getInstance().show("\u0110ang t\u1ea3i danh s\u00e1ch m\u1eddi")});inviteBt.anchor.set(.5,.5);inviteBt.position.set(cc.Global.GameView.width-140,50);MyPixi.gameContainer.addChild(inviteBt);
this.inviteBt=inviteBt;var nguoiChoiBt=MyHelper.createButton("btn_ngchoi.png",true,function(){thiz.onShowPlayerInRoom()});nguoiChoiBt.anchor.set(.5,.5);nguoiChoiBt.position.set(cc.Global.GameView.width-50,120);MyPixi.gameContainer.addChild(nguoiChoiBt);this.btnNguoiChoi=nguoiChoiBt;this.lblTotalPlayer=cc.LabelTTF("0",cc.res.font.Arial,16,null,"white");this.lblTotalPlayer.position.set(0,20);nguoiChoiBt.addChild(this.lblTotalPlayer);var datLaiBt=MyHelper.createButton("btn_button2.png",true,function(){thiz.onFastBetting()});
datLaiBt.anchor.set(.5,.5);datLaiBt.position.set(1E3,cc.Global.designGame.height-140);MyPixi.gameContainer.addChild(datLaiBt);MyHelper.addLblButton(datLaiBt,"\u0110\u1eb7t l\u1ea1i",16);this.btnDatLai=datLaiBt;var datX2Bt=MyHelper.createButton("btn_button2.png",true,function(){thiz.onFastBettingX2()});datX2Bt.anchor.set(.5,.5);datX2Bt.position.set(datLaiBt.x,datLaiBt.y+70);MyPixi.gameContainer.addChild(datX2Bt);MyHelper.addLblButton(datX2Bt,"\u0110\u1eb7t X2",16);this.btnDatX2=datX2Bt;var btnCanTat=
MyHelper.createButton("btn_button2.png",true,function(){thiz.onCanTat()});btnCanTat.anchor.set(.5,.5);btnCanTat.position.set(datLaiBt.x,datLaiBt.y);MyPixi.gameContainer.addChild(btnCanTat);MyHelper.addLblButton(btnCanTat,"C\u00e2n T\u1ea5t",16);this.btnCanTat=btnCanTat;btnCanTat.visible=false;var lamCaiBt=MyHelper.createButton("lamcai.png",true,function(){thiz.onXinCai()});lamCaiBt.anchor.set(.5,.5);lamCaiBt.position.set(cc.Global.GameView.width/2,150);MyPixi.gameContainer.addChild(lamCaiBt);this.btnXinCai=
lamCaiBt;var huyCaiBt=MyHelper.createButton("huycai.png",true,function(){thiz.onHuyCai()});huyCaiBt.anchor.set(.5,.5);huyCaiBt.position.set(cc.Global.GameView.width/2,150);huyCaiBt.visible=false;MyPixi.gameContainer.addChild(huyCaiBt);this.btnHuyCai=huyCaiBt;this.bettingContainer=[];var mToggle=new ToggleNodeGroup;mToggle.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(mToggle);this.mToggle=mToggle;var names=["button/coin5.png","button/coin2.png","button/coin1.png","button/coin4.png",
"button/coin3.png"];var s=cc.p(cc.Global.GameView.width/2-60,cc.Global.GameView.height-140);var dx=90;var pos=[cc.p(s.x-dx,s.y),cc.p(s.x,s.y),cc.p(s.x+dx,s.y),cc.p(s.x+dx*2,s.y),cc.p(s.x+dx*3,s.y)];for(var i=0;i<5;i++)(function(){var bettingItem=new BettingXocDiaToggleItem(names[i],"coin_select.png");bettingItem.position.set(pos[i].x,pos[i].y);bettingItem.setMoney(50);mToggle.addItem(bettingItem);bettingItem.onSelect=function(force){if(!force)thiz.lastBet=bettingItem.betting};thiz.bettingContainer.push(bettingItem)})();
this.mToggle.onEnter();this.mToggle.selectItem(0);if(TEST_MODE){var datCuaBt=MyHelper.createButton("button/btn_0.png",true,function(){cc.log("datCuaBt ");var data={"teb":500,"eid":2,"b":500,"cmd":900,"m":146012};data={"ps":[{"uid":PlayerMe.uid,"b":[{"eid":5,"v":0},{"eid":1,"v":0},{"eid":4,"v":0},{"eid":2,"v":2E3},{"eid":0,"v":0},{"eid":3,"v":0}],"dn":"zzzzzzzzzzzzzzz","m":144512}],"ets":[{"eid":5,"v":0},{"eid":2,"v":2E3}],"cmd":901};thiz.onBettingUpdate(data,true,false)});datCuaBt.position.set(cc.Global.GameView.width-
100,100);MyHelper.addLblButton(datCuaBt,"dat cua",16);MyPixi.gameContainer.addChild(datCuaBt);var dialogBuyGateBt=MyHelper.createButton("button/btn_0.png",true,function(){var maxMoney=1E6;var totalMoney=thiz.getMoneyPlayer(PlayerMe.uid)});dialogBuyGateBt.position.set(cc.Global.GameView.width-100,200);MyPixi.gameContainer.addChild(dialogBuyGateBt);MyHelper.addLblButton(dialogBuyGateBt,"buygate",16)}};GameXocDia.prototype.onLamCaiRequest=function(){MessageNode.getInstance().show("onLamCaiRequest")};
GameXocDia.prototype.isNhaCai=function(){var thiz=this;if(thiz.banker_user_Id&&thiz.banker_user_Id===PlayerMe.uid)return true;return false};GameXocDia.prototype.checkCanBet=function(){if(this.isNhaCai()){this.showSystemNotice("Nh\u00e0 c\u00e1i kh\u00f4ng th\u1ec3 \u0111\u1eb7t c\u01b0\u1ee3c",2);return false}if(!this.bettingTime){this.showSystemNotice("V\u00e1n ch\u01a1i ch\u01b0a b\u1eaft \u0111\u1ea7u",2);return false}return true};
GameXocDia.prototype.onBettingEvent=function(){if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.EVENT;this.onBettingGate()};GameXocDia.prototype.onBettingOdd=function(){if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.ODD;this.onBettingGate()};
GameXocDia.prototype.onBettingFourRed=function(){if(this.banker_user_Id===null){this.showSystemNotice("Ch\u1ec9 \u0111\u00e1nh \u0111\u01b0\u1ee3c c\u1eeda ch\u1eb5n v\u00e0 l\u1ebb khi kh\u00f4ng c\u00f3 nh\u00e0 c\u00e1i",2);return}if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.FOUR_RED;this.onBettingGate()};
GameXocDia.prototype.onBettingFourWhite=function(){if(this.banker_user_Id===null){this.showSystemNotice("Ch\u1ec9 \u0111\u00e1nh \u0111\u01b0\u1ee3c c\u1eeda ch\u1eb5n v\u00e0 l\u1ebb khi kh\u00f4ng c\u00f3 nh\u00e0 c\u00e1i",2);return}if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.FOUR_WHITE;this.onBettingGate()};
GameXocDia.prototype.onBetting3White=function(){if(this.banker_user_Id===null){this.showSystemNotice("Ch\u1ec9 \u0111\u00e1nh \u0111\u01b0\u1ee3c c\u1eeda ch\u1eb5n v\u00e0 l\u1ebb khi kh\u00f4ng c\u00f3 nh\u00e0 c\u00e1i",2);return}if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.THREE_WHITE;this.onBettingGate()};
GameXocDia.prototype.onBetting3Red=function(){if(this.banker_user_Id===null){this.showSystemNotice("Ch\u1ec9 \u0111\u00e1nh \u0111\u01b0\u1ee3c c\u1eeda ch\u1eb5n v\u00e0 l\u1ebb khi kh\u00f4ng c\u00f3 nh\u00e0 c\u00e1i",2);return}if(!this.checkCanBet())return;this.lastGateBet=XD_ENTRY_ID.THREE_RED;this.onBettingGate()};GameXocDia.prototype.getMoneyPlayer=function(uid){var thiz=this;var length=thiz.players.length;for(var j=0;j<length;j++){var el=thiz.players[j];if(el.uid===uid)return el.m}return-1};
GameXocDia.prototype.onBettingGate=function(betValue,gateBet){if(!betValue)betValue=0;if(!gateBet)gateBet=-1;if(betValue===0)betValue=this.lastBet;if(gateBet===-1)gateBet=this.lastGateBet;cc.log("onBettingGate "+betValue);if(this.getMoneyPlayer(PlayerMe.uid)<betValue){this.showSystemNotice("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 c\u01b0\u1ee3c",2);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_BETTING,
"v":betValue,"eid":gateBet}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};GameXocDia.prototype.onXinCai=function(){cc.log("onLamCai ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_XIN_CAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onHuyCai=function(){cc.log("onLamCai ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_HUY_CAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onSellGate=function(eid){cc.log("onSellGate ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_BAN_CUA,"eid":eid}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onBuyGate=function(moneyBuy){cc.log("onBuyGate "+moneyBuy);var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_USER_BUY_GATE,"v":moneyBuy}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onDuoiGate=function(eid){cc.log("onDuoiGate ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_DUOI_CUA,"eid":eid}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onCanTat=function(){cc.log("onCanTat ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_CAN_TAT}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.getMaxMoneyCanBuy=function(){cc.log("getMaxMoneyCanBuy ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_GET_MAX_BUY_GATE}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onFastBetting=function(){cc.log("onFastBetting ");var canbet=false;var arrayBet=[];for(var i=0;i<6;i++){var bet={};bet.eid=i;if(this.saveBetArr[i]>0)canbet=true;bet.v=this.saveBetArr[i];arrayBet.push(bet)}if(!canbet){this.showSystemNotice("V\u00e1n tr\u01b0\u1edbc b\u1ea1n kh\u00f4ng \u0111\u1eb7t c\u1eeda n\u00e0o",2);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_DAT_LAI,"b":arrayBet}];
LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXocDia.prototype.onFastBettingX2=function(){cc.log("onFastBettingX2 ");var canbet=false;var arrayBet=[];for(var i=0;i<6;i++){var bet={};bet.eid=i;if(this.saveBetArr[i]>0)canbet=true;bet.v=2*this.saveBetArr[i];arrayBet.push(bet)}if(!canbet){this.showSystemNotice("V\u00e1n tr\u01b0\u1edbc b\u1ea1n kh\u00f4ng \u0111\u1eb7t c\u1eeda n\u00e0o",2);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":XOCDIA_CMD.CMD_DAT_LAI,"b":arrayBet}];
LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};GameXocDia.prototype.onShowPlayerInRoom=function(){var arrPlayer=Utils.deepCoppyArray(this.data.ps);var lengthSlice=9;if(arrPlayer&&arrPlayer.length>lengthSlice){arrPlayer=arrPlayer.slice(lengthSlice);MH.viewPlayers(arrPlayer)}else{var dialog=new MessageOkDialog;dialog.setMessage("To\u00e0n b\u1ed9 ng\u01b0\u1eddi ch\u01a1i \u0111\u00e3 ng\u1ed3i tr\u00ean b\u00e0n r\u1ed3i");dialog.showWithAnimationScale()}};
GameXocDia.prototype.onLamCaiResponse=function(data){this.registerBanker=data.uid;if(data.uid===PlayerMe.uid)this.onShowNotice("B\u1ea1n \u0111\u00e3 \u0111\u0103ng k\u00fd l\u00e0m c\u00e1i. Vui l\u00f2ng \u0111\u1ee3i v\u00e1n sau",2E3);else this.onShowNotice(data.dn+" \u0111\u00e3 \u0111\u0103ng k\u00fd l\u00e0m c\u00e1i.",2E3);this.btnHuyCai.visible=false;this.btnXinCai.visible=false};
GameXocDia.prototype.onHuyCaiResponse=function(data){if(data.uid===PlayerMe.uid)this.onShowNotice("B\u1ea1n \u0111\u00e3 \u0111\u0103ng k\u00fd h\u1ee7y l\u00e0m c\u00e1i",2E3);else this.onShowNotice(data.dn+" \u0111\u00e3 \u0111\u0103ng k\u00fd h\u1ee7y l\u00e0m c\u00e1i",2E3);this.btnHuyCai.visible=false;this.btnXinCai.visible=false};
GameXocDia.prototype.getIdCoinImg=function(ratio){var id=ChipType.WHITE;if(ratio>=20)id=ChipType.RED;else if(ratio>=10)id=ChipType.VIOLET;else if(ratio>=4)id=ChipType.BLUE;else if(ratio>=2)id=ChipType.GREEN;else if(ratio>=1)id=ChipType.WHITE;return id};
GameXocDia.prototype.onBetting=function(data){var totalMoneyInGate=data.teb;var myMoney=data.m;var gateId=data.eid;if(this.myBetting[gateId])this.myBetting[gateId]+=data.b;else this.myBetting[gateId]=data.b;var isMyPlayer=true;var thiz=this;thiz.playSoundAction("nemxu");thiz.currentBetArr[data.eid]+=data.b;var myPlayer=thiz.getSlotByUid(PlayerMe.uid);var player=thiz.getDataPlayerByUid(PlayerMe.uid);if(!player.betArr)player.betArr=[0,0,0,0,0,0];player.betArr[gateId]+=data.b;cc.log("------------gateid "+
gateId);thiz.allSlot[0].setTotalGoldWithEffect(data.m);data.uid=PlayerMe.uid;thiz.updateMoneyPlayer(data);this.tossChip(myPlayer,gateId,data.b,isMyPlayer,true)};
GameXocDia.prototype.tossChip=function(slot,gateId,bet,isMyPlayer,animation){var typeChip=this.getIdCoinImg(bet/this.betValue);var pos;if(slot)pos=cc.p(slot.x+slot.width/2,slot.y+slot.height/2);else pos=cc.p(this.btnNguoiChoi.x,this.btnNguoiChoi.y);var animTime=this.gateContainer[gateId].chipList.addNewChip([typeChip],animation,pos,.3);this.gateContainer[gateId].updateMyMoneyDelay(animTime,bet,isMyPlayer)};
GameXocDia.prototype.onBettingUpdate=function(data,animation,isReconnect){if(animation===undefined)animation=true;var thiz=this;var isHaveMe=false;var ps=data.ps;for(var i=0;i<thiz.players.length;i++){var player=thiz.players[i];if(!player.betArr)player.betArr=[0,0,0,0,0,0];for(var j=0;j<ps.length;j++){var _ps=ps[j];if(_ps.uid===player.uid){var bArr=_ps.b;if(!bArr)continue;if(PlayerMe.uid===player.uid)isHaveMe=true;if(!isReconnect&&_ps.m===player.m)continue;player.m=_ps.m;var slot=this.getSlotByUid(player.uid);
if(slot)slot.setTotalGoldWithEffect(player.m);for(var k=0;k<bArr.length;k++){var isMyPlayer=false;var index=bArr[k].eid;var m=bArr[k].v;var gateId=index;if(PlayerMe.uid===player.uid){thiz.myBetting[gateId]=m;thiz.currentBetArr[gateId]=m;thiz.btnDatLai.visible=false;thiz.btnDatX2.visible=false;isMyPlayer=true}var oldM=player.betArr[index];if(oldM<m){var tossMoney=m-oldM;var slot=thiz.getSlotByUid(player.uid);var maxMoneyToss=thiz.betValue*20;if(tossMoney>maxMoneyToss){while(tossMoney>=maxMoneyToss){tossMoney-=
maxMoneyToss;this.tossChip(slot,gateId,maxMoneyToss,isMyPlayer,animation)}this.tossChip(slot,gateId,tossMoney,isMyPlayer,animation)}else this.tossChip(slot,gateId,tossMoney,isMyPlayer,animation)}player.betArr[index]=m}break}}}if(!isReconnect&&!isHaveMe)thiz.playSoundAction("nemxu");var _ets=data.ets;if(_ets&&_ets.length)for(var i in _ets){var eid=_ets[i].eid;var m=_ets[i].v;var oldM=thiz.ets[eid];if(oldM<m)thiz.ets[eid]=m}};
GameXocDia.prototype.getPlayerIndexByUid=function(uid){for(var idx in this.allSlot)if(this.allSlot[idx]===uid)return idx;return-1};
GameXocDia.prototype.onSellOrDuoiGateResponse=function(data){this.btnDatLai.visible=false;this.btnDatX2.visible=false;if(this.banker_user_Id===PlayerMe.uid){this.onShowNotice("B\u00e1n ho\u1eb7c c\u00e2n h\u1ebft ",3E3);this.btnCanTat.visible=true;this.gateContainer[2].onShowSellGate(true);this.gateContainer[5].onShowSellGate(true)}else this.onShowNotice("Nh\u00e0 c\u00e1i b\u00e1n ho\u1eb7c c\u00e2n c\u1eeda ",3E3);this.xocdiaContainer.visible=true;this.xocdiaContainer.showTimeCountDown(10)};
GameXocDia.prototype.onBuyGateResponse=function(data){cc.log("onBuyGateResponse "+JSON.stringify(data));cc.log(data.dn+" mua"+data.pm);var thiz=this;var remainMoneyGate=data.rmm;if(remainMoneyGate===0)thiz.gateContainer[data.eid].onShowBuyGate(false);thiz.gateContainer[data.eid].updateMoneyGate(data.rmm);var player=thiz.getDataPlayerByUid(data.uid);player.m-=data.pm;var slot=thiz.getSlotByUid(data.uid);if(slot)slot.setTotalGoldWithEffect(player.m);var str="mua "+cc.Global.NumberFormat2(data.pm);this.showMsgInSlot(data.uid,
str)};
GameXocDia.prototype.onEndGame=function(data){var thiz=this;thiz.playSoundAction("finished");if(thiz.dialogBuyGate){thiz.dialogBuyGate.hide();thiz.dialogBuyGate=null}thiz.totalGamePlay++;thiz.saveBetArr=thiz.currentBetArr;thiz.currentBetArr=[0,0,0,0,0,0];thiz.gameState=XOCDIA_PLAYER_STATE.END_GAME;if(thiz.banker_user_Id===null&&!thiz.registerBanker)thiz.btnXinCai.visible=true;thiz.xocdiaContainer.showCountDown(false);thiz.gateContainer[2].onShowSellGate(false);thiz.gateContainer[5].onShowSellGate(false);if(thiz.sellingGate>
-1)thiz.gateContainer[thiz.sellingGate].onShowBuyGate(false);thiz.myBetting=[0,0,0,0,0,0];var totalRed=data.rt;var totalBlack=4-totalRed;var isChan=totalRed%2===0?true:false;if(isChan){if(thiz.tableResult&&thiz.tableResult.length===32)thiz.tableResult.shift();thiz.tableResult.push(true)}else{if(thiz.tableResult&&thiz.tableResult.length===32)thiz.tableResult.shift();thiz.tableResult.push(false)}var duoiCua=data.kes;var timeDuoiCua=0;if(duoiCua&&duoiCua.length){timeDuoiCua=2;if(thiz.banker_user_Id===
null)thiz.onShowNotice("Tr\u1ea3 ti\u1ec1n c\u00e2n k\u00e8o",2E3);else thiz.onShowNotice("\u0110u\u1ed5i c\u1eeda",2E3);for(var i in duoiCua){var obj=duoiCua[i];var eid=obj.eid;var rdd=obj.rdd;var ps=obj.ps;var arrPos=[];for(var j in ps){var uid=ps[j].uid;var money=ps[j].rdd;var slot=thiz.getSlotByUid(uid);var pos;if(!slot)pos=cc.p(thiz.btnNguoiChoi.x,thiz.btnNguoiChoi.y);else pos=cc.p(slot.x+slot.width/2,slot.y+slot.height/2);arrPos.push(pos)}var gateMng=thiz.gateContainer[eid];gateMng.animChipToWinPlayer(arrPos)}}else if(thiz.banker_user_Id===
null){thiz.onShowNotice();thiz.onShowNoticeSender(timeDuoiCua,["Tr\u1ea3 ti\u1ec1n c\u00e2n k\u00e8o",2E3])}else thiz.onShowNoticeSender(timeDuoiCua,["M\u1edf b\u00e1t",2E3]);this.khungStatistic.updateStatisticDelay(timeDuoiCua,this.tableResult);if(isChan)thiz.gateContainer[2].showGlowDelay(timeDuoiCua,true);else thiz.gateContainer[5].showGlowDelay(timeDuoiCua,true);if(totalRed!=2)thiz.gateContainer[totalRed].showGlowDelay(timeDuoiCua,true);thiz.xocdiaContainer.openBat(totalRed,timeDuoiCua);var ps=
data.ps;for(var i in ps){var uid=ps[i].uid;var winMoney=ps[i].wm;var totalMoney=ps[i].m;var rm=ps[i].rm;var mx=ps[i].mX;var moneyExchange=mx;if(rm!==0)moneyExchange=rm;else if(winMoney>=0)moneyExchange=winMoney;var slot=thiz.getSlotByUid(uid);if(slot)if(moneyExchange!=0)slot.showResultXocDia(totalMoney,moneyExchange,timeDuoiCua);thiz.updateMoneyPlayer(ps[i])}var eidArrWin=[];var ew=data.ew;for(var i in ew){var eid=ew[i].eid;eidArrWin.push(eid);var ps=ew[i].wns;if(!ps||!ps.length)continue;if(ps&&ps.length){var arrPos=
[];for(var j in ps){var uid=ps[j];var slot=thiz.getSlotByUid(uid);var pos;if(!slot)pos=cc.p(thiz.btnNguoiChoi.x,thiz.btnNguoiChoi.y);else pos=cc.p(slot.x+slot.width/2,slot.y+slot.height/2);arrPos.push(pos)}var mng=thiz.gateContainer[eid];mng.animChipToWinPlayer(arrPos,timeDuoiCua)}}var banCua=data.si;if(banCua){var eid=banCua.eid;var ps=banCua.bs;var isBuyWin=false;if(eidArrWin.indexOf(eid)===-1)isBuyWin=true;if(isBuyWin&&ps&&ps.length){var arrPos=[];for(var j in ps){var uid=ps[j];var slot=thiz.getSlotByUid(uid);
var pos;if(!slot)pos=cc.p(thiz.btnNguoiChoi.x,thiz.btnNguoiChoi.y);else pos=cc.p(slot.x+slot.width/2,slot.y+slot.height/2);arrPos.push(pos)}if(timeDuoiCua===0){var mng=thiz.gateContainer[eid];mng.animChipToWinPlayer(arrPos,timeDuoiCua)}}}for(var j=0;j<thiz.gateContainer.length;j++){if(eidArrWin&&eidArrWin.length&&eidArrWin.indexOf(j)!==-1)continue;var arrPos=[];var _gateContainer=thiz.gateContainer[j];var mng=_gateContainer;var slot=thiz.getSlotByUid(thiz.banker_user_Id);var pos;if(!slot)mng.clearAllCuoc();
else{pos=cc.p(slot.x+slot.width/2,slot.y+slot.height/2);arrPos.push(pos);mng.animChipToWinPlayer(arrPos,timeDuoiCua)}}};GameXocDia.prototype.onShowNoticeSender=function(timeDelay,data){var thiz=this;var cb=cc.callFunc(function(){thiz.onShowNotice(data[0],data[1])});var seq=cc.sequence(cc.delayTime(timeDelay),cb);this.runAction(this,seq)};
GameXocDia.prototype.xocdia=function(){var thiz=this;thiz.xocdiaContainer.closeBat();thiz.gameState=XOCDIA_PLAYER_STATE.BETTING;cc.log("--- ok 0");thiz.animXocDia.startAnim();thiz.xocdiaContainer.show(false);cc.log("--- ok");thiz.stopAction(thiz.xocdiaAction);cc.log("--- ok 2");if(thiz.handlePendingBack()){thiz.currentBetArr=[0,0,0,0,0,0];thiz.xocdiaContainer.show(false);thiz.onShowNotice("B\u1eaft \u0111\u1ea7u \u0111\u1eb7t c\u1eeda",2E3);thiz.xocdiaAction=thiz.runAction(thiz,cc.sequence(cc.delayTime(3),
cc.callFunc(function(){thiz.onCountDownBetting()})));thiz.ideGameNumber++}};
GameXocDia.prototype.onCountDownBetting=function(t){if(t===undefined)t=20;var thiz=this;thiz.bettingTime=true;if(thiz.banker_user_Id&&thiz.banker_user_Id&&thiz.banker_user_Id===PlayerMe.uid){thiz.btnDatLai.visible=false;thiz.btnDatX2.visible=false}else if(thiz.totalGamePlay>0){thiz.btnDatLai.visible=true;thiz.btnDatX2.visible=true}thiz.animXocDia.clearAnim();thiz.xocdiaContainer.show(true);thiz.xocdiaContainer.showTimeCountDown(t,20)};
GameXocDia.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameXocDia.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}cc.log("click quit room tlmn");var isDatCuoc=false;for(var i=this.myBetting.length-1;i>=0;i--)if(this.myBetting[i]>0){isDatCuoc=true;break}if(this.isNhaCai()){isDatCuoc=true;this.showSystemNotice("B\u1ea1n \u0111ang l\u00e0 ch\u1ee7 ph\u00f2ng. Vui l\u00f2ng hu\u1ef7 c\u00e1i tr\u01b0\u1edbc khi tho\u00e1t");return}cc.log("isDatCuoc "+isDatCuoc);if(isDatCuoc){this.registerQuit=
!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=null}return}this.quitRoom()};
GameXocDia.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[4];else if(totalPlayer===3)this.sitdownPlayerNext=[5,4];else if(totalPlayer===4)this.sitdownPlayerNext=[8,5,4];else if(totalPlayer===5)this.sitdownPlayerNext=[8,5,4,2];else if(totalPlayer===6)this.sitdownPlayerNext=[8,6,5,4,2];else if(totalPlayer===7)this.sitdownPlayerNext=[8,6,5,4,3,2];else if(totalPlayer===8)this.sitdownPlayerNext=[8,7,6,5,4,3,2];else if(totalPlayer>=9)this.sitdownPlayerNext=[8,7,
6,5,4,3,2,1];return this.sitdownPlayerNext};
GameXocDia.prototype.setPlayerWithPosition=function(players){var idx=-1;for(var i=0;i<players.length;i++)if(players[i].uid==PlayerMe.uid){idx=0;break}var allSlot=[];var maxPlayer=this.getMaxPlayer();for(var i=0;i<maxPlayer;i++)allSlot[i]=null;if(idx>=0){allSlot[idx]=this.playerView[0];cc.log("PLAYERRR ME ngoi` sitId \x3d 0 sit_server \x3d "+idx)}var totalPlayer=players.length;cc.log("totalPlayer "+totalPlayer);if(totalPlayer>=2){this.sitdownPlayerNext=this.getSitPosArr(totalPlayer);var thiz=this;
var start=1;totalPlayer=totalPlayer>MAX_SLOT?MAX_SLOT:totalPlayer;for(var i=start;i<totalPlayer;i++){var sitId=thiz.sitdownPlayerNext[0];allSlot[i]=thiz.playerView[sitId];cc.log("PLAYERRR "+players[i].dn+"  ngoi` sitId \x3d "+sitId+" sit_server \x3d "+i);thiz.sitdownPlayerNext.shift()}}var start=allSlot.length;for(var k=0;k<this.playerView.length;k++)if(!allSlot[k])for(var i=this.playerView.length-1;i>=0;i--)if(allSlot.indexOf(this.playerView[i])===-1)allSlot[k]=this.playerView[i];this.allSlot=allSlot},
GameXocDia.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){var listPlayer=[];var totalPlayer=0;listPlayer=players;totalPlayer=players.length;if(listPlayer&&listPlayer.length>0&&!arrangeChauRiaOnly){var userList=listPlayer;this.setPlayerWithPosition(userList);for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].setEnable(false);this.allSlot[i].reset()}var ownerPlayer=null;userList=userList.sort(function(a,b){if(a.uid==PlayerMe.uid)return-1;else if(b.uid==PlayerMe.uid)return 1;
else if(a.C)return-1;else if(b.C)return 1;else return b.m-a.m});for(var i=0;i<userList.length;i++){var idx=i;if(i>=MAX_SLOT)continue;cc.log(idx+" \x3d\x3e "+userList[i].uid);this.allSlot[idx].setDataPlayer(userList[i]);this.allSlot[idx].setEnable(true);this.allSlot[idx].setIndex(idx);this.allSlot[idx].setUid(userList[i].uid);this.allSlot[idx].setUsername(userList[i].dn);this.allSlot[idx].setGold(Math.floor(userList[i].m));this.allSlot[idx].setAvatar(userList[i].a);if(gameState<4)this.allSlot[idx].setState(userList[i].r?
state_player.READY:state_player.NOTHING);this.allSlot[idx].stopTimeRemain();this.allSlot[idx].showChauRia(false);if(this.allSlot[idx].uid===PlayerMe.uid)this.allSlot[idx].isMe=true;else this.allSlot[idx].isMe=false;if(userList[i].C){cc.log("owner player "+userList[i].dn);ownerPlayer=userList[i]}}this.updateOwner(ownerPlayer)}};var CMD_PHOM=CMD_PHOM||{};CMD_PHOM.CHIABAI=850;CMD_PHOM.CHANGE_TURN=851;CMD_PHOM.BOC_BAI=852;CMD_PHOM.AN_BAI=853;CMD_PHOM.HA_PHOM=854;CMD_PHOM.END_GAME=855;CMD_PHOM.DEAL_CARD=857;CMD_PHOM.U=858;CMD_PHOM.GUI_BAI=856;var PHOM_PLAYER_STATE={SHAPCARD:0,DANG_CO_LUOT:1,AN_BAI:2,BOC_BAI:3,DANH_BAI:4,HA_PHOM:5,U:6,GUI_BAI:7};var ERROR_PHOM={1:{msg:"\u0103n treo tranh"},2:{msg:"\u0103n ch\u1ecdn c\u1ea1"}};
var ERROR_CMD_PHOM={8E3:{msg:"kh\u00f4ng c\u00f3 trong danh s\u00e1ch \u00f9"},8001:{msg:"c\u00f3 ng\u01b0\u1eddi \u0111ang \u0111\u1ee3i \u00f9"},8002:{msg:"\u0102n b\u00e0i ko h\u1ee3p l\u1ec7"},8003:{msg:"C\u00f3 ng\u01b0\u1eddi \u0111ang ch\u00edu"}};
function GamePhom(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GamePhom";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);LobbyClient.getInstance().addListener(kCMD.PHOM_EARN_CARD,this._onEarnCard,this);this.deckCards=new DeckCards;this.deckCards.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.deckCards);
this.initGame()}GamePhom.prototype=Object.create(GameScene.prototype);GamePhom.X_CHIA_BAI=550;GamePhom.MAX_CARD_PLAYER=10;GamePhom.cardOriginScaleBackCard=.6;GamePhom.MAX_SLOT=4;GamePhom.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.tfeg=data.tfeg/1E3;this.timeBaoSam=data.tfbs/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initButton();this.initPlayer();this.initCardContainer();this.showReadyIfCan();this.updateGame(data)};
GamePhom.prototype.updateGame=function(data){var thiz=this;var gameState=data.gS;var players=thiz.data.ps;var remainTime=data.rmT;thiz.lastArrCardDeal=data.ldc;var phomArr=data.mes;var noc=data.ns;var currentPlayerUid=data.cP;if(gameState==GAME_STATE.PLAYING){thiz.deckCards.show(true,noc);if(!data.re){thiz.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);thiz.hideAllBtnPlay();thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd")}}for(var i=0;i<
players.length;i++){var p=players[i];if(p.pi)thiz.totalPlayerPlaying++}thiz.allSlot.forEach(function(slot,index){if(slot!=null)for(var i=0;i<players.length;i++){var p=players[i];var playerState=p.pS;var cardEarns=p.sCs;if(typeof cardEarns!=="undefined"&&cardEarns&&cardEarns.length)thiz.arrEarnCard=thiz.arrEarnCard.concat(cardEarns);var dCs=p.dCs;var rmC=p.rmC;if(slot.uid==p.uid)if(p.pi){if(PlayerMe.uid===p.uid){var cardArray=p.cs;var ssc=p.ssc;var puid=p.puid;var sMs=p.sMs;var sAC=p.sAC;var sAMC=
p.sAMC;var cardDeckRemain=noc;var lastTurn=cardDeckRemain<thiz.totalPlayerPlaying?true:false;thiz.playerView[0].x=cc.Global.GameView.width/2-thiz.playerView[0].widthBG/2-GamePhom.X_CHIA_BAI;var cardAdd=[];for(var k in cardArray){var value=cardArray[k];var card=Utils.getCardFromServer(value);cardAdd.push(card);thiz.cardList.dealCards(cardAdd,false);if(thiz.arrEarnCard&&thiz.arrEarnCard.length&&thiz.arrEarnCard.indexOf(value)!==-1){var cardEarn_=thiz.cardList.getCardByRank(card.point,card.suit);if(cardEarn_){cardEarn_.originState=
state_card.ORANGE_BORDER;cardEarn_.showEffectCard(state_card.ORANGE_BORDER)}}}if(sAC&&sAC.length)thiz.suggestArrangeCard=sAC;var isMyPlayer=true;if(currentPlayerUid===p.uid){thiz.onUpdateTurn(slot.uid,remainTime);if(playerState===1)if(ssc){thiz.activeTurnButton(true,ssc,true);thiz.deckCards.showBocBai(true)}else if(cardArray&&cardArray.length<=9){thiz.deckCards.showBocBai(true);thiz.showBocBai()}else thiz.activeTurnButton(true);if(playerState==2||playerState==3||playerState==5||playerState==7)thiz.activeTurnButton(true);
if(lastTurn)if(sMs&&sMs.length){if(sMs.length>=9)thiz.showUandXepBai();thiz.cardList.onMoveUpCards(sMs);thiz.cardList.setMutiSelectEnable(true)}else{if(sAMC&&sAMC.length){if(sAMC.indexOf(cs)!==-1)cardInPhom=true;thiz.cardList.onMoveUpCards(sAMC);thiz.cardList.setMutiSelectEnable(true);thiz.activeTurnButton(true,false,false,false,true)}}else if(sMs&&sMs.length)if(sMs.length===10)thiz.showUandXepBai();else if(sMs.length===9)thiz.showUandDoiUtronAndXepBai()}}else{var cards=[Utils.getCardFromServer(0)];
thiz.backCardList[slot.sitId].dealBackCards(cards,false);if(currentPlayerUid===p.uid)thiz.onUpdateTurn(slot.uid,remainTime);var remainingCard=p.rmC;if(remainingCard>=9&&typeof cardEarns!=="undefined"&&cardEarns&&cardEarns.length){var cardDataArr=[];for(var idx in cardEarns){var cardData=Utils.getCardFromServer(cardEarns[idx]);cardDataArr.push(cardData)}thiz.cardEarnList[slot.sitId].dealCards(cardDataArr,false,CardAlign.CENTER,state_card.ORANGE_BORDER,GamePhom.cardOriginScaleBackCard);thiz.cardEarnList[slot.sitId].reOrderWithoutAnimation()}}if(typeof dCs!==
"undefined"&&dCs&&dCs.length){var cardDataArr=[];for(var idx in dCs){var cardData=Utils.getCardFromServer(dCs[idx]);cardDataArr.push(cardData)}var bCard=thiz.backCardList[slot.sitId];var pos=bCard.getGlobalPosition();thiz.cardOnTable[slot.sitId].addNewCardListPhomToTable(cardDataArr,cc.p(pos.x,pos.y),slot.sitId,GamePhom.cardOriginScaleBackCard,false)}}else if(gameState==GAME_STATE.PLAYING)thiz.setStatePlayer(slot.uid,state_player.DANG_XEM)}});if(typeof phomArr!=="undefined"&&phomArr&&phomArr.length){var start=
0;var startUid=phomArr[0].uid;for(var i=0;i<phomArr.length;i++){var phom=phomArr[i].cs;var cEarnId=[];var slot=thiz.getSlotByUid(phomArr[i].uid);var bCard=thiz.backCardList[slot.sitId];var worldPos=bCard.getGlobalPosition();thiz.phomOnTable[slot.sitId].dealPhoms(phomArr[i],false,worldPos);thiz.cardEarnList[slot.sitId].removeAll()}}players.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re)thiz.isPlaying=true;else if(players[thiz.idRoomMaster].uid!==PlayerMe.uid)if(cc.Global.GetSetting(GameSetting.autoReady))thiz.sendStartRequest()};
GamePhom.prototype.initCardContainer=function(){var zOrder=2;var left=170;var cardList=new CardList(cc.size(cc.Global.GameView.width-20-left,150));cardList.position.set(left,cc.Global.GameView.height-230);cardList.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(cardList);this.cardList=cardList;this.cardList.setDeckPoint(cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));var dx=110+50;var dy=30;var cardList0=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);
cardList0.canTouch=false;cardList0.position.set(cc.Global.GameView.width/2+dx,dy+this.playerView[0].y);MyPixi.gameContainer.addChild(cardList0);var cardList1=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);cardList1.canTouch=false;cardList1.position.set(this.playerView[1].x+this.playerView[1].widthBG-dx-70,dy+this.playerView[1].y);MyPixi.gameContainer.addChild(cardList1);var cardList2=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);cardList2.canTouch=false;cardList2.position.set(this.playerView[2].x+
dx,dy+this.playerView[2].y);MyPixi.gameContainer.addChild(cardList2);var cardList3=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);cardList3.canTouch=false;cardList3.position.set(this.playerView[3].x+dx,dy+this.playerView[3].y);MyPixi.gameContainer.addChild(cardList3);this.backCardList=[cardList0,cardList1,cardList2,cardList3];for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].setDeckPoint(cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));this.cardEarnList=[];
this.cardOnTable=[];this.phomOnTable=[];var _scale=1;var sizeTable=cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2);var startX=[230,230,-325,-325];var cardPosition=[];cardPosition.push(cc.p(sizeTable.x+startX[0],sizeTable.y+70));cardPosition.push(cc.p(sizeTable.x+startX[1],sizeTable.y-264));cardPosition.push(cc.p(sizeTable.x+startX[2],sizeTable.y-264));cardPosition.push(cc.p(sizeTable.x+startX[3],sizeTable.y+70));var phomPosition=[];phomPosition.push(cc.p(sizeTable.x,sizeTable.y+50));
phomPosition.push(cc.p(sizeTable.x+300,sizeTable.y-125));phomPosition.push(cc.p(sizeTable.x,sizeTable.y-190));phomPosition.push(cc.p(sizeTable.x-300,sizeTable.y-125));var thiz=this;var cb=function(){thiz.sendAnBai()};var callfun=cc.callFunc(cb);for(var i=0;i<4;i++){var _cardOnTable=new CardOnTable(cardPosition[i]);_cardOnTable.setEarnCard(callfun);_cardOnTable.position.set(cardPosition[i].x,cardPosition[i].y);_cardOnTable.setContentSize(cc.size(300,100));MyPixi.gameContainer.addChild(_cardOnTable);
_cardOnTable.displayGroup=MyPixi.gameContainerLayer;_cardOnTable.setDeckPoint(cardPosition[i]);this.cardOnTable[i]=_cardOnTable;var _earnCardList=new CardEarnList(cc.size(60,150),GamePhom.cardOriginScaleBackCard);_earnCardList.position.set(this.backCardList[i].x,this.backCardList[i].y-this.backCardList[i].height/4);MyPixi.gameContainer.addChild(_earnCardList);this.cardEarnList[i]=_earnCardList;var _phomOnTable=new PhomList(cc.size(300,150),1);_phomOnTable.position.set(phomPosition[i].x-150,phomPosition[i].y);
MyPixi.gameContainer.addChild(_phomOnTable);_phomOnTable.displayGroup=MyPixi.gameContainerLayer;this.phomOnTable[i]=_phomOnTable}if(TEST_MODE){var cardListDeal=new CardList(cc.size(cc.Global.GameView.width,150));cardListDeal.position.set(200,cc.Global.GameView.height/2);MyPixi.gameContainer.addChild(cardListDeal);this.cardListDeal=cardListDeal}};
GamePhom.prototype.resetNewGame=function(igNoreCheckReady){if(this.lastArrCardDeal&&this.lastArrCardDeal.length)this.lastArrCardDeal.length=0;this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2;this.deckCards.show(false);this.deckCards.showBocBai(false);this.currentTurn=-1;this.rejectTurnTotal=0;this.arrEarnCard.length=0;this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;this.cardList.removeAll();this.cardList.setMutiSelectEnable(false);for(var i=0;i<this.cardOnTable.length;i++)this.cardOnTable[i].removeAll();
for(var i=0;i<this.cardEarnList.length;i++)this.cardEarnList[i].removeAll();for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();for(var i=0;i<this.phomOnTable.length;i++)this.phomOnTable[i].removeAll();for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].stopTimeRemain(false);this.allSlot[i].setState(state_player.NOTHING);this.allSlot[i].clearAnimMoney()}if(!igNoreCheckReady){var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);
this.showStartIfCan()}else this.showReadyIfCan()}};GamePhom.prototype._onEarnCard=function(command,dataObj){this.sendAnBai()};
GamePhom.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY)this.onReadyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===CMD_PHOM.CHIABAI)this.chiabai(dataObj);else if(cmd===CMD_PHOM.DEAL_CARD);else if(cmd===CMD_PHOM.CHANGE_TURN)this.onChangeTurn(dataObj);else if(cmd===CMD_PHOM.END_GAME)this.onEndGameResponse(dataObj);else if(cmd===CMD_PHOM.BOC_BAI)this.onBocbaiResponse(dataObj);else if(cmd===CMD_PHOM.AN_BAI)this.onAnBaiResponse(dataObj);else if(cmd===CMD_PHOM.GUI_BAI)this.onGuiBaiResponse(dataObj);else if(cmd===CMD_PHOM.HA_PHOM)this.onHaBaiResponse(dataObj);
var newList={};var dataFromServer=[];for(var i=0;i<dataFromServer.length;i++){var element=dataFromServer[i];var amount=element.amount;if(!newList[amount])newList[amount]=[];newList[amount].push(element)}for(var i=0;i<newList.length;i++){var arr=newList[i];cc.log("ds amount "+arr[0].amount);for(var k=0;k<arr.length;k++)cc.log(" element "+arr[0].name)}};GamePhom.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.isRegisterQuit=true};
GamePhom.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=ERROR_CMD_PHOM[errorCode];if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";else errorStr=errorStr.msg;if(errorCode!=210){var msg=errorStr;MessageNode.getInstance().show(msg)}};
GamePhom.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame();this.showStartIfCan()};
GamePhom.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(uid==PlayerMe.uid)this.showReady(false);if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING);var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);
this.showStartIfCan()}else this.showReadyIfCan()};GamePhom.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GamePhom.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GamePhom.prototype.hideAllMarkEarnCard=function(){var thiz=this;for(var i in this.cardOnTable){var cards=this.cardOnTable[i].getCards();if(cards&&cards.length>0)for(var i=0;i<cards.length;i++)cards[i].showEffectCard(state_card.NOTHING)}};
GamePhom.prototype.onBocbaiResponse=function(dataObj){if(TEST_MODE){var rd=Math.floor(Math.random()*4);var uid=this.allSlot[rd].uid;dataObj=[5,{"cs":1,"uid":uid,"sAC":[31,35,39,18,16,24,28,1,6,45],"sMs":[31,35,39],"dn":"003gts","cmd":852}]}var thiz=this;this.hideAllMarkEarnCard();var cs=dataObj[1].cs;if(typeof cs==="undefined")cs=0;var isMom=dataObj[1].mom;var sMs=dataObj[1].sMs;var sAC=dataObj[1].sAC;var sAMC=dataObj[1].sAMC;this.deckCards.reduceTotalCard(true,1);var cardDeckRemain=this.deckCards.numberRemain;
var lastTurn=cardDeckRemain<this.totalPlayerPlaying?true:false;var cardInPhom=false;if(TEST_MODE){lastTurn=true;cardInPhom=true;sMs=[];var c=this.cardList.getCards();for(var i=0;i<c.length/2;i++)sMs.push(c[i].getCardData().codeCard);sMs.push(cs)}if(sMs&&sMs.length&&sMs.indexOf(cs)!==-1&&lastTurn)cardInPhom=true;var curentSeconds=(new Date).getTime()/1E3;var card=Utils.getCardFromServer(cs);var isMyPlayer=false;if(PlayerMe.uid===dataObj[1].uid)isMyPlayer=true;this.allSlot.forEach(function(slot,index){if(slot)if(dataObj[1].uid===
slot.uid){if(isMyPlayer)thiz.cardList.addNewCard([card],true,null,thiz.deckCards.deckCardBtn.scale.x);else{var cards=[Utils.getCardFromServer(0)];thiz.backCardList[slot.sitId].dealBackCards(cards,true,true)}if(sAC&&sAC.length)thiz.suggestArrangeCard=sAC;cc.log("---------------show mom");if(isMom)thiz.setStatePlayer(slot.uid,state_player.MOM)}});if(PlayerMe.uid===dataObj[1].uid){if(lastTurn)if(sMs&&sMs.length){if(sMs.length>=9)this.showUandXepBai();else this.activeTurnButton(true,false,false,true);
this.cardList.onMoveUpCards(sMs);this.cardList.setMutiSelectEnable(true)}else if(sAMC&&sAMC.length){if(sAMC.indexOf(cs)!==-1)cardInPhom=true;this.cardList.onMoveUpCards(sAMC);this.activeTurnButton(true,false,false,false,true)}else this.activeTurnButton(true,false);else if(sMs&&sMs.length)if(sMs.length===10)this.showUandXepBai();else if(sMs.length===9)this.showUandDoiUtronAndXepBai();else this.activeTurnButton(true,false);else this.activeTurnButton(true,false);this.deckCards.showBocBai(false)}};
GamePhom.prototype.onWinAfterChiabai=function(data){cc.log("onWinAfterChiabai");if(TEST_MODE)data={"ps":[{"cs":[16,17,21,22,29,5,49,50,51],"uid":PlayerMe.uid,"pt":32,"dn":"006gts","mes":[],"mX":2375,"m":100110025,"fT":11},{"cs":[42,34,30,28,36,25,27,6,10],"uid":this.allSlot[1].uid,"pt":1,"dn":"005gts","mX":-2500,"m":99888150,"fT":5},{"cs":[42,34,30,28,36,25,27,6,10],"uid":this.allSlot[2].uid,"pt":1,"dn":"005gts","mX":-2500,"m":99888150,"fT":5},{"cs":[42,34,30,28,36,25,27,6,10],"uid":this.allSlot[3].uid,
"pt":1,"dn":"005gts","mX":-2500,"m":99888150,"fT":5}],"fP":{"cs":45,"uid":PlayerMe.uid,"pS":6,"dn":"005gts","mes":[{"meid":1,"cs":[16,17,21]},{"meid":2,"cs":[22,29,5]},{"meid":3,"cs":[49,50,51]}]},"cmd":855};cc.log("onWinAfterChiabai "+JSON.stringify(data));this.stopAllActions();var thiz=this;this.resetNewGame(true);this.hideAllBtnPlay();var player=data.ps;thiz.gameState=GAME_STATE.SHOW_KQ;thiz.isPlaying=true;var _winafterChiabai=true;cc.log("wtf BEGIN");var delay=cc.delayTime(1);var cb=function(){thiz.isPlaying=
false;cc.log("onHaBaiResponse BEGIN");for(var i=0;i<thiz.allSlot.length;i++)if(thiz.allSlot[i].uid==data.uid)thiz.allSlot[i].hideCardEndGame();thiz.onHaBaiResponse(data);cc.log("habai ok");thiz.showResult(true,data,_winafterChiabai);thiz.hideAllBtnPlay();cc.log("showResult ok")};var cardArray=data.cs;var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));for(var j=0;j<this.allSlot.length;j++){var slot=this.allSlot[j];if(slot!=null){var inList=false;for(var i=0;i<player.length;i++){var _player=
player[i];if(_player.uid==slot.uid){inList=true;var cardArray=_player.cs;var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));var rd=Math.floor(Math.random()*10+1);if(TEST_MODE)if(slot.isMe)slot.isMe=rd>5?true:false;if(slot.isMe)slot.x=cc.Global.GameView.width/2-thiz.playerView[0].widthBG/2-GamePhom.X_CHIA_BAI;if(slot.isMe)this.cardList.dealCards(cards,true);else slot.showCardEndGame(cards,true);_player.pi=true}}if(!inList)thiz.setStatePlayer(slot.uid,
state_player.DANG_XEM)}}};
GamePhom.prototype.chiabai=function(dataObj){this.stopAllActions();this.resetNewGame(true);if(TEST_MODE)dataObj=[5,{"cs":[6,10,9,42,40,25,27,28,39,31],"lpi":[this.allSlot[0].uid,"uid1","uid2","uid3"],"cmd":850,"tP":{"uid":this.allSlot[0].uid,"dn":"gts003"}}];var thiz=this;this.showReady(false);this.ideGameNumber++;this.isPlaying=true;this.cardList.removeAll();for(var i=0;i<this.cardOnTable.length;i++)this.cardOnTable[i].removeAll();this.playSoundAction("chiabai");this.updateGoldAllPlayerFromServer(dataObj);this.startGame();
var data=dataObj[1];this.gameState=GAME_STATE.PLAYING;this.data.gS=GAME_STATE.PLAYING;var arrCopy=Utils.deepCoppyArray(data.cs);var cardArray=Utils.shuffleArray(arrCopy);var cfl=data.cfl;var tP=data.tP;var listPlayer=data.lpi;this.totalPlayerPlaying=listPlayer.length;this.deckCards.show(true,0);var delay=cc.delayTime(.4);var cb=function(){thiz.deckCards.show(true,-1+listPlayer.length*4)};var callFun=cc.callFunc(cb);PIXI.actionManager.runAction(this.deckCards,cc.sequence(delay,callFun));this.data.ps.forEach(function(player,
index){if(listPlayer.indexOf(player.uid)!==-1)player.pi=true});this.onUpdateTurn(tP.uid,this.timeTurn,true);if(listPlayer.indexOf(PlayerMe.uid)>-1){var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));this.cardList.dealCards(cards,true);this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2-GamePhom.X_CHIA_BAI;if(tP.uid==PlayerMe.uid){var delay=cc.delayTime(1);var cb=function(){thiz.activeTurnButton(true);if(cfl)thiz.showUandDoiUtronAndXepBai()};
var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun))}else{var delay=cc.delayTime(1);var cb=function(){thiz.showXepBaiOnly()};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun))}this.suggestArrangeCard=data.cs}else{this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);this.isPlaying=false}for(var i=0;i<this.allSlot.length;i++){var slot=this.allSlot[i];if(!slot.isMe)if(listPlayer.indexOf(slot.uid)>-1){var cards=[Utils.getCardFromServer(0)];this.backCardList[slot.sitId].dealBackCards(cards,
true)}else this.setStatePlayer(slot.uid,state_player.DANG_XEM)}};GamePhom.prototype.findPhomOntableByMeId=function(meId){var kq=-1;for(var i in this.phomOnTable){cc.log(this.phomOnTable[i].meIds.toString()+" exit "+meId);if(this.phomOnTable[i].meIds.indexOf(meId)!=-1){kq=i;break}}return kq};
GamePhom.prototype.onGuiBaiResponse=function(dataObj){if(TEST_MODE){fUid=this.allSlot[Math.floor(Math.random()*this.allSlot.length-1)+1].uid;while(fUid===PlayerMe.uid)fUid=this.allSlot[Math.floor(Math.random()*this.allSlot.length-1)+1].uid;var csPhom1=[];var csPhom2=[];var csPhom3=[];var meidGui1=Math.floor(Math.random()*9)+1;var meidGui2=Math.floor(Math.random()*9)+1;var meidGui3=Math.floor(Math.random()*9)+1;if(fUid==PlayerMe.uid){var c=this.cardList.getCards();csPhom1.push(c[0].getCardData().codeCard);
csPhom2.push(c[1].getCardData().codeCard);csPhom2.push(c[2].getCardData().codeCard)}else{csPhom1=Math.floor(Math.random()*51)+1;csPhom2=Math.floor(Math.random()*51)+1;csPhom3=Math.floor(Math.random()*51)+1}dataObj=[5,{"uid":fUid,"aMs":[{"cs":csPhom1,"meid":meidGui1},{"cs":csPhom2,"meid":meidGui2},{"cs":csPhom3,"meid":meidGui3}],"dn":"fucker","cmd":856}]}cc.log("onGuiBaiResponse "+JSON.stringify(dataObj));var thiz=this;var aMs=dataObj[1].aMs;var uid=dataObj[1].uid;var slotGui=this.getSlotByUid(uid);
for(var i in aMs){var cs;if(aMs[i].cs instanceof Array)cs=aMs[i].cs;else cs=[aMs[i].cs];var meId=aMs[i].meid;var sitPhom=this.findPhomOntableByMeId(meId);if(sitPhom==-1){cc.log("ko co phom meId "+meId);continue}else cc.log("gui phom meId "+meId);if(uid==PlayerMe.uid){var cards=[];for(var m=0;m<cs.length;m++){var cardData=Utils.getCardFromServer(cs[m]);cards.push(cardData)}var arr=thiz.cardList.removeCard(cards);for(var i=0;i<arr.length;i++){var worldPos=cc.convertToWorldSpace(arr[i]);var nodePos=
cc.convertToNodeSpace(this.phomOnTable[sitPhom],cc.p(worldPos.x,worldPos.y));arr[i].position.set(nodePos.x,nodePos.y);arr[i].canTouch=false}thiz.phomOnTable[sitPhom].guiBaiMe(meId,arr,true);this.cardList.reOrder();var currSCA=thiz.suggestArrangeCard;var newSCA=Utils.difference(currSCA,cs);if(newSCA&&newSCA.length)thiz.suggestArrangeCard=newSCA}else{var bCard=thiz.backCardList[slotGui.sitId];var worldPos=cc.convertToWorldSpace(bCard);worldPos=cc.p(worldPos.x+bCard.widthContainer/2,worldPos.y+bCard.heightContainer/
2);var nodePos=cc.convertToNodeSpace(this.phomOnTable[sitPhom],cc.p(worldPos.x,worldPos.y));this.phomOnTable[sitPhom].guiBai(meId,cs,true,nodePos)}}};
GamePhom.prototype.onAnBaiResponse=function(dataObj){if(TEST_MODE){var id=Math.floor(Math.random()*this.allSlot.length);var uidAn=this.allSlot[id].uid;var uidBiAn;if(id>0)uidBiAn=this.allSlot[id-1].uid;else uidBiAn=this.allSlot[3].uid;var cards=this.cardOnTable[this.getSlotByUid(uidBiAn).sitId];var cs=cards.getCards();cc.log("aaaaa");var cd=cs[cs.length-1].getCardData();var abc=cd.codeCard;var idRd=Math.floor(Math.random()*this.allSlot.length);while(idRd==uidBiAn)idRd=Math.floor(Math.random()*this.allSlot.length);
var uidCMC=this.allSlot[idRd].uid;var cardsCmc=this.cardOnTable[this.getSlotByUid(uidCMC).sitId];var csCMC=cardsCmc.getCards();cc.log("csCMC.length-1 \x3d"+(csCMC.length-1));var cardData=csCMC[csCMC.length-1].getCardData();var cmc=cardData.codeCard;dataObj=[5,{"cs":abc,"sAC":[23,27,31,12,20,28,6,26,33,49],"cmc":cmc,"sMs":[23,27,31],"ic":false,"fP":{"uid":uidAn,"lm":-500,"puid":uidBiAn,"dn":"003gts","mX":500,"m":54245},"cmd":853}]}var thiz=this;var data=dataObj[1];var cardEarn=data.cs;this.arrEarnCard.push(cardEarn);
var isChot=data.ic;var sAc=data.sAC;var cmc=data.cmc;var sMs=data.sMs;var fP=data.fP;var cardDeckRemain=thiz.deckCards.numberRemain;var lastTurn=cardDeckRemain<thiz.totalPlayerPlaying?true:false;var cardInPhom=false;if(sMs&&sMs.length&&sMs.indexOf(cardEarn)!==-1&&lastTurn)cardInPhom=true;var sitIdBiAn=thiz.getSlotByUid(fP.puid);var cardDeckRemain=thiz.deckCards.numberRemain;var lastTurn=cardDeckRemain<thiz.totalPlayerPlaying?true:false;thiz.deckCards.showBocBai(false);for(var i in thiz.allSlot){var slot=
thiz.allSlot[i];if(slot)if(slot.uid===fP.uid){var startPos=cc.p(slot.avt.x+slot.avt.size.width/2,slot.avt.y);slot.runChangeGoldEffect(fP.mX,null,startPos,true);var isMyPlayer=PlayerMe.uid===fP.uid?true:false;thiz.onAnBaiThanhCong(fP.uid,fP.puid,cardEarn);if(isChot){thiz.setStatePlayer(slot.uid,state_player.AN_CAY_CHOT);thiz.uidAnChot=slot.uid}if(isMyPlayer&&sAc&&sAc.length)this.suggestArrangeCard=sAc;if(isMyPlayer)if(lastTurn)if(sMs&&sMs.length){if(sMs.length>=9)thiz.showUandXepBai();else thiz.activeTurnButton(true,
false,false,true);thiz.cardList.onMoveUpCards(sMs);thiz.cardList.setMutiSelectEnable(true)}else thiz.activeTurnButton(true,false);else if(sMs&&sMs.length)if(sMs.length===10)thiz.showUandXepBai();else if(sMs.length===9)thiz.showUandDoiUtronAndXepBai();else thiz.activeTurnButton(true,false);else thiz.activeTurnButton(true,false)}else if(slot.uid===fP.puid){var startPos=cc.p(slot.avt.x+slot.avt.size.width/2,slot.avt.y);slot.runChangeGoldEffect(fP.lm,null,startPos,true)}}if(cmc)for(var i in thiz.cardOnTable){var holeCard=
thiz.cardOnTable[i];var cardsArr=holeCard.getCards();if(cardsArr&&cardsArr.length){var lastCardInHole=cardsArr[cardsArr.length-1];if(lastCardInHole.getCardData().codeCard===cmc){thiz.setStatePlayer(thiz.allSlot[i].uid,state_player.NOTHING);var cardData=Utils.getCardFromServer(cmc);var arr=holeCard.removeCard([cardData]);for(var i=0;i<arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);arr[i].position.set(pos.x,pos.y)}var slotBiChot=thiz.getSlotByUid(fP.puid);this.cardOnTable[slotBiChot.sitId].addCardPhomToTable(arr,
slotBiChot.sitId,this.cardOnTable[slotBiChot.sitId].cardOrigiScale);this.cardOnTable[slotBiChot.sitId].reOrder();cc.log("slot bi chot "+slotBiChot.sitId);cc.log("slot chuyen card "+i);break}}}else thiz.setStatePlayer(sitIdBiAn,state_player.NOTHING)};GamePhom.prototype.getphomOnTableID=function(uid){for(var idx in this.allSlot){var slot=this.allSlot[idx];if(slot&&slot.uid===uid)return slot.sitId}};
GamePhom.prototype.onHaBaiResponse=function(dataObj){if(TEST_MODE){if(!this._meId)this._meId=1;fUid=this.allSlot[Math.floor(Math.random()*this.allSlot.length)].uid;var slot=this.getSlotByUid(fUid);var csPhom1=[];var csPhom2=[];var csPhom3=[];var meId1,meId2,meId3;if(fUid==PlayerMe.uid){var c=this.cardList.getCards();for(var i=0;i<3;i++){csPhom1.push(c[i].getCardData().codeCard);meId1=this._meId;this._meId++}}else{csPhom1=[6,20,46];meId1=this._meId;this._meId++}dataObj=[5,{"uid":fUid,"sAMC":[],"dn":"006gts",
"mes":[{"meid":meId1,"cs":csPhom1}],"cmd":854}]}cc.log("onHaBaiResponse "+JSON.stringify(dataObj));var thiz=this;var arrGuiGai=dataObj[1].sAMC;var mes=dataObj[1].mes;var allphom=[];var slot=thiz.getSlotByUid(dataObj[1].uid);for(var i=0;i<mes.length;i++){var phom=mes[i].cs;allphom=allphom.concat(phom)}thiz.allSlot.forEach(function(_slot,index){if(_slot)if(dataObj[1].uid===_slot.uid)if(PlayerMe.uid===dataObj[1].uid){thiz.cardList.setMutiSelectEnable(true);thiz.dealPhomMe(mes,_slot);if(arrGuiGai&&arrGuiGai.length){thiz.cardList.onMoveUpCards(arrGuiGai);
thiz.activeTurnButton(true,false,false,false,true)}else thiz.activeTurnButton(true,false);var currSCA=thiz.suggestArrangeCard;if(currSCA){var newSCA=Utils.difference(currSCA,allphom);if(newSCA&&newSCA.length)thiz.suggestArrangeCard=newSCA}}else{cc.log("onHaBaiResponse slot "+slot.sitId);var bCard=thiz.backCardList[slot.sitId];var worldPos=bCard.getGlobalPosition();thiz.phomOnTable[slot.sitId].dealPhoms(mes,true,worldPos);thiz.cardEarnList[slot.sitId].removeAll()}})};
GamePhom.prototype.dealPhomMe=function(mes,slot){var thiz=this;for(var k=0;k<mes.length;k++){var cards=[];var phom=mes[k];for(var m=0;m<phom.cs.length;m++){var cardData=Utils.getCardFromServer(phom.cs[m]);cards.push(cardData)}var arr=thiz.cardList.removeCard(cards);for(var i=0;i<arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);var p=cc.convertToNodeSpace(thiz.phomOnTable[slot.sitId],cc.p(pos.x,pos.y));arr[i].position.set(p.x,p.y)}thiz.phomOnTable[slot.sitId].addPhom(phom.meid,arr,true)}this.cardList.reOrder()};
GamePhom.prototype.dealPhomOther=function(mes,slot){var thiz=this;for(var k=0;k<mes.length;k++){var cards=[];var phom=mes[k];for(var m=0;m<phom.cs.length;m++){var cardData=Utils.getCardFromServer(phom.cs[m]);cards.push(cardData)}var arr=thiz.cardList.removeCard(cards);thiz.phomOnTable[slot.sitId].addPhom(phom.meid,arr)}this.cardList.reOrder()};GamePhom.prototype.showBocBai=function(){this.buttonList[5].visible=true};
GamePhom.prototype.showXepBaiOnly=function(){this.activeTurnButton(false);this.buttonList[0].visible=true};GamePhom.prototype.showUandXepBai=function(){this.activeTurnButton(false);this.buttonList[0].visible=true;this.buttonList[6].visible=true};GamePhom.prototype.showUandDoiUtronAndXepBai=function(){this.activeTurnButton(false);this.buttonList[0].visible=true;this.buttonList[6].visible=true;this.buttonList[8].visible=true};
GamePhom.prototype.showDanhBaiAndHideWaitUTron=function(){this.buttonList[1].visible=true;this.buttonList[8].visible=false};
GamePhom.prototype.activeTurnButton=function(isShow,ssc,canBocbai,canHaPhom,canGuiBai){if(!ssc)ssc=false;if(!canBocbai)canBocbai=false;if(!canHaPhom)canHaPhom=false;if(!canGuiBai)canGuiBai=false;if(isShow){this.activeTurnButton(false);this.buttonList[0].visible=true;if(ssc){this.buttonList[2].visible=true;this.buttonList[5].visible=true}else if(canBocbai)this.buttonList[5].visible=true;else if(canHaPhom){this.buttonList[3].visible=true;this.buttonList[1].visible=true}else if(canGuiBai){this.buttonList[4].visible=
true;this.buttonList[1].visible=true}else this.buttonList[1].visible=true}else for(var i in this.buttonList)this.buttonList[i].visible=false};GamePhom.prototype.showReady=function(visible){this.readyBt.visible=visible;var idMaster=this.getIdRoomMaster();if(idMaster>=0&&this.data.ps[idMaster].uid==PlayerMe.uid)MyHelper.addLblButton(this.readyBt,"Chia b\u00e0i",16);else MyHelper.addLblButton(this.readyBt,"S\u1eb5n s\u00e0ng",16)};
GamePhom.prototype.hideStartAndReady=function(hide){this.readyBt.visible=hide};
GamePhom.prototype.initButton=function(){var thiz=this;var readyBt=MyHelper.createButton("button/btn_button2.png",true,function(){var idMaster=thiz.getIdRoomMaster();if(thiz.data.ps[idMaster].uid===PlayerMe.uid){var notReady=thiz.getNumberPlayerNotReadyIgnoreMaster();if(notReady>0){var dialog=new MessageConfirmDialog;dialog.setMessage("V\u1eabn c\u00f2n ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng.\n B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n b\u1eaft \u0111\u1ea7u kh\u00f4ng?");dialog.okButtonHandler=
function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else thiz.sendStartRequest()}else thiz.sendStartRequest()});readyBt.position.set(cc.Global.GameView.width/2,350);MyPixi.gameContainer.addChild(readyBt);MyHelper.addLblButton(readyBt,"S\u1eb5n s\u00e0ng",16);var startBt=MyHelper.createButton("button/btn_button2.png",true,function(){});startBt.position.set(cc.Global.GameView.width/2,350);MyPixi.gameContainer.addChild(startBt);MyHelper.addLblButton(startBt,
"B\u1eaft \u0111\u1ea7u",16);var anBaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.sendAnBai()});anBaiBt.position.set(cc.Global.GameView.width/2+174,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(anBaiBt);MyHelper.addLblButton(anBaiBt,"\u0102n c\u00e2y",16);var haBaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){if(TEST_MODE){thiz.onHaBaiResponse();return}thiz.onHaBai()});haBaiBt.position.set(cc.Global.GameView.width/2+174,cc.Global.GameView.height/
2+320);MyPixi.gameContainer.addChild(haBaiBt);MyHelper.addLblButton(haBaiBt,"H\u1ea1 b\u00e0i",16);var danhbaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.sendDanhBai()});danhbaiBt.position.set(cc.Global.GameView.width/2-34,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(danhbaiBt);MyHelper.addLblButton(danhbaiBt,"\u0110\u00e1nh b\u00e0i",16);var xepbaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){var cardDataArr=Utils.getArrCardData(thiz.suggestArrangeCard);
console.log(thiz.suggestArrangeCard.toString()+" fuckkkk xepbai suggestArrangeCard");thiz.cardList.xepbai(cardDataArr)});xepbaiBt.position.set(cc.Global.GameView.width/2-234,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(xepbaiBt);MyHelper.addLblButton(xepbaiBt,"X\u1ebfp b\u00e0i",16);var guiBaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){if(TEST_MODE){thiz.onGuiBaiResponse();return}thiz.onGuiBai()});guiBaiBt.position.set(cc.Global.GameView.width/2+174,cc.Global.GameView.height/
2+320);MyPixi.gameContainer.addChild(guiBaiBt);MyHelper.addLblButton(guiBaiBt,"G\u1eedi b\u00e0i",16);var bocBaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){if(TEST_MODE){thiz.onBocbaiResponse();return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.BOC_BAI}];LobbyClient.getInstance().send(sendObj);thiz.ideGameNumber=0});bocBaiBt.position.set(cc.Global.GameView.width/2-34,cc.Global.GameView.height/
2+320);MyPixi.gameContainer.addChild(bocBaiBt);MyHelper.addLblButton(bocBaiBt,"B\u1ed1c b\u00e0i",16);var uBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onU()});uBt.position.set(cc.Global.GameView.width/2+174,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(uBt);MyHelper.addLblButton(uBt,"\u00d9",16);var uTronBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onU()});uTronBt.position.set(cc.Global.GameView.width/2+174,cc.Global.GameView.height/
2+320);MyPixi.gameContainer.addChild(uTronBt);MyHelper.addLblButton(uTronBt,"\u00d9 Tr\u00f2n",16);var doiUTronBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onWaitUTron()});doiUTronBt.position.set(cc.Global.GameView.width/2-34,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(doiUTronBt);MyHelper.addLblButton(doiUTronBt,"\u0110\u1ee3i \u00d9 Tr\u00f2n",16);var reconnectBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onWaitUTron()});reconnectBt.position.set(cc.Global.GameView.width/
2-34,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(reconnectBt);MyHelper.addLblButton(reconnectBt,"rec",16);readyBt.visible=false;startBt.visible=false;anBaiBt.visible=false;haBaiBt.visible=false;xepbaiBt.visible=false;guiBaiBt.visible=false;bocBaiBt.visible=false;uBt.visible=false;uTronBt.visible=false;doiUTronBt.visible=false;danhbaiBt.visible=false;reconnectBt.visible=false;this.buttonList=[xepbaiBt,danhbaiBt,anBaiBt,haBaiBt,guiBaiBt,bocBaiBt,uBt,uTronBt,doiUTronBt];this.readyBt=
readyBt;this.startBt=startBt;this.reconnectBt=reconnectBt;if(TEST_MODE){var chiabaiBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.chiabai()},true,cc.size(100,50),[10,10,10,10]);chiabaiBt.position.set(cc.Global.GameView.width/2-580,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(chiabaiBt);MyHelper.addLblButton(chiabaiBt,"chia",16);var xepbaiBt=MyHelper.createButton("button/btn_0.png",true,function(){cc.log("cardDataArr  b4"+thiz.suggestArrangeCard.length);var cardDataArr=
Utils.getArrCardData(thiz.suggestArrangeCard);cc.log("cardDataArr "+cardDataArr.length);thiz.cardList.xepbai(cardDataArr)},true,cc.size(100,50),[10,10,10,10]);xepbaiBt.position.set(cc.Global.GameView.width/2-580,cc.Global.GameView.height/2-90);MyPixi.gameContainer.addChild(xepbaiBt);MyHelper.addLblButton(xepbaiBt,"xep",16);var danhB=MyHelper.createButton("button/btn_0.png",true,function(){thiz.onChangeTurn()},true,cc.size(100,50),[10,10,10,10]);danhB.position.set(cc.Global.GameView.width/2-450,cc.Global.GameView.height/
2-90);MyPixi.gameContainer.addChild(danhB);MyHelper.addLblButton(danhB,"deal",16);var anBaiBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.sendAnBai()},true,cc.size(100,50),[10,10,10,10]);anBaiBt.position.set(cc.Global.GameView.width/2-500,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(anBaiBt);MyHelper.addLblButton(anBaiBt,"\u0102n c\u00e2y",16);var bocBaiBt=MyHelper.createButton("button/btn_0.png",true,function(){if(TEST_MODE){thiz.onBocbaiResponse();return}},true,
cc.size(100,50),[10,10,10,10]);bocBaiBt.position.set(cc.Global.GameView.width/2-500,cc.Global.GameView.height/2-193);MyPixi.gameContainer.addChild(bocBaiBt);MyHelper.addLblButton(bocBaiBt,"B\u1ed1c",16);var haBaiBt=MyHelper.createButton("button/btn_0.png",true,function(){if(TEST_MODE){thiz.onHaBaiResponse();return}thiz.onHaBai()},true,cc.size(100,50),[10,10,10,10]);haBaiBt.position.set(cc.Global.GameView.width/2-550,cc.Global.GameView.height/2-233);MyPixi.gameContainer.addChild(haBaiBt);MyHelper.addLblButton(haBaiBt,
"H\u1ea1",16);var guiBaiBt=MyHelper.createButton("button/btn_0.png",true,function(){if(TEST_MODE){thiz.onGuiBaiResponse();return}thiz.onGuiBai()},true,cc.size(100,50),[10,10,10,10]);guiBaiBt.position.set(cc.Global.GameView.width/2-450,cc.Global.GameView.height/2-233);MyPixi.gameContainer.addChild(guiBaiBt);MyHelper.addLblButton(guiBaiBt,"Gui",16);var winluonBt=MyHelper.createButton("button/btn_0.png",true,function(){if(TEST_MODE)thiz.onWinAfterChiabai()},true,cc.size(100,50),[10,10,10,10]);winluonBt.position.set(cc.Global.GameView.width/
2-350,cc.Global.GameView.height/2-233);MyPixi.gameContainer.addChild(winluonBt);MyHelper.addLblButton(winluonBt,"winAfterChia",16)}};
GamePhom.prototype.initPlayer=function(){var zOrder=4;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(cc.Global.GameView.width/2-playerMe.widthBG/2,-playerMe.heightBG/2+cc.Global.GameView.height-140);var player1=new GamePlayer;player1.sitId=1;player1.position.set(cc.Global.GameView.width-80-player1.widthBG/2,-player1.heightBG/2+cc.Global.GameView.height/2-50);var player2=new GamePlayer;player2.sitId=2;player2.position.set(cc.Global.GameView.width/2-player2.widthBG/2,-player2.heightBG/
2+cc.Global.GameView.height-630);var player3=new GamePlayer;player3.sitId=3;player3.position.set(80-player3.widthBG/2,-player3.heightBG/2+360-50);this.playerView=[playerMe,player1,player2,player3];if(this.data.Mu==2){this.playerView[1].visible=false;this.playerView[3].visible=false}for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GamePhom.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1)for(var i=1;i<=3;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}this.processPlayerPosition(this.data.ps,this.data.gS,
arrangeChauRiaOnly)};GamePhom.prototype.isReconnectOrViewer=function(){var players=this.data.players;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].TTID===PlayerMe.uid)meInPlayerList=true;if(meInPlayerList&&this.gameState===GAME_STATE.PLAYING)return true;else return false};
GamePhom.prototype.showReadyIfCan=function(){var players=this.data.ps;var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;var meReady=false;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].uid===PlayerMe.uid){meReady=players[i].r;if(players.sit<0)meInPlayerList=false;else meInPlayerList=true}if(!meReady&&!isPlaying&&players.length>=2){this.readyBt.visible=true;cc.log("ready vao dayyyyyy")}else if(meReady&&!isPlaying&&players.length>=2)this.readyBt.visible=false;else this.readyBt.visible=
false;if(this.gameState==GAME_STATE.PLAYING||!meInPlayerList)this.readyBt.visible=false;var autoReady=cc.Global.GetSetting(GameSetting.autoReady,false);if(autoReady&&this.gameState!=GAME_STATE.PLAYING&&meInPlayerList&&!meReady){var idMaster=this.getIdRoomMaster();if(players[idMaster].uid!==PlayerMe.uid)this.sendStartRequest()}};GamePhom.prototype.hideAllBtnPlay=function(){for(var i=0;i<this.buttonList.length;i++)this.buttonList[i].visible=false};
GamePhom.prototype.showAllBtnPlay=function(){this.anBaiBt.visible=true;this.danhbaiBt.visible=true};
GamePhom.prototype.updateStateButton=function(data){if(data&&data.uid==PlayerMe.uid){if(data.canChiu){this.chiuBt.visible=true;this.anBt.visible=false}if(data.canChiuU){this.danhbaiBt.visible=false;this.chiuBt.visible=false;this.anBt.visible=false;this.bocBt.visible=false;this.boUbt.visible=true;this.uBt.visible=true}if(data.canU){this.danhbaiBt.visible=false;this.chiuBt.visible=false;this.anBt.visible=false;this.bocBt.visible=false;this.boUbt.visible=true;this.uBt.visible=true}}};
GamePhom.prototype.onUpdateTurn=function(uid,currentTime,newTurn){this.currentTurn=uid;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,this.timeTurn);else this.allSlot[i].stopTimeRemain()};
GamePhom.prototype.onChangeTurn=function(dataObj){if(TEST_MODE){if(!this.last)this.last=1;fUid=PlayerMe.uid;tUid=this.allSlot[1].uid;var dCs=36;if(fUid===PlayerMe.uid){var rd=0;dCs=this.cardList.getCards()[rd].getCardData().codeCard}else{dCs=this.last;this.last++}if(this.last>51)this.last=1;dataObj=[5,{"ssc":true,"fP":{"uid":fUid,"pS":4,"dCs":dCs,"dn":"005gts"},"cmd":851,"tP":{"uid":tUid,"dn":"006gts"}}]}cc.log("onChangeTurn "+JSON.stringify(dataObj));var thiz=this;if(thiz.uidAnChot){thiz.setStatePlayer(thiz.uidAnChot,
state_player.NOTHING);thiz.uidAnChot=null}var data=dataObj[1];var ssc=dataObj[1].ssc?dataObj[1].ssc:false;var sAC=dataObj[1].sAC;var fromPlayer=dataObj[1].fP;var lastArrCardDeal=fromPlayer.dCs;if(fromPlayer.pS==PHOM_PLAYER_STATE.DANH_BAI&&typeof lastArrCardDeal!=="undefined"){this.lastArrCardDeal=lastArrCardDeal;this.lastUidDealCard=fromPlayer.uid}var tP=dataObj[1].tP;var myActor=null;if(fromPlayer.uid===PlayerMe.uid)if(sAC&&sAC.length)this.suggestArrangeCard=sAC;this.onUpdateTurn(tP.uid,this.timeTurn,
false);this.allSlot.forEach(function(slot,index){if(slot)if(tP.uid===slot.uid)if(tP.uid===PlayerMe.uid){thiz.deckCards.showBocBai(true);thiz.activeTurnButton(true,ssc,true);if(sAC&&sAC.length)this.suggestArrangeCard=sAC;myActor=slot}else{if(thiz.checkMeIsPlaying())thiz.showXepBaiOnly();thiz.deckCards.showBocBai(false)}});if(fromPlayer&&fromPlayer.pS==PHOM_PLAYER_STATE.DANH_BAI&&typeof lastArrCardDeal!=="undefined")thiz.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal,ssc)};
GamePhom.prototype.onDanhBaiThanhCong=function(uid,cardData,showTriangle){var c=Utils.getCardFromServer(cardData);var cardDealInHand=this.cardList.getCardByRank(c.point,c.suit);cardData=[cardData];var slot=this.getSlotByUid(uid);if(slot){var cards=[];for(var i=0;i<cardData.length;i++)cards.push(Utils.getCardFromServer(cardData[i]));if(slot.isMe){var arr=this.cardList.removeCard(cards);for(var i=0;i<arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);arr[i].position.set(pos.x,pos.y);arr[i].canTouch=
false;arr[i]._selected=false}this.cardOnTable[slot.sitId].addCardPhomToTable(arr,slot.sitId,1);this.cardList.reOrder()}else{var bCard=this.backCardList[slot.sitId];var pos=cc.convertToWorldSpace(bCard);pos=cc.p(pos.x+bCard.widthContainer/2,pos.y+bCard.heightContainer/2);this.cardOnTable[slot.sitId].addNewCardListPhomToTable(cards,pos,slot.sitId,GamePhom.cardOriginScaleBackCard,showTriangle)}}};
GamePhom.prototype.onAnBaiThanhCong=function(uid,uidBiAn,cardData,cardDataChuyenPhom){var sitIdBiAn=this.getSlotByUid(uidBiAn).sitId;var c=Utils.getCardFromServer(cardData);var cardDealInHand=this.cardOnTable[sitIdBiAn].getCardByRank(c.point,c.suit);var thiz=this;cardData=[cardData];var slot=this.getSlotByUid(uid);if(slot){var cards=[];for(var i=0;i<cardData.length;i++)cards.push(Utils.getCardFromServer(cardData[i]));var isUp=false;var arr=this.cardOnTable[sitIdBiAn].removeCard(cards);for(var i=0;i<
arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);arr[i].position.set(pos.x,pos.y)}if(uid==PlayerMe.uid){var card=arr[0];card.originState=state_card.ORANGE_BORDER;card.canTouch=true;this.cardList.addCard(card);var p=cc.convertToNodeSpace(this.cardList,cc.p(card.x,card.y));card.position.set(p.x,p.y);this.cardList.reOrder()}else{this.cardEarnList[slot.sitId].addCard(arr[0]);var p=cc.convertToNodeSpace(this.cardEarnList[slot.sitId],cc.p(arr[0].x,arr[0].y));arr[0].position.set(p.x,p.y);this.cardEarnList[slot.sitId].reOrder()}}};
GamePhom.prototype.onEndGameResponse=function(dataObj){if(TEST_MODE)dataObj=[5,{"ps":[{"cs":[39,38,42],"uid":PlayerMe.uid,"pt":31,"dn":"fucker","mes":[],"mX":950,"m":50395,"fT":11,"whr":10},{"cs":[29,21,20,24,9,8],"uid":this.allSlot[1].uid,"pt":33,"dn":"zzzzzzzzzzzzzzz","mX":-1E3,"m":100052526,"fT":4}],"fP":{"cs":37,"uid":this.allSlot[0].uid,"pS":4,"dn":"zzzzzzzzzzzzzzz","mes":[]},"cmd":855}];cc.log("onEndGameResponse "+JSON.stringify(dataObj));var data=dataObj[1];var thiz=this;var player=dataObj[1].ps;
thiz.playerPlayed=player;thiz.isShowingResult=true;thiz.showReady(false);thiz.hideAllBtnPlay();thiz.stopTurnTimeAll();thiz.deckCards.show(false);for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var fromPlayer=dataObj[1].fP;if(fromPlayer){this.isPlaying=false;this.handleEndgameFromPlayer(dataObj);thiz.allSlot.forEach(function(_slot,index){if(_slot!=null){var isHorizontal=true;var scale=.5;if(!_slot.isMe){var p=thiz.getPlayerDataByUid(_slot.uid,player);if(p&&(p.fT<7||p.fT>
10)){var cards=[];var cardArray=p.cs;for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));_slot.showCardEndGame(cards,true)}}}});this.showResult(true,dataObj[1])}else thiz.onWinAfterChiabai(dataObj[1]);thiz.data.ps.forEach(function(p,i){p.pi=false;p.r=false;p.ib=false});var delay=cc.delayTime(this.tfeg);var cb=function(){if(thiz.registerQuit&&thiz.registerQuitHandler){thiz.registerQuit=false;thiz.registerQuitHandler();thiz.registerQuitHandler=null}thiz.resetNewGame();
thiz.arrangePlayerInGame();var idMaster=thiz.getIdRoomMaster();if(thiz.data.ps[idMaster].uid==PlayerMe.uid){thiz.showReady(false);thiz.showStartIfCan()}else thiz.showReadyIfCan()};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));cc.log("delay "+this.tfeg+" then resetgame")};
GamePhom.prototype.handleEndgameFromPlayer=function(dataObj){var thiz=this;var fromPlayer=dataObj[1].fP;var fromUid=fromPlayer.uid;var pS=fromPlayer.pS;var mes=fromPlayer.mes;if(pS===6)mes=fromPlayer.lCs;var allphom=[];var slot=this.getSlotByUid(fromPlayer.uid);var id=slot.sitId;if(pS===6||mes&&mes.length){for(var i=0;i<mes.length;i++){var phom=mes[i].cs;if(pS===6)mes[i].meid=i+1;allphom=allphom.concat(phom)}if(fromPlayer.uid==PlayerMe.uid){thiz.cardList.setMutiSelectEnable(true);thiz.dealPhomMe(mes,
slot)}else{var bCard=thiz.backCardList[slot.sitId];var worldPos=bCard.getGlobalPosition();thiz.phomOnTable[slot.sitId].dealPhoms(mes,true,worldPos);thiz.cardEarnList[slot.sitId].removeAll()}}var cs=fromPlayer.cs;var cardInPhom=false;if(allphom&&allphom.length&&allphom.indexOf(cs)!==-1)cardInPhom=true;thiz.allSlot.forEach(function(_slot,index){if(_slot)if(fromUid===_slot.uid){var isMyPlayer=false;if(PlayerMe.uid===fromUid)isMyPlayer=true;var lastArrCardDeal=fromPlayer.cs;var ssc=fromPlayer.ssc?true:
false;if(fromPlayer&&typeof lastArrCardDeal!=="undefined")if(fromPlayer.pS===PHOM_PLAYER_STATE.DANH_BAI)thiz.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal,ssc);else if(fromPlayer.pS==PHOM_PLAYER_STATE.BOC_BAI)if(isMyPlayer)thiz.cardList.addNewCard(lastArrCardDeal,true,null,thiz.deckCards.deckCardBtn.scale.x);else{var cards=[Utils.getCardFromServer(0)];thiz.backCardList[slot.sitId].dealBackCards(cards,true,true)}if(PlayerMe.uid.uid===fromUid){var currSCA=thiz.suggestArrangeCard;var newSCA=Utils.difference(currSCA,
allphom);if(newSCA&&newSCA.length)thiz.suggestArrangeCard=newSCA}else;}})};
GamePhom.prototype.showResult=function(isShow,dataObj,isWinafterChiabai){if(!isWinafterChiabai)isWinafterChiabai=false;var thiz=this;if(isShow){for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var playerArr=dataObj.ps;this.playerPlayed=playerArr;this.playSoundAction("finished");thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid==slot.uid){var cs=playerArr[i].cs;var fT=playerArr[i].fT;var pt=playerArr[i].pt;slot.showResultPhom(playerArr[i].m,
playerArr[i].mX,slot.sitId,pt,fT);if(playerArr[i].uid==PlayerMe.uid)if(this.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold=playerArr[i].m;else PlayerMe.chip=playerArr[i].m;if(fT>=7&&fT<=10&&!isWinafterChiabai)if(typeof cs!=="undefined"&&cs)thiz.onDanhBaiThanhCong(playerArr[i].uid,cs,false);break}});for(var i=0;i<playerArr.length;i++)thiz.updateMoneyPlayer(playerArr[i])}};
GamePhom.prototype.sendStartRequest=function(){cc.log("send ready ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};GamePhom.prototype.onXepBai=function(){cc.log("send onXepBai");this.ideGameNumber=0};
GamePhom.prototype.sendAnBai=function(){if(TEST_MODE){this.onAnBaiResponse();return}var thiz=this;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.AN_BAI}];LobbyClient.getInstance().send(sendObj);thiz.ideGameNumber=0};
GamePhom.prototype.onGuiBai=function(){cc.log("send onGuiBai");var cards=this.cardList.getCardSelected();if(cards.length>0){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.GUI_BAI,"cs":intCardArr}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c c\u00e2y b\u00e0i n\u00e0o")};
GamePhom.prototype.onHaBai=function(){var cards=this.cardList.getCardSelected();if(cards.length>0){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.HA_PHOM,"cs":intCardArr}];LobbyClient.getInstance().send(msg);this.ideGameNumber=0}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c ph\u1ecfm n\u00e0o")};
GamePhom.prototype.onU=function(){cc.log("send onU");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.U}];LobbyClient.getInstance().send(msg);this.ideGameNumber=0};GamePhom.prototype.onWaitUTron=function(){this.showDanhBaiAndHideWaitUTron();this.ideGameNumber=0};
GamePhom.prototype.onBocBai=function(){cc.log("send onBocBai");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.BOC_BAI}];LobbyClient.getInstance().send(msg);this.ideGameNumber=0};
GamePhom.prototype.sendGuiBai=function(){var cards=this.cardList.getCardSelected();if(cards.length>0){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.GUI_BAI,"cs":intCardArr}];LobbyClient.getInstance().send(msg);this.ideGameNumber=0}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c c\u00e2y b\u00e0i n\u00e0o")};
GamePhom.prototype.sendDanhBai=function(){if(TEST_MODE){this.onChangeTurn([5,{}]);return}var cards=this.cardList.getCardSelected();if(cards.length>1)MessageNode.getInstance().show("Vui l\u00f2ng nh\u1ea5c 1 c\u00e2y b\u00e0i th\u00f4i");else if(cards.length==1){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_PHOM.DEAL_CARD,
"cs":intCardArr[0]}];LobbyClient.getInstance().send(msg);this.ideGameNumber=0}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c c\u00e2y b\u00e0i n\u00e0o")};GamePhom.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GamePhom.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}cc.log("click quit room phom");if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
this.registerQuitHandler=null}return}LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};var sort_chi=sort_chi||{};sort_chi.point=1;sort_chi.rank_chi=2;var state_binh=state_binh||{};state_binh.NOTHING=0;state_binh.BINH_LUNG=1;state_binh.BA_SANH=2;state_binh.BA_THUNG=3;state_binh.SAU_DOI=4;state_binh.NAM_DOI_1_XAM=5;state_binh.DONG_HOA=8;state_binh.DONG_HOA_1=9;state_binh.SANH_RONG=10;state_binh.SANH_RONG_DONG_HOA=11;state_binh.THANG_SAP_HAM=12;state_binh.THUA_SAP_HAM=13;state_binh.THANG_SAP_LANG=14;state_binh.THUA_SAP_LANG=15;var maubinh_chitypes=maubinh_chitypes||[];
maubinh_chitypes[0]="";maubinh_chitypes[1]="M\u1eadu th\u1ea7u";maubinh_chitypes[2]="\u0110\u00f4i";maubinh_chitypes[3]="Th\u00fa";maubinh_chitypes[4]="X\u00e1m chi";maubinh_chitypes[5]="S\u1ea3nh";maubinh_chitypes[6]="Th\u00f9ng";maubinh_chitypes[7]="C\u00f9 l\u0169";maubinh_chitypes[8]="T\u1ee9 qu\u00fd";maubinh_chitypes[9]="Th\u00f9ng ph\u00e1 s\u1ea3nh";maubinh_chitypes[10]="Th\u00f9ng ph\u00e1 s\u1ea3nh";var maubinh_sprite=maubinh_sprite||[];maubinh_sprite[0]="";maubinh_sprite[1]="mauthau";
maubinh_sprite[2]="doi";maubinh_sprite[3]="thu";maubinh_sprite[4]="xamchi";maubinh_sprite[5]="sanh";maubinh_sprite[6]="thung";maubinh_sprite[7]="culu";maubinh_sprite[8]="tuquy";maubinh_sprite[9]="tpsanh";maubinh_sprite[10]="tpsanh";var maubinh_wintypes=maubinh_wintypes||[];maubinh_wintypes[0]="";maubinh_wintypes[1]="abc";var MB_SCALE_ME=.7;var MB_SCALE_OTHER=.6;var CMD_MAUBINH=CMD_MAUBINH||{};CMD_MAUBINH.AUTO_READY=204;CMD_MAUBINH.ON_COUNT_DOWN=607;CMD_MAUBINH.CHIABAI=600;CMD_MAUBINH.END_GAME=602;
CMD_MAUBINH.UPDATE_CARD=606;CMD_MAUBINH.XEP_XONG=603;
function GameMauBinh(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.xepxong=false;this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GameMauBinh";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.khungChiResult=new KhungChi;this.khungChiResult.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(this.khungChiResult);this.clock=new ClockBinh;this.clock.displayGroup=
MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.clock);this.binhlungAnim=new BinhlungAnim;this.binhlungAnim.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.binhlungAnim);this.countDownNode=new CountDownNode;this.countDownNode.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.countDownNode);this.countDownNode.visible=false;var texts=["Chi 1","Chi 2","Chi 3","So s\u1eadp h\u1ea7m","So s\u1eadp l\u00e0ng","K\u1ebft qu\u1ea3"];this.lblNarrativeResult=
new Narrative(cc.size(220,52),texts);this.lblNarrativeResult.y-=50;this.lblNarrativeResult.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.lblNarrativeResult);this.lblNarrativeResult.visible=false;this.initGame()}GameMauBinh.prototype=Object.create(GameScene.prototype);GameMauBinh.prototype.onEnter=function(){};
GameMauBinh.prototype.onExit=function(){this._super();LobbyClient.getInstance().removeListener(this);if(this.actionUpdateCardXep){this.stopAction(this.actionUpdateCardXep);this.actionUpdateCardXep=null}};
GameMauBinh.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;if(gameState>=GAME_STATE.SHOW_KQ)MessageNode.getInstance().show("\u0110ang so k\u1ebft qu\u1ea3. Vui l\u00f2ng ch\u1edd gi\u00e2y l\u00e1t",4);this.aid=data.aid;this.initButton();this.initPlayer();this.updateGame(data)};GameMauBinh.prototype.onEnter=function(){};
GameMauBinh.prototype.updateGame=function(data){var thiz=this;var gameState=data.gS;var players=this.data.ps;var remainTime=data.rmT;if(gameState===GAME_STATE.PLAYING||gameState===GAME_STATE.SHOW_KQ)if(!data.re){this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);for(var i=0;i<players.length;i++){var p=players[i];if(p.pi)thiz.totalPlayerPlaying++}thiz.isViewing=true;thiz.showBaoBinhAndXepBai(false);if(gameState==GAME_STATE.PLAYING){MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd");
if(remainTime>0)thiz.clock.showTimeCountDown(remainTime/1E3,60)}else if(gameState==5){thiz.showBaoBinhAndXepBai(false);this.clearStatePlayer();MessageNode.getInstance().show("\u0110ang so k\u1ebft qu\u1ea3. Vui l\u00f2ng ch\u1edd")}var myActor=null;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<players.length;i++){var p=players[i];if(slot.uid==p.uid){var cardArray=[8,8,8,8,8,8,8,8,8,8,8,8,8];var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;var rr=p.rr;if(pi)if(p.uid==PlayerMe.uid);
else{var cards=[];for(var k=0;k<13;k++)cards.push(Utils.getCardFromServer(0));var animation=false;slot.cardList.dealCards(cards,false,animation);if(slot.sitId==0)slot.cardList.scale.set(MB_SCALE_ME,MB_SCALE_ME);if(rr)thiz.setStatePlayerBinh(slot.uid,rr);else if(playerState===2)thiz.setStatePlayer(slot.uid,state_player.DANG_XEP_BINH);else if(playerState===3)thiz.setStatePlayer(slot.uid,state_player.XEP_XONG_BINH)}else{cc.log("viewer "+p.dn);thiz.setStatePlayer(slot.uid,state_player.DANG_XEM)}return}}})}players.forEach(function(value,
index){if(value.C==true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;thiz.onReconnect(data)}};
GameMauBinh.prototype.onReconnect=function(data){var thiz=this;var listPlayer=data.ps;var gameState=data.gS;self.gameState=data.gS;var remainTime=data.rmT/1E3;cc.log("remainTime "+remainTime);var fi=data.fi;var isAnimChiBai=false;var isMeBaoBinh=false;var isMeXepXong=false;var myActor=null;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(slot.uid==p.uid){var cardArray=p.cs;var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;var rr=p.rr;
if(pi){thiz.totalPlayerPlaying++;if(p.uid==PlayerMe.uid){isMeBaoBinh=p.bb?p.bb:false;var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var animation=false;slot.cardList.dealCards(cards,slot.isMe,animation);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT){myActor=slot;if(!fi)if(rr)thiz.setStatePlayerBinh(slot.uid,rr);else if(playerState===2)thiz.setStatePlayer(slot.uid,state_player.DANG_XEP_BINH);else if(playerState===3)thiz.setStatePlayer(slot.uid,
state_player.XEP_XONG_BINH);if(playerState==3)if(!fi){thiz.showXepLai();isMeXepXong=true;thiz.playerView[0].cardList.setArrangeEnable(false,false)}}}else{var cards=[];for(var k=0;k<13;k++)cards.push(Utils.getCardFromServer(0));var animation=false;slot.cardList.dealCards(cards,false,animation);if(rr)thiz.setStatePlayerBinh(slot.uid,rr);else if(playerState===2)thiz.setStatePlayer(slot.uid,state_player.DANG_XEP_BINH);else if(playerState===3)thiz.setStatePlayer(slot.uid,state_player.XEP_XONG_BINH)}}else thiz.setStatePlayer(slot.uid,
state_player.DANG_XEM);return}}});if(gameState==GAME_STATE.PLAYING){thiz.showBaoBinhAndXepBai(true);if(isMeBaoBinh)thiz.buttons[0].visible=false;if(isMeXepXong)thiz.buttons[0].visible=false;var currTime=(new Date).getTime()/1E3;thiz.showResultBegin=currTime;thiz.clock.showTimeCountDown(remainTime,60);if(this.actionUpdateCardXep){this.stopAction(this.actionUpdateCardXep);this.actionUpdateCardXep=null}this.actionUpdateCardXep=cc.repeatForever(cc.sequence(cc.delayTime(2),cc.callFunc(function(){thiz.onUpdateCardXep()})));
thiz.runAction(thiz,thiz.actionUpdateCardXep)}else if(gameState==5){thiz.showBaoBinhAndXepBai(false);cc.log("browser reconnect when sochi is animationing");thiz.showResult(true,fi,0,remainTime)}};
GameMauBinh.prototype.initPlayer=function(){var thiz=this;var size=cc.Global.GameView;var zOrder=3;var dXX=65/2;var dYY=75/2;var player3=new GamePlayer;player3.sitId=3;player3.position.set(90-player3.widthBG/2,-player3.heightBG/2+size.height-440);player3.cardList=new MauBinhCardList(cc.p(370+dXX,dYY+370));player3.cardList.scale.set(.5,.5);player3.cardList.displayResultRight=true;player3.infoLayer.addChild(player3.cardList);player3.cardList.displayGroup=MyPixi.cardLayer;MyPixi.gameContainer.addChild(player3);
var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(cc.Global.GameView.width/2-240-playerMe.widthBG/2,-playerMe.heightBG/2+size.height-130);var sizeMe=cc.size(playerMe.widthBG,playerMe.heightBG);playerMe.cardList=new MauBinhCardList(cc.p(sizeMe.width+310+dXX,dYY+sizeMe.height/2+40));playerMe.cardList.isSlotMe=true;playerMe.cardList.onUpdateResultChi=function(strArr,isBinhLung){thiz.khungChiResult.showResultChi(strArr);if(thiz.gameState!=GAME_STATE.SHOW_KQ)thiz.binhlungAnim.show(isBinhLung);
cc.log(thiz.gameState+" showbinhlung "+isBinhLung)};playerMe.infoLayer.addChild(playerMe.cardList);playerMe.cardList.displayGroup=MyPixi.cardLayer;MyPixi.gameContainer.addChild(playerMe);var player1=new GamePlayer;player1.sitId=1;player1.position.set(cc.Global.GameView.width-100-player1.widthBG/2,-player1.heightBG/2+size.height-310);player1.cardList=new MauBinhCardList(cc.p(220+dXX,dYY+70));player1.cardList.scale.set(.5,.5);player1.infoLayer.addChild(player1.cardList);player1.cardList.displayGroup=
MyPixi.cardLayer;MyPixi.gameContainer.addChild(player1);var player2=new GamePlayer;player2.sitId=2;player2.position.set(cc.Global.GameView.width/2+200-player2.widthBG/2,-player2.heightBG/2+120);player2.cardList=new MauBinhCardList(cc.p(70+dXX,dYY+230));player2.cardList.scale.set(.5,.5);player2.infoLayer.addChild(player2.cardList);player2.cardList.displayGroup=MyPixi.cardLayer;MyPixi.gameContainer.addChild(player2);this.playerView=[playerMe,player1,player2,player3];if(this.data.Mu==2){this.playerView[1].visible=
false;this.playerView[3].visible=false}for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GameMauBinh.prototype.initButton=function(){var thiz=this;var baobinhBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onBaoBinh()});baobinhBt.position.set(cc.Global.GameView.width-100,cc.Global.GameView.height/2+214);MyPixi.gameContainer.addChild(baobinhBt);MyHelper.addLblButton(baobinhBt,"B\u00e1o binh",16);var xepBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.xepBaiXong()});xepBt.position.set(cc.Global.GameView.width-100,cc.Global.GameView.height/2+
288);MyPixi.gameContainer.addChild(xepBt);MyHelper.addLblButton(xepBt,"X\u1ebfp xong",16);this.buttons=[baobinhBt,xepBt];this.showBaoBinhAndXepBai(false);if(TEST_MODE){var chiabaiBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.chiabai()},true,cc.size(100,50),[10,10,10,10]);chiabaiBt.position.set(cc.Global.GameView.width-580,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(chiabaiBt);MyHelper.addLblButton(chiabaiBt,"chia",16);var xepxongBt=MyHelper.createButton("button/btn_0.png",
true,function(){var iar=!thiz.xepxong;var data=[5,{"uid":PlayerMe.uid,"cmd":603,"iar":iar}];thiz.onXepBaiResponse(data)},true,cc.size(100,50),[10,10,10,10]);xepxongBt.position.set(cc.Global.GameView.width-480,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(xepxongBt);MyHelper.addLblButton(xepxongBt,"xepxong",16);var endGameBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.onEndGameResponse()},true,cc.size(100,50),[10,10,10,10]);endGameBt.position.set(cc.Global.GameView.width-
380,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(endGameBt);MyHelper.addLblButton(endGameBt,"End",16)}};GameMauBinh.prototype.xepBaiXong=function(){this.onToggleXepBai(this.xepxong)};
GameMauBinh.prototype.onBaoBinh=function(){var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n ch\u1ec9 c\u00f3 1 l\u01b0\u1ee3t b\u00e1o binh.\n B\u1ea1n c\u00f3 mu\u1ed1n b\u00e1o kh\u00f4ng ?");var thiz=this;dialog.okButtonHandler=function(){var intCardArr=thiz.playerView[0].cardList.getCardsId();if(!intCardArr||intCardArr.length==0){cc.log("intCardArr null || []");return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),
{"cmd":605,"cs":intCardArr}];LobbyClient.getInstance().send(sendObj);dialog.hide()};dialog.showWithAnimationScale();this.ideGameNumber=0};
GameMauBinh.prototype.onToggleXepBai=function(xepxong){var thiz=this;cc.log("send onToggleXepBai");var intCardArr=this.playerView[0].cardList.getCardsId();if(!intCardArr||intCardArr.length==0){cc.log("intCardArr null || []");return}var cmdCode=xepxong===true?604:603;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":cmdCode,"cs":intCardArr}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameMauBinh.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);
else if(cmd==CMD_MAUBINH.AUTO_READY)this.onAutoReadyResponse(dataObj);else if(cmd==CMD_MAUBINH.ON_COUNT_DOWN)this.onCountDownResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY)this.onReadyResponse(dataObj);else if(cmd===CMD_MAUBINH.CHIABAI)this.chiabai(dataObj);else if(cmd===CMD_MAUBINH.END_GAME)this.onEndGameResponse(dataObj);else if(cmd===CMD_MAUBINH.XEP_XONG)this.onXepBaiResponse(dataObj)};
GameMauBinh.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};GameMauBinh.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);if(errorCode==600){this.isBaoBinh=true;this.buttons[0].visible=false;var msg="B\u00e1o binh th\u1ea5t b\u1ea1i";var dialog=new MessageOkDialog;dialog.setMessage(msg);dialog.showWithAnimationScale()}};
GameMauBinh.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame();this.showStartIfCan()};
GameMauBinh.prototype.onAutoReadyResponse=function(dataObj){cc.log("onAutoReadyResponse "+JSON.stringify(dataObj));cc.log("send ready");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameMauBinh.prototype.onCountDownResponse=function(dataObj){cc.log("onCountDownResponse "+JSON.stringify(dataObj));this.checkLeaveRoomIfCan();var timeCountDown=dataObj[1].T/1E3;cc.log(timeCountDown+" timeCountDown");var thiz=this;cc.log("vao day nao");thiz.resetNewGame();thiz.arrangePlayerInGame();var cb=function(){thiz.requestStart()};var callFun=cc.callFunc(cb);this.countDownNode.showWithTime(timeCountDown);this.runAction(this,cc.sequence(cc.delayTime(timeCountDown),callFun))};
GameMauBinh.prototype.requestStart=function(){cc.log("aaaa send 607 to server");this.countDownNode.visible=false;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":607}];LobbyClient.getInstance().send(sendObj)};
GameMauBinh.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("onReadyResponse "+JSON.stringify(dataObj));cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING)};
GameMauBinh.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameMauBinh.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameMauBinh.prototype.onUpdateCardXep=function(){if(this.gameState==GAME_STATE.SHOW_KQ)return;var intCardArr=this.playerView[0].cardList.getCardsId();if(!intCardArr||intCardArr.length==0){cc.log("intCardArr null || []");return}if(this.oldIntCardArr&&intCardArr.toString()==this.oldIntCardArr.toString())return;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":606,"cs":intCardArr}];LobbyClient.getInstance().send(sendObj);this.oldIntCardArr=
intCardArr};GameMauBinh.prototype.showXepLai=function(){var thiz=this;thiz.xepxong=true;thiz.buttons[0].visible=false;thiz.buttons[1].visible=true;MyHelper.addLblButton(this.buttons[1],"X\u1ebfp l\u1ea1i",16);thiz.setStatePlayer(PlayerMe.uid,state_player.XEP_XONG_BINH)};GameMauBinh.prototype.showBaoBinhAndXepBai=function(isShow){var thiz=this;if(isShow){thiz.buttons[0].visible=true;thiz.buttons[1].visible=true}else{thiz.buttons[0].visible=false;thiz.buttons[1].visible=false}};
GameMauBinh.prototype.onXepBaiResponse=function(dataObj){var thiz=this;var uid=dataObj[1].uid;var r=dataObj[1].r;var stateId=1;var slot=this.getSlotByUid(uid);if(r){stateId=3;this.xepxong=true;thiz.isBaoBinh=true;thiz.buttons[0].visible=false;thiz.buttons[1].visible=false;if(uid===PlayerMe.uid){this.xepxong=true;this.binhlungAnim.show(false)}thiz.playerView[0].cardList.setArrangeEnable(false,true);MessageNode.getInstance().show("B\u00e1o binh th\u00e0nh c\u00f4ng",1);thiz.setStatePlayerBinh(slot.uid,
r)}else if(dataObj[1].iar){stateId=2;if(uid===PlayerMe.uid){this.xepxong=true;thiz.showXepLai();thiz.playerView[0].cardList.setArrangeEnable(false,true)}thiz.setStatePlayer(slot.uid,state_player.XEP_XONG_BINH)}else{if(uid===PlayerMe.uid){if(thiz.isBaoBinh)thiz.buttons[0].visible=false;else thiz.buttons[0].visible=true;MyHelper.addLblButton(this.buttons[1],"X\u1ebfp xong",16);thiz.playerView[0].cardList.setArrangeEnable(true,true);thiz.xepxong=false}thiz.setStatePlayer(slot.uid,state_player.NOTHING)}};
GameMauBinh.prototype.onEndGameResponse=function(dataObj){cc.log("endgame "+JSON.stringify(dataObj));for(var i=0;i<this.allSlot.length;i++){var action=this.allSlot[i].actionEndGame;if(action){this.stopAction(action);this.allSlot[i].actionEndGame=null}}var thiz=this;this.gameState=GAME_STATE.SHOW_KQ;this.clock.showClock(false);thiz.playerView[0].cardList.setArrangeEnable(false,false);thiz.clearStatePlayer();thiz.binhlungAnim.show(false);if(TEST_MODE)thiz.showResult();else thiz.showResult(true,dataObj[1])};
GameMauBinh.prototype.showResult=function(isShow,dataObj,timePass,timeRemain){if(TEST_MODE){isShow=true;dataObj={"hsl":false,"ps":[{"cs":[22,21,40,47,30,33,29,9,39,24,17,7,42],"rr":1,"uid":"0aa6ea41-1d17-4a3a-a62d-65c2f66b7ee7","psh":0,"psl":0,"dn":"004gts","mX":-3E3,"gr":[[],[],[]],"tp":-6,"m":97520,"rp":-6},{"cs":[34,37,41,44,49,15,13,16,25,46,8,26,2],"uid":this.allSlot[2].uid,"psh":0,"psl":0,"dn":"dohimi123","mX":2850,"gr":[[],[],[]],"tp":6,"m":100039350,"rp":6}],"hsc":false,"hb":false,"cmd":602,
"hsh":false};dataObj={"hsl":true,"ps":[{"cs":[17,15,10,7,0,27,22,21,11,9,41,38,32],"uid":"uid3","psh":0,"psl":0,"dn":"solotroi11","mX":475,"gr":[[{"sc":1,"uid":"PlayerMe.uid"},{"sc":1,"uid":"uid1"},{"sc":-1,"uid":"uid2"}],[{"sc":-1,"uid":"uid1"},{"sc":1,"uid":"uid2"},{"sc":1,"uid":"PlayerMe.uid"}],[{"sc":1,"uid":"PlayerMe.uid"},{"sc":-1,"uid":"uid1"},{"sc":-1,"uid":"uid2"}]],"tp":1,"m":7380,"rp":0},{"cs":[3,12,6,5,4,23,51,49,47,45,40,30,24],"uid":PlayerMe.uid,"psh":10,"psl":10,"dn":"ad_suYbx0aE",
"mX":-500,"gr":[[{"sc":1,"uid":"uid1"},{"sc":-1,"uid":"uid3"},{"sc":-1,"uid":"uid2"}],[{"sc":1,"uid":"uid1"},{"sc":1,"uid":"uid3"},{"sc":1,"uid":"uid2"}],[{"sc":-1,"uid":"uid1"},{"sc":-1,"uid":"uid3"},{"sc":-1,"uid":"uid2"}]],"tp":-1,"m":18276,"rp":0},{"cs":[31,29,39,37,36,25,20,16,35,34,1,48,46],"uid":"uid2","psh":3,"psl":0,"dn":"quynht1","mX":3800,"gr":[[{"sc":1,"uid":PlayerMe.uid},{"sc":1,"uid":"uid1"},{"sc":1,"uid":"uid3"}],[{"sc":-1,"uid":PlayerMe.uid},{"sc":1,"uid":"uid1"},{"sc":-1,"uid":"uid3"}],
[{"sc":1,"uid":PlayerMe.uid},{"sc":1,"uid":"uid1"},{"sc":1,"uid":"uid3"}]],"tp":8,"m":57536,"rp":0},{"cs":[44,43,18,42,19,28,8,13,14,26,33,50,2],"uid":"uid1","psh":-3,"psl":0,"dn":"dohimihi","mX":-4E3,"gr":[[{"sc":-1,"uid":PlayerMe.uid},{"sc":-1,"uid":"uid3"},{"sc":-1,"uid":"uid2"}],[{"sc":-1,"uid":PlayerMe.uid},{"sc":-1,"uid":"uid3"},{"sc":-1,"uid":"uid2"}],[{"sc":1,"uid":PlayerMe.uid},{"sc":1,"uid":"uid3"},{"sc":-1,"uid":"uid2"}]],"tp":-8,"m":240743,"rp":0}],"hsc":true,"hb":false,"cmd":602,"hsh":true}}if(!timePass)timePass=
0;if(!timeRemain)timeRemain=-1;var thiz=this;thiz.disablePendingAndResetNewGame=false;this.binhlungAnim.show(false);thiz.showBaoBinhAndXepBai(false);thiz.clock.showClock(false);var hsh=dataObj.hsh;var hsl=dataObj.hsl;var hsc=dataObj.hsc;var hb=dataObj.hb;var playerArr=dataObj.ps;thiz.playerPlayed=playerArr;if(isShow){var time3s=3;var timeToDelay=(playerArr.length-1)*.8+2;if(timePass===0){thiz.playSoundAction("finished");thiz.dataResult=dataObj;thiz.isShowingResult=true;thiz.showResultTotalTime=0;
if(hsc)thiz.showResultTotalTime=3*timeToDelay+9;if(hsh)thiz.showResultTotalTime+=3;if(hsl)thiz.showResultTotalTime+=3;thiz.showResultTotalTime+=4;if(timeRemain>=0){timePass=thiz.showResultTotalTime-timeRemain;thiz.showResultBegin-=timePass}}var isBinh=false;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){var cs=playerArr[i].cs;var uid=playerArr[i].uid;var psl=playerArr[i].psl;var psh=playerArr[i].psh;var fdn=playerArr[i].dn;var mx=
playerArr[i].mX;var gr=playerArr[i].gr;var tp=playerArr[i].tp;var m=playerArr[i].m;var rp=playerArr[i].rp;var rr=playerArr[i].rr;if(rr)isBinh=true;var cards=[];for(var k=0;k<cs.length;k++)cards.push(Utils.getCardFromServer(cs[k]));cc.log("deal card to "+slot.sitId+"cardlength "+cards.length);slot.cardList.dealCards(cards,slot.isMe,false);slot.cardList.arrangeCard();cc.log("deal card to then arrange done "+slot.sitId);if(slot.isMe)slot.cardList.setArrangeEnable(false);var kq=cc.callFunc(function(){thiz.lblNarrativeResult.showLine(5)});
var hideKq=cc.callFunc(function(){thiz.lblNarrativeResult.hideLine()});var delay3s=cc.delayTime(time3s-.2);var delay=cc.delayTime(timeToDelay);var delay2=cc.delayTime(timeToDelay);var delay3=cc.delayTime(timeToDelay);var delay3sChi2=cc.delayTime(time3s-.2);var delay3sChi3=cc.delayTime(time3s-.2);var delay3hsh=cc.delayTime(time3s);var delay3hsl=cc.delayTime(time3s);var delay3chiExchange=cc.delayTime(time3s);var delay1s=cc.delayTime(1);var hshAction=null;var hslAction=null;if(hsh)hshAction=cc.sequence(cc.callFunc(function(){thiz.lblNarrativeResult.showLine(3)}),
cc.callFunc(function(){cc.log("hsh debug "+psh);slot.showChiExchange(psh,true,false)}));else{hshAction=cc.delayTime(0);delay3hsh=cc.delayTime(0)}if(hsl)hslAction=cc.sequence(cc.callFunc(function(){thiz.lblNarrativeResult.showLine(4)}),cc.callFunc(function(){cc.log("hsh debug "+psl);slot.showChiExchange(psl,false,true)}));else{hslAction=cc.delayTime(0);delay3hsl=cc.delayTime(0)}var showResultMauBinh=cc.callFunc(function(){slot.cardList.removeAll();slot.showResultMauBinh(m,mx)});var pendingAction=cc.callFunc(function(){thiz.handlePendingBack()});
var endResultAction=cc.callFunc(function(){thiz.resetNewGame()});var showAllChiExchange=cc.callFunc(function(){slot.showAllChi(tp,mx,m,true)});var showAll=cc.callFunc(function(){slot.cardList.showCardAll(true,slot.isMe)});if(hsc){var chi1=cc.callFunc(function(){thiz.lblNarrativeResult.showLine(0)});var chi2=cc.callFunc(function(){thiz.lblNarrativeResult.showLine(1)});var chi3=cc.callFunc(function(){thiz.lblNarrativeResult.showLine(2)});var callback1=cc.callFunc(function(){slot.cardList.revealChi(0,
slot.isMe,timeToDelay)});var callback2=cc.callFunc(function(){slot.cardList.revealChi(1,slot.isMe,timeToDelay)});var callback3=cc.callFunc(function(){slot.cardList.revealChi(2,slot.isMe,timeToDelay)});var chiResult1=0;gr[0].forEach(function(v,i){chiResult1-=v.sc});var chiResult2=0;gr[1].forEach(function(v,i){chiResult2-=v.sc});var chiResult3=0;gr[2].forEach(function(v,i){chiResult3-=v.sc});if(timePass<=timeToDelay)delay=cc.delayTime(timeToDelay-timePass);else if(timePass<=timeToDelay+time3s){delay=
cc.delayTime(0);delay3s=cc.delayTime(timeToDelay+time3s-timePass)}else if(timePass<=timeToDelay+time3s+timeToDelay){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(2*timeToDelay+time3s-timePass)}else if(timePass<=2*timeToDelay+2*time3s){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=cc.delayTime(2*timeToDelay+2*time3s-timePass)}else if(timePass<=3*timeToDelay+2*time3s){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=
cc.delayTime(0);delay3=cc.delayTime(3*timeToDelay+2*time3s-timePass)}else if(timePass<=3*timeToDelay+3*time3s){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=cc.delayTime(0);delay3=cc.delayTime(0);delay3sChi3=cc.delayTime(3*timeToDelay+3*time3s-timePass)}else if(timePass<=3*timeToDelay+4*time3s){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=cc.delayTime(0);delay3=cc.delayTime(0);delay3sChi3=cc.delayTime(0);if(hsh)delay3hsh=cc.delayTime(3*
timeToDelay+4*time3s-timePass);else if(hsl)delay3hsl=cc.delayTime(3*timeToDelay+4*time3s-timePass);if(!hsh&&!hsh)delay3chiExchange=cc.delayTime(3*timeToDelay+4*time3s-timePass)}else if(hsh||hsl){if(timePass<=3*timeToDelay+5*time3s){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=cc.delayTime(0);delay3=cc.delayTime(0);delay3sChi3=cc.delayTime(0);delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=cc.delayTime(3*timeToDelay+5*time3s-timePass)}}else if(timePass<=
3*timeToDelay+4*time3s+1){delay=cc.delayTime(0);delay3s=cc.delayTime(0);delay2=cc.delayTime(0);delay3sChi2=cc.delayTime(0);delay3=cc.delayTime(0);delay3sChi3=cc.delayTime(0);delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=cc.delayTime(0);delay1s=cc.delayTime(3*timeToDelay+4*time3s-timePass)}var rs1=cc.callFunc(function(){slot.showResultForChi(1,delay3s.time/1E3,-chiResult1)});var rs2=cc.callFunc(function(){slot.showResultForChi(2,delay3sChi2.time/1E3,-chiResult2)});var rs3=cc.callFunc(function(){slot.showResultForChi(2,
delay3sChi3.time/1E3,-chiResult3)});var seq=cc.sequence(chi1,callback1,delay,rs1,delay3s,chi2,callback2,delay2,rs2,delay3sChi2,chi3,callback3,delay3,rs3,delay3sChi3,showAll,hshAction,delay3hsh,hslAction,delay3hsl,kq,showAllChiExchange,delay3chiExchange,showResultMauBinh,hideKq,delay1s,cc.delayTime(1),pendingAction,endResultAction);if(rr){var hb=cc.callFunc(function(){slot.setStateBinhResult(rr)});var flipAndShowAllChi=cc.callFunc(function(){slot.cardList.flipAndShowAllCard(slot.isMe)});seq=cc.sequence(hb,
flipAndShowAllChi,chi1,delay,delay3s,chi2,delay2,delay3sChi2,chi3,delay3,delay3sChi3,showAll,hshAction,delay3hsh,hslAction,delay3hsl,kq,showAllChiExchange,delay3chiExchange,showResultMauBinh,hideKq,delay1s,cc.delayTime(1),pendingAction)}slot.actionEndGame=seq;thiz.runAction(slot,seq)}else{var rankBinhID=-1;var arrInterval=[];var hbinh;if(rr){rankBinhID=rr;var hbinh=cc.callFunc(function(){slot.setStateBinhResult(rr)});arrInterval.push(hbinh)}if(!hsh)delay3hsh=cc.delayTime(0);if(!hsl)delay3hsl=cc.delayTime(0);
if(hsh||hsl)if(timePass<=time3s)if(hsh)delay3hsh=cc.delayTime(time3s-timePass);else{if(hsl)delay3hsl=cc.delayTime(time3s-timePass)}else if(timePass<=2*time3s){delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=cc.delayTime(2*time3s-timePass)}else{if(timePass<=2*time3s+1){delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=cc.delayTime(0);delay1s=cc.delayTime(2*time3s+1-timePass)}}else if(timePass<=time3s){delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=
cc.delayTime(time3s-timePass)}else if(timePass<=time3s+1){delay3hsh=cc.delayTime(0);delay3hsl=cc.delayTime(0);delay3chiExchange=cc.delayTime(0);delay1s=cc.delayTime(time3s+1-timePass)}var flipAndShowAllChi=cc.callFunc(function(){slot.cardList.flipAndShowAllCard(slot.isMe)});arrInterval=arrInterval.concat([kq,flipAndShowAllChi,hshAction,delay3hsh,hslAction,delay3hsl,kq,showAllChiExchange,delay3chiExchange,showResultMauBinh,hideKq,delay1s,cc.delayTime(1),pendingAction,endResultAction]);var seq=new PIXI.action.Sequence(arrInterval);
slot.actionEndGame=seq;thiz.runAction(slot,seq)}break}});for(var i=0;i<playerArr.length;i++)thiz.updateMoneyPlayer(playerArr[i])}};
GameMauBinh.prototype.chiabai=function(dataObj){var thiz=this;this.stopAllActions();this.countDownNode.visible=false;for(var i=0;i<this.allSlot.length;i++){var action=this.allSlot[i].actionEndGame;if(action){this.stopAction(action);this.allSlot[i].actionEndGame=null}}this.resetNewGame();this.showBaoBinhAndXepBai(true);MyHelper.addLblButton(this.buttons[1],"X\u1ebfp xong",16);if(TEST_MODE){var uid=this.allSlot[0].uid;var cardsTest=[5,8,12,16,20,13,16,20,15,19,0,3,50];dataObj=[5,{"cs":cardsTest,"T":6E4,
"lpi":[PlayerMe.uid,this.allSlot[1].uid,this.allSlot[2].uid,this.allSlot[3].uid],"cmd":600}]}cc.log("chiabai  "+JSON.stringify(dataObj));var data=dataObj[1];this.showReady(false);this.ideGameNumber++;this.isPlaying=true;this.playSoundAction("chiabai");var time=data.T/1E3;this.clock.showTimeCountDown(data.T/1E3,time);if(this.actionUpdateCardXep){this.stopAction(this.actionUpdateCardXep);this.actionUpdateCardXep=null}this.actionUpdateCardXep=cc.repeatForever(cc.sequence(cc.delayTime(2),cc.callFunc(function(){thiz.onUpdateCardXep()})));
thiz.runAction(thiz,thiz.actionUpdateCardXep);this.updateGoldAllPlayerFromServer(dataObj);this.startGame();var data=dataObj[1];this.gameState=GAME_STATE.PLAYING;this.data.gS=GAME_STATE.PLAYING;var cardArray=data.cs;var listPlayer=data.lpi;this.totalPlayerPlaying=listPlayer.length;this.showBaoBinhAndXepBai(true);this.data.ps.forEach(function(player,index){if(listPlayer.indexOf(player.uid)!==-1)player.pi=true});var animation=true;if(listPlayer.indexOf(PlayerMe.uid)>-1){thiz.setStatePlayer(PlayerMe.uid,
state_player.NOTHING);var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));this.playerView[0].cardList.dealCards(cards,true,animation)}else{this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);this.isPlaying=false}for(var i=0;i<this.allSlot.length;i++){var slot=this.allSlot[i];if(!slot.isMe)if(listPlayer.indexOf(slot.uid)>-1){thiz.setStatePlayer(slot.uid,state_player.DANG_XEP_BINH);var cards=[];for(var k=0;k<13;k++)cards.push(Utils.getCardFromServer(0));
slot.cardList.dealCards(cards,false,animation)}else this.setStatePlayer(slot.uid,state_player.DANG_XEM)}};
GameMauBinh.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1){for(var i=1;i<=3;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}cc.log("arrangePlayerInGame")}this.processPlayerPosition(this.data.ps,
this.data.gS,arrangeChauRiaOnly)};GameMauBinh.prototype.checkLeaveRoomIfCan=function(){var isIdeKick=false;cc.log("registerQuit "+this.registerQuit);if(this.registerQuit){this.registerQuit=false;this.quitRoom(isIdeKick)}else if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;isIdeKick=true;this.registerQuit=false;this.quitRoom(isIdeKick)}};
GameMauBinh.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameMauBinh.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}var thiz=this;cc.log("click quit room tlmn");if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();thiz.quitRoom(false)}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
this.registerQuitHandler=null}return}LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GameMauBinh.prototype.showMoneyChange=function(pos,amount){var changeSprite=cc.LabelBmtFont("","48px font_do");var changeText=(amount>=0?"+":"")+amount;changeSprite.text=changeText;changeSprite.position.set(pos.x,pos.y);this.addChild(changeSprite);var action=cc.sequence(cc.moveTo(2,cc.p(pos.x,pos.y+100)),cc.callFunc(function(){changeSprite.parent.removeChild(changeSprite)}));PIXI.actionManager.runAction(changeSprite,action)};
GameMauBinh.prototype.handlePendingBack=function(){cc.log("checkLeaveRoomIfCan handlePendingBack");this.isPlaying=false;if(this.registerQuit){this.registerQuit=false;this.quitRoom();return}if(!this.isPlaying)this.gameState=0;if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;this.registerQuit=false;this.quitRoom(true)}};
GameMauBinh.prototype.resetNewGame=function(){if(this.actionUpdateCardXep){this.stopAction(this.actionUpdateCardXep);this.actionUpdateCardXep=null}this.xepxong=false;this.isPlaying=false;this.totalPlayerPlaying=0;this.isViewing=false;this.khungChiResult.reset();this.binhlungAnim.show(false);this.clock.showClock(false);this.lblNarrativeResult.hideLine();this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;this.data.ps.forEach(function(player,index){player.pi=false});for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].resetEndGame();
this.allSlot[i].cardList.removeAll()}this.clearStatePlayer();this.arrangePlayerInGame()};var CMD_TLMN=CMD_TLMN||{};CMD_TLMN.CHIABAI=250;CMD_TLMN.CHANGE_TURN=251;CMD_TLMN.TOI_TRANG=252;CMD_TLMN.CHOSE_CAI=5001;var ERROR_CMD_TLMN={8E3:{msg:"kh\u00f4ng c\u00f3 trong danh s\u00e1ch \u00f9"},8001:{msg:"c\u00f3 ng\u01b0\u1eddi \u0111ang \u0111\u1ee3i \u00f9"},8002:{msg:"\u0102n b\u00e0i ko h\u1ee3p l\u1ec7"},8003:{msg:"C\u00f3 ng\u01b0\u1eddi \u0111ang ch\u00edu"}};
function GameTLMN(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GameTLMN";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.initGame()}GameTLMN.prototype=Object.create(GameScene.prototype);GameTLMN.X_CHIA_BAI=550;GameTLMN.MAX_CARD_PLAYER=13;GameTLMN.cardOriginScaleBackCard=.6;GameTLMN.MAX_SLOT=4;
GameTLMN.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;var remainTime=data.tRMT/1E3;this.tFDC=data.tFDC;var timeBocNoc=data.tPC;this.timeBocNoc=timeBocNoc;this.timeXuong=data.tSLC/1E3;this.nocSize=data.nSz;this.timeReadyBeforeKick=data.tFR;this.timeChonCai=timeBocNoc;this.timeReady=data.timeReady?data.timeReady:0;this.timeChiaBai=this.tFDC-timeBocNoc;this.initButton();this.initPlayer();this.initCardContainer();
this.showReadyIfCan();this.updateGame(data)};
GameTLMN.prototype.updateGame=function(data){var thiz=this;var gameState=data.gS;var players=this.data.ps;var remainTime=data.rmT;this.lastArrCardDeal=data.ldc;if(gameState==GAME_STATE.PLAYING)if(!data.re){this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);for(var i=0;i<players.length;i++){var p=players[i];if(p.pi)thiz.totalPlayerPlaying++}thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd",2);thiz.allSlot.forEach(function(slot,index){if(slot!=
null&&!slot.isMe)for(var i=0;i<players.length;i++){var p=players[i];var playerState=p.pS;if(slot.uid==p.uid)if(p.pi){var card=Utils.getCardFromServer(0);var remainingCard=p.rmC;thiz.backCardList[slot.sitId].dealBackCards([card],false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime,true);thiz.backCardList[slot.sitId].showRemainCard(true,remainingCard)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM)}})}players.forEach(function(value,index){if(value.C==
true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;thiz.onReconnect(data)}else if(players[thiz.idRoomMaster].uid!==PlayerMe.uid)if(cc.Global.GetSetting(GameSetting.autoReady))thiz.sendStartRequest()};
GameTLMN.prototype.onReconnect=function(data){var thiz=this;thiz.totalPlayerPlaying=0;thiz.rejectTurnTotal=0;var listPlayer=data.ps;var gameState=data.gS;thiz.gameState=data.gS;var remainTime=data.rmT;thiz.lastArrCardDeal=data.ldc;var myPlayState=0;for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];var playerState=p.pS;if(p.pi){thiz.totalPlayerPlaying++;if(playerState===Constant.PLAYER_STATE.BO_LUOT)thiz.rejectTurnTotal++;if(p.uid===PlayerMe.uid){this.playerView[0].x=cc.Global.GameView.width/
2-this.playerView[0].widthBG/2-GameTLMN.X_CHIA_BAI;myPlayState=playerState}}}if(thiz.lastArrCardDeal&&thiz.lastArrCardDeal.length){var cards=[];for(var i=0;i<thiz.lastArrCardDeal.length;i++)cards.push(Utils.getCardFromServer(thiz.lastArrCardDeal[i]));this.cardOnTable.addNewCardList(cards)}var mySlot=null;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(slot.uid==p.uid){var cardArray=p.cs;var isRoomMaster=p.C;var playerState=p.pS;var pi=
p.pi;var remainingCard=p.rmC;if(pi)if(p.uid===PlayerMe.uid){var cards=[];for(var num=0;num<cardArray.length;num++)cards.push(Utils.getCardFromServer(cardArray[num]));thiz.cardList.dealCards(cards,false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT){mySlot=slot;thiz.onUpdateTurn(slot.uid,remainTime);thiz.showAllBtnPlay()}else if(playerState==Constant.PLAYER_STATE.BO_LUOT)thiz.setStatePlayer(slot.uid,state_player.BO_LUOT)}else{var card=Utils.getCardFromServer(0);thiz.backCardList[slot.sitId].dealBackCards([card],
false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);break}}});if(thiz.rejectTurnTotal===thiz.totalPlayerPlaying-1){thiz.rejectTurnTotal=0;thiz.suggestCard([])}else if(thiz.lastArrCardDeal&&thiz.lastArrCardDeal.length){var isBlurCardIfNeed=myPlayState==3?true:false;thiz.suggestCard(thiz.lastArrCardDeal,isBlurCardIfNeed)}};
GameTLMN.prototype.initCardContainer=function(){var zOrder=2;var left=170;var cardList=new CardList(cc.size(cc.Global.GameView.width-20-left,150));cardList.position.set(left,cc.Global.GameView.height-230);cardList.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(cardList);cardList.setDeckPoint(cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));this.cardList=cardList;SuggestCardMng.getInstance().initCardList(cardList);var dx=110+50;var dy=30;var cardList0=new CardList(cc.size(60,
75),GamePhom.cardOriginScaleBackCard);cardList0.canTouch=false;cardList0.position.set(cc.Global.GameView.width/2+dx,dy+this.playerView[0].y);MyPixi.gameContainer.addChild(cardList0);var cardList1=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);cardList1.canTouch=false;cardList1.position.set(this.playerView[1].x+this.playerView[1].widthBG-dx-70,dy+this.playerView[1].y);MyPixi.gameContainer.addChild(cardList1);var cardList2=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);
cardList2.canTouch=false;cardList2.position.set(this.playerView[2].x+dx,dy+this.playerView[2].y);MyPixi.gameContainer.addChild(cardList2);var cardList3=new CardList(cc.size(60,75),GamePhom.cardOriginScaleBackCard);cardList3.canTouch=false;cardList3.position.set(this.playerView[3].x+dx,dy+this.playerView[3].y);MyPixi.gameContainer.addChild(cardList3);this.backCardList=[cardList0,cardList1,cardList2,cardList3];for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].setDeckPoint(cc.p(cc.Global.GameView.width/
2,cc.Global.GameView.height/2));var cardOnTable=new CardOnTable;cardOnTable.setContentSize(cc.size(500,300));MyPixi.gameContainer.addChild(cardOnTable);cardOnTable.displayGroup=MyPixi.gameContainerLayer;cardOnTable.setDeckPoint(cc.p(cc.winSize.width/2,cc.winSize.height/2));this.cardOnTable=cardOnTable;if(TEST_MODE){var cardListDeal=new CardList(cc.size(cc.Global.GameView.width,150),GamePhom.cardOriginScaleBackCard);cardListDeal.position.set(200,cc.Global.GameView.height/2);MyPixi.gameContainer.addChild(cardListDeal);
this.cardListDeal=cardListDeal}};GameTLMN.prototype.handlePendingBack=function(){this.isPlaying=false;if(this.isRegisterQuit){this.quitRoom();return}if(!this.isPlaying)this.gameState=0;if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;this.quitRoom(true)}};
GameTLMN.prototype.resetNewGame=function(ignoreCheckReady){SuggestCardMng.getInstance().reset();this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2;if(this.lastArrCardDeal&&this.lastArrCardDeal.length)this.lastArrCardDeal.length=0;this.currentTurn=-1;this.rejectTurnTotal=0;this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;this.cardList.removeAll();this.cardOnTable.removeAll();for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();for(var i=
0;i<this.allSlot.length;i++){this.allSlot[i].stopTimeRemain(false);this.allSlot[i].setState(state_player.NOTHING);this.allSlot[i].clearAnimMoney()}if(!ignoreCheckReady){var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);this.showStartIfCan()}else this.showReadyIfCan()}};
GameTLMN.prototype._onRoomPluginMsg=function(command,dataObj){cc.log(command+" _onRoomPluginMsg in GameTLMN \x3d\x3e "+JSON.stringify(dataObj));var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY)this.onReadyResponse(dataObj);
else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===CMD_TLMN.CHIABAI){console.log("CMD_TLMN.CHIABAI");console.log(dataObj);this.chiabai(dataObj)}else if(cmd===CMD_TLMN.DANH);else if(cmd===CMD_TLMN.CHANGE_TURN)this.onChangeTurn(dataObj);else if(cmd===CMD_TLMN.TOI_TRANG){LobbyClient.getInstance().setGameState(GAME_STATE.SHOW_KQ);this.onEndGameResponse(dataObj)}};
GameTLMN.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.isRegisterQuit=true};GameTLMN.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=ERROR_CMD_TLMN[errorCode];if(errorStr===undefined)return;errorStr=errorStr.msg;if(errorCode!=210){var msg=errorStr;var dialog=new MessageOkDialog;dialog.setMessage(msg);dialog.showWithAnimationScale()}};
GameTLMN.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame();this.showStartIfCan()};
GameTLMN.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(uid==PlayerMe.uid)this.showReady(false);if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING);var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);
this.showStartIfCan()}else this.showReadyIfCan()};GameTLMN.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameTLMN.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameTLMN.prototype.chiabai=function(dataObj){this.stopAllActions();this.resetNewGame(true);if(TEST_MODE){var uid=this.allSlot[0].uid;dataObj=[5,{"cs":[10,11,19,20,26,27,32,35,41,42,44,50,1],"ps":[{"uid":"uid1","m":1111},{"uid":uid,"m":10005E4}],"lpi":["uid1","uid2","uid3",uid],"cmd":250,"tP":{"uid":uid,"dn":"005gts"},"m":10005E4}]}this.showReady(false);this.ideGameNumber++;this.isPlaying=true;this.cardList.removeAll();this.cardOnTable.removeAll();this.playSoundAction("chiabai");this.updateGoldAllPlayerFromServer(dataObj);
this.startGame();var data=dataObj[1];cc.log("chiabai gamestate "+data.gS);this.gameState=GAME_STATE.PLAYING;this.data.gS=GAME_STATE.PLAYING;var cardArray=data.cs;var tP=data.tP;var listPlayer=data.lpi;this.totalPlayerPlaying=listPlayer.length;this.data.ps.forEach(function(player,index){if(listPlayer.indexOf(player.uid)!==-1)player.pi=true});this.onUpdateTurn(tP.uid,this.timeTurn,true);if(listPlayer.indexOf(PlayerMe.uid)>-1){var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));
this.cardList.dealCards(cards,true);this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2-GameTLMN.X_CHIA_BAI}else{this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);this.isPlaying=false}for(var i=0;i<this.allSlot.length;i++){var slot=this.allSlot[i];if(!slot.isMe)if(listPlayer.indexOf(slot.uid)>-1){var cards=[Utils.getCardFromServer(0)];this.backCardList[slot.sitId].dealBackCards(cards,true)}else this.setStatePlayer(slot.uid,state_player.DANG_XEM)}};
GameTLMN.prototype.showReady=function(visible){this.readyBt.visible=visible;var idMaster=this.getIdRoomMaster();if(idMaster>=0&&this.data.ps[idMaster].uid==PlayerMe.uid)MyHelper.addLblButton(this.readyBt,"Chia b\u00e0i",16);else MyHelper.addLblButton(this.readyBt,"S\u1eb5n s\u00e0ng",16)};GameTLMN.prototype.hideStartAndReady=function(hide){this.readyBt.visible=hide};
GameTLMN.prototype.initButton=function(){var thiz=this;var readyBt=MyHelper.createButton("button/btn_button2.png",true,function(){var idMaster=thiz.getIdRoomMaster();cc.log("idMaster  \x3d "+idMaster);cc.log("PlayerMe  \x3d "+PlayerMe.uid);if(thiz.data.ps[idMaster].uid===PlayerMe.uid){var notReady=thiz.getNumberPlayerNotReadyIgnoreMaster();if(notReady>0){var dialog=new MessageConfirmDialog;dialog.setMessage("V\u1eabn c\u00f2n ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng.\n B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n b\u1eaft \u0111\u1ea7u kh\u00f4ng?");
dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else thiz.sendStartRequest()}else thiz.sendStartRequest()});readyBt.position.set(cc.Global.GameView.width/2,350);MyPixi.gameContainer.addChild(readyBt);MyHelper.addLblButton(readyBt,"S\u1eb5n s\u00e0ng",16);var startBt=MyHelper.createButton("button/btn_button2.png",true,function(){var idMaster=thiz.getIdRoomMaster();cc.log("idMaster  \x3d "+idMaster);cc.log("PlayerMe  \x3d "+
PlayerMe.uid);if(thiz.data.ps[idMaster].uid===PlayerMe.uid){var notReady=thiz.getNumberPlayerNotReadyIgnoreMaster();if(notReady>0){var dialog=new MessageConfirmDialog;dialog.setMessage("V\u1eabn c\u00f2n ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng.\n B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n b\u1eaft \u0111\u1ea7u kh\u00f4ng?");dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else thiz.sendStartRequest()}else thiz.sendStartRequest()});
startBt.position.set(cc.Global.GameView.width/2,350);MyPixi.gameContainer.addChild(startBt);MyHelper.addLblButton(startBt,"B\u1eaft \u0111\u1ea7u",16);var boLuotBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.sendBoLuot()});boLuotBt.position.set(cc.Global.GameView.width/2-100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(boLuotBt);MyHelper.addLblButton(boLuotBt,"B\u1ecf l\u01b0\u1ee3t",16);var danhbaiBt=MyHelper.createButton("button/bg_napthe.png",true,function(){thiz.sendDanhBai()});
danhbaiBt.position.set(cc.Global.GameView.width/2+100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(danhbaiBt);MyHelper.addLblButton(danhbaiBt,"\u0110\u00e1nh b\u00e0i",16);readyBt.visible=false;startBt.visible=false;boLuotBt.visible=false;danhbaiBt.visible=false;this.readyBt=readyBt;this.startBt=startBt;this.boLuotBt=boLuotBt;this.danhbaiBt=danhbaiBt;if(TEST_MODE){var chiabaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.chiabai()});chiabaiBt.position.set(cc.Global.GameView.width/
2-580,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(chiabaiBt);MyHelper.addLblButton(chiabaiBt,"chia",16);var endGameBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onEndGameResponse()});endGameBt.position.set(cc.Global.GameView.width/2-580,cc.Global.GameView.height/2-73);endGameBt.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(endGameBt);MyHelper.addLblButton(endGameBt,"end",16);var danhbaiBt=MyHelper.createButton("button/btn_button2.png",
true,function(){var cardArr=thiz.cardList.getCardSelected();var arr=[];for(var i=0;i<cardArr.length;i++)arr.push(cardArr[i].getCardData().codeCard);thiz.onDanhBaiThanhCong(PlayerMe.uid,arr)});danhbaiBt.position.set(cc.Global.GameView.width/2+200,cc.Global.GameView.height/2);MyPixi.gameContainer.addChild(danhbaiBt);MyHelper.addLblButton(danhbaiBt,"dealcard",16)}var reccBt=MyHelper.createButton("button/btn_button2.png",true,function(){LobbyClient.getInstance().reConnect()});reccBt.position.set(cc.Global.GameView.width/
2-580-reccBt.width/2,cc.Global.GameView.height-50);MyPixi.gameContainer.addChild(reccBt);MyHelper.addLblButton(reccBt,"recc",16);reccBt.visible=false;var suggestBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.suggestCard()});suggestBt.position.set(cc.Global.GameView.width/2-580,cc.Global.GameView.height-150);MyPixi.gameContainer.addChild(suggestBt);MyHelper.addLblButton(suggestBt,"suggest",16);suggestBt.visible=false;if(TEST_MODE)suggestBt.visible=true};
GameTLMN.prototype.initPlayer=function(){var zOrder=4;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(cc.Global.GameView.width/2-playerMe.widthBG/2,-playerMe.heightBG/2+cc.Global.GameView.height-140);var player1=new GamePlayer;player1.sitId=1;player1.position.set(cc.Global.GameView.width-80-player1.widthBG/2,-player1.heightBG/2+cc.Global.GameView.height/2-50);var player2=new GamePlayer;player2.sitId=2;player2.position.set(cc.Global.GameView.width/2-player2.widthBG/2,-player2.heightBG/
2+cc.Global.GameView.height-630);var player3=new GamePlayer;player3.sitId=3;player3.position.set(80-player3.widthBG/2,-player3.heightBG/2+360-50);this.playerView=[playerMe,player1,player2,player3];if(this.data.Mu==2){this.playerView[1].visible=false;this.playerView[3].visible=false}for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GameTLMN.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1){for(var i=1;i<=3;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}cc.log("arrangePlayerInGame")}this.processPlayerPosition(this.data.ps,
this.data.gS,arrangeChauRiaOnly);if(TEST_MODE);};GameTLMN.prototype.updateInfoPlayer=function(player,info,index){player.setEnable(true);player.setUsername(info.usViewName);player.setGold(info.money);if(index===0)player.setMasterRoom(true);else player.setMasterRoom(false)};
GameTLMN.prototype.isReconnectOrViewer=function(){var players=this.data.players;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].TTID===PlayerMe.uid)meInPlayerList=true;if(meInPlayerList&&this.gameState===GAME_STATE.PLAYING)return true;else return false};
GameTLMN.prototype.showReadyIfCan=function(){var players=this.data.ps;var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;var meReady=false;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].uid===PlayerMe.uid){meReady=players[i].r;if(players.sit<0)meInPlayerList=false;else meInPlayerList=true}if(!meReady&&!isPlaying&&players.length>=2){this.readyBt.visible=true;cc.log("ready vao dayyyyyy")}else if(meReady&&!isPlaying&&players.length>=2)this.readyBt.visible=false;else this.readyBt.visible=
false;if(this.gameState==GAME_STATE.PLAYING||!meInPlayerList)this.readyBt.visible=false;var autoReady=cc.Global.GetSetting(GameSetting.autoReady,false);if(autoReady&&this.gameState!=GAME_STATE.PLAYING&&meInPlayerList&&!meReady){var idMaster=this.getIdRoomMaster();if(players[idMaster].uid!==PlayerMe.uid)this.sendStartRequest()}};GameTLMN.prototype.getCardWithId=function(cardId){var rankCard=cardId%13+3;if(rankCard>13)rankCard-=13;return{rank:rankCard,suit:Math.floor(cardId/13)}};
GameTLMN.prototype.getCardIdWithRank=function(rank,suit){var rankCard=rank-3;if(rankCard<0)rankCard=13+rankCard;return suit*13+rankCard};GameTLMN.prototype.activeTurnButton=function(visible){this.boLuotBt.visible=visible;this.danhbaiBt.visible=visible};GameTLMN.prototype.hideAllBtnPlay=function(){this.boLuotBt.visible=false;this.danhbaiBt.visible=false};GameTLMN.prototype.showAllBtnPlay=function(){this.boLuotBt.visible=true;this.danhbaiBt.visible=true};
GameTLMN.prototype.onUpdateTurn=function(uid,currentTime,newTurn){this.currentTurn=uid;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].showTimeRemain(currentTime,this.timeTurn);if(this.allSlot[i].isMe){this.hideAllBtnPlay();this.boLuotBt.visible=true;this.danhbaiBt.visible=true;if(newTurn)this.boLuotBt.visible=false}else{this.boLuotBt.visible=false;this.danhbaiBt.visible=false}}else this.allSlot[i].stopTimeRemain()};
GameTLMN.prototype.suggestCard=function(cardsDeaded,isBlurCardIfNeed){if(!isBlurCardIfNeed)isBlurCardIfNeed=true;if(TEST_MODE){this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2-GameTLMN.X_CHIA_BAI;var cards=[];cardArray=[8,9,12,13,16,17,18,19,20,21,24,27,28,36,40,44,49];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));this.cardList.dealCards(cards,false);cardsDeaded=[];var cards=[];for(var i=0;i<cardsDeaded.length;i++)cards.push(Utils.getCardFromServer(cardsDeaded[i]));
this.cardListDeal.visible=true;this.cardListDeal.dealCards(cards,false)}SuggestCardMng.getInstance().suggestCard(this.cardList,cardsDeaded,isBlurCardIfNeed)};
GameTLMN.prototype.onChangeTurn=function(dataObj){if(TEST_MODE){if(!this.last)this.last=1;fUid=PlayerMe.uid;tUid=this.allSlot[Math.floor(Math.random()*this.allSlot.length)].uid;var dCs=36;if(fUid===PlayerMe.uid){var rd=0;dCs=this.cardList.getCards()[rd].getCardData().codeCard}else{dCs=this.last;this.last++}if(this.last>51)this.last=1;dataObj=[5,{"fP":{"uid":fUid,"pS":1,"dCs":[dCs]},"cmd":5002,"tP":{"uid":tUid}}]}cc.log("onChangeTurn "+JSON.stringify(dataObj));var data=dataObj[1];var nCmd=dataObj[1].nCmd;
var fromPlayer=dataObj[1].fP;var puid=fromPlayer.puid;var lastArrCardDeal=fromPlayer.dCs;var thiz=this;if(fromPlayer.pS==Constant.PLAYER_STATE.DANH_BAI&&lastArrCardDeal&&lastArrCardDeal.length){this.lastArrCardDeal=lastArrCardDeal;this.lastUidDealCard=fromPlayer.uid;if(fromPlayer.uid!==PlayerMe.uid){var totalReduce=lastArrCardDeal.length;var slot=this.getSlotByUid(fromPlayer.uid);this.backCardList[slot.sitId].showRemainCard(true,-totalReduce)}}if(fromPlayer.pS==Constant.PLAYER_STATE.BO_LUOT){this.rejectTurnTotal++;
if(fromPlayer.uid==PlayerMe.uid)this.meRejectTurn=true}var tP=dataObj[1].tP;var mySlot=null;this.activeTurnButton(false);thiz.onUpdateTurn(data.tP.uid,thiz.timeTurn,false);if(fromPlayer&&fromPlayer.pS==Constant.PLAYER_STATE.DANH_BAI&&lastArrCardDeal.length)this.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal);this.allSlot.forEach(function(slot,index){if(slot){if(tP.uid===slot.uid&&slot.isMe){thiz.activeTurnButton(true);if(thiz.rejectTurnTotal===thiz.totalPlayerPlaying-1){cc.log("0000suggest "+lastArrCardDeal);
thiz.suggestCard()}else if(lastArrCardDeal&&lastArrCardDeal.length){cc.log("----suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,true)}else{cc.log("--11-suggest"+thiz.lastArrCardDeal);thiz.suggestCard(thiz.lastArrCardDeal,true)}mySlot=slot}if(fromPlayer.uid===slot.uid){if(fromPlayer.pS==2)slot.setState(state_player.BO_LUOT);if(fromPlayer.uid===PlayerMe.uid)if(fromPlayer.pS===2)thiz.suggestCard([]);else{cc.log("333suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,false)}}if(tP.uid!=
slot.uid&&fromPlayer.uid!=slot.uid&&slot.isMe)if(lastArrCardDeal&&lastArrCardDeal.length){cc.log("444suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,false)}else{cc.log("555suggest "+thiz.lastArrCardDeal);thiz.suggestCard(thiz.lastArrCardDeal,false)}if(fromPlayer.puid){cc.log("------- an chat ");var addMoney=fromPlayer.mX;var reduceMoney=fromPlayer.lm;var puid=fromPlayer.puid;if(fromPlayer.uid==slot.uid)slot.runChangeGoldEffect(addMoney);if(puid==slot.uid)slot.runChangeGoldEffect(reduceMoney)}}});
cc.log(thiz.rejectTurnTotal+" \x3c\x3d\x3d\x3d\x3d \x3e "+(thiz.totalPlayerPlaying-1));if(thiz.rejectTurnTotal==thiz.totalPlayerPlaying-1){thiz.rejectTurnTotal=0;thiz.meRejectTurn=false;thiz.lastArrCardDeal.length=0;cc.log("\x3c\x3d\x3d\x3d\x3d \x3e hideAllBoLuot ----");thiz.hideAllBoLuot();if(tP.uid==PlayerMe.uid)thiz.boLuotBt.visible=false;thiz.cardOnTable.flipAndRemoveAll()}if(tP.uid==PlayerMe.uid)if(mySlot&&this.cardList.isAllBlur())this.danhbaiBt.visible=false};
GameTLMN.prototype.onDanhBaiThanhCong=function(uid,cardData){cc.log("onDanhBaiThanhCong  "+cardData);var slot=this.getSlotByUid(uid);if(slot){var cards=[];for(var i=0;i<cardData.length;i++)cards.push(Utils.getCardFromServer(cardData[i]));if(slot.isMe){var arr=this.cardList.removeCard(cards);for(var i=0;i<arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);arr[i].position.set(pos.x,pos.y);arr[i].canTouch=false}this.cardOnTable.moveOldCard();this.cardOnTable.addCard(arr);this.cardList.reOrder();
cc.log("onDanhBaiThanhCong  me ")}else{this.cardOnTable.moveOldCard();var bCard=this.backCardList[slot.sitId];var pos=cc.convertToWorldSpace(bCard);pos=cc.p(pos.x+bCard.widthContainer/2,pos.y+bCard.heightContainer/2);this.cardOnTable.addNewCardList(cards,pos);cc.log("onDanhBaiThanhCong  not me")}}};
GameTLMN.prototype.onEndGameResponse=function(dataObj){if(TEST_MODE){var _WHR=Math.floor(Math.random()*11+1);dataObj=[5,{"ps":[{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":PlayerMe.uid,"dn":"gts005","whR":_WHR,"mX":5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[1].uid,"dn":"gts001","mX":-5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[2].uid,"dn":"gts002","mX":-5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[3].uid,
"dn":"gts003","mX":-5500,"m":99981075}],"cmd":252}]}cc.log("onEndGameResponse "+JSON.stringify(dataObj));var data=dataObj[1];var thiz=this;var player=dataObj[1].ps;thiz.playerPlayed=player;thiz.isShowingResult=true;thiz.showReady(false);thiz.hideAllBtnPlay();thiz.stopTurnTimeAll();for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var fromPlayer=dataObj[1].fP;if(fromPlayer){this.isPlaying=false;var lastArrCardDeal=fromPlayer.dCs;this.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal);
thiz.allSlot.forEach(function(_slot,index){if(_slot!=null){var isHorizontal=true;var scale=.5;if(!_slot.isMe){var p=thiz.getPlayerDataByUid(_slot.uid,player);if(p){var cards=[];var cardArray=p.cs;for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));_slot.showCardEndGame(cards,true)}}}});this.showResult(true,dataObj[1])}else thiz.onWinAfterChiabai(dataObj[1]);thiz.data.ps.forEach(function(p,i){p.pi=false;p.r=false});var delay=cc.delayTime(this.tfeg);var cb=function(){if(thiz.registerQuit&&
thiz.registerQuitHandler){thiz.registerQuit=false;thiz.registerQuitHandler();thiz.registerQuitHandler=null}LobbyClient.getInstance().checkkickWhenEndGame();thiz.resetNewGame();thiz.arrangePlayerInGame();var idMaster=thiz.getIdRoomMaster();if(thiz.data.ps[idMaster].uid==PlayerMe.uid){thiz.showReady(false);thiz.showStartIfCan()}else thiz.showReadyIfCan()};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));cc.log("delay "+this.tfeg+" then resetgame")};
GameTLMN.prototype.showResult=function(isShow,dataObj){var thiz=this;if(isShow){for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var playerArr=dataObj.ps;if(dataObj.fP){this.playSoundAction("finished");var uidWin=dataObj.fP.uid;var winMoney=dataObj.fP.mX;var totalMoney=dataObj.fP.m;thiz.allSlot.forEach(function(slot,index){if(slot)if(slot.uid==uidWin){slot.showResult(true,totalMoney,winMoney,slot.sitId);if(uidWin==PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold+=
winMoney;else PlayerMe.chip+=winMoney}else for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid==slot.uid){var isCong=false;if(playerArr[i].cs&&playerArr[i].cs.length==13&&playerArr[i].mX<0)isCong=true;slot.showResult(false,playerArr[i].m,playerArr[i].mX,slot.sitId,-1,isCong);if(playerArr[i].uid==PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold=playerArr[i].m;else PlayerMe.chip=playerArr[i].m;else{var cards=[];var cardArray=playerArr[i].cs;for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));
slot.showCardEndGame(cards,true)}break}});playerArr.push(dataObj.fP)}else{var delay=cc.delayTime(1);var cb=function(){thiz.playSoundAction("finished");var uidWin=-1;var whR=-1;var winMoney=0;var totalMoney=0;var playWin="";var cardWinArr=[];playerArr.forEach(function(_player,index){if(_player.whR&&_player.whR>0){uidWin=_player.uid;whR=_player.whR;playWin=_player.dn;totalMoney=_player.m;winMoney=_player.mX;cardWinArr=_player.cs}});thiz.allSlot.forEach(function(slot,index){if(slot)if(slot.uid==uidWin){slot.showResult(true,
totalMoney,winMoney,slot.sitId,whR,false);if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold+=winMoney;else PlayerMe.chip+=winMoney}else for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid==slot.uid){slot.showResult(false,playerArr[i].m,playerArr[i].mX,slot.sitId,whR,false);if(playerArr[i].uid==PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold-=winMoney;else PlayerMe.chip-=winMoney;break}})};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun))}for(var i=0;i<playerArr.length;i++)thiz.updateMoneyPlayer(playerArr[i])}};
GameTLMN.prototype.onWinAfterChiabai=function(data){var player=data.ps;var thiz=this;thiz.resetNewGame(true);var whR=-1;var cardWinArr=[];player.forEach(function(_player,index){if(_player.whR&&_player.whR>0){whR=_player.whR;cardWinArr=_player.cs}});thiz.gameState=GAME_STATE.SHOW_KQ;thiz.isPlaying=true;var delay=cc.delayTime(.4);var cb=function(){thiz.isPlaying=false;thiz.showResult(true,data)};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));this.hideAllBtnPlay();thiz.allSlot.forEach(function(slot,
index){if(slot!=null)player.forEach(function(_player,j){if(_player.uid==slot.uid){var cardArray=_player.cs;var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));var rd=Math.floor(Math.random()*10+1);if(TEST_MODE)if(slot.isMe)slot.isMe=rd>5?true:false;if(slot.isMe)slot.x=cc.Global.GameView.width/2-thiz.playerView[0].widthBG/2-GameTLMN.X_CHIA_BAI;var deckPoint=cc.p(cc.winSize.width/2,cc.winSize.height/2);slot.showCardEndGame(cards,true,deckPoint);_player.pi=
true}})})};GameTLMN.prototype.sendStartRequest=function(){cc.log("send ready ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameTLMN.prototype.sendBoLuot=function(){var thiz=this;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.REJECT_TURN}];LobbyClient.getInstance().send(sendObj);thiz.ideGameNumber=0};
GameTLMN.prototype.sendDanhBai=function(){if(TEST_MODE){this.onChangeTurn();return}var cards=this.cardList.getCardSelected();if(cards.length>0){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.DANH_BAI,"cs":intCardArr}];LobbyClient.getInstance().send(msg)}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c c\u00e2y b\u00e0i n\u00e0o",
1)};GameTLMN.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameTLMN.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}cc.log("click quit room tlmn");if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
this.registerQuitHandler=null}return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};var CMD_SAM=CMD_SAM||{};CMD_SAM.CHIABAI=700;CMD_SAM.CHANGE_TURN=703;CMD_SAM.TOI_TRANG=701;CMD_SAM.HUY_SAM=702;CMD_SAM.REJECT_TURN=706;CMD_SAM.DANH_BAI=705;var ERROR_CMD_Sam={8E3:{msg:"kh\u00f4ng c\u00f3 trong danh s\u00e1ch \u00f9"},8001:{msg:"c\u00f3 ng\u01b0\u1eddi \u0111ang \u0111\u1ee3i \u00f9"},8002:{msg:"\u0102n b\u00e0i ko h\u1ee3p l\u1ec7"},8003:{msg:"C\u00f3 ng\u01b0\u1eddi \u0111ang ch\u00edu"}};
function GameSam(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GameSam";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.initGame()}GameSam.prototype=Object.create(GameScene.prototype);GameSam.X_CHIA_BAI=550;GameSam.MAX_CARD_PLAYER=10;GameSam.cardOriginScaleBackCard=.6;GameSam.MAX_SLOT=5;
GameSam.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.tfeg=data.tfeg/1E3;this.timeBaoSam=data.tfbs/1E3;if(data.gS===GAME_STATE.CHIA_BAI)data.gS=GAME_STATE.PLAYING;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initButton();this.initPlayer();this.initCardContainer();this.showReadyIfCan();this.updateGame(data)};
GameSam.prototype.updateGame=function(data){var thiz=this;var gameState=data.gS;var players=this.data.ps;var remainTime=data.rmT;this.lastArrCardDeal=data.ldc;if(gameState==GAME_STATE.PLAYING)if(!data.re){this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);for(var i=0;i<players.length;i++){var p=players[i];if(p.pi)thiz.totalPlayerPlaying++}thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd",2);thiz.allSlot.forEach(function(slot,index){if(slot!=
null&&!slot.isMe)for(var i=0;i<players.length;i++){var p=players[i];var playerState=p.pS;if(slot.uid==p.uid)if(p.pi){var card=Utils.getCardFromServer(0);var remainingCard=p.rmC;var isBao=p.ib;if(isBao)thiz.setStatePlayer(p.uid,state_player.BAO_SAM);thiz.backCardList[slot.sitId].dealBackCards([card],false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime,true);thiz.backCardList[slot.sitId].showRemainCard(true,remainingCard)}else thiz.setStatePlayer(slot.uid,
state_player.DANG_XEM)}})}players.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;thiz.onReconnect(data)}else if(players[thiz.idRoomMaster].uid!==PlayerMe.uid)if(cc.Global.GetSetting(GameSetting.autoReady))thiz.sendStartRequest()};
GameSam.prototype.onReconnect=function(data){var thiz=this;thiz.totalPlayerPlaying=0;thiz.rejectTurnTotal=0;var listPlayer=data.ps;var gameState=data.gS;thiz.gameState=data.gS;var remainTime=data.rmT;thiz.lastArrCardDeal=data.ldc;var myPlayState=0;for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];var playerState=p.pS;if(p.pi){thiz.totalPlayerPlaying++;if(playerState===Constant.PLAYER_STATE.BO_LUOT)thiz.rejectTurnTotal++;if(p.uid===PlayerMe.uid){var isBao=p.ib;if(isBao)thiz.setStatePlayer(p.uid,
state_player.BAO_SAM);this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2-GameSam.X_CHIA_BAI;myPlayState=playerState}}}if(thiz.lastArrCardDeal&&thiz.lastArrCardDeal.length){var cards=[];for(var i=0;i<thiz.lastArrCardDeal.length;i++)cards.push(Utils.getCardFromServer(thiz.lastArrCardDeal[i]));this.cardOnTable.addNewCardList(cards)}var mySlot=null;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(slot.uid==p.uid){var cardArray=
p.cs;var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;var remainingCard=p.rmC;if(pi)if(p.uid===PlayerMe.uid){var cards=[];for(var num=0;num<cardArray.length;num++)cards.push(Utils.getCardFromServer(cardArray[num]));thiz.cardList.dealCards(cards,false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT){mySlot=slot;thiz.onUpdateTurn(slot.uid,remainTime);thiz.showAllBtnPlay();thiz.activeTurnButton(true,p.ib)}else if(playerState==Constant.PLAYER_STATE.BO_LUOT)thiz.setStatePlayer(slot.uid,state_player.BO_LUOT)}else{var card=
Utils.getCardFromServer(0);thiz.backCardList[slot.sitId].dealBackCards([card],false);if(playerState==Constant.PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);break}}});if(thiz.rejectTurnTotal===thiz.totalPlayerPlaying-1){thiz.rejectTurnTotal=0;thiz.suggestCard([])}else if(thiz.lastArrCardDeal&&thiz.lastArrCardDeal.length){var isBlurCardIfNeed=myPlayState==3?true:false;thiz.suggestCard(thiz.lastArrCardDeal,isBlurCardIfNeed)}};
GameSam.prototype.initCardContainer=function(){var zOrder=2;var left=170;var cardList=new CardList(cc.size(cc.Global.GameView.width-20-left,150));cardList.position.set(left,cc.Global.GameView.height-230);cardList.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(cardList);cardList.setDeckPoint(cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));this.cardList=cardList;SuggestCardMng.getInstance().initCardList(cardList);var dx=110+50;var dy=30;var cardList0=new CardList(cc.size(60,
75),GameSam.cardOriginScaleBackCard);cardList0.canTouch=false;cardList0.position.set(cc.Global.GameView.width/2+dx,dy+this.playerView[0].y);MyPixi.gameContainer.addChild(cardList0);var cardList1=new CardList(cc.size(60,75),GameSam.cardOriginScaleBackCard);cardList1.canTouch=false;cardList1.position.set(this.playerView[1].x+this.playerView[1].widthBG-dx-70,dy+this.playerView[1].y);MyPixi.gameContainer.addChild(cardList1);var cardList2=new CardList(cc.size(60,75),GameSam.cardOriginScaleBackCard);cardList2.canTouch=
false;cardList2.position.set(this.playerView[2].x+dx,dy+this.playerView[2].y);MyPixi.gameContainer.addChild(cardList2);var cardList3=new CardList(cc.size(60,75),GameSam.cardOriginScaleBackCard);cardList3.canTouch=false;cardList3.position.set(this.playerView[3].x+dx,dy+this.playerView[3].y);MyPixi.gameContainer.addChild(cardList3);var cardList4=new CardList(cc.size(60,75),GameSam.cardOriginScaleBackCard);cardList4.canTouch=false;cardList4.position.set(this.playerView[4].x+dx,dy+this.playerView[4].y);
MyPixi.gameContainer.addChild(cardList4);this.backCardList=[cardList0,cardList1,cardList2,cardList3,cardList4];for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].setDeckPoint(cc.p(cc.Global.GameView.width/2,cc.Global.GameView.height/2));var cardOnTable=new CardOnTable;cardOnTable.setContentSize(cc.size(500,300));MyPixi.gameContainer.addChild(cardOnTable);cardOnTable.displayGroup=MyPixi.gameContainerLayer;cardOnTable.setDeckPoint(cc.p(cc.winSize.width/2,cc.winSize.height/2));this.cardOnTable=
cardOnTable;if(TEST_MODE){var cardListDeal=new CardList(cc.size(cc.Global.GameView.width,150),GameSam.cardOriginScaleBackCard);cardListDeal.position.set(200,cc.Global.GameView.height/2);MyPixi.gameContainer.addChild(cardListDeal);this.cardListDeal=cardListDeal}};GameSam.prototype.handlePendingBack=function(){this.isPlaying=false;if(this.isRegisterQuit){this.quitRoom();return}if(!this.isPlaying)this.gameState=0;if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;this.quitRoom(true)}};
GameSam.prototype.resetNewGame=function(ignoreCheckReady){SuggestCardMng.getInstance().reset();this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2;if(this.lastArrCardDeal&&this.lastArrCardDeal.length)this.lastArrCardDeal.length=0;this.currentTurn=-1;this.rejectTurnTotal=0;this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;this.cardList.removeAll();this.cardOnTable.removeAll();this.hideBaoSamCenter();for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();
for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].stopTimeRemain(false);this.allSlot[i].setState(state_player.NOTHING);this.allSlot[i].clearAnimMoney()}if(!ignoreCheckReady){var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);this.showStartIfCan()}else this.showReadyIfCan()}};GameSam.prototype.hideBaoSamCenter=function(){this.baoSamTimer.stopAllActions();this.baoSamImg.visible=false;this.baoSamBt.visible=false;this.huySamBt.visible=false};
GameSam.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY)this.onReadyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===CMD_SAM.CHIABAI)this.chiabai(dataObj);else if(cmd===CMD_SAM.DANH)this.onDanhBaiResponse(dataObj);else if(cmd===CMD_SAM.CHANGE_TURN)this.onChangeTurn(dataObj);else if(cmd===CMD_SAM.TOI_TRANG){LobbyClient.getInstance().setGameState(GAME_STATE.SHOW_KQ);this.onEndGameResponse(dataObj)}else if(cmd==702){cc.log("h\u1ee7y b\u00e1o s\u00e2m  ");var uidHuyBao=dataObj[1].uid;this.setStatePlayer(uidHuyBao,state_player.HUY_BAO);if(PlayerMe.uid===
uidHuyBao)this.hideBaoSamCenter()}};GameSam.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.isRegisterQuit=true};GameSam.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=ERROR_CMD_Sam[errorCode];if(errorStr===undefined)return;errorStr=errorStr.msg;if(errorCode!=210){var msg=errorStr;var dialog=new MessageOkDialog;dialog.setMessage(msg);dialog.showWithAnimationScale()}};
GameSam.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame();this.showStartIfCan()};
GameSam.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(uid==PlayerMe.uid)this.showReady(false);if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING);var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);
this.showStartIfCan()}else this.showReadyIfCan()};GameSam.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameSam.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameSam.prototype.chiabai=function(dataObj){this.stopAllActions();this.resetNewGame(true);if(TEST_MODE){var uid=this.allSlot[0].uid;dataObj=[5,{"cs":[10,11,19,20,26,27,32,35,41,42,44,50,1],"ps":[{"uid":"uidTest","m":10005E4},{"uid":"de05eb1e-7cc4-4923-b8f8-b606e1a8fa88","m":10005E4}],"lpi":["uid1","uid2","uid3","uid4",PlayerMe.uid],"cmd":250,"tP":{"uid":"de05eb1e-7cc4-4923-b8f8-b606e1a8fa88","dn":"005gts"},"m":10005E4}]}this.showReady(false);this.ideGameNumber++;this.isPlaying=true;this.cardList.removeAll();
this.cardOnTable.removeAll();this.playSoundAction("chiabai");this.updateGoldAllPlayerFromServer(dataObj);this.startGame();var data=dataObj[1];cc.log("chiabai gamestate "+data.gS);this.gameState=GAME_STATE.PLAYING;this.data.gS=GAME_STATE.PLAYING;var cardArray=data.cs;var tP=data.tP;var listPlayer=data.lpi;this.totalPlayerPlaying=listPlayer.length;this.data.ps.forEach(function(player,index){if(listPlayer.indexOf(player.uid)!==-1)player.pi=true});if(listPlayer.indexOf(PlayerMe.uid)>-1){var cards=[];
for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));this.cardList.dealCards(cards,true);this.playerView[0].x=cc.Global.GameView.width/2-this.playerView[0].widthBG/2-GameSam.X_CHIA_BAI}else{this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);this.isPlaying=false}for(var i=0;i<this.allSlot.length;i++){var slot=this.allSlot[i];if(!slot.isMe)if(listPlayer.indexOf(slot.uid)>-1){var cards=[Utils.getCardFromServer(0)];this.backCardList[slot.sitId].dealBackCards(cards,
true)}else this.setStatePlayer(slot.uid,state_player.DANG_XEM)}this.showBaoSamStartGame(listPlayer)};
GameSam.prototype.showBaoSamStartGame=function(listPlayer){if(TEST_MODE)this.timeBaoSam=8;var timeDelay=this.timeBaoSam-1;var delay=cc.delayTime(1);var thiz=this;var cb=function(){thiz.baoSamImg.visible=true;if(listPlayer.indexOf(PlayerMe.uid)!==-1){thiz.baoSamBt.visible=true;thiz.huySamBt.visible=true}thiz.showTimeRemain(timeDelay*1E3,timeDelay*1E3)};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun))};
GameSam.prototype.showTimeRemain=function(currentTime,maxTime){if(this.baoSamTimer){this.baoSamTimer.stopAllActions();this.baoSamTimer.showTimeRemain(currentTime,maxTime)}};GameSam.prototype.showReady=function(visible){this.readyBt.visible=visible;var idMaster=this.getIdRoomMaster();if(idMaster>=0&&this.data.ps[idMaster].uid==PlayerMe.uid)MyHelper.addLblButton(this.readyBt,"Chia b\u00e0i",16);else MyHelper.addLblButton(this.readyBt,"S\u1eb5n s\u00e0ng",16)};
GameSam.prototype.hideStartAndReady=function(hide){this.readyBt.visible=hide};
GameSam.prototype.initButton=function(){var thiz=this;var readyBt=MyHelper.createButton("button/btn_button2.png",true,function(){var idMaster=thiz.getIdRoomMaster();cc.log("idMaster  \x3d "+idMaster);cc.log("PlayerMe  \x3d "+PlayerMe.uid);if(thiz.data.ps[idMaster].uid===PlayerMe.uid){var notReady=thiz.getNumberPlayerNotReadyIgnoreMaster();if(notReady>0){var dialog=new MessageConfirmDialog;dialog.setMessage("V\u1eabn c\u00f2n ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng.\n B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n b\u1eaft \u0111\u1ea7u kh\u00f4ng?");dialog.okButtonHandler=
function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else thiz.sendStartRequest()}else thiz.sendStartRequest()});readyBt.position.set(cc.Global.GameView.width/2,350);MyPixi.gameContainer.addChild(readyBt);MyHelper.addLblButton(readyBt,"S\u1eb5n s\u00e0ng",16);var startBt=MyHelper.createButton("button/btn_button2.png",true,function(){var idMaster=thiz.getIdRoomMaster();cc.log("idMaster  \x3d "+idMaster);cc.log("PlayerMe  \x3d "+PlayerMe.uid);
if(thiz.data.ps[idMaster].uid===PlayerMe.uid){var notReady=thiz.getNumberPlayerNotReadyIgnoreMaster();if(notReady>0){var dialog=new MessageConfirmDialog;dialog.setMessage("V\u1eabn c\u00f2n ng\u01b0\u1eddi ch\u01a1i ch\u01b0a s\u1eb5n s\u00e0ng.\n B\u1ea1n c\u00f3 ch\u1eafc mu\u1ed1n b\u1eaft \u0111\u1ea7u kh\u00f4ng?");dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){dialog.hide()};dialog.show()}else thiz.sendStartRequest()}else thiz.sendStartRequest()},
true,cc.size(172,68),[10,10,10,10]);startBt.position.set(cc.Global.GameView.width/2-startBt.width/2,-startBt.height/2+350);MyPixi.gameContainer.addChild(startBt);MyHelper.addLblButton(startBt,"B\u1eaft \u0111\u1ea7u",16);var boLuotBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.sendBoLuot()});boLuotBt.position.set(cc.Global.GameView.width/2-100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(boLuotBt);MyHelper.addLblButton(boLuotBt,"B\u1ecf l\u01b0\u1ee3t",16);
var danhbaiBt=MyHelper.createButton("button/bg_napthe.png",true,function(){thiz.sendDanhBai()});danhbaiBt.position.set(cc.Global.GameView.width/2+100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(danhbaiBt);MyHelper.addLblButton(danhbaiBt,"\u0110\u00e1nh b\u00e0i",16);var baoSamImg=PIXI.Sprite.fromFrame("btn_baosam.png");baoSamImg.anchor.set(.5,.5);baoSamImg.position.set(cc.Global.GameView.width/2,-74+cc.Global.GameView.height/2);MyPixi.gameContainer.addChild(baoSamImg);baoSamImg.displayGroup=
MyPixi.animationLayer;baoSamImg.visible=false;this.baoSamImg=baoSamImg;var baoSamTimer=new BaoSamTimer(0,"btn_baosam1.png");baoSamTimer.position.set(-baoSamImg.width/2+7,-baoSamImg.height/2+7);this.baoSamImg.addChild(baoSamTimer);this.baoSamTimer=baoSamTimer;var baoSamBt=MyHelper.createButton("button/bg_napthe.png",true,function(){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":704,"ib":true}];LobbyClient.getInstance().send(sendObj);
thiz.baoSamTimer.stopAllActions();thiz.baoSamImg.visible=false;thiz.baoSamBt.visible=false;thiz.huySamBt.visible=false});baoSamBt.position.set(cc.Global.GameView.width/2-100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(baoSamBt);MyHelper.addLblButton(baoSamBt,"B\u00e1o S\u00e2m",16);var huySamBt=MyHelper.createButton("button/btn_button2.png",true,function(){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":704,
"ib":false}];LobbyClient.getInstance().send(sendObj);thiz.baoSamTimer.stopAllActions();thiz.baoSamImg.visible=false;thiz.baoSamBt.visible=false;thiz.huySamBt.visible=false});huySamBt.position.set(cc.Global.GameView.width/2+100,cc.Global.GameView.height/2+320);MyPixi.gameContainer.addChild(huySamBt);MyHelper.addLblButton(huySamBt,"Hu\u1ef7",16);baoSamBt.visible=false;huySamBt.visible=false;readyBt.visible=false;startBt.visible=false;boLuotBt.visible=false;danhbaiBt.visible=false;this.baoSamBt=baoSamBt;
this.huySamBt=huySamBt;this.readyBt=readyBt;this.startBt=startBt;this.boLuotBt=boLuotBt;this.danhbaiBt=danhbaiBt;if(TEST_MODE){var chiabaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.chiabai()});chiabaiBt.position.set(cc.Global.GameView.width/2-580,cc.Global.GameView.height/2-143);MyPixi.gameContainer.addChild(chiabaiBt);MyHelper.addLblButton(chiabaiBt,"chia",16);var endGameBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onEndGameResponse()});endGameBt.position.set(cc.Global.GameView.width/
2-580,cc.Global.GameView.height/2-73);endGameBt.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(endGameBt);MyHelper.addLblButton(endGameBt,"end",16);var danhbaiBt=MyHelper.createButton("button/btn_button2.png",true,function(){var cardArr=thiz.cardList.getCardSelected();var arr=[];for(var i=0;i<cardArr.length;i++)arr.push(cardArr[i].getCardData().codeCard);thiz.onDanhBaiThanhCong(PlayerMe.uid,arr)});danhbaiBt.position.set(cc.Global.GameView.width/2+200,cc.Global.GameView.height/2);
MyPixi.gameContainer.addChild(danhbaiBt);MyHelper.addLblButton(danhbaiBt,"dealcard",16)}var reccBt=MyHelper.createButton("button/btn_0.png",true,function(){LobbyClient.getInstance().reConnect()},true,cc.size(100,50),[10,10,10,10]);reccBt.position.set(cc.Global.GameView.width/2-580-reccBt.width/2,cc.Global.GameView.height-50);MyPixi.gameContainer.addChild(reccBt);MyHelper.addLblButton(reccBt,"recc",16);reccBt.visible=false;var suggestBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.suggestCard()},
true,cc.size(100,50),[10,10,10,10]);suggestBt.position.set(cc.Global.GameView.width/2-580-suggestBt.width/2,cc.Global.GameView.height-150);MyPixi.gameContainer.addChild(suggestBt);MyHelper.addLblButton(suggestBt,"suggest",16);if(TEST_MODE)suggestBt.visible=true;else suggestBt.visible=false};
GameSam.prototype.initPlayer=function(){var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(cc.Global.GameView.width/2-playerMe.widthBG/2,-playerMe.heightBG/2+cc.Global.GameView.height-140);var player1=new GamePlayer;player1.sitId=1;player1.position.set(cc.Global.GameView.width-80-player1.widthBG/2,-player1.heightBG/2+cc.Global.GameView.height/2-50);var player2=new GamePlayer;player2.sitId=2;player2.position.set(cc.Global.GameView.width/2-player2.widthBG/2+280,-player2.heightBG/2+cc.Global.GameView.height-
630);var player3=new GamePlayer;player3.sitId=3;player3.position.set(cc.Global.GameView.width/2-280,-player3.heightBG/2+cc.Global.GameView.height-630);var player4=new GamePlayer;player4.sitId=4;player4.position.set(80-player4.widthBG/2,-player4.heightBG/2+360-50);this.playerView=[playerMe,player1,player2,player3,player4];if(this.data.Mu==2){this.playerView[1].visible=false;this.playerView[3].visible=false;this.playerView[4].visible=false;player2.position.set(cc.Global.GameView.width/2-player2.widthBG/
2,-player2.heightBG/2+cc.Global.GameView.height-630)}for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GameSam.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1){for(var i=1;i<=4;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}cc.log("arrangePlayerInGame")}this.processPlayerPosition(this.data.ps,
this.data.gS,arrangeChauRiaOnly);if(TEST_MODE);};GameSam.prototype.isReconnectOrViewer=function(){var players=this.data.players;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].TTID===PlayerMe.uid)meInPlayerList=true;if(meInPlayerList&&this.gameState===GAME_STATE.PLAYING)return true;else return false};
GameSam.prototype.showReadyIfCan=function(){var players=this.data.ps;var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;var meReady=false;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].uid===PlayerMe.uid){meReady=players[i].r;if(players.sit<0)meInPlayerList=false;else meInPlayerList=true}if(!meReady&&!isPlaying&&players.length>=2){this.readyBt.visible=true;cc.log("ready vao dayyyyyy")}else if(meReady&&!isPlaying&&players.length>=2)this.readyBt.visible=false;else this.readyBt.visible=
false;if(this.gameState==GAME_STATE.PLAYING||!meInPlayerList)this.readyBt.visible=false;var autoReady=cc.Global.GetSetting(GameSetting.autoReady,false);if(autoReady&&this.gameState!=GAME_STATE.PLAYING&&meInPlayerList&&!meReady){var idMaster=this.getIdRoomMaster();if(players[idMaster].uid!==PlayerMe.uid)this.sendStartRequest()}};GameSam.prototype.activeTurnButton=function(visible,isBaoSam){this.boLuotBt.visible=visible;this.danhbaiBt.visible=visible;if(isBaoSam)this.boLuotBt.visible=false};
GameSam.prototype.hideAllBtnPlay=function(){this.boLuotBt.visible=false;this.danhbaiBt.visible=false};GameSam.prototype.showAllBtnPlay=function(){this.boLuotBt.visible=true;this.danhbaiBt.visible=true};
GameSam.prototype.onUpdateTurn=function(uid,currentTime,newTurn){this.currentTurn=uid;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid){this.allSlot[i].showTimeRemain(currentTime,this.timeTurn);if(this.allSlot[i].isMe){this.hideAllBtnPlay();this.boLuotBt.visible=true;this.danhbaiBt.visible=true;if(newTurn)this.boLuotBt.visible=false}else{this.boLuotBt.visible=false;this.danhbaiBt.visible=false}}else this.allSlot[i].stopTimeRemain()};
GameSam.prototype.suggestCard=function(cardsDeaded,isBlurCardIfNeed){if(!isBlurCardIfNeed)isBlurCardIfNeed=true;if(TEST_MODE){this.playerView[0].x=cc.Global.GameView.width/2-GameSam.X_CHIA_BAI;var cards=[];cardArray=[8,9,12,13,16,17,18,19,20,21,24,27,28,36,40,44,49];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));this.cardList.dealCards(cards,false);cardsDeaded=[8,12,16];var cards=[];for(var i=0;i<cardsDeaded.length;i++)cards.push(Utils.getCardFromServer(cardsDeaded[i]));
this.cardListDeal.visible=true;this.cardListDeal.dealCards(cards,false)}SuggestCardMng.getInstance().suggestCard(this.cardList,cardsDeaded,isBlurCardIfNeed)};
GameSam.prototype.onChangeTurn=function(dataObj){cc.log("onChangeTurn "+JSON.stringify(dataObj));this.baoSamTimer.stopAllActions();this.baoSamImg.visible=false;var data=dataObj[1];var nCmd=dataObj[1].nCmd;var fromPlayer=dataObj[1].fP;var puid=fromPlayer?fromPlayer.puid:null;var lastArrCardDeal;if(fromPlayer&&fromPlayer.pS==Constant.PLAYER_STATE.DANH_BAI)lastArrCardDeal=fromPlayer.dCs;if(lastArrCardDeal&&lastArrCardDeal.length){this.lastArrCardDeal=lastArrCardDeal;this.lastUidDealCard=fromPlayer.uid}var thiz=
this;if(fromPlayer&&fromPlayer.pS==Constant.PLAYER_STATE.DANH_BAI&&lastArrCardDeal&&lastArrCardDeal.length){this.lastArrCardDeal=lastArrCardDeal;this.lastUidDealCard=fromPlayer.uid;if(fromPlayer.uid!==PlayerMe.uid){var totalReduce=lastArrCardDeal.length;var slot=this.getSlotByUid(fromPlayer.uid);cc.log("reduce "+totalReduce);this.backCardList[slot.sitId].showRemainCard(true,-totalReduce)}}if(fromPlayer&&fromPlayer.pS==Constant.PLAYER_STATE.BO_LUOT){this.rejectTurnTotal++;if(fromPlayer.uid==PlayerMe.uid)this.meRejectTurn=
true}var tP=dataObj[1].tP;var baoSam=tP.ib;if(!baoSam)baoSam=false;this.hideBaoSamCenter();if(baoSam){this.setStatePlayer(tP.uid,state_player.BAO_SAM);var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===tP.uid){el.ib=true;break}}}var mySlot=null;this.activeTurnButton(false);thiz.onUpdateTurn(data.tP.uid,thiz.timeTurn,false);if(fromPlayer&&fromPlayer.pS==Constant.PLAYER_STATE.DANH_BAI&&lastArrCardDeal.length)this.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal);
this.allSlot.forEach(function(slot,index){if(slot){thiz.setStatePlayer(slot.uid,state_player.NOTHING);if(tP.uid===slot.uid&&slot.isMe){thiz.activeTurnButton(true,baoSam);if(thiz.rejectTurnTotal===thiz.totalPlayerPlaying-1){cc.log("0000suggest "+lastArrCardDeal);thiz.suggestCard()}else if(lastArrCardDeal&&lastArrCardDeal.length){cc.log("----suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,true)}else{cc.log("--11-suggest"+thiz.lastArrCardDeal);thiz.suggestCard(thiz.lastArrCardDeal,true)}mySlot=
slot}if(fromPlayer&&fromPlayer.uid===slot.uid){if(fromPlayer.pS==2)slot.setState(state_player.BO_LUOT);if(fromPlayer.uid===PlayerMe.uid)if(fromPlayer.pS===2)thiz.suggestCard([]);else{cc.log("333suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,false)}}if(tP.uid!=slot.uid&&fromPlayer&&fromPlayer.uid!=slot.uid&&slot.isMe)if(lastArrCardDeal&&lastArrCardDeal.length){cc.log("444suggest "+lastArrCardDeal);thiz.suggestCard(lastArrCardDeal,false)}else{cc.log("555suggest "+thiz.lastArrCardDeal);
thiz.suggestCard(thiz.lastArrCardDeal,false)}if(fromPlayer&&fromPlayer.puid){cc.log("------- an chat ");var addMoney=fromPlayer.mX;var reduceMoney=fromPlayer.lm;var puid=fromPlayer.puid;if(fromPlayer.uid==slot.uid)slot.runChangeGoldEffect(addMoney);if(puid==slot.uid)slot.runChangeGoldEffect(reduceMoney)}}});cc.log(thiz.rejectTurnTotal+" \x3c\x3d\x3d\x3d\x3d \x3e "+(thiz.totalPlayerPlaying-1));if(thiz.rejectTurnTotal==thiz.totalPlayerPlaying-1){thiz.rejectTurnTotal=0;thiz.meRejectTurn=false;thiz.lastArrCardDeal.length=
0;thiz.hideAllBoLuot();if(tP.uid==PlayerMe.uid)thiz.boLuotBt.visible=false;thiz.cardOnTable.flipAndRemoveAll()}if(tP.uid==PlayerMe.uid)if(mySlot&&this.cardList.isAllBlur())this.danhbaiBt.visible=false};
GameSam.prototype.onDanhBaiThanhCong=function(uid,cardData){cc.log("onDanhBaiThanhCong  "+cardData);var slot=this.getSlotByUid(uid);if(slot){var cards=[];for(var i=0;i<cardData.length;i++)cards.push(Utils.getCardFromServer(cardData[i]));if(slot.isMe){var arr=this.cardList.removeCard(cards);for(var i=0;i<arr.length;i++){var pos=cc.convertToWorldSpace(arr[i]);arr[i].position.set(pos.x,pos.y);arr[i].canTouch=false}this.cardOnTable.moveOldCard();this.cardOnTable.addCard(arr);this.cardList.reOrder();cc.log("onDanhBaiThanhCong  me ")}else{this.cardOnTable.moveOldCard();
var bCard=this.backCardList[slot.sitId];var pos=cc.convertToWorldSpace(bCard);pos=cc.p(pos.x+bCard.widthContainer/2,pos.y+bCard.heightContainer/2);this.cardOnTable.addNewCardList(cards,pos);cc.log("onDanhBaiThanhCong  not me")}}};
GameSam.prototype.onEndGameResponse=function(dataObj){if(TEST_MODE)dataObj=[5,{"ps":[{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":PlayerMe.uid,"dn":"gts005","whR":1,"mX":5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[1].uid,"dn":"gts005","mX":-5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[2].uid,"dn":"gts005","mX":-5500,"m":99981075},{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[3].uid,"dn":"gts005","mX":-5500,"m":99981075},
{"cs":[10,19,22,25,26,27,29,31,37,44,46],"uid":this.allSlot[4].uid,"dn":"gts005","mX":-5500,"m":99981075}],"cmd":252}];cc.log("onEndGameResponse "+JSON.stringify(dataObj));cc.log("onEndGameResponse "+JSON.stringify(dataObj));var data=dataObj[1];var thiz=this;var player=dataObj[1].ps;thiz.playerPlayed=player;thiz.isShowingResult=true;thiz.showReady(false);thiz.hideAllBtnPlay();thiz.stopTurnTimeAll();for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var fromPlayer=dataObj[1].fP;
if(fromPlayer){this.isPlaying=false;var lastArrCardDeal=fromPlayer.dCs;this.onDanhBaiThanhCong(fromPlayer.uid,lastArrCardDeal);thiz.allSlot.forEach(function(_slot,index){if(_slot!=null){var isHorizontal=true;var scale=.5;if(!_slot.isMe){var p=thiz.getPlayerDataByUid(_slot.uid,player);if(p){var cards=[];var cardArray=p.cs;for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));_slot.showCardEndGame(cards,true)}}}});this.showResult(true,dataObj[1])}else thiz.onWinAfterChiabai(dataObj[1]);
thiz.data.ps.forEach(function(p,i){p.pi=false;p.r=false;p.ib=false});var delay=cc.delayTime(this.tfeg);var cb=function(){if(thiz.registerQuit&&thiz.registerQuitHandler){thiz.registerQuit=false;thiz.registerQuitHandler();thiz.registerQuitHandler=null}LobbyClient.getInstance().checkkickWhenEndGame();thiz.resetNewGame();thiz.arrangePlayerInGame();var idMaster=thiz.getIdRoomMaster();if(thiz.data.ps[idMaster].uid==PlayerMe.uid){thiz.showReady(false);thiz.showStartIfCan()}else thiz.showReadyIfCan()};var callFun=
cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));cc.log("delay "+this.tfeg+" then resetgame")};
GameSam.prototype.showResult=function(isShow,dataObj){var thiz=this;if(isShow){for(var i=0;i<this.backCardList.length;i++)this.backCardList[i].removeAll();var playerArr=dataObj.ps;if(dataObj.fP){this.playSoundAction("finished");var uidWin=dataObj.fP.uid;var winMoney=dataObj.fP.mX;var totalMoney=dataObj.fP.m;var loseType=dataObj.fP.lt;thiz.allSlot.forEach(function(slot,index){if(slot)if(slot.uid==uidWin){slot.showResult(true,totalMoney,winMoney,slot.sitId,-1,false,loseType);if(uidWin==PlayerMe.uid)if(thiz.aid==
Constant.ASSET_ID.GOLD)PlayerMe.gold+=winMoney;else PlayerMe.chip+=winMoney}else for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid==slot.uid){var isCong=playerArr[i].lt===2?true:false;slot.showResult(false,playerArr[i].m,playerArr[i].mX,slot.sitId,-1,isCong,playerArr[i].lt);if(playerArr[i].uid==PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold-=winMoney;else PlayerMe.chip-=winMoney;else{var cards=[];var cardArray=playerArr[i].cs;for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));
slot.showCardEndGame(cards,true)}break}});playerArr.push(dataObj.fP)}else{var delay=cc.delayTime(1);var cb=function(){thiz.playSoundAction("finished");var uidWin=-1;var wcr=-1;var winMoney=0;var totalMoney=0;var playWin="";var cardWinArr=[];playerArr.forEach(function(_player,index){if(_player.wcr&&_player.wcr>0){uidWin=_player.uid;wcr=_player.wcr;playWin=_player.dn;totalMoney=_player.m;winMoney=_player.mX;cardWinArr=_player.cs}});thiz.allSlot.forEach(function(slot,index){if(slot)if(slot.uid==uidWin){slot.showResult(true,
totalMoney,winMoney,slot.sitId,wcr,false);if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold+=winMoney;else PlayerMe.chip+=winMoney}else for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid==slot.uid){slot.showResult(false,playerArr[i].m,playerArr[i].mX,slot.sitId,-1,false);if(playerArr[i].uid==PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold-=winMoney;else PlayerMe.chip-=winMoney;break}})};var callFun=new cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun))}for(var i=0;i<
playerArr.length;i++)thiz.updateMoneyPlayer(playerArr[i])}};
GameSam.prototype.onWinAfterChiabai=function(data){var player=data.ps;var thiz=this;thiz.resetNewGame(true);var whR=-1;var cardWinArr=[];player.forEach(function(_player,index){if(_player.whR&&_player.whR>0){whR=_player.whR;cardWinArr=_player.cs}});thiz.gameState=GAME_STATE.SHOW_KQ;thiz.isPlaying=true;var delay=cc.delayTime(.4);var cb=function(){thiz.isPlaying=false;thiz.showResult(true,data)};var callFun=cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));this.hideAllBtnPlay();thiz.allSlot.forEach(function(slot,
index){if(slot!=null)player.forEach(function(_player,j){if(_player.uid==slot.uid){var cardArray=_player.cs;var cards=[];for(var i=0;i<cardArray.length;i++)cards.push(Utils.getCardFromServer(cardArray[i]));var rd=Math.floor(Math.random()*10+1);if(TEST_MODE)if(slot.isMe)slot.isMe=rd>5?true:false;if(slot.isMe)slot.x=cc.Global.GameView.width/2-thiz.playerView[0].widthBG/2-GameSam.X_CHIA_BAI;var deckPoint=cc.p(cc.winSize.width/2,cc.winSize.height/2);slot.showCardEndGame(cards,true,deckPoint);_player.pi=
true}})})};GameSam.prototype.sendStartRequest=function(){cc.log("send ready ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameSam.prototype.sendBoLuot=function(){var thiz=this;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_SAM.REJECT_TURN}];LobbyClient.getInstance().send(sendObj);thiz.ideGameNumber=0};
GameSam.prototype.sendDanhBai=function(){if(TEST_MODE){this.onChangeTurn();return}var cards=this.cardList.getCardSelected();if(cards.length>0){var intCardArr=[];for(var i=0;i<cards.length;i++)intCardArr.push(Utils.getCodeCard(cards[i].point,cards[i].suit));var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_SAM.DANH_BAI,"cs":intCardArr}];LobbyClient.getInstance().send(msg)}else MessageNode.getInstance().show("B\u1ea1n ch\u01b0a nh\u1ea5c c\u00e2y b\u00e0i n\u00e0o",
1)};GameSam.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameSam.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}cc.log("click quit room tlmn");if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
this.registerQuitHandler=null}return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};var state_lieng=state_lieng||{};state_lieng.SHAPCARD=0;state_lieng.UP_BAI=1;state_lieng.THEO=2;state_lieng.XEM=3;state_lieng.TO=4;state_lieng.XA_LANG=5;state_lieng.DANG_CO_LUOT=6;var LIENG_PLAYER_STATE={SHAPCARD:0,UP_BAI:1,THEO:2,XEM:3,TO:4,XA_LANG:5,DANG_CO_LUOT:6};var LIENG_CMD={CMD_WITHDRAW:699,CMD_AUTO_READY:204,CMD_CHIA_BAI:700,CMD_END_GAME:702,CMD_ON_COUNT_DOWN:708,CMD_SHOW_CARD:709,CMD_CHANGE_TURN:701};
function GameLieng(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.roomID=LobbyClient.getInstance().getCurrentRoomId();this.registerQuit=false;this.totalPlayerPlaying=0;this.rejectTurnTotal=0;this.arrEarnCard=[];this.data=data;this.type="GameLieng";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.countDownNode=new CountDownNode;this.countDownNode.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.countDownNode);
this.countDownNode.visible=false;var texts=["N\u1eb7n b\u00e0i","Chi 2","Chi 3","So s\u1eadp h\u1ea7m","So s\u1eadp l\u00e0ng","K\u1ebft qu\u1ea3"];this.lblNarrativeResult=new Narrative(cc.size(180,52),texts);this.lblNarrativeResult.y-=130;this.lblNarrativeResult.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.lblNarrativeResult);this.lblNarrativeResult.visible=false;this.init();this.initDialog();this.initGame()}GameLieng.prototype=Object.create(GameScene.prototype);
GameLieng.X_CHIA_BAI=550;GameLieng.MAX_CARD_PLAYER=10;GameLieng.cardOriginScaleBackCard=.7;GameLieng.MAX_SLOT=9;GameLieng.prototype.init=function(){this.registerQuit=false;this.currentTurn=0;this.ideGameNumber=0;this.IDE_GAME_KICK=3};
GameLieng.prototype.initDialog=function(){this.dialogs=[];this.dialogWithdrawMoney=new WithdrawMoneyDialog(this);this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney=new RaiseMoney(this);this.dialogRaiseMoney.show(false);this.dialogShapCardShow=new ShapeCardShow(this,cc.size(500,344),"res/bg/bg_dialog_small.png");this.dialogShapCardShow.show(false);var thiz=this;this.dialogStandUpQuit=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogStandUpQuit.okButton,"\u0110\u1ee9ng l\u00ean",16);
MyHelper.addLblButton(this.dialogStandUpQuit.cancelButton,"R\u1eddi b\u00e0n",16);this.dialogStandUpQuit.setMessage("B\u1ea1n mu\u1ed1n \u0111\u1ee9ng l\u00ean hay tho\u00e1t b\u00e0n?");this.dialogStandUpQuit.okButtonHandler=function(){thiz.onStandUp()};this.dialogStandUpQuit.cancelButtonHandler=function(){thiz.quitRoom()};this.dialogStandUpQuit.hide=function(){if(thiz.dialogStandUpQuit.parent){thiz.dialogStandUpQuit.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,
cc.callFunc(function(){thiz.dialogStandUpQuit.visible=false}));thiz.dialogStandUpQuit.runAction(thiz.dialogStandUpQuit.bgHide,ac)}};this.dialogStandUpQuit.show(false)};GameLieng.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.shapeTime=1E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initPlayer();this.initButton();this.initCardContainer();this.updateGame(this.data)};
GameLieng.prototype.updateGame=function(data){cc.log("updateGame "+JSON.stringify(data));var thiz=this;this.betValue=data.b;this.currentBet=data.cb;this.timeEndGame=data.tfeg;this.maxPlayer=data.Mu;this.mMBI=data.mMBI;this.MMBI=data.MMBI;var gameState=data.gS;this.gameState=gameState;var remainTime=data.rmT;var remainTime=data.rmT;var players=data.ps;var listPlayer=data.ps;this.arrangePlayerInGame();if(gameState==GAME_STATE.PLAYING||gameState===5)if(!data.re){var isShapCardTime=true;this.setStatePlayer(PlayerMe.uid,
state_player.DANG_XEM);for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(p.pi)thiz.totalPlayerPlaying++;if(p.pS!==0)isShapCardTime=false}thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd",2);thiz.allSlot.forEach(function(slot,index){if(slot!=null&&!slot.isMe)for(var i=0;i<players.length;i++){var p=players[i];if(slot.uid==p.uid){var cardArray=[8,8,8];var isRoomMaster=p.C;var playerState=p.pS;var faceCard=p.fc;var pi=p.pi;var rr=p.rr;
var currentBet=p.cb;if(pi){var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var animation=false;var isMe=slot.uid==PlayerMe.uid;var showBackCard=isMe?false:true;var originScale=isMe?1:.7;slot.cardList.dealCards(cards,isMe,animation,showBackCard,originScale);thiz.tossChip(slot.uid,currentBet,true,animation);if(faceCard)slot.cardList.changeCardAndShow(faceCard);if(playerState===LIENG_PLAYER_STATE.SHAPCARD)thiz.onUpdateTurn(slot.uid,remainTime,isShapCardTime);
else if(playerState===LIENG_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime);else if(playerState>0&&playerState<LIENG_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerLieng(slot.uid,playerState)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);continue}}})}listPlayer.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;this.onReconnect(data);if(this.isPlaying)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(false)}else this.currentBet=
this.betValue};
GameLieng.prototype.onReconnect=function(data){cc.log("reconect data*** "+Utils.encode(data));var thiz=this;thiz.meSitDown=true;var listPlayer=data.ps;var gameState=data.gS;thiz.gameState=data.gS;var mb=data.mb;var remainTime=data.rmT;var isReconnect=true;var isAnimChiaBai=false;var isShapCardTime=true;var fi=data;var isAnimChiBai=false;for(var i=0;i<listPlayer.length;i++)if(listPlayer.pS!==0){isShapCardTime=false;break}if(isShapCardTime)thiz.lblNarrativeResult.showText("N\u1eb7n b\u00e0i");var myActor=
null;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(slot.uid===p.uid){var cardArray=p.cs;var faceCard=p.fc;var currentBet=p.cb;var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;if(pi){thiz.totalPlayerPlaying++;if(!cardArray)cardArray=[0,1,2];while(cardArray.length<3)cardArray.push(0);var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var animation=true;var isMe=slot.uid==PlayerMe.uid;
var showBackCard=isMe?false:true;var originScale=isMe?1:.7;slot.cardList.dealCards(cards,isMe,animation,showBackCard,originScale);thiz.tossChip(slot.uid,currentBet,true,animation);if(slot.uid===PlayerMe.uid){thiz.currentBet=p.cb;slot.cardList.finishShapeCard();if(playerState===LIENG_PLAYER_STATE.DANG_CO_LUOT)thiz.turnButtons.showAll(true);else thiz.turnButtons.showAll(false);if(thiz.currentBet===mb)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false)}if(faceCard)if(p.uid===
PlayerMe.uid){cc.log("changeCardAndShow "+faceCard);slot.cardList.changeCardAndShow(faceCard)}else{cc.log("changeCardAndShow "+faceCard);slot.cardList.changeCardAndShow(faceCard)}cc.log(p.dn+" playerState "+playerState);if(playerState===LIENG_PLAYER_STATE.SHAPCARD&&isShapCardTime)thiz.onUpdateTurn(slot.uid,remainTime,isShapCardTime);else if(playerState===LIENG_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime);else if(playerState>0&&playerState<LIENG_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerLieng(slot.uid,
playerState);if(p.uid===PlayerMe.uid){var myCardState=[0,0,0];if(faceCard)for(var i=0;i<faceCard.length;i++){var index=cardArray.indexOf(faceCard[i]);if(index!=-1)myCardState[index]=1}while(myCardState.length<3)myCardState.push(0);thiz.myCards=cardArray;thiz.myCardState=myCardState;cc.log("myCardState "+myCardState)}}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);break}}});thiz.changeSitToInviteBg()};
GameLieng.prototype.initCardContainer=function(){this.potOnTable=[];var y=cc.Global.GameView.height/2-175;var startX=cc.Global.GameView.width/2-600;for(var i=0;i<GameLieng.MAX_SLOT;i++){var chipColumnPot=new ChipColumnList(cc.size(30,100),.3,ChipColumnList.LBL_BOT);chipColumnPot.position.set(startX+i*150,y);chipColumnPot.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPot);if(TEST_MODE)chipColumnPot.showBlurBg(true);this.potOnTable.push(chipColumnPot)}var list=[this.potOnTable[0],
this.potOnTable[1],this.potOnTable[7],this.potOnTable[8]];startX=cc.Global.GameView.width/2-225;for(var i=0;i<list.length;i++){list[i].position.set(startX+i*150,y+25);if(TEST_MODE)list[i].showBlurBg(true)}};GameLieng.prototype.changeSitToInviteBg=function(){var totalSit=9;for(var i=0;i<this.playerView.length;i++){var slot=this.playerView[i];if(!slot.uid||slot.uid===""){slot.changeToSmallBg(this.meSitDown);slot.showInfoLayer(false)}}};
GameLieng.prototype.hideAllBtnPlay=function(){for(var i=0;i<this.turnButtons.length;i++)this.turnButtons[i].visible=false};GameLieng.prototype.onUpdateTurn=function(uid,currentTime,isTimeShapCard){var timeTurn=this.timeTurn;if(isTimeShapCard)timeTurn=this.shapeTime;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,timeTurn);else if(!isTimeShapCard)this.allSlot[i].stopTimeRemain()};
GameLieng.prototype.handlePendingBack=function(){this.isPlaying=false;this.isShowingResult=false;if(this.registerQuit){this.quitRoom();return false}this.resetNewGame();if(this.ideGameNumber>=this.IDE_GAME_KICK){this.ideGameNumber++;this.quitRoom(true);this.idleKick=true;return false}return true};
GameLieng.prototype.resetNewGame=function(igNoreCheckReady){this.isPlaying=false;this.totalPlayerPlaying=0;this.isViewing=false;this.lblNarrativeResult.hideLine();this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;for(var i=0;i<this.chipColumns.length;i++)this.chipColumns[i].onReset();for(var i=0;i<this.potOnTable.length;i++)this.potOnTable[i].onReset();this.myCards=[];this.myCardState=[];this.currentBet=this.betValue;this.maxBet=this.currentBet;this.meUpBai=false;this.showResultTotalTime=
0;this.showResultBegin=0;this.dataResult="";this.isShowingResult=false;this.isPlaying=false;this.currentTurn=0;cc.log("reset----------------------------");this.data.ps.forEach(function(player,index){player.pi=false});for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].resetEndGame();this.allSlot[i].cardList.removeAll()}this.clearStatePlayer();this.arrangePlayerInGame()};
GameLieng.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT){this.onUserInOut(dataObj);if(dataObj[1].t===1){if(dataObj[1].p.uid===PlayerMe.uid){this.dialogWithdrawMoney.show(false);if(this.gameState===4||this.gameState===5)this.isViewing=true;else this.isViewing=false;this.meSitDown=true}}else if(dataObj[1].t===
2)if(dataObj[1].p.uid===PlayerMe.uid){this.meSitDown=false;this.dialogStandUpQuit.hide();if(this.playerView[0])this.playerView[0].showRutTienBtn(false);if(this.gameState===4||this.gameState===5)this.isViewing=true}if(dataObj[1].p.uid===PlayerMe.uid||this.meSitDown)this.changeSitToInviteBg();if(this.data.ps.length===1)this.countDownNode.hide()}else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===LIENG_CMD.CMD_WITHDRAW)this.onWithDrawResponse(dataObj[1]);else if(cmd===LIENG_CMD.CMD_AUTO_READY)this.onAutoReadyResponse(dataObj);else if(cmd==LIENG_CMD.CMD_CHIA_BAI)this.chiabai(dataObj[1]);else if(cmd==LIENG_CMD.CMD_END_GAME)this.onEndGame(dataObj[1]);else if(cmd==LIENG_CMD.CMD_ON_COUNT_DOWN)this.onCountDownResponse(dataObj);else if(cmd==LIENG_CMD.CMD_SHOW_CARD)this.onShowCard(dataObj);else if(cmd==LIENG_CMD.CMD_CHANGE_TURN)this.onChangeTurn(dataObj);
else if(cmd==Constant.CMD_RESULT.PLAYER_READY){var uid=dataObj[1].uid;this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=true})}};GameLieng.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};
GameLieng.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=dataObj[1].mgs;if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";if(errorCode===1E3)errorStr="Kh\u00f4ng c\u00f2n ch\u1ed7 tr\u1ed1ng \u0111\u1ec3 ng\u1ed3i";MessageNode.getInstance().show(errorStr)};
GameLieng.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GameLieng.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameLieng.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateRealMoneyPlayer(playerArr[i]);break}}};
GameLieng.prototype.onWithDrawResponse=function(data){var thiz=this;this.updateMoneyPlayer(data);this.allSlot.forEach(function(slot,index){if(slot&&slot.uid===data.uid){slot.setTotalGoldWithEffect(data.m);if(data.uid===PlayerMe.uid)thiz.dialogWithdrawMoney.show(false)}})};
GameLieng.prototype.onAutoReadyResponse=function(dataObj){cc.log("onAutoReadyResponse "+JSON.stringify(dataObj));cc.log("send ready");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameLieng.prototype.onCountDownResponse=function(dataObj){cc.log("onCountDownResponse "+JSON.stringify(dataObj));this.checkLeaveRoomIfCan();var timeCountDown=dataObj[1].T/1E3;cc.log(timeCountDown+" timeCountDown");var thiz=this;cc.log("vao day nao");thiz.resetNewGame();thiz.arrangePlayerInGame();var cb=function(){thiz.requestStart();thiz.countDownNode.hide()};var callFun=cc.callFunc(cb);this.countDownNode.showWithTime(timeCountDown);this.runAction(this,cc.sequence(cc.delayTime(timeCountDown),callFun))};
GameLieng.prototype.requestStart=function(){cc.log("aaaa send 708 to server");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":708}];LobbyClient.getInstance().send(sendObj)};
GameLieng.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("onReadyResponse "+JSON.stringify(dataObj));cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING)};
GameLieng.prototype.onShowCard=function(dataObj){cc.log("onShowCard "+JSON.stringify(dataObj));var thiz=this;this.dialogShapCardShow.show(false);var myUid=PlayerMe.uid;var senderUid=dataObj[1].uid;var cs=dataObj[1].cs;thiz.allSlot.forEach(function(slot,index){if(slot){var actorUid=slot.uid;if(actorUid===senderUid)if(actorUid===myUid)slot.cardList.moveCardShow(cs);else{cc.log("card show---- "+JSON.stringify(cs));slot.cardList.changeCardAndShow(cs)}}})};
GameLieng.prototype.tossChip=function(uid,moneyToss,isReconnect,animation){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;var slot=this.getSlotByUid(uid);var typeChip=this.getIdCoinImg(moneyToss/this.betValue);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var pos=cc.convertToNodeSpace(this.chipColumns[slot.sitId],slotPos);this.chipColumns[slot.sitId].show(true);
var animTime=this.chipColumns[slot.sitId].addNewChip([typeChip],moneyToss,animation,pos,.5)};
GameLieng.prototype.onChangeTurn=function(dataObj){var thiz=this;thiz.lblNarrativeResult.hideLine();this.dialogRaiseMoney.show(false);var mb=dataObj[1].mb;thiz.maxBet=mb;var fromPlayer=dataObj[1].fP;if(fromPlayer)thiz.data.ps.forEach(function(p,i){if(p.uid==fromPlayer.uid)p.pS=fromPlayer.pS});var tP=dataObj[1].tP;thiz.turnButtons.showAll(false);thiz.allSlot.forEach(function(slot,index){if(slot){if(slot.uid===PlayerMe.uid)if(!thiz.isViewing&&thiz.gameState===GAME_STATE.PLAYING)slot.cardList.finishShapeCard();
if(tP.uid==slot.uid)thiz.onUpdateTurn(slot.uid,thiz.timeTurn);else slot.stopTimeRemain();if(fromPlayer&&slot.uid===fromPlayer.uid){thiz.setStatePlayerLieng(slot.uid,fromPlayer.pS);if(fromPlayer.pS===1)thiz.meUpBai=true;if(fromPlayer.pS===2||fromPlayer.pS===4||fromPlayer.pS===5){var addBet=thiz.getMoneyPlayer(fromPlayer.uid)-fromPlayer.m;if(addBet>0){thiz.tossChip(slot.uid,addBet,false,true);slot.reduceMoney(-addBet)}if(slot.uid===PlayerMe.uid)thiz.currentBet=fromPlayer.cb}}if(slot.uid===PlayerMe.uid)if(tP.uid===
PlayerMe.uid)if(thiz.isXemUp||thiz.isTheoTat){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);if(thiz.isTheoTat)if(mb===thiz.currentBet)thiz.onXem();else thiz.onTheo();else if(thiz.isXemUp)if(mb===thiz.currentBet)thiz.onXem();else thiz.onUpBai()}else{thiz.turnButtons.showAll(true);thiz.turnButtons.showAllAuto(false);thiz.dialogRaiseMoney.show(false);if(thiz.currentBet===mb)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false);if(mb-thiz.currentBet>=thiz.getMoneyPlayer(PlayerMe.uid)||
thiz.getMaxRaise()<=0)thiz.turnButtons.showTo(false)}else if(thiz.meUpBai||thiz.isViewing){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false)}else{thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(true)}}});thiz.updateMoneyPlayer(fromPlayer);if(tP.uid===PlayerMe.uid)if(thiz.getMaxRaise()<=0)thiz.turnButtons.showTo(false)};
GameLieng.prototype.chiabai=function(data){if(TEST_MODE){var player=[];for(var i=0;i<this.allSlot.length;i++)player.push(this.allSlot[i].uid);data={"cs":[37,33,29],"lpi":player,"cmd":700}}this.dialogWithdrawMoney.show(false);this.dialogStandUpQuit.visible=false;cc.log("chiabai "+JSON.stringify(data));var thiz=this;thiz.disablePendindAndReset=true;var playerArr=data.ps;if(playerArr)for(var idx in thiz.allSlot){var slot=thiz.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===
slot.uid){thiz.updateRealMoneyPlayer(playerArr[i]);break}}thiz.ideGameNumber++;thiz.resetNewGame();thiz.lblNarrativeResult.showText("N\u1eb7n b\u00e0i");thiz.gameState=GAME_STATE.PLAYING;thiz.data.gS=GAME_STATE.PLAYING;var listPlayer=data.lpi;thiz.listPlayer=listPlayer;if(listPlayer.indexOf(PlayerMe.uid)!==-1)thiz.isViewing=false;else thiz.isViewing=true;if(!thiz.isViewing)thiz.isPlaying=true;thiz.playSoundAction("chiabai");var cardArray=data.cs;thiz.myCards=data.cs;thiz.myCardState=[0,0,0];thiz.data.ps.forEach(function(p,
i){for(var j=0;j<listPlayer.length;j++)if(p.uid==listPlayer[j]){p.pi=true;p.pS=0;p.m-=thiz.betValue;thiz.updateMoneyPlayer(p);break}});thiz.totalPlayerPlaying=listPlayer.length;thiz.allSlot.forEach(function(slot,index){if(slot){if(thiz.isViewing)cardArray=[0,0,0];if(listPlayer.indexOf(slot.uid)>-1){thiz.onUpdateTurn(slot.uid,thiz.shapeTime,true);thiz.setStatePlayer(slot.uid,state_player.NOTHING);thiz.animChiaBaiToPlayer(cardArray,slot,true);if(slot.uid==PlayerMe.uid)slot.showRutTienBtn(false)}else{thiz.setStatePlayer(slot.uid,
state_player.DANG_XEM);if(slot.uid==PlayerMe.uid)slot.showRutTienBtn(false)}}})};
GameLieng.prototype.animChiaBaiToPlayer=function(cardArray,slot,animation,isReconnect){if(hiepnh.isUndefined(animation))animation=true;if(hiepnh.isUndefined(isReconnect))isReconnect=false;this.tossChip(slot.uid,this.betValue,isReconnect,animation);slot.reduceMoney(-this.betValue);var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var isMe=slot.uid==PlayerMe.uid;var showBackCard=isMe?false:true;var originScale=isMe?1:.7;slot.cardList.dealCards(cards,isMe,
animation,showBackCard,originScale,false)};
GameLieng.prototype.initButton=function(){var thiz=this;var x=cc.Global.GameView.width/2;var y=cc.Global.GameView.height/2;var upBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onUpBai()});upBt.position.set(x+533,y+311);upBt.displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(upBt);MyHelper.addLblButton(upBt,"\u00dap",16);upBt.visible=false;var latBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onLatBai()});latBt.position.set(x+347,y+311);
MyPixi.gameContainer.addChild(latBt);latBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(latBt,"L\u1eadt",16);latBt.visible=false;var xemBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onXem()});xemBt.position.set(x+347,y+240);MyPixi.gameContainer.addChild(xemBt);xemBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(xemBt,"Xem",16);xemBt.visible=false;var toBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onShowTo()});toBt.position.set(x+
533,y+240);MyPixi.gameContainer.addChild(toBt);toBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(toBt,"T\u1ed1",16);toBt.visible=false;var xemUpBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");xemUpBt.setText("Xem \u00fap");xemUpBt.anchor.set(.5,.5);xemUpBt.position.set(x+347,y+311);MyPixi.gameContainer.addChild(xemUpBt);xemUpBt.displayGroup=MyPixi.gamePlayerLayer;xemUpBt.onSelect=function(selected){thiz.theoTatBt.unSelect();thiz.onUpTheo()};xemUpBt.onUnSelect=
function(selected){thiz.onUpTheo()};xemUpBt.visible=false;var theoTatBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");theoTatBt.setText("Theo t\u1ea5t");theoTatBt.anchor.set(.5,.5);theoTatBt.position.set(x+533,y+311);MyPixi.gameContainer.addChild(theoTatBt);theoTatBt.displayGroup=MyPixi.gamePlayerLayer;theoTatBt.onSelect=function(selected){thiz.xemUpBt.unSelect();thiz.onTheoTat()};theoTatBt.onUnSelect=function(selected){thiz.onTheoTat()};theoTatBt.visible=false;this.theoTatBt=
theoTatBt;this.xemUpBt=xemUpBt;var btnList=[upBt,latBt,xemBt,toBt];var btnListAuto=[xemUpBt,theoTatBt];this.turnButtons=new TurnButtonUI(btnList,btnListAuto);if(TEST_MODE){var tossChip=MyHelper.createButton("button/btn_button2.png",true,function(){var rd=Math.floor(Math.random()*thiz.playerView.length);thiz.tossChip(thiz.getSlotByIndex(rd).uid,500,false,true)});tossChip.position.set(50,cc.Global.GameView.height-150);tossChip.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(tossChip);
MyHelper.addLblButton(tossChip,"toss",16);var chiaBai=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.chiabai()});chiaBai.position.set(50,cc.Global.GameView.height-80);chiaBai.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(chiaBai);MyHelper.addLblButton(chiaBai,"chiabai",16);var showTo=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onShowTo()});showTo.position.set(200,cc.Global.GameView.height-80);showTo.displayGroup=MyPixi.gameContainerLayer;
MyPixi.gameContainer.addChild(showTo);MyHelper.addLblButton(showTo,"showTo",16);var endBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onEndGame()});endBt.position.set(200,cc.Global.GameView.height-150);endBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(endBt);MyHelper.addLblButton(endBt,"endBt",16);var recBt=MyHelper.createButton("button/btn_button2.png",true,function(){LobbyClient.getInstance().reConnect()});recBt.position.set(50,cc.Global.GameView.height-
150);recBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(recBt);MyHelper.addLblButton(recBt,"recBt",16)}};GameLieng.prototype.updateRealMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.rM=data.m;break}}};
GameLieng.prototype.updateMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.m=data.m;if(data.rM)el.rM=data.rM;break}}};GameLieng.prototype.getMoneyPlayer=function(uid){var thiz=this;var length=thiz.data.ps.length;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===uid)return el.m}return-1};
GameLieng.prototype.getIdCoinImg=function(ratio){var id=ChipType.WHITE;if(ratio>=20)id=ChipType.RED;else if(ratio>=10)id=ChipType.VIOLET;else if(ratio>=4)id=ChipType.BLUE;else if(ratio>=2)id=ChipType.GREEN;else if(ratio>=1)id=ChipType.WHITE;return id};GameLieng.prototype.getPlayerIndexByUid=function(uid){for(var idx in this.allSlot)if(this.allSlot[idx]===uid)return idx;return-1};
GameLieng.prototype.onEndGame=function(data){var thiz=this;this.dialogRaiseMoney.show(false);thiz.lblNarrativeResult.hideLine();thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);thiz.turnButtons.checkAllAuto(false);thiz.isTheoTat=false;thiz.isXemUp=false;this.clearStatePlayer();thiz.allSlot.forEach(function(slot,index){if(slot)if(slot.uid===PlayerMe.uid)if(!thiz.isViewing&&thiz.gameState===GAME_STATE.PLAYING)slot.cardList.finishShapeCard()});this.dialogWithdrawMoney.show(false);
this.dialogRaiseMoney.show(false);this.dialogShapCardShow.show(false);if(TEST_MODE){if(!this.numTest)this.numTest=1;data={"ps":[],"fP":{"cs":[17,49,21],"uid":this.allSlot[0].uid,"pS":3,"rh":1,"dn":"dohimi123","mX":100,"rM":100071029,"m":4500,"iw":false,"cb":500},"pots":[],"cmd":702};for(var i=1;i<9;i++){var _player={"cs":[33,31,27],"uid":this.allSlot[i].uid,"u":"gts001","rh":11,"mX":975,"rM":100035955,"m":5475,"iw":true};if(i==5){_player["pS"]=state_lieng.UP_BAI;_player.mX=-1E3}else if(i==6)_player.mX=
-1E3;data.ps.push(_player)}this.numTest=1;for(var i=0;i<this.numTest;i++){var _pot={"uid":this.allSlot[4].uid,"dn":"zzzzzzzzzzzzzzz","id":i+1,"m":999.99};data.pots.push(_pot)}}cc.log("showResult "+Utils.encode(data));thiz.showResult(true,data)};
GameLieng.prototype.showResult=function(isShow,dataObj,timeRemain){if(!timeRemain)timeRemain=-1;var thiz=this;thiz.disablePendindAndReset=false;if(thiz.playerArr)thiz.playerArr.length=0;thiz.playerArr=dataObj.ps;if(thiz.pots)thiz.pots.length=0;thiz.pots=dataObj.pots;var timeDelay=0;if(isShow){thiz.playSoundAction("finished");thiz.allSlot.forEach(function(slot,index){if(slot)thiz.setStatePlayer(slot.uid,state_player.NOTHING)});if(dataObj.fP){if([2,4,5].indexOf(dataObj.fP.pS)!==-1){timeDelay=1;thiz.allSlot.forEach(function(slot,
index){if(slot&&slot.uid===dataObj.fP.uid){var addBet=thiz.getMoneyPlayer(dataObj.fP.uid)-dataObj.fP.m;if(addBet>0){if(timeRemain==-1||timeRemain>2)thiz.tossChip(slot.uid,addBet,false,true);slot.reduceMoney(-addBet)}if(slot.uid===PlayerMe.uid)thiz.currentBet=dataObj.fP.cb}})}thiz.playerArr.push(dataObj.fP)}else;for(var i=0;i<thiz.playerArr.length;i++)thiz.updateMoneyPlayer(thiz.playerArr[i]);if(timeRemain>-1&&timeRemain<2)timeDelay=0;var timeEnd=thiz.timeEndGame/1E3;if(timeRemain>=0&&timeEnd<timeRemain)timeEnd=
timeRemain;var cb=cc.callFunc(function(){thiz.animationResult()});this.runAction(this,cc.sequence(cc.delayTime(timeDelay),cb));var cbEnd=cc.callFunc(function(){thiz.endGame()});this.runAction(this,cc.sequence(cc.delayTime(timeEnd),cbEnd))}};
GameLieng.prototype.animationResult=function(){var thiz=this;var playerArr=thiz.playerArr;var pots=thiz.pots;this.gopChip(pots);thiz.allSlot.forEach(function(slot,index){if(slot){slot.stopTimeRemain();for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){var isUp=false;if(playerArr[i].pS)if(playerArr[i].pS===1){thiz.setStatePlayerLieng(slot.uid,playerArr[i].pS);isUp=true}if(playerArr[i].cs&&playerArr[i].cs.length){slot.cardList.changeCard(playerArr[i].cs);slot.cardList.flipAndShowAllCard(.2)}else isUp=
true;slot.showResultLieng(playerArr[i].m,playerArr[i].mX,playerArr[i].rh?playerArr[i].rh:-1,isUp);if(slot.uid===PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold=playerArr[i].rM;else PlayerMe.chip=playerArr[i].rM;break}}})};
GameLieng.prototype.endGame=function(preventWidthDraw){if(preventWidthDraw==undefined)preventWidthDraw=false;var thiz=this;if(thiz.isPlaying&&thiz.meSitDown)thiz.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);if(!preventWidthDraw&&thiz.meSitDown&&thiz.betValue>thiz.getMoneyPlayer(PlayerMe.uid)){var realMoney=0;if(this.aid==Constant.ASSET_ID.GOLD)realMoney=PlayerMe.gold;else realMoney=PlayerMe.chip;if(thiz.autoRutTien&&realMoney>=thiz.currentMoneyBuy)thiz.onWithdrawMoney(thiz.currentMoneyBuy,true,
true);else thiz.onSitdown(true)}thiz.gameState=0;thiz.meUpBai=false;if(thiz.meSitDown)thiz.isViewing=false;thiz.resetNewGame()};
GameLieng.prototype.initPlayer=function(){var center=cc.Global.GameView;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(center.width/2-playerMe.widthBG/2,center.height/2+160);var player1=new GamePlayer;player1.sitId=1;player1.position.set(center.width/2+290-player1.widthBG/2,center.height/2+160);var player2=new GamePlayer;player2.sitId=2;player2.position.set(center.width/2+480,center.height/2+20);var player3=new GamePlayer;player3.sitId=3;player3.position.set(center.width/2+480,
center.height/2-180);var player4=new GamePlayer;player4.sitId=4;player4.position.set(center.width/2+220-player4.widthBG/2,center.height/2-350);var player5=new GamePlayer;player5.sitId=5;player5.position.set(center.width/2-220-player5.widthBG/2,center.height/2-350);var player6=new GamePlayer;player6.sitId=6;player6.position.set(center.width/2-620,center.height/2-180);var player7=new GamePlayer;player7.sitId=7;player7.position.set(center.width/2-620,center.height/2+20);var player8=new GamePlayer;player8.sitId=
8;player8.position.set(center.width/2-290-player8.widthBG/2,center.height/2+160);this.playerView=[playerMe,player1,player2,player3,player4,player5,player6,player7,player8];for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;this.playerView[i].listener=this;MyPixi.gameContainer.addChild(this.playerView[i])}if(this.data.Mu==5){this.playerView[1].visible=false;this.playerView[3].visible=false;this.playerView[6].visible=false;this.playerView[8].visible=false}this.chipColumns=
[];var thiz=this;var defaultPos=cc.p(-50,65);var defaultPos2=cc.p(165,65);var leftPos=cc.p(-40,75);var rightPos=cc.p(175,75);var posArr=[cc.p(5+this.playerView[0].widthBG/2,-70),defaultPos,leftPos,leftPos,defaultPos,defaultPos2,rightPos,rightPos,defaultPos2];var dxChip=0;var dyChip=0;var isVertical=false;for(var i=0,max=this.playerView.length;i<max;i++){this.playerView[i].onSitdown=function(){thiz.onSitdown()};var sizeCards=cc.size(330,150);var align=LiengCardList.ALIGN_CENTER;if(i==2||i==3||i==6||
i==7){sizeCards=cc.size(75,150);isVertical=true;align=LiengCardList.ALIGN_LEFT}else if(i==1||i==4||i==5||i==8){sizeCards=cc.size(160,90);isVertical=false;if(i==1||i==4)align=LiengCardList.ALIGN_RIGHT}else isVertical=false;this.playerView[i].cardList=new LiengCardList(posArr[i],sizeCards,GameLieng.cardOriginScaleBackCard,isVertical,align);this.playerView[i].infoLayer.addChild(this.playerView[i].cardList);this.playerView[i].cardList.setListener(this.playerView[i]);this.playerView[i].cardList.setSitId(i);
this.playerView[i].cardList.onShowLatBai=function(visible){thiz.onShowLatBai(visible)};if(TEST_MODE)this.playerView[i].cardList.showBlurBg(true);if(i==0||i==1||i==4||i==5||i==8){dxChip=0;if(i==8)dxChip=0;if(i==0)dyChip=230;else if(i==1||i==8)dyChip=110;else dyChip=-140}else if(i==2||i==3){dxChip=-170;if(i==2)dyChip=30;else dyChip=0}else if(i==6||i==7){dxChip=170;if(i==7)dyChip=30;else dyChip=0}var alignLbl=ChipColumnList.LBL_RIGHT;if(i==1||i==2||i==3||i==4)alignLbl=ChipColumnList.LBL_LEFT;var chipColumnPlayer=
new ChipColumnList(cc.size(30,100),.3,alignLbl);chipColumnPlayer.position.set(this.playerView[i].x+this.playerView[i].widthBG/2+dxChip-chipColumnPlayer.widthContainer/2,-chipColumnPlayer.heightContainer/2+this.playerView[i].y+this.playerView[i].heightBG/2-dyChip-50);chipColumnPlayer.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPlayer);if(TEST_MODE)chipColumnPlayer.showBlurBg(true);this.chipColumns.push(chipColumnPlayer)}this.arrangePlayerInGame()};
GameLieng.prototype.onShowLatBai=function(isShow){this.turnButtons.onShowLatBai(isShow)};GameLieng.prototype.onListenerAutoRutTien=function(isCheck){this.autoRutTien=isCheck;cc.log("autoRutTien "+this.autoRutTien)};
GameLieng.prototype.onStandUp=function(){var thiz=this;if(thiz.isPlaying&&thiz.gameState===4||thiz.gameState===5){MessageNode.getInstance().show("V\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);this.dialogStandUpQuit.show(false);return}cc.log("onStandUp");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":707}];LobbyClient.getInstance().send(sendObj)};
GameLieng.prototype.onSitdown=function(isSitDown){if(isSitDown===undefined)isSitDown=false;var thiz=this;var money=0;if(this.aid==Constant.ASSET_ID.GOLD)money=PlayerMe.gold;else money=PlayerMe.chip;if(money<this.mMBI)MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 tham gia v\u00e1n ch\u01a1i",2);else{this.dialogWithdrawMoney.show(true);this.dialogWithdrawMoney.setData(money,this.mMBI,this.MMBI,this.betValue,isSitDown);this.dialogWithdrawMoney.showWithAnimationScale()}};
GameLieng.prototype.onWithdrawMoney=function(money,isSit,isAutoRutTiem){if(isAutoRutTiem===undefined)isAutoRutTiem=false;var thiz=this;if(thiz.meSitDown&&(thiz.gameState===4||thiz.gameState===5)&&!isAutoRutTiem){MessageNode.getInstance().show("Kh\u00f4ng \u0111\u01b0\u1ee3c r\u00fat ti\u1ec1n khi v\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);return}cc.log("send Mua ti\u1ec1n v\u00e0o b\u00e0n");this.currentMoneyBuy=money;var cmd=703;if(isSit)cmd=699;var sendObj=[command.RoomPluginMessage,
Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":cmd,"m":money}];LobbyClient.getInstance().send(sendObj)};GameLieng.prototype.onUpBai=function(){cc.log("send upbai 706");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":706}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};GameLieng.prototype.onUpTheo=function(){var thiz=this;thiz.isXemUp=this.xemUpBt.selected;cc.log("isXemUp "+thiz.isXemUp);if(thiz.isXemUp)thiz.isTheoTat=false;this.ideGameNumber=0};
GameLieng.prototype.onTheoTat=function(){var thiz=this;thiz.isTheoTat=thiz.theoTatBt.selected;cc.log("isTheoTat "+thiz.isTheoTat);if(thiz.isTheoTat)thiz.isXemUp=false;this.ideGameNumber=0};GameLieng.prototype.onTheo=function(){cc.log("onTheo");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":705}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameLieng.prototype.onXem=function(){if(!this.turnButtons.isXemShow()){this.onTheo();return}cc.log("onXem");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":710}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameLieng.prototype.onShowTo=function(){var min=0;var max=this.getMaxRaise();if(TEST_MODE)max=this.betValue*10.5;var thiz=this;if(!thiz.dialogRaiseMoney.visible){thiz.dialogRaiseMoney.showDialog(true,min,max,thiz.betValue);cc.log("show dilaog raise")}else{cc.log("hide dilaog raise and to");thiz.dialogRaiseMoney.show(false);thiz.onTo(thiz.dialogRaiseMoney.getMoneyRaise())}};
GameLieng.prototype.onTo=function(toValue){cc.log("onTo "+toValue);if(toValue>0){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":704,"b":toValue}];LobbyClient.getInstance().send(sendObj)}};GameLieng.prototype.onLatBai=function(){cc.log("onLatBai");this.dialogShapCardShow.showDialog(true,this.myCards,this.myCardState)};
GameLieng.prototype.onSendLatBai=function(cs,cardState){this.myCardState=cardState;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":LIENG_CMD.CMD_SHOW_CARD,"cs":cs}];if(TEST_MODE){var data=["aaaa",{"cs":cs,"uid":this.allSlot[4].uid,"cmd":709}];cc.log("onSendLatBai demo fix cs\x3d\x3d\x3e ");this.onShowCard(data)}else{cc.log("onSendLatBai cs\x3d\x3d\x3e "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}};
GameLieng.prototype.getMaxRaise=function(){var thiz=this;var length=thiz.data.ps.length;var raiseMax=0;var maxMoney=0;var myMoney=0;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===PlayerMe.uid)myMoney=el.m;if(maxMoney<el.m&&el.uid!==PlayerMe.uid&&el.pi===true&&el.pS!==1)maxMoney=el.m}var hs=thiz.maxBet-thiz.currentBet;if(myMoney<=maxMoney){raiseMax=myMoney;raiseMax-=hs}else if(myMoney>maxMoney)if(myMoney>=maxMoney+hs)raiseMax=maxMoney;else raiseMax=myMoney-hs;if(raiseMax<0)raiseMax=0;
return raiseMax};
GameLieng.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){cc.log("arrangeChauRiaOnly "+arrangeChauRiaOnly);if(TEST_MODE&&this.data.ps.length===1){var totalPlayer=9;cc.log("totalPlayer "+totalPlayer);for(var i=1;i<=totalPlayer;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+
i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}}this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);this.changeSitToInviteBg()};GameLieng.prototype.checkLeaveRoomIfCan=function(){var isIdeKick=false;if(this.registerQuit)this.quitRoom(isIdeKick);else if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;isIdeKick=true;this.quitRoom(isIdeKick)}};
GameLieng.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameLieng.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}var thiz=this;cc.log("click quit room lieng "+JSON.stringify(this.data.ps));cc.log("click quit room lieng "+this.checkMeIsPlaying());if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();
thiz.quitRoom(false)}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=null}return}else if(this.meSitDown){this.dialogStandUpQuit.show(true);this.dialogStandUpQuit.showWithAnimationScale();return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GameLieng.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[4];else if(totalPlayer===3)this.sitdownPlayerNext=[4,5];else if(totalPlayer===4)this.sitdownPlayerNext=[4,5,7];else if(totalPlayer===5)this.sitdownPlayerNext=[2,4,5,7];else if(totalPlayer===6)this.sitdownPlayerNext=[2,3,4,5,7];else if(totalPlayer===7)this.sitdownPlayerNext=[2,3,4,5,6,7];else if(totalPlayer===8)this.sitdownPlayerNext=[2,3,4,5,6,7,8];else if(totalPlayer>=9)this.sitdownPlayerNext=[1,2,3,
4,5,6,7,8];return this.sitdownPlayerNext};
GameLieng.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){GameScene.prototype.processPlayerPosition.call(this,players,gameState,arrangeChauRiaOnly);var listPlayer=[];var totalPlayer=0;listPlayer=players;totalPlayer=players.length;var meSitDown=false;var viewerSitedUid=[-1];this.sitIdMyPlayer=-1;var cloneArr=[];for(i=0;i<listPlayer.length;i++)if(PlayerMe.uid===listPlayer[i].uid){meSitDown=true;cloneArr.push(0);if(listPlayer[i].p)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);break}if(!listPlayer||
!listPlayer.length)for(var i=0;i<GameLieng.MAX_SLOT;i++){this.playerView[i].setEnable(false);this.playerView[i].reset()}for(var i=0;i<GameLieng.MAX_SLOT;i++)if(!this.playerView[i].uid||!this.playerView[i].uid.length)if(!meSitDown){this.playerView[i].showNgoiXuong(true);this.playerView[i].showInfoLayer(false)}};GameLieng.prototype.getAnchorIDwinPots=function(pot){return this.getSlotByUid(pot.uid).sitId};
GameLieng.prototype.getPotsEndGame=function(numPots){var listPots=[];switch(numPots){case 1:listPots=this.potOnTable.slice(4,4+1);break;case 2:listPots=this.potOnTable.slice(4,4+2);break;case 3:listPots=this.potOnTable.slice(3,3+3);break;case 4:listPots=this.potOnTable.slice(3,3+4);break;case 5:listPots=this.potOnTable.slice(2,2+5);break;case 6:listPots=this.potOnTable.slice(2,2+6);break;case 7:listPots=this.potOnTable.slice(1,1+7);break;case 8:listPots=this.potOnTable.slice(1,1+8);break;default:listPots=
this.potOnTable;break}return listPots};
GameLieng.prototype.gopChip=function(pots){var thiz=this;var idx;var totoalMoney=0;var totalNumChip=0;thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&chipList.length)totalNumChip+=chipList.length});for(idx in pots)totoalMoney+=pots[idx].m;for(idx in pots)pots[idx].chipNumb=Math.floor(pots[idx].m*totalNumChip/totoalMoney);var chipArr=[];thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&
chipList.length)chipArr=chipArr.concat(chipList);chipColumnPlayer.hideMucCuoc()});var start=0;var end=0;var listPotsUse=this.getPotsEndGame(pots.length);var chipByPots=[];for(var i=0;i<pots.length;i++){end=start+pots[i].chipNumb;if(i==pots.length-1)end=chipArr.length;var chips=chipArr.slice(start,end);chipByPots.push(chips);start=end}for(var i=0;i<pots.length;i++){var chipColumnPot=listPotsUse[i];thiz.groupPots(chipColumnPot,chipByPots[i],pots[i]);chipColumnPot.updateMyMoneyPot(pots[i].m);chipColumnPot.reOrder()}};
GameLieng.prototype.groupPots=function(chipColumnPot,chipArr,pot){var sitWin=this.getAnchorIDwinPots(pot);cc.log("sitWin "+sitWin);var slot=this.getSlotByUid(pot.uid);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var posWin=cc.convertToNodeSpace(chipColumnPot,slotPos);for(var k=0;k<chipArr.length;k++){var chipObj=chipArr[k];var pos=cc.convertToNodeSpace(chipColumnPot,cc.convertToWorldSpace(chipObj));chipObj.position.set(pos.x,pos.y);chipObj.addOriginWinPot(posWin);
chipColumnPot.addChip(chipObj,0)}};var state_xito=state_xito||{};state_xito.SHAPCARD=0;state_xito.UP_BAI=1;state_xito.THEO=2;state_xito.XEM=3;state_xito.TO=4;state_xito.XA_LANG=5;state_xito.DANG_CO_LUOT=6;var XITO_PLAYER_STATE={SHAPCARD:0,UP_BAI:1,THEO:2,XEM:3,TO:4,XA_LANG:5,DANG_CO_LUOT:6};
var XITO_CMD={CMD_WITHDRAW:699,CMD_WITHDRAW_FOR_SIT:806,CMD_AUTO_READY:204,CMD_CHIA_BAI:801,CMD_END_GAME:804,CMD_ON_COUNT_DOWN:800,CMD_CHOSE_CARD_SHOW:805,CMD_SHOW_CARD:802,CMD_CHANGE_TURN:803,CMD_STAND_UP:807,CMD_TO:808,CMD_THEO:809,CMD_UP_BAI:810,CMD_XEM_BAI:811};
function GameXiTo(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.roomID=LobbyClient.getInstance().getCurrentRoomId();this.registerQuit=false;this.totalPlayerPlaying=0;this.selectedCards=[];this.playerPlayed=[];this.data=data;this.type="GameXiTo";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.countDownNode=new CountDownNode;this.countDownNode.displayGroup=MyPixi.gameContainerLayer;this.countDownNode.y-=50;MyPixi.gameContainer.addChild(this.countDownNode);
this.countDownNode.visible=false;var texts=["N\u1eb7n b\u00e0i"];this.lblNarrativeResult=new Narrative(cc.size(180,52),texts);this.lblNarrativeResult.y-=130;this.lblNarrativeResult.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.lblNarrativeResult);this.lblNarrativeResult.visible=false;this.init();this.initDialog();this.initGame()}GameXiTo.prototype=Object.create(GameScene.prototype);GameXiTo.X_CHIA_BAI=550;GameXiTo.MAX_CARD_PLAYER=5;GameXiTo.cardOriginScaleBackCard=.7;
GameXiTo.MAX_SLOT=5;GameXiTo.prototype.init=function(){this.registerQuit=false;this.currentTurn=0;this.ideGameNumber=0;this.IDE_GAME_KICK=3};
GameXiTo.prototype.initDialog=function(){this.dialogs=[];this.dialogWithdrawMoney=new WithdrawMoneyDialog(this);this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney=new RaiseMoney(this);this.dialogRaiseMoney.show(false);this.dialogShapCardShow=new ChoseCardShow(this,cc.size(500,344));this.dialogShapCardShow.show(false);var thiz=this;this.dialogStandUpQuit=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogStandUpQuit.okButton,"\u0110\u1ee9ng l\u00ean",16);MyHelper.addLblButton(this.dialogStandUpQuit.cancelButton,
"R\u1eddi b\u00e0n",16);this.dialogStandUpQuit.setMessage("B\u1ea1n mu\u1ed1n \u0111\u1ee9ng l\u00ean hay tho\u00e1t b\u00e0n?");this.dialogStandUpQuit.okButtonHandler=function(){thiz.onStandUp()};this.dialogStandUpQuit.cancelButtonHandler=function(){thiz.quitRoom()};this.dialogStandUpQuit.hide=function(){if(thiz.dialogStandUpQuit.parent){thiz.dialogStandUpQuit.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogStandUpQuit.visible=false}));
thiz.dialogStandUpQuit.runAction(thiz.dialogStandUpQuit.bgHide,ac)}};this.dialogStandUpQuit.show(false)};GameXiTo.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.shapeTime=1E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initPlayer();this.initButton();this.initCardContainer();this.updateGame(this.data)};
GameXiTo.prototype.updateGame=function(data){cc.log("updateGame "+JSON.stringify(data));var thiz=this;this.betValue=data.b;this.currentBet=data.cb;this.timeEndGame=data.tfeg;this.maxPlayer=data.Mu;this.mMBI=data.mMBI;this.MMBI=data.MMBI;var gameState=data.gS;this.gameState=gameState;var remainTime=data.rmT;var players=data.ps;var listPlayer=data.ps;this.arrangePlayerInGame();this.players=data.ps;if(gameState==GAME_STATE.PLAYING||gameState===5)if(!data.re){var pots=data.pots;if(pots&&pots.length)thiz.initPotsData(pots);
var isShapCardTime=true;this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(p.pi)thiz.totalPlayerPlaying++;if(p.pS!==0)isShapCardTime=false}thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd",2);thiz.allSlot.forEach(function(slot,index){if(slot!=null)for(var i=0;i<players.length;i++){var p=players[i];if(slot.uid==p.uid){var cardArray=p.cs;var isRoomMaster=p.C;var playerState=p.pS;
var faceCard=p.fc;var pi=p.pi;var rr=p.rr;var currentBet=p.cb;if(pi){if(p.uid==PlayerMe.uid);else if(cardArray.length===0){cardArray.unshift(0);cardArray.unshift(0);slot.cardList.onAddCardArray(slot,cardArray,null,false)}else{var fc=0;cardArray.unshift(fc);slot.cardList.onAddCardArray(slot,cardArray,fc)}p.totalCard=cardArray.length;if(currentBet&&currentBet>0)thiz.tossChip(slot.uid,currentBet,true,false);if(playerState===XITO_PLAYER_STATE.SHAPCARD)thiz.onUpdateTurn(slot.uid,remainTime,isShapCardTime);
else if(playerState===XITO_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime);else if(playerState>0&&playerState<XITO_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerGameTo(slot.uid,playerState)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);continue}}})}listPlayer.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;this.onReconnect(data);if(this.isPlaying)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(false)}else this.currentBet=
this.betValue};
GameXiTo.prototype.onReconnect=function(data){cc.log("reconect data*** "+Utils.encode(data));var thiz=this;thiz.meSitDown=true;var listPlayer=data.ps;var gameState=data.gS;thiz.gameState=data.gS;var pots=data.pots;var mb=data.mb;var remainTime=data.rmT;var isReconnect=true;var isShapCardTime=true;var fi=data;for(var i=0;i<listPlayer.length;i++)if(listPlayer.pS!==0){isShapCardTime=false;break}if(pots&&pots.length)thiz.initPotsData(pots);thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<
listPlayer.length;i++){var p=listPlayer[i];if(slot.uid===p.uid){var cardArray=p.cs;var faceCard=p.fc;var currentBet=p.cb;var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;if(pi){thiz.totalPlayerPlaying++;if(slot.uid===PlayerMe.uid){p.totalCard=cardArray.length;thiz.currentBet=currentBet;if(playerState===XITO_PLAYER_STATE.DANG_CO_LUOT)thiz.turnButtons.showAll(true);else thiz.turnButtons.showAll(false);if(thiz.currentBet===mb)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false);
slot.cardList.onAddCardArray(slot,cardArray,faceCard);thiz.myCards=cardArray}else{if(cardArray.length===0){cardArray.unshift(0);cardArray.unshift(0);slot.cardList.onAddCardArray(slot,cardArray,null,false)}else{var faceCard=0;cardArray.unshift(faceCard);slot.cardList.onAddCardArray(slot,cardArray,faceCard)}p.totalCard=cardArray.length}if(currentBet&&currentBet>0)thiz.tossChip(slot.uid,currentBet,true,false);if(playerState===XITO_PLAYER_STATE.SHAPCARD&&isShapCardTime)thiz.onUpdateTurn(slot.uid,remainTime,
isShapCardTime);else if(playerState===XITO_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime);else if(playerState>0&&playerState<XITO_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerLieng(slot.uid,playerState)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);break}}});thiz.changeSitToInviteBg()};
GameXiTo.prototype.initCardContainer=function(){this.potOnTable=[];var y=cc.Global.GameView.height/2-125;var startX=cc.Global.GameView.width/2-300;for(var i=0;i<GameXiTo.MAX_SLOT;i++){var chipColumnPot=new ChipColumnList(cc.size(30,100),.3,ChipColumnList.LBL_BOT);chipColumnPot.position.set(startX+i*150,y);chipColumnPot.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPot);if(TEST_MODE)chipColumnPot.showBlurBg(true);this.potOnTable.push(chipColumnPot)}};
GameXiTo.prototype.changeSitToInviteBg=function(){var totalSit=9;for(var i=0;i<this.playerView.length;i++){var slot=this.playerView[i];if(!slot.uid||slot.uid===""){slot.changeToSmallBg(this.meSitDown);slot.showInfoLayer(false)}}};GameXiTo.prototype.hideAllBtnPlay=function(){for(var i=0;i<this.turnButtons.length;i++)this.turnButtons[i].visible=false};
GameXiTo.prototype.onUpdateTurn=function(uid,currentTime,isTimeShapCard){var timeTurn=this.timeTurn;if(isTimeShapCard)timeTurn=this.shapeTime;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,timeTurn);else if(!isTimeShapCard)this.allSlot[i].stopTimeRemain()};
GameXiTo.prototype.handlePendingBack=function(){this.isPlaying=false;this.isShowingResult=false;if(this.registerQuit){this.quitRoom();return false}this.resetNewGame();if(this.ideGameNumber>=this.IDE_GAME_KICK){this.ideGameNumber++;this.quitRoom(true);this.idleKick=true;return false}return true};
GameXiTo.prototype.resetNewGame=function(igNoreCheckReady){this.isPlaying=false;this.totalPlayerPlaying=0;this.isViewing=false;this.lblNarrativeResult.hideLine();this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;for(var i=0;i<this.chipColumns.length;i++)this.chipColumns[i].onReset();for(var i=0;i<this.potOnTable.length;i++)this.potOnTable[i].onReset();this.myCards=[];this.currentBet=this.betValue;this.maxBet=this.currentBet;this.meUpBai=false;this.showResultTotalTime=0;this.showResultBegin=
0;this.dataResult="";this.isShowingResult=false;this.isPlaying=false;this.currentTurn=0;cc.log("reset----------------------------");this.data.ps.forEach(function(player,index){player.pi=false});for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].resetEndGame();this.allSlot[i].cardList.removeAll()}this.clearStatePlayer();this.arrangePlayerInGame()};
GameXiTo.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT){this.onUserInOut(dataObj);if(dataObj[1].t===1){if(dataObj[1].p.uid===PlayerMe.uid){this.dialogWithdrawMoney.show(false);if(this.gameState===4||this.gameState===5)this.isViewing=true;else this.isViewing=false;this.meSitDown=true}}else if(dataObj[1].t===
2)if(dataObj[1].p.uid===PlayerMe.uid){this.meSitDown=false;this.dialogStandUpQuit.hide();if(this.playerView[0])this.playerView[0].showRutTienBtn(false);if(this.gameState===4||this.gameState===5)this.isViewing=true}if(dataObj[1].p.uid===PlayerMe.uid||this.meSitDown)this.changeSitToInviteBg();if(this.data.ps.length===1)this.countDownNode.hide()}else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===XITO_CMD.CMD_WITHDRAW)this.onWithDrawResponse(dataObj[1]);else if(cmd===XITO_CMD.CMD_AUTO_READY)this.onAutoReadyResponse(dataObj);else if(cmd==XITO_CMD.CMD_CHIA_BAI)this.chiabai(dataObj[1]);else if(cmd==XITO_CMD.CMD_END_GAME)this.onEndGame(dataObj[1]);else if(cmd==XITO_CMD.CMD_ON_COUNT_DOWN)this.onCountDownResponse(dataObj);else if(cmd==XITO_CMD.CMD_SHOW_CARD)this.onShowCard(dataObj);else if(cmd==XITO_CMD.CMD_CHANGE_TURN)this.onChangeTurn(dataObj);
else if(cmd==Constant.CMD_RESULT.PLAYER_READY){var uid=dataObj[1].uid;this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=true})}};GameXiTo.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};
GameXiTo.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=Constant.ERROR_STR[errorCode]?Constant.ERROR_STR[errorCode]:dataObj[1].mgs;if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";if(errorCode===1E3)errorStr="Kh\u00f4ng c\u00f2n ch\u1ed7 tr\u1ed1ng \u0111\u1ec3 ng\u1ed3i";if(errorCode!=600&&errorCode!=750&&errorCode!=1E3)return;MessageNode.getInstance().show(errorStr)};
GameXiTo.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GameXiTo.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameXiTo.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateRealMoneyPlayer(playerArr[i]);break}}};
GameXiTo.prototype.onWithDrawResponse=function(data){var thiz=this;this.updateMoneyPlayer(data);this.allSlot.forEach(function(slot,index){if(slot&&slot.uid===data.uid){slot.setTotalGoldWithEffect(data.m);if(data.uid===PlayerMe.uid)thiz.dialogWithdrawMoney.show(false)}})};
GameXiTo.prototype.onAutoReadyResponse=function(dataObj){cc.log("onAutoReadyResponse "+JSON.stringify(dataObj));cc.log("send ready");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameXiTo.prototype.onCountDownResponse=function(dataObj){cc.log("onCountDownResponse "+JSON.stringify(dataObj));this.checkLeaveRoomIfCan();var timeCountDown=dataObj[1].T/1E3;cc.log(timeCountDown+" timeCountDown");var thiz=this;cc.log("vao day nao");thiz.resetNewGame();thiz.arrangePlayerInGame();var cb=function(){thiz.requestStart();thiz.countDownNode.hide()};var callFun=cc.callFunc(cb);this.countDownNode.showWithTime(timeCountDown);this.runAction(this,cc.sequence(cc.delayTime(timeCountDown),callFun))};
GameXiTo.prototype.requestStart=function(){cc.log("aaaa send 800 to server");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":800}];LobbyClient.getInstance().send(sendObj)};
GameXiTo.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("onReadyResponse "+JSON.stringify(dataObj));cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING)};
GameXiTo.prototype.onShowCard=function(dataObj){if(TEST_MODE)dataObj=[5,{"ps":[{"cs":dataObj[1].cs,"uid":PlayerMe.uid,"dn":"benzamamu"}],"cmd":802}];cc.log("onShowCard "+JSON.stringify(dataObj));var thiz=this;var ps=dataObj[1].ps;var tP=dataObj[1].tP;if(tP){ps.push(tP);if(tP.uid===PlayerMe.uid){thiz.turnButtons.showAll(true);thiz.turnButtons.showAllAuto(false);thiz.turnButtons.showTextXem(true);this.dialogShapCardShow.show(false);this.dialogRaiseMoney.show(false)}else if(!thiz.isViewing){thiz.turnButtons.showAll(false);
thiz.turnButtons.showAllAuto(true)}}var myUid=PlayerMe.uid;thiz.allSlot.forEach(function(slot,index){if(slot){thiz.changeTurnPlayer(tP,slot);var actorUid=slot.uid;ps.forEach(function(player,index){var senderUid=player.uid;if(actorUid===senderUid){if(actorUid===myUid){thiz.dialogShapCardShow.show(false);thiz.meChoseCardShow=true;if(!hiepnh.isUndefined(player.cs)){var cardData=Utils.getCardFromServer(player.cs);slot.cardList.changeCardAndShow([player.cs],true)}}else if(!hiepnh.isUndefined(player.cs)){var cardData=
Utils.getCardFromServer(player.cs);slot.cardList.changeCardAndShow([player.cs],false)}slot.stopTimeRemain()}})}});if(tP)thiz.onUpdateTurn(tP.uid,this.timeTurn)};
GameXiTo.prototype.tossChip=function(uid,moneyToss,isReconnect,animation){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;var slot=this.getSlotByUid(uid);var typeChip=this.getIdCoinImg(moneyToss/this.betValue);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var pos=cc.convertToNodeSpace(this.chipColumns[slot.sitId],slotPos);this.chipColumns[slot.sitId].show(true);
var animTime=this.chipColumns[slot.sitId].addNewChip([typeChip],moneyToss,animation,pos,.5)};
GameXiTo.prototype.onChangeTurn=function(dataObj){cc.log("changeturn "+JSON.stringify(dataObj));if(TEST_MODE){pS=[];for(var i=0;i<5;i++)pS.push({"cs":[32,46,1,12,13],"uid":this.allSlot[i].uid,"dn":"fucker","m":18250,"cb":0});dataObj=[5,{"mb":2500,"fP":{"uid":PlayerMe.uid,"pS":4,"dn":"52haivip1","m":45726,"cb":2500},"cmd":803,"pots":[{"id":1,"m":2E3}],"ps":pS,"tP":{"uid":this.allSlot[1].uid,"dn":"fb_vanduong105"}}]}var thiz=this;thiz.lblNarrativeResult.hideLine();this.dialogRaiseMoney.show(false);
this.dialogShapCardShow.show(false);var mb=dataObj[1].mb;thiz.maxBet=mb;var pS=dataObj[1].ps;var pots=dataObj[1].pots;var tP=dataObj[1].tP;var isFirstTurnNewRound=false;if(tP&&pS)pS.push(tP);if(pS)thiz.players.forEach(function(p,i){for(var j=0;j<pS.length;j++)if(p.uid==pS[j]){p.pi=true;break}});else;var fromPlayer=dataObj[1].fP;if(fromPlayer)thiz.data.ps.forEach(function(p,i){if(p.uid==fromPlayer.uid)p.pS=fromPlayer.pS});if(pS)for(var j=0;j<pS.length;j++)if(PlayerMe.uid==pS[j].uid){thiz.currentBet=
pS[j].cb;cc.log(" newturn currentBet \x3d "+thiz.currentBet);break}thiz.turnButtons.showAll(false);var isTossChip=false;thiz.allSlot.forEach(function(slot,index){if(slot){thiz.changeTurnPlayer(tP,slot);if(pS)isFirstTurnNewRound=true;isTossChip=thiz.updateFromPlayer(fromPlayer,slot,isFirstTurnNewRound);thiz.handleAutoPlay(tP,slot,mb,isFirstTurnNewRound)}});if(pS){if(pots)this.gopChipNewRound(pots,isTossChip);this.chiabaiNewRound(pS)}this.allSlot.forEach(function(slot,index){if(slot)if(slot.getStatePlayer()!==
state_xito.UP_BAI&&slot.getStatePlayer()!==state_xito.XA_LANG)thiz.setStatePlayer(slot.uid,state_player.NOTHING)});if(pS)for(var j=0;j<pS.length;j++)if(PlayerMe.uid==pS[j].uid){this.updateMoneyPlayer(pS[j]);break}this.updateMoneyPlayer(fromPlayer);if(tP&&tP.uid===PlayerMe.uid)if(this.getMaxRaise()<=0)this.turnButtons.showTo(false)};
GameXiTo.prototype.handleAutoPlay=function(tP,slot,mb,isFirstTurnInRound){if(!tP||!slot)return;if(hiepnh.isUndefined(mb))mb=null;if(hiepnh.isUndefined(isFirstTurnInRound))isFirstTurnInRound=false;var thiz=this;if(slot.uid===PlayerMe.uid){this.dialogRaiseMoney.show(false);if(tP.uid===PlayerMe.uid)if(thiz.isXemUp||thiz.isTheoTat){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);if(thiz.isTheoTat)if(mb&&mb===thiz.currentBet)thiz.onXem();else thiz.onTheo();else if(thiz.isXemUp){cc.log("thiz.isXemUp mb \x3d "+
mb+" currentBet \x3d "+thiz.currentBet);if(mb===thiz.currentBet)thiz.onXem();else thiz.onUpBai()}}else{thiz.turnButtons.showAll(true);thiz.turnButtons.showAllAuto(false);if(mb===0||mb&&thiz.currentBet===mb||isFirstTurnInRound)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false);if(mb-thiz.currentBet>=thiz.getMoneyPlayer(PlayerMe.uid)||thiz.getMaxRaise()<=0)thiz.turnButtons.showTo(false)}else if(!thiz.isViewing){thiz.turnButtons.showAll(false);var slotMe=thiz.getSlotByUid(PlayerMe.uid);
if(slotMe&&slotMe.getStatePlayer()!==state_xito.UP_BAI)thiz.turnButtons.showAllAuto(true);else thiz.turnButtons.showAllAuto(false)}else{thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false)}}};
GameXiTo.prototype.updateFromPlayer=function(fromPlayer,slot,isFirstTurnNewRound){if(!fromPlayer||!slot)return false;var isTossChip=false;var thiz=this;if(fromPlayer&&slot.uid===fromPlayer.uid){thiz.setStatePlayerGameTo(slot.uid,fromPlayer.pS);if(fromPlayer.pS===2||fromPlayer.pS===4||fromPlayer.pS===5){var addBet=thiz.getMoneyPlayer(fromPlayer.uid)-fromPlayer.m;cc.log("fromPlayer.pS addBet"+addBet);if(addBet>0){cc.log("toss chip "+fromPlayer);thiz.tossChip(slot.uid,addBet,false,!isFirstTurnNewRound);
slot.reduceMoney(-addBet);isTossChip=true}}else if(fromPlayer.pS===1)if(fromPlayer.uid===PlayerMe.uid){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false)}if(slot.uid===PlayerMe.uid)thiz.currentBet=fromPlayer.cb}return isTossChip};GameXiTo.prototype.changeTurnPlayer=function(tP,slot){if(!tP||!slot)return;if(tP.uid===slot.uid)this.onUpdateTurn(slot.uid,this.timeTurn);else slot.stopTimeRemain()};
GameXiTo.prototype.chiabai=function(data){if(TEST_MODE){var player=[];for(var i=0;i<this.allSlot.length;i++)player.push(this.allSlot[i].uid);data={"cs":[34,24],"lpi":player,"cmd":801}}this.dialogWithdrawMoney.show(false);this.dialogStandUpQuit.visible=false;cc.log("chiabai "+JSON.stringify(data));var thiz=this;thiz.disablePendindAndReset=true;var playerArr=data.ps;if(playerArr)for(var idx in thiz.allSlot){var slot=thiz.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===
slot.uid){thiz.updateRealMoneyPlayer(playerArr[i]);break}}thiz.ideGameNumber++;thiz.resetNewGame();thiz.gameState=GAME_STATE.PLAYING;thiz.data.gS=GAME_STATE.PLAYING;var listPlayer=data.lpi;thiz.listPlayer=listPlayer;if(listPlayer.indexOf(PlayerMe.uid)!==-1)thiz.isViewing=false;else thiz.isViewing=true;if(!thiz.isViewing)thiz.isPlaying=true;thiz.playSoundAction("chiabai");var cardArray=data.cs;if(listPlayer.indexOf(PlayerMe.uid)!==-1)thiz.myCards=data.cs;thiz.data.ps.forEach(function(p,i){for(var j=
0;j<listPlayer.length;j++)if(p.uid==listPlayer[j]){p.pi=true;p.pS=0;p.m-=thiz.betValue;p.totalCard=2;thiz.updateMoneyPlayer(p);break}});thiz.totalPlayerPlaying=listPlayer.length;thiz.allSlot.forEach(function(slot,index){if(slot){if(thiz.isViewing)cardArray=[0,0];if(listPlayer.indexOf(slot.uid)>-1){thiz.onUpdateTurn(slot.uid,thiz.shapeTime,true);thiz.setStatePlayer(slot.uid,state_player.NOTHING);thiz.animChiaBaiToPlayer(cardArray,slot,true);if(slot.uid==PlayerMe.uid){slot.showRutTienBtn(false);thiz.onLatBai()}}else{thiz.setStatePlayer(slot.uid,
state_player.DANG_XEM);if(slot.uid==PlayerMe.uid)slot.showRutTienBtn(false)}}})};GameXiTo.prototype.getPlayer=function(uid){var thiz=this;var p=null;thiz.players.forEach(function(_player,index){if(_player)if(_player.uid===uid)p=_player});return p};
GameXiTo.prototype.chiabaiNewRound=function(pS){if(TEST_MODE){pS=[];for(var i=0;i<5;i++)pS.push({"cs":[32,46,1,12,13],"uid":this.allSlot[i].uid,"dn":"fucker","m":18250,"cb":0})}var isShowCardTime=true;var thiz=this;var isToss=false;thiz.allSlot.forEach(function(slot,index){if(slot)for(var i=0;i<pS.length;i++){var player=pS[i];var _player=thiz.getPlayer(player.uid);if(player.uid===slot.uid){if(_player.totalCard<player.cs.length+1){var newcard=player.cs.slice(player.cs.length-1);thiz.animChiaBaiToPlayer(newcard,
slot,true,false,isToss);_player.totalCard++}break}}})};
GameXiTo.prototype.animChiaBaiToPlayer=function(cardArray,slot,animation,isReconnect,isToss,isChiaBai){if(hiepnh.isUndefined(animation))animation=true;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(isToss))isToss=true;if(hiepnh.isUndefined(isChiaBai))isChiaBai=false;if(isToss){this.tossChip(slot.uid,this.betValue,isReconnect,animation);slot.reduceMoney(-this.betValue)}var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var isMe=
slot.uid==PlayerMe.uid;var showBackCard=isMe?false:true;var originScale=isMe?1:.7;slot.cardList.dealCards(cards,isMe,animation,showBackCard,originScale,false,isChiaBai)};
GameXiTo.prototype.initButton=function(){var thiz=this;var x=cc.Global.GameView.width/2;var y=cc.Global.GameView.height/2;var upBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onUpBai()});upBt.position.set(x+553,y+311);upBt.displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(upBt);MyHelper.addLblButton(upBt,"\u00dap",16);upBt.visible=false;var latBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onLatBai()});latBt.position.set(x+387,y+311);
MyPixi.gameContainer.addChild(latBt);latBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(latBt,"L\u1eadt",16);latBt.visible=false;var xemBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onXem()});xemBt.position.set(x+387,y+240);MyPixi.gameContainer.addChild(xemBt);xemBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(xemBt,"Xem",16);xemBt.visible=false;var toBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onShowTo()});toBt.position.set(x+
553,y+240);MyPixi.gameContainer.addChild(toBt);toBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(toBt,"T\u1ed1",16);toBt.visible=false;var xemUpBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");xemUpBt.setText("Xem \u00fap");xemUpBt.anchor.set(.5,.5);xemUpBt.position.set(x+367,y+311);MyPixi.gameContainer.addChild(xemUpBt);xemUpBt.displayGroup=MyPixi.gamePlayerLayer;xemUpBt.onSelect=function(selected){thiz.theoTatBt.unSelect();thiz.onUpTheo()};xemUpBt.onUnSelect=
function(selected){thiz.onUpTheo()};xemUpBt.visible=false;var theoTatBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");theoTatBt.setText("Theo t\u1ea5t");theoTatBt.anchor.set(.5,.5);theoTatBt.position.set(x+553,y+311);MyPixi.gameContainer.addChild(theoTatBt);theoTatBt.displayGroup=MyPixi.gamePlayerLayer;theoTatBt.onSelect=function(selected){thiz.xemUpBt.unSelect();thiz.onTheoTat()};theoTatBt.onUnSelect=function(selected){thiz.onTheoTat()};theoTatBt.visible=false;this.theoTatBt=
theoTatBt;this.xemUpBt=xemUpBt;var btnList=[upBt,xemBt,toBt];var btnListAuto=[xemUpBt,theoTatBt];this.turnButtons=new TurnButtonUI(btnList,btnListAuto);if(TEST_MODE){var tossChip=MyHelper.createButton("button/btn_0.png",true,function(){var rd=Math.floor(Math.random()*thiz.playerView.length);thiz.tossChip(thiz.getSlotByIndex(rd).uid,500,false,true)},true,cc.size(150,60),[60,20,60,20]);tossChip.position.set(50,cc.Global.GameView.height-150);tossChip.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(tossChip);
MyHelper.addLblButton(tossChip,"toss",16);var chiaBai=MyHelper.createButton("button/btn_0.png",true,function(){thiz.chiabai()},true,cc.size(150,60),[60,20,60,20]);chiaBai.position.set(50,cc.Global.GameView.height-80);chiaBai.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(chiaBai);MyHelper.addLblButton(chiaBai,"chiabai",16);var showTo=MyHelper.createButton("button/btn_0.png",true,function(){thiz.onChangeTurn()},true,cc.size(150,60),[60,20,60,20]);showTo.position.set(200,cc.Global.GameView.height-
80);showTo.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(showTo);MyHelper.addLblButton(showTo,"newRound",16);var endBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.onEndGame()},true,cc.size(150,60),[60,20,60,20]);endBt.position.set(200,cc.Global.GameView.height-150);endBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(endBt);MyHelper.addLblButton(endBt,"endBt",16);var recBt=MyHelper.createButton("button/btn_0.png",true,function(){LobbyClient.getInstance().reConnect()},
true,cc.size(150,60),[60,20,60,20]);recBt.position.set(50,cc.Global.GameView.height-150);recBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(recBt);MyHelper.addLblButton(recBt,"recBt",16)}};GameXiTo.prototype.updateRealMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.rM=data.m;break}}};
GameXiTo.prototype.updateMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.m=data.m;if(data.rM)el.rM=data.rM;break}}};GameXiTo.prototype.getMoneyPlayer=function(uid){var thiz=this;var length=thiz.data.ps.length;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===uid)return el.m}return-1};
GameXiTo.prototype.getIdCoinImg=function(ratio){var id=ChipType.WHITE;if(ratio>=20)id=ChipType.RED;else if(ratio>=10)id=ChipType.VIOLET;else if(ratio>=4)id=ChipType.BLUE;else if(ratio>=2)id=ChipType.GREEN;else if(ratio>=1)id=ChipType.WHITE;return id};GameXiTo.prototype.getPlayerIndexByUid=function(uid){for(var idx in this.allSlot)if(this.allSlot[idx]===uid)return idx;return-1};
GameXiTo.prototype.onEndGame=function(data){cc.log("onEndGame "+JSON.stringify(data));var thiz=this;thiz.lblNarrativeResult.hideLine();thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);thiz.turnButtons.checkAllAuto(false);thiz.isTheoTat=false;thiz.isXemUp=false;this.clearStatePlayer();this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney.show(false);this.dialogShapCardShow.show(false);if(TEST_MODE){if(!this.numTest)this.numTest=1;data={"ps":[],"fP":{"cs":[17,49,21],"uid":this.allSlot[0].uid,
"pS":3,"rh":1,"dn":"dohimi123","mX":0,"rM":100071029,"m":4500,"iw":false,"cb":500},"pots":[],"cmd":702};for(var i=1;i<9;i++){var _player={"cs":[33,31,27],"uid":this.allSlot[i].uid,"u":"gts001","rh":11,"mX":975,"rM":100035955,"m":5475,"iw":true};if(i==5){_player["pS"]=state_xito.UP_BAI;_player.mX=-1E3}else if(i==6)_player.mX=-1E3;data.ps.push(_player)}this.numTest=1;for(var i=0;i<this.numTest;i++){var _pot={"uid":this.allSlot[4].uid,"dn":"zzzzzzzzzzzzzzz","id":i+1,"m":999.99};data.pots.push(_pot)}}cc.log("showResult "+
Utils.encode(data));thiz.showResult(true,data)};
GameXiTo.prototype.showResult=function(isShow,dataObj,timeRemain){if(!timeRemain)timeRemain=-1;var thiz=this;thiz.disablePendindAndReset=false;if(thiz.playerArr)thiz.playerArr.length=0;thiz.playerArr=dataObj.ps;if(thiz.pots)thiz.pots.length=0;thiz.pots=dataObj.pots;var timeDelay=0;if(isShow){thiz.playSoundAction("finished");thiz.allSlot.forEach(function(slot,index){if(slot)thiz.setStatePlayer(slot.uid,state_player.NOTHING)});if(dataObj.fP){if([2,4,5].indexOf(dataObj.fP.pS)!==-1){timeDelay=1;thiz.allSlot.forEach(function(slot,
index){if(slot&&slot.uid===dataObj.fP.uid){var addBet=thiz.getMoneyPlayer(dataObj.fP.uid)-dataObj.fP.m;if(addBet>0){if(timeRemain==-1||timeRemain>2)thiz.tossChip(slot.uid,addBet,false,true);slot.reduceMoney(-addBet)}if(slot.uid===PlayerMe.uid)thiz.currentBet=dataObj.fP.cb}})}else if(dataObj.fP.pS===1)thiz.allSlot.forEach(function(slot,index){if(slot&&slot.uid===dataObj.fP.uid)thiz.setStatePlayerGameTo(slot.uid,dataObj.fP.pS)});thiz.playerArr.push(dataObj.fP)}else;for(var i=0;i<thiz.playerArr.length;i++){var player=
thiz.playerArr[i];thiz.updateMoneyPlayer(thiz.playerArr[i]);if(player.pS===1)thiz.allSlot.forEach(function(slot,index){if(slot&&slot.uid===player.uid)thiz.setStatePlayerGameTo(slot.uid,player.pS)})}if(timeRemain>-1&&timeRemain<2)timeDelay=0;var timeEnd=thiz.timeEndGame/1E3;if(timeRemain>=0&&timeEnd<timeRemain)timeEnd=timeRemain;var cb=cc.callFunc(function(){thiz.animationResult()});this.runAction(this,cc.sequence(cc.delayTime(timeDelay),cb));var cbEnd=cc.callFunc(function(){thiz.endGame()});this.runAction(this,
cc.sequence(cc.delayTime(timeEnd),cbEnd))}};
GameXiTo.prototype.animationResult=function(){var thiz=this;var playerArr=thiz.playerArr;var pots=thiz.pots;var isEndGame=true;var chipArr=[];thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&chipList.length)chipArr=chipArr.concat(chipList);chipColumnPlayer.hideMucCuoc()});if(!chipArr||!chipArr.length)thiz.potsToPlayerWin(pots);else thiz.gopChipNewRound(pots,false,isEndGame);thiz.allSlot.forEach(function(slot,index){if(slot){slot.stopTimeRemain();
for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){var isUp=false;if(playerArr[i].pS)if(playerArr[i].pS===1){thiz.setStatePlayerLieng(slot.uid,playerArr[i].pS);isUp=true}if(playerArr[i].cs&&playerArr[i].cs.length===5){slot.cardList.showCardEndGame(playerArr[i].cs,slot.isMe);slot.cardList.flipAndShowAllCard(.2)}else isUp=true;slot.showResultXiTo(playerArr[i].m,playerArr[i].mX,playerArr[i].rh?playerArr[i].rh:0,isUp,playerArr[i].iw);if(slot.uid===PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold=
playerArr[i].rM;else PlayerMe.chip=playerArr[i].rM;break}}})};
GameXiTo.prototype.endGame=function(preventWidthDraw){if(preventWidthDraw==undefined)preventWidthDraw=false;var thiz=this;if(thiz.isPlaying&&thiz.meSitDown)thiz.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);if(!preventWidthDraw&&thiz.meSitDown&&thiz.betValue>thiz.getMoneyPlayer(PlayerMe.uid)){var realMoney=0;if(this.aid==Constant.ASSET_ID.GOLD)realMoney=PlayerMe.gold;else realMoney=PlayerMe.chip;if(thiz.autoRutTien&&realMoney>=thiz.currentMoneyBuy)thiz.onWithdrawMoney(thiz.currentMoneyBuy,true,
true);else thiz.onSitdown(true)}thiz.gameState=0;thiz.meUpBai=false;if(thiz.meSitDown)thiz.isViewing=false;thiz.resetNewGame()};
GameXiTo.prototype.initPlayer=function(){var center=cc.Global.GameView;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(center.width/2-300-playerMe.widthBG/2,center.height/2+140);var player1=new GamePlayer;player1.sitId=1;player1.position.set(center.width/2+480,center.height/2);var player2=new GamePlayer;player2.sitId=2;player2.position.set(center.width/2+480,center.height/2-220);var player3=new GamePlayer;player3.sitId=3;player3.position.set(center.width/2-600,center.height/2-220);
var player4=new GamePlayer;player4.sitId=4;player4.position.set(center.width/2-600,center.height/2);this.playerView=[playerMe,player1,player2,player3,player4];for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;this.playerView[i].listener=this;MyPixi.gameContainer.addChild(this.playerView[i])}this.chipColumns=[];var thiz=this;var leftPos=cc.p(-170,63);var rightPos=cc.p(305,63);var posArr=[cc.p(this.playerView[0].widthBG+15+500/2,65),leftPos,leftPos,rightPos,
rightPos];var dxChip=0;var dyChip=0;var isVertical=false;for(var i=0,max=this.playerView.length;i<max;i++){this.playerView[i].onSitdown=function(){thiz.onSitdown()};var sizeCards=cc.size(500,150);var align=LiengCardList.ALIGN_LEFT;if(i==1||i==2){sizeCards=cc.size(330,100);align=LiengCardList.ALIGN_RIGHT}else if(i==3||i==4){sizeCards=cc.size(330,100);align=LiengCardList.ALIGN_LEFT}this.playerView[i].cardList=new XiToCardList(posArr[i],sizeCards,GameXiTo.cardOriginScaleBackCard,isVertical,align);this.playerView[i].infoLayer.addChild(this.playerView[i].cardList);
this.playerView[i].cardList.setListener(this.playerView[i]);this.playerView[i].cardList.setSitId(i);this.playerView[i].cardList.onShowLatBai=function(visible){thiz.onShowLatBai(visible)};if(TEST_MODE)this.playerView[i].cardList.showBlurBg(true);if(i==0){dxChip=150;dyChip=100}else if(i==1||i==2){dxChip=-170;if(i==1)dyChip=70;else dyChip=-80}else if(i==3||i==4){dxChip=170;if(i==4)dyChip=70;else dyChip=-80}var alignLbl=ChipColumnList.LBL_RIGHT;if(i==1||i==2)alignLbl=ChipColumnList.LBL_LEFT;var chipColumnPlayer=
new ChipColumnList(cc.size(30,100),.3,alignLbl);chipColumnPlayer.position.set(this.playerView[i].x+this.playerView[i].widthBG/2+dxChip-chipColumnPlayer.widthContainer/2,-chipColumnPlayer.heightContainer/2+this.playerView[i].y+this.playerView[i].heightBG/2-dyChip-50);chipColumnPlayer.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPlayer);if(TEST_MODE)chipColumnPlayer.showBlurBg(true);this.chipColumns.push(chipColumnPlayer)}this.arrangePlayerInGame()};
GameXiTo.prototype.onShowLatBai=function(isShow){this.turnButtons.onShowLatBai(isShow)};GameXiTo.prototype.onListenerAutoRutTien=function(isCheck){this.autoRutTien=isCheck;cc.log("autoRutTien "+this.autoRutTien)};
GameXiTo.prototype.onStandUp=function(){var thiz=this;if(thiz.isPlaying&&thiz.gameState===4||thiz.gameState===5){MessageNode.getInstance().show("V\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);this.dialogStandUpQuit.show(false);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":XITO_CMD.CMD_STAND_UP}];LobbyClient.getInstance().send(sendObj);cc.log("onStandUp "+JSON.stringify(sendObj))};
GameXiTo.prototype.onSitdown=function(isSitDown){if(isSitDown===undefined)isSitDown=false;var thiz=this;var money=0;if(this.aid==Constant.ASSET_ID.GOLD)money=PlayerMe.gold;else money=PlayerMe.chip;if(money<this.mMBI)MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 tham gia v\u00e1n ch\u01a1i",2);else{this.dialogWithdrawMoney.show(true);this.dialogWithdrawMoney.setData(money,this.mMBI,this.MMBI,this.betValue,isSitDown);this.dialogWithdrawMoney.showWithAnimationScale()}};
GameXiTo.prototype.onWithdrawMoney=function(money,isSit,isAutoRutTiem){if(isAutoRutTiem===undefined)isAutoRutTiem=false;var thiz=this;if(thiz.meSitDown&&(thiz.gameState===4||thiz.gameState===5)&&!isAutoRutTiem){MessageNode.getInstance().show("Kh\u00f4ng \u0111\u01b0\u1ee3c r\u00fat ti\u1ec1n khi v\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);return}cc.log("send Mua ti\u1ec1n v\u00e0o b\u00e0n");this.currentMoneyBuy=money;var cmd=XITO_CMD.CMD_WITHDRAW_FOR_SIT;if(isSit)cmd=XITO_CMD.CMD_WITHDRAW;
var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":cmd,"m":money}];LobbyClient.getInstance().send(sendObj)};GameXiTo.prototype.onUpBai=function(){cc.log("send upbai 810");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":XITO_CMD.CMD_UP_BAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXiTo.prototype.onUpTheo=function(){var thiz=this;thiz.isXemUp=this.xemUpBt.selected;cc.log("isXemUp "+thiz.isXemUp);if(thiz.isXemUp)thiz.isTheoTat=false;this.ideGameNumber=0};GameXiTo.prototype.onTheoTat=function(){var thiz=this;thiz.isTheoTat=thiz.theoTatBt.selected;cc.log("isTheoTat "+thiz.isTheoTat);if(thiz.isTheoTat)thiz.isXemUp=false;this.ideGameNumber=0};
GameXiTo.prototype.onTheo=function(){cc.log("onTheo");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":XITO_CMD.CMD_THEO}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};GameXiTo.prototype.onXem=function(){if(!this.turnButtons.isXemShow()){this.onTheo();return}cc.log("onXem");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":XITO_CMD.CMD_XEM_BAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameXiTo.prototype.onShowTo=function(){var min=0;var max=this.getMaxRaise();if(TEST_MODE)max=this.betValue*10.5;var thiz=this;if(!thiz.dialogRaiseMoney.visible)thiz.dialogRaiseMoney.showDialog(true,min,max,thiz.betValue);else{thiz.dialogRaiseMoney.show(false);thiz.onTo(thiz.dialogRaiseMoney.getMoneyRaise())}};
GameXiTo.prototype.onTo=function(toValue){cc.log("onTo "+toValue);if(toValue>0){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":XITO_CMD.CMD_TO,"b":toValue}];LobbyClient.getInstance().send(sendObj)}};GameXiTo.prototype.onLatBai=function(){cc.log("onLatBai");this.dialogShapCardShow.showDialog(true,this.myCards)};
GameXiTo.prototype.onSendLatBai=function(cs){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":XITO_CMD.CMD_CHOSE_CARD_SHOW,"cs":cs}];if(TEST_MODE){var data=["aaaa",{"cs":cs,"uid":PlayerMe.uid,"cmd":XITO_CMD.CMD_SHOW_CARD}];this.onShowCard(data)}else{cc.log("onSendLatBai cs\x3d\x3d\x3e "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}};
GameXiTo.prototype.getMaxRaise=function(){var thiz=this;var length=thiz.data.ps.length;var raiseMax=0;var maxMoney=0;var myMoney=0;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===PlayerMe.uid)myMoney=el.m;if(maxMoney<el.m&&el.uid!==PlayerMe.uid&&el.pi===true&&el.pS!==1)maxMoney=el.m}var hs=thiz.maxBet-thiz.currentBet;if(myMoney<=maxMoney){raiseMax=myMoney;raiseMax-=hs}else if(myMoney>maxMoney)if(myMoney>=maxMoney+hs)raiseMax=maxMoney;else raiseMax=myMoney-hs;if(raiseMax<0)raiseMax=0;
return raiseMax};
GameXiTo.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){cc.log("arrangeChauRiaOnly "+arrangeChauRiaOnly);if(TEST_MODE&&this.data.ps.length===1){var totalPlayer=5;cc.log("totalPlayer "+totalPlayer);for(var i=1;i<=totalPlayer;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+
i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}}this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);this.changeSitToInviteBg()};GameXiTo.prototype.checkLeaveRoomIfCan=function(){var isIdeKick=false;if(this.registerQuit)this.quitRoom(isIdeKick);else if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;isIdeKick=true;this.quitRoom(isIdeKick)}};
GameXiTo.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameXiTo.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}var thiz=this;cc.log("click quit room lieng "+JSON.stringify(this.data.ps));cc.log("click quit room lieng "+this.checkMeIsPlaying());if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();
thiz.quitRoom(false)}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=null}return}else if(this.meSitDown){this.dialogStandUpQuit.show(true);this.dialogStandUpQuit.showWithAnimationScale();return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GameXiTo.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[2];else if(totalPlayer===3)this.sitdownPlayerNext=[2,3];else if(totalPlayer===4)this.sitdownPlayerNext=[2,3,4];else if(totalPlayer>=5)this.sitdownPlayerNext=[1,2,3,4];return this.sitdownPlayerNext};
GameXiTo.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){GameScene.prototype.processPlayerPosition.call(this,players,gameState,arrangeChauRiaOnly);var listPlayer=[];var totalPlayer=0;listPlayer=players;totalPlayer=players.length;var meSitDown=false;var viewerSitedUid=[-1];this.sitIdMyPlayer=-1;var cloneArr=[];for(i=0;i<listPlayer.length;i++)if(PlayerMe.uid===listPlayer[i].uid){meSitDown=true;cloneArr.push(0);if(listPlayer[i].p)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);
break}if(!listPlayer||!listPlayer.length)for(var i=0;i<GameXiTo.MAX_SLOT;i++){this.playerView[i].setEnable(false);this.playerView[i].reset()}for(var i=0;i<GameXiTo.MAX_SLOT;i++)if(!this.playerView[i].uid||!this.playerView[i].uid.length)if(!meSitDown){this.playerView[i].showNgoiXuong(true);this.playerView[i].showInfoLayer(false)}};GameXiTo.prototype.getAnchorIDwinPots=function(pot){return this.getSlotByUid(pot.uid).sitId};
GameXiTo.prototype.getPotsEndGame=function(numPots){var listPots=[];switch(numPots){case 1:listPots=this.potOnTable.slice(2,2+1);break;case 2:listPots=this.potOnTable.slice(2,2+2);break;case 3:listPots=this.potOnTable.slice(1,1+3);break;case 4:listPots=this.potOnTable.slice(0,0+4);break;default:listPots=this.potOnTable;break}return listPots};
GameXiTo.prototype.gopChip=function(pots){var thiz=this;var idx;var totoalMoney=0;var totalNumChip=0;thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&chipList.length)totalNumChip+=chipList.length});for(idx in pots)totoalMoney+=pots[idx].m;for(idx in pots)pots[idx].chipNumb=Math.floor(pots[idx].m*totalNumChip/totoalMoney);var chipArr=[];thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&
chipList.length)chipArr=chipArr.concat(chipList);chipColumnPlayer.hideMucCuoc()});var start=0;var end=0;var listPotsUse=this.getPotsEndGame(pots.length);var chipByPots=[];for(var i=0;i<pots.length;i++){end=start+pots[i].chipNumb;if(i==pots.length-1)end=chipArr.length;var chips=chipArr.slice(start,end);cc.log("GameXiTo.gopChip \x3d\x3d\x3d\x3e slice "+start+" : "+end);chipByPots.push(chips);start=end}for(var i=0;i<pots.length;i++){var chipColumnPot=listPotsUse[i];thiz.groupPots(chipColumnPot,chipByPots[i],
pots[i]);chipColumnPot.updateMyMoneyPot(pots[i].m);chipColumnPot.reOrder()}if(pots[0].uid){var timeMoveLastPots=.5;var cbMovePots=cc.callFunc(function(){thiz.potsToPlayerWin(pots)});this.runAction(this,cc.sequence(cc.delayTime(timeMoveLastPots),cbMovePots))}for(var i=0;i<GameXiTo.MAX_SLOT;i++){this.chipColumns[i].chipList=[];this.chipColumns[i].onReset()}};
GameXiTo.prototype.gopChipNewRound=function(pots,isTossChipBefore,isEndGame){cc.log("gopChipNewRound "+JSON.stringify(pots));if(hiepnh.isUndefined(isEndGame))isEndGame=false;this.gopChip(pots)};
GameXiTo.prototype.groupPots=function(chipColumnPot,chipArr,pot){var moveToWinPlayer=true;if(hiepnh.isUndefined(pot.uid))moveToWinPlayer=false;var posWin=cc.p(0,0);if(moveToWinPlayer){var slot=this.getSlotByUid(pot.uid);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;posWin=cc.convertToNodeSpace(chipColumnPot,slotPos)}for(var k=0;k<chipArr.length;k++){var chipObj=chipArr[k];var pos=cc.convertToNodeSpace(chipColumnPot,cc.convertToWorldSpace(chipObj));chipObj.position.set(pos.x,
pos.y);chipObj.addOriginWinPot(null);chipColumnPot.addChip(chipObj,0)}};GameXiTo.prototype.potsToPlayerWin=function(pots){var listPotUse=this.getPotsEndGame(pots.length);for(var k=0;k<pots.length;k++){var pot=pots[k];var potColumn=listPotUse[k];this.potToPlayer(pot,potColumn)}};
GameXiTo.prototype.potToPlayer=function(pot,potColumn){var posWin=cc.p(0,0);var slot=this.getSlotByUid(pot.uid);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;posWin=cc.convertToNodeSpace(potColumn,slotPos);var chipList=potColumn.getChips();if(chipList&&chipList.length)for(var i=0;i<chipList.length;i++)chipList[i].addOriginWinPot(posWin);potColumn.updateMyMoneyPot(pot.m);potColumn.reOrder()};
GameXiTo.prototype.initPotsData=function(pots){var listPotsUse=this.getPotsEndGame(pots.length);var chipByPots=[];for(var i=0;i<pots.length;i++){var idPots=pots[i].id-1;var moneyPots=pots[i].m;var numChip=Math.floor(moneyPots/this.betValue);if(numChip>8)numChip=8;var chipIds=[];for(var j=0;j<numChip;j++)chipIds.push(1);listPotsUse[i].addNewChip(chipIds,0,false,cc.p(0,0));listPotsUse[i].updateMyMoneyPot(moneyPots)}};var state_poker=state_poker||{};state_poker.SHAPCARD=0;state_poker.UP_BAI=1;state_poker.THEO=2;state_poker.XEM=3;state_poker.TO=4;state_poker.XA_LANG=5;state_poker.DANG_CO_LUOT=6;var POKER_PLAYER_STATE={SHAPCARD:0,UP_BAI:1,THEO:2,XEM:3,TO:4,XA_LANG:5,DANG_CO_LUOT:6};
var POKER_CMD={CMD_WITHDRAW:699,CMD_WITHDRAW_FOR_SIT:755,CMD_AUTO_READY:204,CMD_CHIA_BAI:750,CMD_END_GAME:752,CMD_ON_COUNT_DOWN:754,CMD_CHOSE_CARD_SHOW:805,CMD_SHOW_CARD:802,CMD_CHANGE_TURN:751,CMD_STAND_UP:756,CMD_TO:757,CMD_THEO:758,CMD_UP_BAI:759,CMD_XEM_BAI:760,CMD_NEW_ROUND:753};
function GamePoker(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.roomID=LobbyClient.getInstance().getCurrentRoomId();this.registerQuit=false;this.totalPlayerPlaying=0;this.selectedCards=[];this.playerPlayed=[];this.data=data;this.type="GamePoker";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.countDownNode=new CountDownNode;this.countDownNode.displayGroup=MyPixi.gameContainerLayer;this.countDownNode.y-=50;MyPixi.gameContainer.addChild(this.countDownNode);
this.countDownNode.visible=false;var texts=["N\u1eb7n b\u00e0i"];this.lblNarrativeResult=new Narrative(cc.size(180,52),texts);this.lblNarrativeResult.y-=130;this.lblNarrativeResult.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.lblNarrativeResult);this.lblNarrativeResult.visible=false;this.init();this.initDialog();this.initGame();MyPixi.test=this}GamePoker.prototype=Object.create(GameScene.prototype);GamePoker.X_CHIA_BAI=550;GamePoker.MAX_CARD_PLAYER=5;
GamePoker.cardOriginScaleOnTable=1;GamePoker.MAX_SLOT=9;GamePoker.prototype.init=function(){this.registerQuit=false;this.currentTurn=0;this.ideGameNumber=0;this.IDE_GAME_KICK=3};
GamePoker.prototype.initDialog=function(){this.dialogs=[];this.dialogWithdrawMoney=new WithdrawMoneyDialog(this);this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney=new RaiseMoney(this);this.dialogRaiseMoney.show(false);this.dialogShapCardShow=new ChoseCardShow(this);this.dialogShapCardShow.show(false);var thiz=this;this.dialogStandUpQuit=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogStandUpQuit.okButton,"\u0110\u1ee9ng l\u00ean",16);MyHelper.addLblButton(this.dialogStandUpQuit.cancelButton,
"R\u1eddi b\u00e0n",16);this.dialogStandUpQuit.setMessage("B\u1ea1n mu\u1ed1n \u0111\u1ee9ng l\u00ean hay tho\u00e1t b\u00e0n?");this.dialogStandUpQuit.okButtonHandler=function(){thiz.onStandUp()};this.dialogStandUpQuit.cancelButtonHandler=function(){thiz.quitRoom()};this.dialogStandUpQuit.hide=function(){if(thiz.dialogStandUpQuit.parent){thiz.dialogStandUpQuit.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogStandUpQuit.visible=false}));
thiz.dialogStandUpQuit.runAction(thiz.dialogStandUpQuit.bgHide,ac)}};this.dialogStandUpQuit.show(false)};GamePoker.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.shapeTime=1E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initPlayer();this.initButton();this.initCardContainer();this.updateGame(this.data)};
GamePoker.prototype.updateGame=function(data){cc.log("updateGame "+JSON.stringify(data));var thiz=this;this.betValue=data.b;this.currentBet=data.cb;this.timeEndGame=data.tfeg;this.maxPlayer=data.Mu;this.mMBI=data.mMBI;this.MMBI=data.MMBI;var gameState=data.gS;this.gameState=gameState;var remainTime=data.rmT;var players=data.ps;var listPlayer=data.ps;this.arrangePlayerInGame();this.players=data.ps;if(gameState==GAME_STATE.PLAYING||gameState===5)if(!data.re){var pots=data.pots;if(pots&&pots.length)thiz.initPotsData(pots);
var dealerUid=data.D;var snallBlinderUid=data.sb;var bigBlinderUid=data.bb;var cardShow=data.cmc;this.chiabaiNewRound(cardShow);var isShapCardTime=true;this.setStatePlayer(PlayerMe.uid,state_player.DANG_XEM);thiz.isViewing=true;MessageNode.getInstance().show("B\u00e0n \u0111ang ch\u01a1i. Vui l\u00f2ng ch\u1edd",2);thiz.allSlot.forEach(function(slot,index){if(slot!=null){slot.showDealer(slot.uid===dealerUid);for(var i=0;i<players.length;i++){var p=players[i];if(slot.uid==p.uid){var cardArray=p.cs?
p.cs:[];var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;var rr=p.rr;var currentBet=p.cb;if(pi){if(p.uid==PlayerMe.uid);else if(!cardArray.length){cardArray.unshift(0);cardArray.unshift(0);slot.cardList.onAddCardArray(slot,cardArray,null,false)}else slot.cardList.onAddCardArray(slot,cardArray,fc);if(currentBet&&currentBet>0)thiz.tossChip(slot.uid,currentBet,true,false);if(playerState===POKER_PLAYER_STATE.SHAPCARD)thiz.onUpdateTurn(slot.uid,remainTime,isShapCardTime);else if(playerState===POKER_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,
remainTime);else if(playerState>0&&playerState<POKER_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerGameTo(slot.uid,playerState)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);continue}}}})}listPlayer.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re){this.isPlaying=true;this.onReconnect(data);if(this.isPlaying)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(false)}else this.currentBet=0};
GamePoker.prototype.onReconnect=function(data){cc.log("reconect data*** "+Utils.encode(data));var thiz=this;thiz.meSitDown=true;var listPlayer=data.ps;var gameState=data.gS;thiz.gameState=data.gS;var pots=data.pots;var mb=data.mb;var remainTime=data.rmT;var isReconnect=true;var isShapCardTime=true;var fi=data;var dealerUid=data.D;var snallBlinderUid=data.sb;var bigBlinderUid=data.bb;var cardShow=data.cmc;this.chiabaiNewRound(cardShow);for(var i=0;i<listPlayer.length;i++)if(listPlayer.pS!==0){isShapCardTime=
false;break}if(pots&&pots.length)thiz.initPotsData(pots);thiz.allSlot.forEach(function(slot,index){if(slot){slot.showDealer(slot.uid===dealerUid);for(var i=0;i<listPlayer.length;i++){var p=listPlayer[i];if(slot.uid===p.uid){var cardArray=p.cs?p.cs:[];var faceCard=p.fc;var currentBet=p.cb;var isRoomMaster=p.C;var playerState=p.pS;var pi=p.pi;if(pi){thiz.totalPlayerPlaying++;if(slot.uid===PlayerMe.uid){thiz.currentBet=currentBet;if(playerState===POKER_PLAYER_STATE.DANG_CO_LUOT)thiz.turnButtons.showAll(true);
else thiz.turnButtons.showAll(false);if(thiz.currentBet===mb)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false);slot.cardList.onAddCardArray(slot,cardArray,faceCard);thiz.myCards=cardArray}else{if(!cardArray.length){cardArray.unshift(0);cardArray.unshift(0);slot.cardList.onAddCardArray(slot,cardArray,null,false)}else slot.cardList.onAddCardArray(slot,cardArray,null,false);p.totalCard=cardArray.length}if(currentBet&&currentBet>0)thiz.tossChip(slot.uid,currentBet,true,false);
if(playerState===POKER_PLAYER_STATE.SHAPCARD&&isShapCardTime)thiz.onUpdateTurn(slot.uid,remainTime,isShapCardTime);else if(playerState===POKER_PLAYER_STATE.DANG_CO_LUOT)thiz.onUpdateTurn(slot.uid,remainTime);else if(playerState>0&&playerState<POKER_PLAYER_STATE.DANG_CO_LUOT)thiz.setStatePlayerLieng(slot.uid,playerState)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);break}}}});thiz.changeSitToInviteBg()};
GamePoker.prototype.initCardContainer=function(){this.potOnTable=[];var y=cc.Global.GameView.height/2-230;var startX=cc.Global.GameView.width/2-600;for(var i=0;i<GameLieng.MAX_SLOT;i++){var chipColumnPot=new ChipColumnList(cc.size(30,100),.3,ChipColumnList.LBL_BOT);chipColumnPot.position.set(startX+i*150,y);chipColumnPot.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPot);if(TEST_MODE)chipColumnPot.showBlurBg(true);this.potOnTable.push(chipColumnPot)}var list=[this.potOnTable[0],
this.potOnTable[1],this.potOnTable[7],this.potOnTable[8]];startX=cc.Global.GameView.width/2-225;for(var i=0;i<list.length;i++){list[i].position.set(startX+i*150,y+25);if(TEST_MODE)list[i].showBlurBg(true)}var pos=cc.p(cc.Global.GameView.width/2+70,cc.Global.GameView.height/2+20);var cardOnTable=new PokerCardList(pos,cc.size(cc.Global.GameView.width/2,150));cardOnTable.cardAlign=LiengCardList.ALIGN_LEFT;cardOnTable.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(cardOnTable);cardOnTable.setDeckPoint(cc.p(cc.Global.GameView.width/
2,cc.Global.GameView.height/2-200));this.cardOnTable=cardOnTable};GamePoker.prototype.changeSitToInviteBg=function(){var totalSit=9;for(var i=0;i<this.playerView.length;i++){var slot=this.playerView[i];if(!slot.uid||slot.uid===""){slot.changeToSmallBg(this.meSitDown);slot.showInfoLayer(false)}}};GamePoker.prototype.hideAllBtnPlay=function(){for(var i=0;i<this.turnButtons.length;i++)this.turnButtons[i].visible=false};
GamePoker.prototype.onUpdateTurn=function(uid,currentTime,isTimeShapCard){var timeTurn=this.timeTurn;if(isTimeShapCard)timeTurn=this.shapeTime;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,timeTurn);else if(!isTimeShapCard)this.allSlot[i].stopTimeRemain()};
GamePoker.prototype.handlePendingBack=function(){this.isPlaying=false;this.isShowingResult=false;if(this.registerQuit){this.quitRoom();return false}this.resetNewGame();if(this.ideGameNumber>=this.IDE_GAME_KICK){this.ideGameNumber++;this.quitRoom(true);this.idleKick=true;return false}return true};
GamePoker.prototype.resetNewGame=function(igNoreCheckReady){this.isPlaying=false;this.totalPlayerPlaying=0;this.isViewing=false;this.lblNarrativeResult.hideLine();this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;for(var i=0;i<this.chipColumns.length;i++)this.chipColumns[i].onReset();for(var i=0;i<this.potOnTable.length;i++)this.potOnTable[i].onReset();this.cardOnTable.removeAll();this.myCards=[];this.currentBet=this.betValue;this.maxBet=this.currentBet;this.meUpBai=false;this.showResultTotalTime=
0;this.showResultBegin=0;this.dataResult="";this.isShowingResult=false;this.isPlaying=false;this.currentTurn=0;cc.log("reset----------------------------");this.data.ps.forEach(function(player,index){player.pi=false});for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].resetEndGame();this.allSlot[i].cardList.removeAll();this.allSlot[i].showDealer(false)}this.clearStatePlayer();this.arrangePlayerInGame()};
GamePoker.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT){this.onUserInOut(dataObj);if(dataObj[1].t===1){if(dataObj[1].p.uid===PlayerMe.uid){this.dialogWithdrawMoney.show(false);if(this.gameState===4||this.gameState===5)this.isViewing=true;else this.isViewing=false;this.meSitDown=true}}else if(dataObj[1].t===
2)if(dataObj[1].p.uid===PlayerMe.uid){this.meSitDown=false;this.dialogStandUpQuit.hide();if(this.playerView[0])this.playerView[0].showRutTienBtn(false);if(this.gameState===4||this.gameState===5)this.isViewing=true}if(dataObj[1].p.uid===PlayerMe.uid||this.meSitDown)this.changeSitToInviteBg();if(this.data.ps.length===1)this.countDownNode.hide()}else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===POKER_CMD.CMD_WITHDRAW)this.onWithDrawResponse(dataObj[1]);else if(cmd===POKER_CMD.CMD_AUTO_READY)this.onAutoReadyResponse(dataObj);else if(cmd==POKER_CMD.CMD_CHIA_BAI)this.chiabai(dataObj[1]);else if(cmd==POKER_CMD.CMD_END_GAME)this.onEndGame(dataObj[1]);else if(cmd==POKER_CMD.CMD_ON_COUNT_DOWN)this.onCountDownResponse(dataObj);else if(cmd==POKER_CMD.CMD_SHOW_CARD)this.onShowCard(dataObj);else if(cmd==POKER_CMD.CMD_CHANGE_TURN)this.onChangeTurn(dataObj);
else if(cmd===POKER_CMD.CMD_NEW_ROUND){cc.log("CMD_NEW_ROUND maxBet "+JSON.stringify(dataObj));this.currentBet=0;this.onChangeTurn(dataObj)}else if(cmd==Constant.CMD_RESULT.PLAYER_READY){var uid=dataObj[1].uid;this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=true})}};GamePoker.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};
GamePoker.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=Constant.ERROR_STR[errorCode]?Constant.ERROR_STR[errorCode]:dataObj[1].mgs;if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";if(errorCode===1E3)errorStr="Kh\u00f4ng c\u00f2n ch\u1ed7 tr\u1ed1ng \u0111\u1ec3 ng\u1ed3i";if(errorCode!=600&&errorCode!=750&&errorCode!=1E3)return;MessageNode.getInstance().show(errorStr)};
GamePoker.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GamePoker.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GamePoker.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateRealMoneyPlayer(playerArr[i]);break}}};
GamePoker.prototype.onWithDrawResponse=function(data){var thiz=this;this.updateMoneyPlayer(data);this.allSlot.forEach(function(slot,index){if(slot&&slot.uid===data.uid){slot.setTotalGoldWithEffect(data.m);if(data.uid===PlayerMe.uid)thiz.dialogWithdrawMoney.show(false)}})};
GamePoker.prototype.onAutoReadyResponse=function(dataObj){cc.log("onAutoReadyResponse "+JSON.stringify(dataObj));cc.log("send ready");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GamePoker.prototype.onCountDownResponse=function(dataObj){cc.log("onCountDownResponse "+JSON.stringify(dataObj));this.checkLeaveRoomIfCan();var timeCountDown=dataObj[1].T/1E3;cc.log(timeCountDown+" timeCountDown");var thiz=this;cc.log("vao day nao");thiz.resetNewGame();thiz.arrangePlayerInGame();var cb=function(){thiz.requestStart();thiz.countDownNode.hide()};var callFun=cc.callFunc(cb);this.countDownNode.showWithTime(timeCountDown);this.runAction(this,cc.sequence(cc.delayTime(timeCountDown),callFun))};
GamePoker.prototype.requestStart=function(){cc.log("aaaa send 800 to server");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":POKER_CMD.CMD_ON_COUNT_DOWN}];LobbyClient.getInstance().send(sendObj)};
GamePoker.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("onReadyResponse "+JSON.stringify(dataObj));cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING)};
GamePoker.prototype.onShowCard=function(dataObj){if(TEST_MODE)dataObj=[5,{"ps":[{"cs":dataObj[1].cs,"uid":PlayerMe.uid,"dn":"benzamamu"}],"cmd":802}];cc.log("onShowCard "+JSON.stringify(dataObj));var thiz=this;var ps=dataObj[1].ps;var tP=dataObj[1].tP;if(tP){ps.push(tP);if(tP.uid===PlayerMe.uid){thiz.turnButtons.showAll(true);thiz.turnButtons.showAllAuto(false);thiz.turnButtons.showTextXem(true);this.dialogShapCardShow.show(false);this.dialogRaiseMoney.show(false)}else if(!thiz.isViewing){thiz.turnButtons.showAll(false);
thiz.turnButtons.showAllAuto(true)}}var myUid=PlayerMe.uid;thiz.allSlot.forEach(function(slot,index){if(slot){thiz.changeTurnPlayer(tP,slot);var actorUid=slot.uid;ps.forEach(function(player,index){var senderUid=player.uid;if(actorUid===senderUid){if(actorUid===myUid){thiz.dialogShapCardShow.show(false);thiz.meChoseCardShow=true;if(!hiepnh.isUndefined(player.cs)){var cardData=Utils.getCardFromServer(player.cs);slot.cardList.changeCardAndShow([player.cs],true)}}else if(!hiepnh.isUndefined(player.cs)){var cardData=
Utils.getCardFromServer(player.cs);slot.cardList.changeCardAndShow([player.cs],false)}slot.stopTimeRemain()}})}});if(tP)thiz.onUpdateTurn(tP.uid,this.timeTurn)};
GamePoker.prototype.tossChip=function(uid,moneyToss,isReconnect,animation){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;var slot=this.getSlotByUid(uid);var typeChip=this.getIdCoinImg(moneyToss/this.betValue);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var pos=cc.convertToNodeSpace(this.chipColumns[slot.sitId],slotPos);this.chipColumns[slot.sitId].show(true);
var animTime=this.chipColumns[slot.sitId].addNewChip([typeChip],moneyToss,animation,pos,.5)};
GamePoker.prototype.onChangeTurn=function(dataObj){cc.log("changeturn "+JSON.stringify(dataObj));if(TEST_MODE){pS=[];for(var i=0;i<5;i++)pS.push({"cs":[32,46,1,12,13],"uid":this.allSlot[i].uid,"dn":"fucker","m":18250,"cb":0});dataObj=[5,{"mb":2500,"fP":{"uid":PlayerMe.uid,"pS":4,"dn":"52haivip1","m":45726,"cb":2500},"cmd":803,"pots":[{"id":1,"m":2E3}],"ps":pS,"tP":{"uid":this.allSlot[1].uid,"dn":"fb_vanduong105"}}]}var thiz=this;thiz.lblNarrativeResult.hideLine();this.dialogRaiseMoney.show(false);
var mb=dataObj[1].mb;thiz.maxBet=mb;var pS=dataObj[1].ps;var cardShow=dataObj[1].cmc;var pots=dataObj[1].pots;var tP=dataObj[1].tP;if(tP&&pS)pS.push(tP);if(pS)thiz.players.forEach(function(p,i){for(var j=0;j<pS.length;j++)if(p.uid==pS[j]){p.pi=true;break}});else;var fromPlayer=dataObj[1].fP;if(fromPlayer)thiz.data.ps.forEach(function(p,i){if(p.uid==fromPlayer.uid)p.pS=fromPlayer.pS;if(tP&&p.uid==tP.uid)p.pS=tP.pS});if(fromPlayer&&PlayerMe.uid==fromPlayer.uid)thiz.currentBet=fromPlayer.cb;thiz.turnButtons.showAll(false);
var isTossChip=false;var newTurn=cardShow?true:false;thiz.allSlot.forEach(function(slot,index){if(slot){thiz.changeTurnPlayer(tP,slot);if(fromPlayer.uid===slot.uid)isTossChip=thiz.updateFromPlayer(fromPlayer,slot,newTurn);thiz.handleAutoPlay(tP,slot,mb,false)}});if(cardShow){if(pots)this.gopChipNewRound(pots,isTossChip);this.chiabaiNewRound(cardShow);this.allSlot.forEach(function(slot,index){if(slot)if(slot.getStatePlayer()!==state_poker.UP_BAI&&slot.getStatePlayer()!==state_poker.XA_LANG)thiz.setStatePlayer(slot.uid,
state_player.NOTHING)})}this.allSlot.forEach(function(slot,index){if(tP&&slot.uid==tP.uid)if(slot.getStatePlayer()!==state_poker.UP_BAI&&slot.getStatePlayer()!==state_poker.XA_LANG)thiz.setStatePlayer(slot.uid,state_player.NOTHING)});this.updateMoneyPlayer(fromPlayer);if(tP&&tP.uid===PlayerMe.uid)if(this.getMaxRaise()<=0)this.turnButtons.showTo(false)};
GamePoker.prototype.handleAutoPlay=function(tP,slot,mb,isFirstTurnInRound){if(!tP||!slot)return;if(hiepnh.isUndefined(mb))mb=null;if(hiepnh.isUndefined(isFirstTurnInRound))isFirstTurnInRound=false;var thiz=this;if(slot.uid===PlayerMe.uid){this.dialogRaiseMoney.show(false);if(tP.uid===PlayerMe.uid)if(thiz.isXemUp||thiz.isTheoTat){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);if(thiz.isTheoTat)if(mb&&mb===thiz.currentBet)thiz.onXem();else thiz.onTheo();else if(thiz.isXemUp){cc.log("thiz.isXemUp mb \x3d "+
mb+" currentBet \x3d "+thiz.currentBet);if(mb===thiz.currentBet)thiz.onXem();else thiz.onUpBai()}}else{thiz.turnButtons.showAll(true);thiz.turnButtons.showAllAuto(false);if(mb===0||mb&&thiz.currentBet===mb||isFirstTurnInRound)thiz.turnButtons.showTextXem(true);else thiz.turnButtons.showTextXem(false);if(mb-thiz.currentBet>=thiz.getMoneyPlayer(PlayerMe.uid)||thiz.getMaxRaise()<=0)thiz.turnButtons.showTo(false)}else if(!thiz.isViewing){thiz.turnButtons.showAll(false);var slotMe=thiz.getSlotByUid(PlayerMe.uid);
if(slotMe&&slotMe.getStatePlayer()!==state_poker.UP_BAI)thiz.turnButtons.showAllAuto(true);else thiz.turnButtons.showAllAuto(false)}else{thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false)}}};
GamePoker.prototype.updateFromPlayer=function(fromPlayer,slot,isFirstTurnNewRound){if(!fromPlayer||!slot)return false;var isTossChip=false;var thiz=this;if(fromPlayer&&slot.uid===fromPlayer.uid){thiz.setStatePlayerGameTo(slot.uid,fromPlayer.pS);if(fromPlayer.pS===2||fromPlayer.pS===4||fromPlayer.pS===5){var addBet=thiz.getMoneyPlayer(fromPlayer.uid)-fromPlayer.m;cc.log("fromPlayer.pS addBet"+addBet);if(addBet>0){cc.log("toss chip "+fromPlayer);thiz.tossChip(slot.uid,addBet,false,!isFirstTurnNewRound);
slot.reduceMoney(-addBet);isTossChip=true}}else if(fromPlayer.pS===1)if(fromPlayer.uid===PlayerMe.uid){thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false)}if(slot.uid===PlayerMe.uid)thiz.currentBet=fromPlayer.cb}return isTossChip};GamePoker.prototype.changeTurnPlayer=function(tP,slot){if(!tP||!slot)return;if(tP.uid===slot.uid)this.onUpdateTurn(slot.uid,this.timeTurn);else slot.stopTimeRemain()};
GamePoker.prototype.chiabai=function(data){if(TEST_MODE){var player=[];for(var i=0;i<this.allSlot.length;i++)player.push(this.allSlot[i].uid);data={"cs":[30,18],"lpi":player,"sb":500,"bb":1E3,"tP":{"uid":this.allSlot[0].uid},"cmd":801}}this.dialogWithdrawMoney.show(false);this.dialogStandUpQuit.visible=false;cc.log("chiabai "+JSON.stringify(data));var thiz=this;thiz.disablePendindAndReset=true;var playerArr=data.ps;if(playerArr)for(var idx in thiz.allSlot){var slot=thiz.allSlot[idx];if(!slot)continue;
for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){thiz.updateRealMoneyPlayer(playerArr[i]);break}}thiz.ideGameNumber++;thiz.resetNewGame();thiz.gameState=GAME_STATE.PLAYING;thiz.data.gS=GAME_STATE.PLAYING;var dealerUid=data.D;var listPlayer=data.lpi;thiz.listPlayer=listPlayer;if(listPlayer.indexOf(PlayerMe.uid)!==-1)thiz.isViewing=false;else thiz.isViewing=true;if(!thiz.isViewing)thiz.isPlaying=true;thiz.playSoundAction("chiabai");var smallBlind=data.sb;var bigBlind=data.bb;thiz.maxBet=
bigBlind.cb;thiz.currentBet=0;var toPlayer=data.tP;var cardArray=data.cs;if(listPlayer.indexOf(PlayerMe.uid)!==-1)thiz.myCards=data.cs;if(thiz.isPlaying)if(PlayerMe.uid===smallBlind.uid)thiz.currentBet=smallBlind.cb;else if(PlayerMe.uid===bigBlind.uid)thiz.currentBet=bigBlind.cb;thiz.data.ps.forEach(function(p,i){for(var j=0;j<listPlayer.length;j++)if(p.uid==listPlayer[j]){p.pi=true;p.pS=0;p.totalCard=2;break}});thiz.updateMoneyPlayerBlinder(smallBlind,bigBlind);thiz.allSlot.forEach(function(slot,
index){if(slot){slot.showDealer(slot.uid===dealerUid);if(thiz.isViewing)cardArray=[0,0];if(listPlayer.indexOf(slot.uid)>-1){thiz.setStatePlayer(slot.uid,state_player.NOTHING);var isFirstTurnNewRound=false;thiz.handleAutoPlay(toPlayer,slot,thiz.maxBet,isFirstTurnNewRound);if(slot.uid===smallBlind.uid)thiz.tossChip(slot.uid,smallBlind.cb,false);else if(slot.uid===bigBlind.uid)thiz.tossChip(slot.uid,bigBlind.cb,false);thiz.animChiaBaiToPlayer(cardArray,slot,true,false,false);if(slot.uid==PlayerMe.uid){slot.showRutTienBtn(false);
slot.cardList.checkPokerRank([])}}else{thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);if(slot.uid==PlayerMe.uid)slot.showRutTienBtn(false)}}});thiz.onUpdateTurn(toPlayer.uid,thiz.timeTurn)};GamePoker.prototype.getPlayer=function(uid){var thiz=this;var p=null;thiz.players.forEach(function(_player,index){if(_player)if(_player.uid===uid)p=_player});return p};
GamePoker.prototype.chiabaiNewRound=function(cardShow){cc.log("chiabaiNewRound \x3d "+JSON.stringify(cardShow));if(cardShow.length){var oldLength=this.cardOnTable.getCards().length;var cards=[];for(var k=oldLength;k<cardShow.length;k++)cards.push(Utils.getCardFromServer(cardShow[k]));this.cardOnTable.dealCardsOnTable(cards,false,true,false,GamePoker.cardOriginScaleOnTable,false);if(!this.isViewing){var slot=this.getSlotByUid(PlayerMe.uid);if(slot)slot.cardList.checkPokerRank(this.cardOnTable.getCards())}}};
GamePoker.prototype.animChiaBaiToPlayer=function(cardArray,slot,animation,isReconnect,isToss,isChiaBai){if(hiepnh.isUndefined(animation))animation=true;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(isToss))isToss=true;if(hiepnh.isUndefined(isChiaBai))isChiaBai=false;if(isToss){this.tossChip(slot.uid,this.betValue,isReconnect,animation);slot.reduceMoney(-this.betValue)}var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var isMe=
slot.uid==PlayerMe.uid;var showBackCard=isMe?false:true;var originScale=isMe?.7:.7;slot.cardList.dealCards(cards,isMe,animation,showBackCard,originScale,false,isChiaBai)};
GamePoker.prototype.initButton=function(){var thiz=this;var x=cc.Global.GameView.width/2;var y=cc.Global.GameView.height/2;var upBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onUpBai()});upBt.position.set(x+387,y+311);upBt.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(upBt);MyHelper.addLblButton(upBt,"\u00dap",16);upBt.visible=false;var latBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onLatBai()});latBt.position.set(x+553,y+311);
MyPixi.gameContainer.addChild(latBt);latBt.displayGroup=MyPixi.animationLayer;MyHelper.addLblButton(latBt,"L\u1eadt",16);latBt.visible=false;var xemBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onXem()});xemBt.position.set(x+387,y+240);MyPixi.gameContainer.addChild(xemBt);xemBt.displayGroup=MyPixi.animationLayer;MyHelper.addLblButton(xemBt,"Xem",16);xemBt.visible=false;var toBt=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.onShowTo()});toBt.position.set(x+
553,y+240);MyPixi.gameContainer.addChild(toBt);toBt.displayGroup=MyPixi.animationLayer;MyHelper.addLblButton(toBt,"T\u1ed1",16);toBt.visible=false;var xemUpBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");xemUpBt.setText("Xem \u00fap");xemUpBt.anchor.set(.5,.5);xemUpBt.position.set(x+367,y+311);MyPixi.gameContainer.addChild(xemUpBt);xemUpBt.displayGroup=MyPixi.animationLayer;xemUpBt.onSelect=function(selected){thiz.theoTatBt.unSelect();thiz.onUpTheo()};xemUpBt.onUnSelect=function(selected){thiz.onUpTheo()};
xemUpBt.visible=false;var theoTatBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");theoTatBt.setText("Theo t\u1ea5t");theoTatBt.anchor.set(.5,.5);theoTatBt.position.set(x+553,y+311);MyPixi.gameContainer.addChild(theoTatBt);theoTatBt.displayGroup=MyPixi.animationLayer;theoTatBt.onSelect=function(selected){thiz.xemUpBt.unSelect();thiz.onTheoTat()};theoTatBt.onUnSelect=function(selected){thiz.onTheoTat()};theoTatBt.visible=false;this.theoTatBt=theoTatBt;this.xemUpBt=xemUpBt;var btnList=
[upBt,xemBt,toBt];var btnListAuto=[xemUpBt,theoTatBt];this.turnButtons=new TurnButtonUI(btnList,btnListAuto);if(TEST_MODE){var tossChip=MyHelper.createButton("button/btn_button2.png",true,function(){var rd=Math.floor(Math.random()*thiz.playerView.length);thiz.tossChip(thiz.getSlotByIndex(rd).uid,500,false,true)});tossChip.position.set(50,cc.Global.GameView.height-150);tossChip.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(tossChip);MyHelper.addLblButton(tossChip,"toss",16);
var chiaBai=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.chiabai()});chiaBai.position.set(50,cc.Global.GameView.height-80);chiaBai.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(chiaBai);MyHelper.addLblButton(chiaBai,"chiabai",16);var showTo=MyHelper.createButton("button/btn_button2.png",true,function(){thiz.chiabaiNewRound([45,15,40,5,46])});showTo.position.set(200,cc.Global.GameView.height-80);showTo.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(showTo);
MyHelper.addLblButton(showTo,"newRound",16);var endBt=MyHelper.createButton("button/btn_button2.png",true,function(){for(var i=0;i<thiz.allSlot.length;i++)thiz.allSlot[i].showResultPoker(1E3,-999999,0,false,true,[1,2],0);thiz.cardOnTable.showOrrangeEffect([45,15,40,46]);thiz.getSlotByUid(PlayerMe.uid).showResultPoker(1,100,0,false,true,[30,18],[45,15,40,46,30])});endBt.position.set(200,cc.Global.GameView.height-150);endBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(endBt);
MyHelper.addLblButton(endBt,"endBt",16);var recBt=MyHelper.createButton("button/btn_button2.png",true,function(){LobbyClient.getInstance().reConnect()});recBt.position.set(50,cc.Global.GameView.height-150);recBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(recBt);MyHelper.addLblButton(recBt,"recBt",16)}};
GamePoker.prototype.updateRealMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.rM=data.m;break}}};GamePoker.prototype.updateMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.m=data.m;if(data.rM)el.rM=data.rM;break}}};
GamePoker.prototype.getMoneyPlayer=function(uid){var thiz=this;var length=thiz.data.ps.length;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===uid)return el.m}return-1};GamePoker.prototype.getIdCoinImg=function(ratio){var id=ChipType.WHITE;if(ratio>=20)id=ChipType.RED;else if(ratio>=10)id=ChipType.VIOLET;else if(ratio>=4)id=ChipType.BLUE;else if(ratio>=2)id=ChipType.GREEN;else if(ratio>=1)id=ChipType.WHITE;return id};
GamePoker.prototype.getPlayerIndexByUid=function(uid){for(var idx in this.allSlot)if(this.allSlot[idx]===uid)return idx;return-1};
GamePoker.prototype.onEndGame=function(data){cc.log("onEndGame "+JSON.stringify(data));var thiz=this;thiz.lblNarrativeResult.hideLine();thiz.turnButtons.showAll(false);thiz.turnButtons.showAllAuto(false);thiz.turnButtons.checkAllAuto(false);thiz.isTheoTat=false;thiz.isXemUp=false;this.clearStatePlayer();this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney.show(false);this.dialogShapCardShow.show(false);thiz.showResult(true,data)};
GamePoker.prototype.showResult=function(isShow,dataObj,timeRemain){if(TEST_MODE)dataObj={"ps":[{"cs":[30,18],"uid":PlayerMe.uid,"rh":1,"ph":[45,15,40,37,46],"dn":"dohimi","mX":0,"rM":10039199,"m":4800,"iw":false}],"cmc":[45,15,40,5,46],"fP":{"cs":[8,37],"uid":this.allSlot[1].uid,"pS":3,"rh":2,"ph":[45,15,40,46,30],"dn":"todau11","mX":390,"rM":997712,"m":5190,"iw":true,"cb":0},"pots":[{"id":1,"m":400,"wns":[PlayerMe.uid]}],"cmd":752};cc.log("showResult "+JSON.stringify(dataObj));if(!timeRemain)timeRemain=
-1;var thiz=this;thiz.disablePendindAndReset=false;if(thiz.playerArr)thiz.playerArr.length=0;thiz.playerArr=dataObj.ps;if(thiz.pots)thiz.pots.length=0;thiz.pots=dataObj.pots;var timeDelay=0;var cardShow=dataObj.cmc;if(cardShow)thiz.chiabaiNewRound(cardShow);if(isShow){thiz.playSoundAction("finished");thiz.allSlot.forEach(function(slot,index){if(slot)thiz.setStatePlayer(slot.uid,state_player.NOTHING)});if(dataObj.fP){if([2,4,5].indexOf(dataObj.fP.pS)!==-1){timeDelay=1;thiz.allSlot.forEach(function(slot,
index){if(slot&&slot.uid===dataObj.fP.uid){var addBet=thiz.getMoneyPlayer(dataObj.fP.uid)-dataObj.fP.m;if(addBet>0){if(timeRemain==-1||timeRemain>2)thiz.tossChip(slot.uid,addBet,false,true);slot.reduceMoney(-addBet)}if(slot.uid===PlayerMe.uid)thiz.currentBet=dataObj.fP.cb}})}else if(dataObj.fP.pS===1)thiz.allSlot.forEach(function(slot,index){if(slot&&slot.uid===dataObj.fP.uid)thiz.setStatePlayerGameTo(slot.uid,dataObj.fP.pS)});thiz.playerArr.push(dataObj.fP)}else;for(var i=0;i<thiz.playerArr.length;i++){var player=
thiz.playerArr[i];thiz.updateMoneyPlayer(thiz.playerArr[i]);if(player.pS===1)thiz.allSlot.forEach(function(slot,index){if(slot&&slot.uid===player.uid)thiz.setStatePlayerGameTo(slot.uid,player.pS)})}if(timeRemain>-1&&timeRemain<2)timeDelay=0;var timeEnd=thiz.timeEndGame/1E3;if(timeRemain>=0&&timeEnd<timeRemain)timeEnd=timeRemain;var cb=cc.callFunc(function(){thiz.animationResult()});this.runAction(this,cc.sequence(cc.delayTime(timeDelay),cb));var cbEnd=cc.callFunc(function(){thiz.endGame()});this.runAction(this,
cc.sequence(cc.delayTime(timeEnd),cbEnd))}};
GamePoker.prototype.animationResult=function(){var thiz=this;var playerArr=thiz.playerArr;var pots=thiz.pots;var isEndGame=true;var chipArr=[];thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&chipList.length)chipArr=chipArr.concat(chipList);chipColumnPlayer.hideMucCuoc()});if(!chipArr||!chipArr.length)thiz.potsToPlayerWin(pots);else thiz.gopChipNewRound(pots,false,isEndGame);thiz.allSlot.forEach(function(slot,index){if(slot){slot.stopTimeRemain();
for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){var isUp=false;if(playerArr[i].pS)if(playerArr[i].pS===1){thiz.setStatePlayerLieng(slot.uid,playerArr[i].pS);isUp=true}if(playerArr[i].cs&&!isUp){slot.cardList.showCardEndGame(playerArr[i].cs,slot.isMe);slot.cardList.flipAndShowAllCard(.2)}if(playerArr[i].iw)if(playerArr[i].ph)thiz.cardOnTable.showOrrangeEffect(playerArr[i].ph);slot.showResultPoker(playerArr[i].m,playerArr[i].mX,playerArr[i].rh?playerArr[i].rh:0,isUp,playerArr[i].iw,
playerArr[i].cs?playerArr[i].cs:[],playerArr[i].ph?playerArr[i].ph:0);if(slot.uid===PlayerMe.uid)if(thiz.aid==Constant.ASSET_ID.GOLD)PlayerMe.gold=playerArr[i].rM;else PlayerMe.chip=playerArr[i].rM;break}}})};
GamePoker.prototype.endGame=function(preventWidthDraw){if(preventWidthDraw==undefined)preventWidthDraw=false;var thiz=this;if(thiz.isPlaying&&thiz.meSitDown)thiz.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);if(!preventWidthDraw&&thiz.meSitDown&&2*thiz.betValue>thiz.getMoneyPlayer(PlayerMe.uid)){var realMoney=0;if(this.aid==Constant.ASSET_ID.GOLD)realMoney=PlayerMe.gold;else realMoney=PlayerMe.chip;if(thiz.autoRutTien&&realMoney>=thiz.currentMoneyBuy)thiz.onWithdrawMoney(thiz.currentMoneyBuy,true,
true);else thiz.onSitdown(true)}thiz.gameState=0;thiz.meUpBai=false;if(thiz.meSitDown)thiz.isViewing=false;thiz.resetNewGame()};
GamePoker.prototype.initPlayer=function(){var center=cc.Global.GameView;var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(center.width/2-playerMe.widthBG/2,center.height/2+160);var player1=new GamePlayer;player1.sitId=1;player1.position.set(center.width/2+290-player1.widthBG/2,center.height/2+160);var player2=new GamePlayer;player2.sitId=2;player2.position.set(center.width/2+490,center.height/2+20);var player3=new GamePlayer;player3.sitId=3;player3.position.set(center.width/2+490,
center.height/2-180);var player4=new GamePlayer;player4.sitId=4;player4.position.set(center.width/2+220-player4.widthBG/2,center.height/2-350);var player5=new GamePlayer;player5.sitId=5;player5.position.set(center.width/2-220-player5.widthBG/2,center.height/2-350);var player6=new GamePlayer;player6.sitId=6;player6.position.set(center.width/2-620,center.height/2-180);var player7=new GamePlayer;player7.sitId=7;player7.position.set(center.width/2-620,center.height/2+20);var player8=new GamePlayer;player8.sitId=
8;player8.position.set(center.width/2-290-player8.widthBG/2,center.height/2+160);this.playerView=[playerMe,player1,player2,player3,player4,player5,player6,player7,player8];for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;this.playerView[i].listener=this;MyPixi.gameContainer.addChild(this.playerView[i])}if(this.data.Mu==5){this.playerView[1].visible=false;this.playerView[3].visible=false;this.playerView[6].visible=false;this.playerView[8].visible=false}this.chipColumns=
[];var thiz=this;var defaultPos=cc.p(-50,65);var defaultPos2=cc.p(165,65);var leftPos=cc.p(-60,65);var rightPos=cc.p(195,65);var posArr=[cc.p(60+this.playerView[0].widthBG,65),rightPos,leftPos,leftPos,rightPos,leftPos,rightPos,rightPos,leftPos];var dxChip=0;var dyChip=0;var isVertical=false;for(var i=0,max=this.playerView.length;i<max;i++){this.playerView[i].onSitdown=function(){thiz.onSitdown()};var sizeCards=cc.size(160,90);var align=LiengCardList.ALIGN_LEFT;if(i==2||i==3){sizeCards=cc.size(160,
90);align=LiengCardList.ALIGN_RIGHT}else if(i==6||i==7){sizeCards=cc.size(160,90);align=LiengCardList.ALIGN_LEFT}else if(i==1||i==4||i==5||i==8){sizeCards=cc.size(160,90);if(i==5||i==8)align=LiengCardList.ALIGN_RIGHT}else isVertical=false;this.playerView[i].cardList=new PokerCardList(posArr[i],sizeCards,GameLieng.cardOriginScaleBackCard,isVertical,align);this.playerView[i].infoLayer.addChild(this.playerView[i].cardList);this.playerView[i].cardList.setListener(this.playerView[i]);this.playerView[i].cardList.setSitId(i);
this.playerView[i].cardList.onShowLatBai=function(visible){thiz.onShowLatBai(visible)};if(TEST_MODE)this.playerView[i].cardList.showBlurBg(true);if(i==0||i==1||i==4||i==5||i==8){dxChip=0;if(i==8)dxChip=0;if(i==0)dyChip=100;else if(i==1||i==8)dyChip=110;else dyChip=-140}else if(i==2||i==3){dxChip=-210;if(i==2)dyChip=30;else dyChip=0}else if(i==6||i==7){dxChip=190;if(i==7)dyChip=30;else dyChip=0}var alignLbl=ChipColumnList.LBL_RIGHT;if(i==1||i==2||i==3||i==4)alignLbl=ChipColumnList.LBL_LEFT;var chipColumnPlayer=
new ChipColumnList(cc.size(30,100),.3,alignLbl);chipColumnPlayer.position.set(this.playerView[i].x+this.playerView[i].widthBG/2+dxChip-chipColumnPlayer.widthContainer/2,-chipColumnPlayer.heightContainer/2+this.playerView[i].y+this.playerView[i].heightBG/2-dyChip-50);chipColumnPlayer.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPlayer);if(TEST_MODE)chipColumnPlayer.showBlurBg(true);this.chipColumns.push(chipColumnPlayer)}this.arrangePlayerInGame()};
GamePoker.prototype.onShowLatBai=function(isShow){this.turnButtons.onShowLatBai(isShow)};GamePoker.prototype.onListenerAutoRutTien=function(isCheck){this.autoRutTien=isCheck;cc.log("autoRutTien "+this.autoRutTien)};
GamePoker.prototype.onStandUp=function(){var thiz=this;if(thiz.isPlaying&&thiz.gameState===4||thiz.gameState===5){MessageNode.getInstance().show("V\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);this.dialogStandUpQuit.show(false);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":POKER_CMD.CMD_STAND_UP}];LobbyClient.getInstance().send(sendObj);cc.log("onStandUp "+JSON.stringify(sendObj))};
GamePoker.prototype.onSitdown=function(isSitDown){if(isSitDown===undefined)isSitDown=false;var thiz=this;var money=0;if(this.aid==Constant.ASSET_ID.GOLD)money=PlayerMe.gold;else money=PlayerMe.chip;if(money<this.mMBI)MessageNode.getInstance().show("B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 tham gia v\u00e1n ch\u01a1i",2);else{this.dialogWithdrawMoney.show(true);this.dialogWithdrawMoney.setData(money,this.mMBI,this.MMBI,this.betValue,isSitDown);this.dialogWithdrawMoney.showWithAnimationScale()}};
GamePoker.prototype.onWithdrawMoney=function(money,isSit,isAutoRutTiem){if(isAutoRutTiem===undefined)isAutoRutTiem=false;var thiz=this;if(thiz.meSitDown&&(thiz.gameState===4||thiz.gameState===5)&&!isAutoRutTiem){MessageNode.getInstance().show("Kh\u00f4ng \u0111\u01b0\u1ee3c r\u00fat ti\u1ec1n khi v\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);return}cc.log("send Mua ti\u1ec1n v\u00e0o b\u00e0n");this.currentMoneyBuy=money;var cmd=POKER_CMD.CMD_WITHDRAW_FOR_SIT;if(isSit)cmd=POKER_CMD.CMD_WITHDRAW;
var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":cmd,"m":money}];LobbyClient.getInstance().send(sendObj)};GamePoker.prototype.onUpBai=function(){cc.log("send upbai 810");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":POKER_CMD.CMD_UP_BAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GamePoker.prototype.onUpTheo=function(){var thiz=this;thiz.isXemUp=this.xemUpBt.selected;cc.log("isXemUp "+thiz.isXemUp);if(thiz.isXemUp)thiz.isTheoTat=false;this.ideGameNumber=0};GamePoker.prototype.onTheoTat=function(){var thiz=this;thiz.isTheoTat=thiz.theoTatBt.selected;cc.log("isTheoTat "+thiz.isTheoTat);if(thiz.isTheoTat)thiz.isXemUp=false;this.ideGameNumber=0};
GamePoker.prototype.onTheo=function(){cc.log("onTheo");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":POKER_CMD.CMD_THEO}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GamePoker.prototype.onXem=function(){if(!this.turnButtons.isXemShow()){this.onTheo();return}cc.log("onXem");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":POKER_CMD.CMD_XEM_BAI}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GamePoker.prototype.onShowTo=function(){var min=0;var max=this.getMaxRaise();if(TEST_MODE)max=this.betValue*10.5;var thiz=this;if(!thiz.dialogRaiseMoney.visible)thiz.dialogRaiseMoney.showDialog(true,min,max,thiz.betValue);else{thiz.dialogRaiseMoney.show(false);thiz.onTo(thiz.dialogRaiseMoney.getMoneyRaise())}};
GamePoker.prototype.onTo=function(toValue){cc.log("onTo "+toValue);if(toValue>0){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":POKER_CMD.CMD_TO,"b":toValue}];LobbyClient.getInstance().send(sendObj)}};GamePoker.prototype.onLatBai=function(){cc.log("onLatBai");this.dialogShapCardShow.showDialog(true,this.myCards)};
GamePoker.prototype.onSendLatBai=function(cs){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":POKER_CMD.CMD_CHOSE_CARD_SHOW,"cs":cs}];if(TEST_MODE){var data=["aaaa",{"cs":cs,"uid":PlayerMe.uid,"cmd":POKER_CMD.CMD_SHOW_CARD}];this.onShowCard(data)}else{cc.log("onSendLatBai cs\x3d\x3d\x3e "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}};
GamePoker.prototype.getMaxRaise=function(){var thiz=this;var length=thiz.data.ps.length;var raiseMax=0;var maxMoney=0;var myMoney=0;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===PlayerMe.uid)myMoney=el.m;if(maxMoney<el.m&&el.uid!==PlayerMe.uid&&el.pi===true&&el.pS!==1)maxMoney=el.m}var hs=thiz.maxBet-thiz.currentBet;if(myMoney<=maxMoney){raiseMax=myMoney;raiseMax-=hs}else if(myMoney>maxMoney)if(myMoney>=maxMoney+hs)raiseMax=maxMoney;else raiseMax=myMoney-hs;if(raiseMax<0)raiseMax=0;
return raiseMax};
GamePoker.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){cc.log("arrangeChauRiaOnly "+arrangeChauRiaOnly);if(TEST_MODE&&this.data.ps.length===1){var totalPlayer=9;cc.log("totalPlayer "+totalPlayer);for(var i=1;i<=totalPlayer;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+
i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}}this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);this.changeSitToInviteBg()};GamePoker.prototype.checkLeaveRoomIfCan=function(){var isIdeKick=false;if(this.registerQuit)this.quitRoom(isIdeKick);else if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;isIdeKick=true;this.quitRoom(isIdeKick)}};
GamePoker.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GamePoker.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}var thiz=this;cc.log("click quit room lieng "+JSON.stringify(this.data.ps));cc.log("click quit room lieng "+this.checkMeIsPlaying());if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();
thiz.quitRoom(false)}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=null}return}else if(this.meSitDown){this.dialogStandUpQuit.show(true);this.dialogStandUpQuit.showWithAnimationScale();return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GamePoker.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[4];else if(totalPlayer===3)this.sitdownPlayerNext=[5,4];else if(totalPlayer===4)this.sitdownPlayerNext=[7,5,4];else if(totalPlayer===5)this.sitdownPlayerNext=[7,5,4,2];else if(totalPlayer===6)this.sitdownPlayerNext=[7,5,4,3,2];else if(totalPlayer===7)this.sitdownPlayerNext=[7,6,5,4,3,2];else if(totalPlayer===8)this.sitdownPlayerNext=[8,7,6,5,4,3,2];else if(totalPlayer>=9)this.sitdownPlayerNext=[8,7,6,
5,4,3,2,1];return this.sitdownPlayerNext};
GamePoker.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){GameScene.prototype.processPlayerPosition.call(this,players,gameState,arrangeChauRiaOnly);var listPlayer=[];var totalPlayer=0;listPlayer=players;totalPlayer=players.length;var meSitDown=false;var viewerSitedUid=[-1];this.sitIdMyPlayer=-1;var cloneArr=[];for(i=0;i<listPlayer.length;i++)if(PlayerMe.uid===listPlayer[i].uid){meSitDown=true;cloneArr.push(0);if(listPlayer[i].p)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);break}if(!listPlayer||
!listPlayer.length)for(var i=0;i<GamePoker.MAX_SLOT;i++){this.playerView[i].setEnable(false);this.playerView[i].reset()}for(var i=0;i<GamePoker.MAX_SLOT;i++)if(!this.playerView[i].uid||!this.playerView[i].uid.length)if(!meSitDown){this.playerView[i].showNgoiXuong(true);this.playerView[i].showInfoLayer(false)}};GamePoker.prototype.getListSlotwinPots=function(pot){var listSlotWin=[];this.allSlot.forEach(function(slot,index){if(slot)if(pot.wns.indexOf(slot.uid)>-1)listSlotWin.push(slot)});return listSlotWin};
GamePoker.prototype.getPotsEndGame=function(numPots){var listPots=[];switch(numPots){case 1:listPots=this.potOnTable.slice(4,4+1);break;case 2:listPots=this.potOnTable.slice(4,4+2);break;case 3:listPots=this.potOnTable.slice(3,3+3);break;case 4:listPots=this.potOnTable.slice(3,3+4);break;case 5:listPots=this.potOnTable.slice(2,2+5);break;case 6:listPots=this.potOnTable.slice(2,2+6);break;case 7:listPots=this.potOnTable.slice(1,1+7);break;case 8:listPots=this.potOnTable.slice(1,1+8);break;default:listPots=
this.potOnTable;break}return listPots};
GamePoker.prototype.gopChip=function(pots){var thiz=this;var idx;var totoalMoney=0;var totalNumChip=0;thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&chipList.length)totalNumChip+=chipList.length});for(idx in pots)totoalMoney+=pots[idx].m;for(idx in pots)pots[idx].chipNumb=Math.floor(pots[idx].m*totalNumChip/totoalMoney);var chipArr=[];thiz.chipColumns.forEach(function(chipColumnPlayer,i){var chipList=chipColumnPlayer.getChips();if(chipList&&
chipList.length)chipArr=chipArr.concat(chipList);chipColumnPlayer.hideMucCuoc()});var start=0;var end=0;var listPotsUse=this.getPotsEndGame(pots.length);var chipByPots=[];for(var i=0;i<pots.length;i++){end=start+pots[i].chipNumb;if(i==pots.length-1)end=chipArr.length;var chips=chipArr.slice(start,end);chipByPots.push(chips);start=end}for(var i=0;i<pots.length;i++){var chipColumnPot=listPotsUse[i];thiz.groupPots(chipColumnPot,chipByPots[i],pots[i]);chipColumnPot.updateMyMoneyPot(pots[i].m);chipColumnPot.reOrder()}if(pots[0].wns){var timeMoveLastPots=
.5;var cbMovePots=cc.callFunc(function(){thiz.potsToPlayerWin(pots)});this.runAction(this,cc.sequence(cc.delayTime(timeMoveLastPots),cbMovePots))}for(var i=0;i<GamePoker.MAX_SLOT;i++){this.chipColumns[i].chipList=[];this.chipColumns[i].onReset()}};GamePoker.prototype.gopChipNewRound=function(pots,isTossChipBefore,isEndGame){cc.log("gopChipNewRound "+JSON.stringify(pots));if(hiepnh.isUndefined(isEndGame))isEndGame=false;this.gopChip(pots)};
GamePoker.prototype.groupPots=function(chipColumnPot,chipArr,pot){var moveToWinPlayer=true;if(hiepnh.isUndefined(pot.uid))moveToWinPlayer=false;var posWin=cc.p(0,0);if(moveToWinPlayer){var slot=this.getSlotByUid(pot.uid);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;posWin=cc.convertToNodeSpace(chipColumnPot,slotPos)}for(var k=0;k<chipArr.length;k++){var chipObj=chipArr[k];var pos=cc.convertToNodeSpace(chipColumnPot,cc.convertToWorldSpace(chipObj));chipObj.position.set(pos.x,
pos.y);chipObj.addOriginWinPot(null);chipColumnPot.addChip(chipObj,0)}};GamePoker.prototype.potsToPlayerWin=function(pots){var listPotUse=this.getPotsEndGame(pots.length);for(var k=0;k<pots.length;k++){var pot=pots[k];var potColumn=listPotUse[k];this.potToPlayer(pot,potColumn)}};
GamePoker.prototype.potToPlayer=function(pot,potColumn){var slotList=this.getListSlotwinPots(pot);var posWinArr=[];for(var i=0;i<slotList.length;i++){var slot=slotList[i];var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var posWin=cc.convertToNodeSpace(potColumn,slotPos);posWinArr.push(posWin)}var index=0;var chipList=potColumn.getChips();if(chipList&&chipList.length)for(var i=0;i<chipList.length;i++){chipList[i].addOriginWinPot(posWinArr[index]);index++;if(index>=
posWinArr.length)index=0}potColumn.updateMyMoneyPot(pot.m);potColumn.reOrder()};GamePoker.prototype.initPotsData=function(pots){var listPotsUse=this.getPotsEndGame(pots.length);var chipByPots=[];for(var i=0;i<pots.length;i++){var idPots=pots[i].id-1;var moneyPots=pots[i].m;var numChip=Math.floor(moneyPots/this.betValue);if(numChip>8)numChip=8;var chipIds=[];for(var j=0;j<numChip;j++)chipIds.push(1);listPotsUse[i].addNewChip(chipIds,0,false,cc.p(0,0));listPotsUse[i].updateMyMoneyPot(moneyPots)}};
GamePoker.prototype.updateMoneyPlayerBlinder=function(smallBlind,bigBlind){var length=this.players.length;for(var j=0;j<length;j++){var el=this.players[j];if(el.uid===smallBlind.uid)el.m-=smallBlind.cb;else if(el.uid===bigBlind.uid)el.m-=bigBlind.cb}for(var i in this.allSlot){var slot=this.allSlot[i];if(slot.uid===smallBlind.uid)slot.reduceMoney(-smallBlind.cb);else if(slot.uid===bigBlind.uid)slot.reduceMoney(-bigBlind.cb)}};var state_bacay=state_bacay||{};state_bacay.SHAPCARD=0;state_bacay.UP_BAI=1;state_bacay.THEO=2;state_bacay.XEM=3;state_bacay.TO=4;state_bacay.XA_LANG=5;state_bacay.DANG_CO_LUOT=6;var BACAY_PLAYER_STATE={SHAPCARD:0,UP_BAI:1,THEO:2,XEM:3,TO:4,XA_LANG:5,DANG_CO_LUOT:6};
var BACAY_CMD={CMD_AUTO_READY:204,CMD_BEGIN_BETTING:650,CMD_CHIABAI:651,CMD_END_GAME:652,CMD_BETTING:653,CMD_SHOW_CARD:655,CMD_COUNTDOW_START:656,CMD_VAO_GA:660,CMD_BEGIN_DIDEM_KECUA:661,CMD_DANH_BIEN:657,CMD_ACCEPT_BIEN:658,CMD_KE_CUA:659,CMD_SELL_CHUONG:663,CMD_MUA_CHUONG:662,CMD_NGOI_XUONG:664,CMD_DUNG_LEN:665};
function BaCayTimeBar(){PIXI.Sprite.call(this,PIXI.Texture.fromFrame("dia.png"));this.anchor.set(.5,.5);this.position.x=cc.Global.GameView.width/2;this.position.y=cc.Global.GameView.height/2-50;this.timer=new MyProgressBar(0,"elip_loading.png");this.timer.position.set(-this.width/2+5,-this.height/2);this.addChild(this.timer)}BaCayTimeBar.prototype=Object.create(PIXI.Sprite.prototype);BaCayTimeBar.prototype.showTimeRemain=function(currentTime,maxTime){this.timer.showTimeRemain(currentTime,maxTime)};
BaCayTimeBar.prototype.stopTimeRemain=function(){this.timer.stopTimeRemain()};
function GameBaCay(data){GameScene.call(this,data);this.position.x=0;this.position.y=0;this.roomID=LobbyClient.getInstance().getCurrentRoomId();this.registerQuit=false;this.totalPlayerPlaying=0;this.selectedCards=[];this.playerPlayed=[];this.data=data;this.type="GameBaCay";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.countDownNode=new CountDownNode;this.countDownNode.displayGroup=MyPixi.animationLayer;this.countDownNode.y-=50;MyPixi.gameContainer.addChild(this.countDownNode);
this.countDownNode.visible=false;var texts=["N\u1eb7n b\u00e0i"];this.lblNarrativeResult=new Narrative(cc.size(180,52),texts);this.lblNarrativeResult.y-=50;this.lblNarrativeResult.displayGroup=MyPixi.animationLayer;MyPixi.gameContainer.addChild(this.lblNarrativeResult);this.lblNarrativeResult.visible=false;this.init();this.initDialog();this.initGame()}GameBaCay.prototype=Object.create(GameScene.prototype);GameBaCay.X_CHIA_BAI=550;GameBaCay.MAX_CARD_PLAYER=5;GameBaCay.cardOriginScaleOnTable=1;
GameBaCay.MAX_SLOT=9;GameBaCay.prototype.init=function(){this.registerQuit=false;this.currentTurn=0;this.ideGameNumber=0;this.IDE_GAME_KICK=3};
GameBaCay.prototype.initDialog=function(){MyPixi.test3Cay=this;var thiz=this;this.dialogs=[];this.dialogGetOrSellChuong=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogGetOrSellChuong.okButton,"Nh\u1eadn Ch\u01b0\u01a1ng",16);MyHelper.addLblButton(this.dialogGetOrSellChuong.cancelButton,"B\u00e1n Ch\u01b0\u01a1ng",16);this.dialogGetOrSellChuong.setMessage("B\u1ea1n \u0111\u01b0\u1ee3c l\u00e0m ch\u01b0\u01a1ng. B\u1ea1n c\u00f3 mu\u1ed1n b\u00e1n ch\u01b0\u01a1ng lu\u00f4n kh\u00f4ng?");this.dialogGetOrSellChuong.okButtonHandler=
function(){thiz.onNhanChuong();thiz.dialogGetOrSellChuong.hide()};this.dialogGetOrSellChuong.cancelButtonHandler=function(){thiz.onBanChuong();thiz.dialogGetOrSellChuong.hide()};this.dialogGetOrSellChuong.hide=function(){if(thiz.dialogGetOrSellChuong.parent){thiz.dialogGetOrSellChuong.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogGetOrSellChuong.visible=false}));thiz.dialogGetOrSellChuong.runAction(thiz.dialogGetOrSellChuong.bgHide,
ac)}};this.dialogGetOrSellChuong.show(false);this.dialogDiDem=new WithdrawMoneyDialog(this);this.dialogDiDem.okButtonHandler=function(){cc.log("dialogDiDem okburron")};this.dialogDiDem.show(false);this.dialogWithdrawMoney=new WithdrawMoneyDialog(this);this.dialogWithdrawMoney.show(false);this.dialogRaiseMoney=new RaiseMoney(this);this.dialogRaiseMoney.show(false);this.dialogShapCardShow=new ShapeCardShowBaCay(this);this.dialogShapCardShow.show(false);var thiz=this;this.dialogStandUpQuit=new MessageConfirmDialog;
MyHelper.addLblButton(this.dialogStandUpQuit.okButton,"\u0110\u1ee9ng l\u00ean",16);MyHelper.addLblButton(this.dialogStandUpQuit.cancelButton,"R\u1eddi b\u00e0n",16);this.dialogStandUpQuit.setMessage("B\u1ea1n mu\u1ed1n \u0111\u1ee9ng l\u00ean hay tho\u00e1t b\u00e0n?");this.dialogStandUpQuit.okButtonHandler=function(){thiz.onStandUp()};this.dialogStandUpQuit.cancelButtonHandler=function(){thiz.quitRoom()};this.dialogStandUpQuit.hide=function(){if(thiz.dialogStandUpQuit.parent){thiz.dialogStandUpQuit.stopAllActions();
var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogStandUpQuit.visible=false}));thiz.dialogStandUpQuit.runAction(thiz.dialogStandUpQuit.bgHide,ac)}};this.dialogStandUpQuit.show(false);this.dialogYesNo=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogYesNo.okButton,"\u0110\u1ed3ng \u00fd",16);MyHelper.addLblButton(this.dialogYesNo.cancelButton,"T\u1eeb ch\u1ed1i",16);this.dialogYesNo.setMessage("B\u1ea1n mu\u1ed1n \u0111\u1ee9ng l\u00ean hay tho\u00e1t b\u00e0n?");
this.dialogYesNo.okButtonHandler=function(){thiz.dialogYesNo.hide()};this.dialogYesNo.cancelButtonHandler=function(){thiz.dialogYesNo.hide()};this.dialogYesNo.hide=function(){if(thiz.dialogYesNo.parent){thiz.dialogYesNo.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogYesNo.visible=false}));thiz.dialogYesNo.runAction(thiz.dialogYesNo.bgHide,ac)}};this.dialogYesNo.show(false);this.dialogYesNoDanhBien=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogYesNoDanhBien.okButton,
"\u0110\u1ed3ng \u00fd",16);MyHelper.addLblButton(this.dialogYesNoDanhBien.cancelButton,"T\u1eeb ch\u1ed1i",16);this.dialogYesNoDanhBien.setMessage("abc m\u1eddi b\u00e0n \u0111\u00e1nh bi\u00ean 100?");this.dialogYesNoDanhBien.okButtonHandler=function(){thiz.onAcceptDiDem(thiz.dialogYesNoDanhBien.inviteId);thiz.dialogYesNoDanhBien.hide()};this.dialogYesNoDanhBien.cancelButtonHandler=function(){thiz.dialogYesNoDanhBien.hide()};this.dialogYesNoDanhBien.hide=function(){if(thiz.dialogYesNoDanhBien.parent){thiz.dialogYesNo.stopAllActions();
var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogYesNoDanhBien.visible=false}));thiz.dialogYesNoDanhBien.runAction(thiz.dialogYesNoDanhBien.bgHide,ac)}};this.dialogYesNoDanhBien.show(false);this.dialogBuyChuong=new MessageConfirmDialog;MyHelper.addLblButton(this.dialogBuyChuong.okButton,"\u0110\u1ed3ng \u00fd",16);MyHelper.addLblButton(this.dialogBuyChuong.cancelButton,"T\u1eeb ch\u1ed1i",16);this.dialogBuyChuong.setMessage("B\u1ea1n c\u00f3 mu\u1ed1n mua Ch\u01b0\u01a1ng ?");
this.dialogBuyChuong.okButtonHandler=function(){thiz.onMuaChuong();thiz.dialogBuyChuong.hide()};this.dialogBuyChuong.cancelButtonHandler=function(){thiz.dialogBuyChuong.hide()};this.dialogBuyChuong.hide=function(){if(thiz.dialogBuyChuong.parent){thiz.dialogBuyChuong.stopAllActions();var scaleAction=cc.scaleTo(.2,0);var ac=cc.sequence(scaleAction,cc.callFunc(function(){thiz.dialogBuyChuong.visible=false}));thiz.dialogBuyChuong.runAction(thiz.dialogBuyChuong.bgHide,ac)}};this.dialogBuyChuong.show(false)};
GameBaCay.prototype.initGame=function(){var data=this.data;this.timeTurn=2E4;this.shapeTime=1E4;this.tfeg=data.tfeg/1E3;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;this.initPlayer();this.initButton();this.initCardContainer();this.updateGame(this.data)};
GameBaCay.prototype.updateGame=function(data){cc.log("updateGame "+JSON.stringify(data));var thiz=this;this.betValue=data.b;this.currentBet=data.cb;this.timeEndGame=data.tfeg;this.maxPlayer=data.Mu;this.uidChuong=data.M?data.M:null;this.mMBI=data.mMBI;this.MMBI=data.MMBI;var gameState=data.gS;this.gameState=gameState;this.data.gS=this.gameState;var remainTime=data.rmT;var players=data.ps;var listPlayer=data.ps;this.players=data.ps;this.listPlayer=this.players;if(!data.re){this.isViewing=true;this.isPlaying=
false;if(gameState>=4&&gameState<=6)this.onShowNotice("B\u00e0n \u0111ang ch\u01a1i, vui l\u00f2ng ch\u1edd",2E3)}else{this.meSitDown=true;this.isViewing=false;this.isPlaying=true}this.arrangePlayerInGame();for(var i=0;i<this.players.length;i++){var p=this.players[i];if(p.pi)this.totalPlayerPlaying++}if(gameState===4)this.lblNarrativeResult.showText("\u0110\u1eb7t c\u01b0\u1ee3c");else if(gameState===6)this.lblNarrativeResult.showText("N\u1eb7n b\u00e0i");var isAnimChiaBai=false;if(this.allSlot)this.allSlot.forEach(function(slot,
index){if(slot){if(thiz.uidChuong&&slot.uid===thiz.uidChuong)slot.showChuong(true);for(var i=0;i<thiz.players.length;i++){var p=thiz.players[i];if(slot.uid==p.uid){var cardArray=p.cs;if(!cardArray&&gameState===6)cardArray=[8,8,8];var isRoomMaster=p.C;var playerState=p.pS;var pip=p.pip;var pi=p.pi;var bet=p.b;var ctbs=p.ctbs;var ko=data.ko;if(PlayerMe.uid===p.uid)if(gameState===5&&pip===0)thiz.btnVaoGa.visible=true;if(pi){if(pip)pip=Math.abs(pip);if(pip>0){slot.showGa(true);var typeChip=ChipType.BLUE;
thiz.chiponTable.show(true);var animTime=thiz.chiponTable.addNewChip([typeChip],pip,true,cc.p(0,0),.5)}if(ko&&ko.length){var totalMoneyBien=0;for(var j in ko)if(ko[j].acpt)totalMoneyBien+=ko[j].b;totalMoneyBien=Math.abs(totalMoneyBien);slot.addMoneyBien(totalMoneyBien)}if(bet)bet=Math.abs(bet);if(bet>0)thiz.tossChip(slot.uid,bet,false,false);if(ctbs&&ctbs.length){var totalMoneyKeCua=0;for(var k in ctbs)totalMoneyKeCua+=ctbs[k].b;totalMoneyKeCua=Math.abs(totalMoneyKeCua);thiz.tossChipKeCua(slot.uid,
totalMoneyKeCua,false,false)}if(cardArray)thiz.animChiaBaiToPlayer(cardArray,slot,false,false,false);if(gameState===5){var isDidem=gameState===5?true:false;thiz.startCountdownPbar(0,remainTime,isDidem)}else if(gameState===4&&thiz.uidChuong!==p.uid||gameState===6)if(p.cs&&gameState===6)slot.cardList.changeCard(p.cs);else slot.showTimeRemain(remainTime,thiz.shapeTime)}else{if(gameState>=4&&gameState<=6)thiz.setStatePlayer(slot.uid,state_player.DANG_XEM);if(gameState===5){var isDidem=gameState===5?true:
false;thiz.startCountdownPbar(0,remainTime,isDidem)}else if(gameState===4&&thiz.uidChuong!==p.uid||gameState===6)if(p.cs&&gameState===6)slot.cardList.changeCard(p.cs);else slot.showTimeRemain(remainTime,thiz.shapeTime)}continue}}}});listPlayer.forEach(function(value,index){if(value.C==true)thiz.idRoomMaster=index});if(data.re)this.isPlaying=true;else this.currentBet=this.betValue;if(data.pot>0)this.showDefaultGa(data.pot)};
GameBaCay.prototype.initCardContainer=function(){this.baCayTimeBar=new BaCayTimeBar;this.baCayTimeBar.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(this.baCayTimeBar);var thiz=this;var vaoGaBt=MyHelper.createButton("bacay/vaoga.png",true,function(){thiz.onVaoGa()},false);vaoGaBt.position.set(cc.Global.GameView.width/2,cc.Global.GameView.height/2+50);vaoGaBt.displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(vaoGaBt);vaoGaBt.visible=false;this.btnVaoGa=vaoGaBt};
GameBaCay.prototype.changeSitToInviteBg=function(){var totalSit=9;for(var i=0;i<this.playerView.length;i++){var slot=this.playerView[i];if(!slot.uid||slot.uid===""){slot.changeToSmallBg(this.meSitDown);slot.showInfoLayer(false)}}};GameBaCay.prototype.hideAllBtnPlay=function(){for(var i=0;i<this.turnButtons.length;i++)this.turnButtons[i].visible=false};
GameBaCay.prototype.onUpdateTurn=function(uid,currentTime,isTimeShapCard){var timeTurn=this.timeTurn;if(isTimeShapCard)timeTurn=this.shapeTime;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,timeTurn);else if(!isTimeShapCard)this.allSlot[i].stopTimeRemain()};
GameBaCay.prototype.handlePendingBack=function(){this.isPlaying=false;this.isShowingResult=false;if(this.registerQuit){this.quitRoom();return false}this.resetNewGame();if(this.ideGameNumber>=this.IDE_GAME_KICK){this.ideGameNumber++;this.quitRoom(true);this.idleKick=true;return false}return true};
GameBaCay.prototype.resetNewGame=function(igNoreCheckReady){this.isPlaying=false;this.totalPlayerPlaying=0;this.isViewing=false;this.lblNarrativeResult.hideLine();this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;for(var i=0;i<this.chipColumns.length;i++)this.chipColumns[i].onReset();if(this.isAnGa){this.chiponTable.onReset();this.isAnGa=false}this.myCards=[];this.currentBet=this.betValue;this.maxBet=this.currentBet;this.showResultTotalTime=0;this.showResultBegin=0;this.dataResult=
"";this.isShowingResult=false;this.isPlaying=false;this.currentTurn=0;cc.log("reset----------------------------");this.data.ps.forEach(function(player,index){player.pi=false});for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].resetEndGame();this.allSlot[i].cardList.removeAll();this.allSlot[i].showDealer(false)}this.clearStatePlayer();this.arrangePlayerInGame()};
GameBaCay.prototype._onRoomPluginMsg=function(command,dataObj){cc.log(command+" _onRoomPluginMsg in GameBaCay \x3d\x3e "+JSON.stringify(dataObj));var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT){this.onUserInOut(dataObj);if(dataObj[1].t===1){if(dataObj[1].p.uid===PlayerMe.uid){this.dialogWithdrawMoney.show(false);if(this.gameState===4||this.gameState===
5)this.isViewing=true;else this.isViewing=false;this.meSitDown=true}}else if(dataObj[1].t===2)if(dataObj[1].p.uid===PlayerMe.uid){this.meSitDown=false;this.dialogStandUpQuit.hide();if(this.gameState===4||this.gameState===5)this.isViewing=true}if(dataObj[1].p.uid===PlayerMe.uid||this.meSitDown)this.changeSitToInviteBg();if(this.data.ps.length===1)this.countDownNode.hide()}else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===BACAY_CMD.CMD_AUTO_READY)this.onAutoReadyResponse(dataObj);else if(cmd==BACAY_CMD.CMD_COUNTDOW_START)this.onCountDownResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY){var uid=dataObj[1].uid;this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=true})}else if(cmd===BACAY_CMD.CMD_BEGIN_BETTING)this.beginBetting(dataObj[1]);else if(cmd===BACAY_CMD.CMD_BETTING){cc.log("CMD_BETTING response  "+Utils.encode(dataObj[1]));
this.updateBetting(dataObj[1])}else if(cmd===BACAY_CMD.CMD_VAO_GA)this.updateVaoGa(dataObj[1]);else if(cmd===BACAY_CMD.CMD_BEGIN_DIDEM_KECUA)this.beginDiDemAndKeCua(dataObj[1]);else if(cmd===BACAY_CMD.CMD_DANH_BIEN)this.onDanhBienResponse(dataObj[1]);else if(cmd===BACAY_CMD.CMD_ACCEPT_BIEN)this.onAcceptDanhBienResponse(dataObj[1]);else if(cmd===BACAY_CMD.CMD_KE_CUA)this.onKeCuaResponse(dataObj[1]);else if(cmd==BACAY_CMD.CMD_CHIABAI)this.chiabai(dataObj[1]);else if(cmd===BACAY_CMD.CMD_SHOW_CARD)this.showCard(dataObj[1]);
else if(cmd==BACAY_CMD.CMD_END_GAME)this.showResult(true,dataObj[1]);else if(cmd===BACAY_CMD.CMD_MUA_CHUONG){cc.log("test CMD_MUA_CHUONG "+Utils.encode(dataObj[1]));var byr=dataObj[1].byr;var seller=dataObj[1].M;this.updateMoneyPlayer(byr);this.updateMoneyPlayer(seller);var slot=this.getSlotByUid(byr.uid);if(slot)slot.setTotalGoldWithEffect(byr.m);slot=this.setTotalGoldWithEffect(seller.uid);if(slot)actor.setTotalGoldWithEffect(seller.m);this.byrChuongUid=byr.uid;this.nrm=null;if(this.byrChuongUid){var actor=
this.getSlotByUid(this.byrChuongUid);if(actor){var player=this.getPlayer(this.byrChuongUid);if(player)this.onShowNotice(player.dn+" mua ch\u01b0\u01a1ng")}this.byrChuongUid=null}else if(this.nrm){var actor=this.getSlotByUid(this.nrm);if(actor){var player=this.getPlayer(this.nrm);if(player)this.onShowNotice(player.dn+" c\u01b0\u1edbp \u0111\u01b0\u1ee3c ch\u01b0\u01a1ng")}}this.uidChuong=byr.uid;this.updateChuong(this.uidChuong)}else if(cmd===BACAY_CMD.CMD_SELL_CHUONG){cc.log("test CMD_SELL_CHUONG "+
Utils.encode(dataObj[1]));var M=dataObj[1].M;var acpt=dataObj[1].acpt;if(acpt&&M!==PlayerMe.uid){var dn=this.getPlayer(M).dn;var mgs=dn+" mu\u1ed1n b\u00e1n ch\u01b0\u01a1ng cho b\u1ea1n v\u1edbi gi\u00e1 ti\u1ec1n b\u1eb1ng 1 l\u1ea7n c\u01b0\u1ee3c ?";this.dialogBuyChuong.setMessage(mgs);this.dialogBuyChuong.show(true);this.dialogBuyChuong.showWithAnimationScale()}if(!acpt){var dn=this.getPlayer(M).dn;if(M!==PlayerMe.uid)this.onShowNotice(dn+" c\u01b0\u1edbp \u0111\u01b0\u1ee3c ch\u01b0\u01a1ng");
else this.onShowNotice("B\u1ea1n c\u01b0\u1edbp \u0111\u01b0\u1ee3c ch\u01b0\u01a1ng")}this.uidChuong=M;this.updateChuong(this.uidChuong)}};GameBaCay.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.registerQuit=true};
GameBaCay.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;this.dialogDiDem.show(false);this.dialogYesNo.show(false);cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=Constant.ERROR_STR[errorCode]?Constant.ERROR_STR[errorCode]:dataObj[1].mgs;if(errorStr===undefined)errorStr="H\u00e0nh \u0111\u1ed9ng kh\u00f4ng h\u1ee3p l\u1ec7 (m\u00e3 l\u1ed7i \x3d "+errorCode+")";if(errorCode===1E3)errorStr="Kh\u00f4ng c\u00f2n ch\u1ed7 tr\u1ed1ng \u0111\u1ec3 ng\u1ed3i";
MessageNode.getInstance().show(errorStr)};GameBaCay.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GameBaCay.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";MessageNode.getInstance().show(message,1)}else this.showInviteDialog(listUser)};
GameBaCay.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateRealMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}};
GameBaCay.prototype.onWithDrawResponse=function(data){var thiz=this;this.updateMoneyPlayer(data);this.allSlot.forEach(function(slot,index){if(slot&&slot.uid===data.uid){slot.setTotalGoldWithEffect(data.m);if(data.uid===PlayerMe.uid)thiz.dialogWithdrawMoney.show(false)}})};
GameBaCay.prototype.onAutoReadyResponse=function(dataObj){cc.log("onAutoReadyResponse "+JSON.stringify(dataObj));cc.log("send ready");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};
GameBaCay.prototype.onCountDownResponse=function(dataObj){cc.log("onCountDownResponse "+JSON.stringify(dataObj));this.checkLeaveRoomIfCan();var timeCountDown=dataObj[1].T/1E3;cc.log(timeCountDown+" timeCountDown");var thiz=this;cc.log("vao day nao");thiz.resetNewGame();thiz.arrangePlayerInGame();var cb=function(){thiz.requestStart();thiz.countDownNode.hide()};var callFun=cc.callFunc(cb);this.countDownNode.showWithTime(timeCountDown);this.runAction(this,cc.sequence(cc.delayTime(timeCountDown),callFun))};
GameBaCay.prototype.requestStart=function(){cc.log("aaaa send 708 to server");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":BACAY_CMD.CMD_COUNTDOW_START}];LobbyClient.getInstance().send(sendObj)};
GameBaCay.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=true;cc.log("onReadyResponse "+JSON.stringify(dataObj));cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});if(isReady)this.setStatePlayer(uid,state_player.READY);else this.setStatePlayer(uid,state_player.NOTHING)};
GameBaCay.prototype.tossChip=function(uid,moneyToss,isReconnect,animation){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;var slot=this.getSlotByUid(uid);var typeChip=this.getIdCoinImg(moneyToss/this.betValue);var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var pos=cc.convertToNodeSpace(this.chipColumns[slot.sitId],slotPos);this.chipColumns[slot.sitId].show(true);
var animTime=this.chipColumns[slot.sitId].addNewChip([typeChip],0,animation,pos,.5);this.chipColumns[slot.sitId].updateMyMoney(moneyToss)};
GameBaCay.prototype.tossChipKeCua=function(uid,moneyToss,isReconnect,animation,uidKe){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;if(hiepnh.isUndefined(uidKe))uidKe=uid;var slotKe=this.getSlotByUid(uidKe);var slot=this.getSlotByUid(uid);var typeChip=this.getIdCoinImg(moneyToss/this.betValue);var slotPos=slotKe.getGlobalPosition();slotPos.x+=slotKe.widthBG/2;slotPos.y+=slotKe.heightBG/2;var pos=
cc.convertToNodeSpace(this.chipColumns[slot.sitId],slotPos);this.chipColumns[slot.sitId].show(true);var animTime=this.chipColumns[slot.sitId].addNewChip([typeChip],moneyToss,animation,pos,.5)};
GameBaCay.prototype.tossChipChicken=function(uid,moneyToss,isReconnect,animation){if(hiepnh.isUndefined(moneyToss))moneyToss=100;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(animation))animation=true;var slot=this.getSlotByUid(uid);var typeChip=ChipType.BLUE;var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var pos=cc.convertToNodeSpace(this.chiponTable,slotPos);this.chiponTable.show(true);var animTime=this.chiponTable.addNewChip([typeChip],
moneyToss,animation,pos,.5)};GameBaCay.prototype.resetCountdown=function(){this.baCayTimeBar.stopTimeRemain()};
GameBaCay.prototype.chiabai=function(data){if(TEST_MODE)data={"cs":[11,3,22],"cmd":651};this.dialogWithdrawMoney.show(false);cc.log("chiabai "+JSON.stringify(data));var thiz=this;thiz.disablePendindAndReset=true;thiz.btnVaoGa.visible=false;thiz.resetCountdown();thiz.dialogDiDem.show(false);thiz.dialogYesNo.show(false);thiz.lblNarrativeResult.showText("N\u1eb7n b\u00e0i");thiz.playSoundAction("chiabai");var playerArr=data.ps;if(playerArr)for(var idx in thiz.allSlot){var slot=thiz.allSlot[idx];if(!slot)continue;
for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){thiz.updateRealMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}var cardArray=data.cs;if(cardArray)this.dialogShapCardShow.showDialog(true,cardArray);this.myCards=data.cs;var listUid=[];if(this.listPlayerUid&&this.listPlayerUid.length)listUid=this.listPlayerUid;else if(this.listPlayer&&this.listPlayer.length)for(var i in this.listPlayer)listUid.push(this.listPlayer[i].uid);var listPlayerUid=data.lpi?data.lpi:
listUid;cc.log("chiabai listPlayerUid \x3d\x3d\x3e "+Utils.encode(listPlayerUid));this.allSlot.forEach(function(slot,index){if(slot){slot.showDiDem(false);if(thiz.isViewing||!cardArray||!cardArray.length)cardArray=[0,0,0];if(listPlayerUid&&listPlayerUid.length&&listPlayerUid.indexOf(slot.uid)>-1){slot.showTimeRemain(thiz.shapeTime,thiz.shapeTime);cc.log(index+"chiabai to "+cardArray);thiz.animChiaBaiToPlayer(cardArray,slot,true,false,false)}else;}})};
GameBaCay.prototype.getPlayer=function(uid){var thiz=this;var p=null;thiz.players.forEach(function(_player,index){if(_player)if(_player.uid===uid)p=_player});return p};GameBaCay.prototype.showDefaultGa=function(money){this.chiponTable.show(true);var animation=true;this.chiponTable.addNewChip([ChipType.BLUE],money,animation,cc.p(0,0),.5);MyPixi.test=this};
GameBaCay.prototype.beginBetting=function(data){if(TEST_MODE){var pS=[];var mP=[];for(var i=0;i<9;i++){pS[i]=this.allSlot[i].uid;mP.push({"uid":this.allSlot[i].uid,"m":97520})}data={"ps":mP,"lpi":pS,"cmd":650,"M":this.allSlot[1].uid}}cc.log("beginbetting \x3d "+JSON.stringify(data));var thiz=this;this.disablePendingAndResetNewGame=true;this.dialogGetOrSellChuong.visible=false;this.dialogBuyChuong.visible=false;this.dialogStandUpQuit.visible=false;var playerArr=data.ps;if(playerArr)for(var idx in this.allSlot){var slot=
this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}if(this.ucm)if(this.ucm===PlayerMe.uid)this.onShowNotice("B\u1ea1n kh\u00f4ng \u0111\u1ee7 \u0111i\u1ec1u ki\u1ec7n l\u00e0m ch\u01b0\u01a1ng",2E3);this.ideGameNumber++;this.resetNewGame();this.lblNarrativeResult.showText("\u0110\u1eb7t c\u01b0\u1ee3c");var uidChuong=data.M;this.uidChuong=uidChuong;var idChuong=
this.getPlayerIndexByUid(uidChuong);var playerArr=data.ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);break}}this.gameState=GAME_STATE.PLAYING;this.data.gS=GAME_STATE.PLAYING;var listPlayer=data.lpi;this.listPlayerUid=listPlayer;this.totalPlayerPlaying=listPlayer.length;if(listPlayer.indexOf(PlayerMe.uid)!==-1)this.isViewing=
false;else this.isViewing=true;if(!this.isViewing)this.isPlaying=true;if(this.meSitDown&&PlayerMe.uid!==uidChuong)this.onShowTo();this.players.forEach(function(p,i){for(var j=0;j<listPlayer.length;j++)if(p.uid==listPlayer[j]){p.pi=true;p.pS=0;p.m-=this.betValue;thiz.updateMoneyPlayer(p);break}});this.allSlot.forEach(function(slot,index){if(slot){if(slot.uid===uidChuong)slot.showChuong(true);else slot.showChuong(false);thiz.setStatePlayer(slot.uid,state_player.NOTHING);if(listPlayer.indexOf(slot.uid)>
-1){if(slot.uid!==uidChuong)thiz.onUpdateTurn(slot.uid,thiz.timeTurn,true)}else thiz.setStatePlayer(slot.uid,state_player.DANG_XEM)}})};
GameBaCay.prototype.updateBetting=function(data){if(TEST_MODE){var rd=Math.floor(Math.random()*this.playerView.length);data={"uid":this.allSlot[rd].uid,"b":this.betValue,"dn":"fb_tamduong978","cmd":653,"m":49E3}}if(data.uid===PlayerMe.uid){this.dialogRaiseMoney.show(false);this.getSlotByUid(PlayerMe.uid).showDiDem(false)}var slot=this.getSlotByUid(data.uid);this.tossChip(data.uid,data.b,false,true);slot.reduceMoney(-data.b);this.updateMoneyPlayer(data);slot.stopTimeRemain()};
GameBaCay.prototype.updateVaoGa=function(data){if(TEST_MODE)data={"uid":PlayerMe.uid,"cmd":660};if(data.uid===PlayerMe.uid)this.btnVaoGa.visible=false;var tossMoney=this.betValue;var slot=this.getSlotByUid(data.uid);this.tossChipChicken(data.uid,tossMoney,false,true);slot.showGa(true);slot.reduceMoney(-tossMoney);var mydata=this.getPlayer(data.uid);mydata.m-=tossMoney};
GameBaCay.prototype.showCard=function(data){cc.log("onShowCard "+JSON.stringify(data));if(data.uid!==PlayerMe.uid){var slot=this.getSlotByUid(data.uid);slot.cardList.showCardEndGame(data.cs,false);slot.cardList.flipAndShowAllCard(.2);slot.stopTimeRemain()}};
GameBaCay.prototype.onDiDem=function(money,uidOponent){var oponentMoney=this.getMoneyPlayer(uidOponent);var myMoney=this.getMoneyPlayer(PlayerMe.uid);if(oponentMoney<20*this.betValue){var name=this.getPlayer(uidOponent).dn;this.onShowNotice(name+" kh\u00f4ng \u0111\u1ee7 20 l\u1ea7n m\u1ee9c c\u01b0\u1ee3c \u0111\u1ec3 \u0111\u00e1nh bi\u00ean",2E3);return}if(myMoney<20*this.betValue){this.onShowNotice(PlayerMe.displayName+" kh\u00f4ng \u0111\u1ee7 20 l\u1ea7n m\u1ee9c c\u01b0\u1ee3c \u0111\u1ec3 \u0111\u00e1nh bi\u00ean",
2E3);return}cc.log("send onDiDem");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_DANH_BIEN,"uid":uidOponent,"b":money}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0;this.dialogDiDem.showDialog(false);var name=this.getPlayer(uidOponent).dn;this.onShowNotice("B\u1ea1n g\u1eedi l\u1eddi m\u1eddi \u0111\u00e1nh bi\u00ean t\u1edbi "+name,2E3)};
GameBaCay.prototype.onKeCua=function(money,uidOponent){var isDiDem=false;var currBetOponent=this.chipColumns[this.getSlotByUid(uidOponent).sitId].moneyPot;var maxMoney=this.betValue*4;maxMoney-=currBetOponent;if(maxMoney<=0){this.onShowNotice("Kh\u00f4ng th\u1ec3 k\u00e9 c\u1eeda khi \u0111\u00e3 v\u01b0\u1ee3t qu\u00e1 4 l\u1ea7n m\u1ee9c c\u01b0\u1ee3c",2E3);return}cc.log("send onKeCua");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_KE_CUA,"uid":uidOponent,
"b":money}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};GameBaCay.prototype.onKeCuaResponse=function(data){var fromPlayerUid=data.fP;var toPlayerUid=data.tP;var bettingKeCua=data.b;this.dialogDiDem.show(false);var slot=this.getSlotByUid(toPlayerUid);var slotKe=this.getSlotByUid(fromPlayerUid);this.tossChipKeCua(toPlayerUid,bettingKeCua,false,true,fromPlayerUid);slotKe.reduceMoney(-bettingKeCua);var mydata=this.getPlayer(fromPlayerUid);mydata.m-=bettingKeCua};
GameBaCay.prototype.onDanhBienResponse=function(data){var inviteId=data.iid;var uidInvite=data.fP;var bettingDidem=data.b;var name=this.getPlayer(uidInvite).dn;this.dialogYesNoDanhBien.inviteId=inviteId;this.dialogYesNoDanhBien.setMessage(name+" m\u1eddi b\u1ea1n \u0111\u00e1nh bi\u00ean "+cc.Global.NumberFormat2(bettingDidem)+" ?");this.dialogYesNoDanhBien.show(true);this.dialogYesNoDanhBien.showWithAnimationScale()};
GameBaCay.prototype.onAcceptDiDem=function(inviteId){cc.log("send onAcceptDiDem");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_ACCEPT_BIEN,"iid":inviteId}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameBaCay.prototype.onAcceptDanhBienResponse=function(data){var fP=data.fP;var tP=data.tP;var bettingDidem=data.b;var fName=this.getPlayer(fP.uid).dn;var tName=this.getPlayer(tP.uid).dn;var str="";if(tP.uid===PlayerMe.uid)this.dialogYesNo.show(false);this.updateMoneyPlayer(fP);this.updateMoneyPlayer(tP);this.getSlotByUid(fP.uid).addMoneyBien(bettingDidem);this.getSlotByUid(tP.uid).addMoneyBien(bettingDidem);this.getSlotByUid(fP.uid).setTotalGoldWithEffect(fP.m);this.getSlotByUid(tP.uid).addMoneyBien(tP.m);
this.showMsgInSlot(fP.uid,"\u0110\u00e1nh bi\u00ean "+cc.Global.NumberFormat1(bettingDidem));this.showMsgInSlot(tP.uid,"\u0110\u00e1nh bi\u00ean "+cc.Global.NumberFormat1(bettingDidem))};GameBaCay.prototype.startCountdownPbar=function(valueProgress,remainTime,isDidem){if(hiepnh.isUndefined(remainTime))remainTime=-1;if(hiepnh.isUndefined(isDidem))isDidem=false;if(this.baCayTimeBar)this.baCayTimeBar.showTimeRemain(remainTime,this.timeTurn)};
GameBaCay.prototype.beginDiDemAndKeCua=function(data){if(TEST_MODE){var _ps=[];for(var i=0;i<this.allSlot.length;i++)_ps[i]={"uid":this.allSlot[i].uid,"b":this.betValue,"dn":"kaka167","m":831927};data={"ps":_ps,"cmd":661}}this.startCountdownPbar(0,this.timeTurn,false);this.lblNarrativeResult.hideLine();var isReconnect=false;var ps=data.ps;for(var i in ps){var isMyPlayer=false;if(ps[i].uid===PlayerMe.uid&&this.meSitDown){this.dialogRaiseMoney.showDialog(false,0,0);this.getSlotByUid(PlayerMe.uid).showDiDem(false);
this.btnVaoGa.visible=true;isMyPlayer=true}var tossMoney=ps[i].b;var slot=this.getSlotByUid(ps[i].uid);if(slot.sitId===-1)return;if(!isMyPlayer&&this.uidChuong!==PlayerMe.uid&&this.uidChuong!==ps[i].uid&&!this.isViewing)slot.showDiDem(true,false,null,this.betValue);var idCoinImg=tossMoney>this.betValue?1:0;cc.log(tossMoney+"\x3e moneyPot "+this.chipColumns[slot.sitId].moneyPot);if(this.chipColumns[slot.sitId].moneyPot<tossMoney){tossMoney-=this.chipColumns[slot.sitId].moneyPot;this.tossChip(slot.uid,
0,false,true);this.chipColumns[slot.sitId].updateMyMoney(tossMoney)}}this.stopTurnTimeAll()};GameBaCay.prototype.updateChuong=function(uidChuong){this.allSlot.forEach(function(slot,index){if(slot)if(slot.uid===uidChuong)slot.showChuong(true);else slot.showChuong(false)})};
GameBaCay.prototype.animChiaBaiToPlayer=function(cardArray,slot,animation,isReconnect,isToss){if(hiepnh.isUndefined(animation))animation=true;if(hiepnh.isUndefined(isReconnect))isReconnect=false;if(hiepnh.isUndefined(isToss))isToss=true;if(isToss){this.tossChip(slot.uid,this.betValue,isReconnect,animation);slot.reduceMoney(-this.betValue)}var cards=[];for(var k=0;k<cardArray.length;k++)cards.push(Utils.getCardFromServer(cardArray[k]));var isMe=slot.uid==PlayerMe.uid;var showBackCard=isMe?false:true;
var originScale=isMe?.7:.7;slot.cardList.dealCards(cards,isMe,animation,showBackCard,originScale,false)};
GameBaCay.prototype.initButton=function(){var thiz=this;var x=cc.Global.GameView.width/2;var y=cc.Global.GameView.height/2;var upBt=MyHelper.createButton("button/btn_1.png",true,function(){thiz.onUpBai()},true,cc.size(150,60),[60,20,60,20]);upBt.position.set(x+387-upBt.width/2,y-upBt.height/2+311);upBt.displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(upBt);MyHelper.addLblButton(upBt,"\u00dap",16);upBt.visible=false;var latBt=MyHelper.createButton("button/btn_1.png",true,function(){thiz.onLatBai()},
true,cc.size(150,60),[60,20,60,20]);latBt.position.set(x+553-latBt.width/2,y-latBt.height/2+311);MyPixi.gameContainer.addChild(latBt);latBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(latBt,"L\u1eadt",16);latBt.visible=false;var xemBt=MyHelper.createButton("button/btn_1.png",true,function(){thiz.onXem()},true,cc.size(150,60),[60,20,60,20]);xemBt.position.set(x+387-xemBt.width/2,y-xemBt.height/2+240);MyPixi.gameContainer.addChild(xemBt);xemBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(xemBt,
"Xem",16);xemBt.visible=false;var toBt=MyHelper.createButton("button/btn_1.png",true,function(){thiz.onShowTo()},true,cc.size(150,60),[60,20,60,20]);toBt.position.set(x+553-toBt.width/2,y-toBt.height/2+240);MyPixi.gameContainer.addChild(toBt);toBt.displayGroup=MyPixi.gamePlayerLayer;MyHelper.addLblButton(toBt,"T\u1ed1",16);toBt.visible=false;var xemUpBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");xemUpBt.setText("Xem \u00fap");xemUpBt.anchor.set(.5,.5);xemUpBt.position.set(x+
367,y+311);MyPixi.gameContainer.addChild(xemUpBt);xemUpBt.displayGroup=MyPixi.gamePlayerLayer;xemUpBt.onSelect=function(selected){thiz.theoTatBt.unSelect();thiz.onUpTheo()};xemUpBt.onUnSelect=function(selected){thiz.onUpTheo()};xemUpBt.visible=false;var theoTatBt=new ButtonToggle("button/btn_1_checked.png","button/btn_1_check.png");theoTatBt.setText("Theo t\u1ea5t");theoTatBt.anchor.set(.5,.5);theoTatBt.position.set(x+553,y+311);MyPixi.gameContainer.addChild(theoTatBt);theoTatBt.displayGroup=MyPixi.gamePlayerLayer;
theoTatBt.onSelect=function(selected){thiz.xemUpBt.unSelect();thiz.onTheoTat()};theoTatBt.onUnSelect=function(selected){thiz.onTheoTat()};theoTatBt.visible=false;this.theoTatBt=theoTatBt;this.xemUpBt=xemUpBt;var btnList=[upBt,xemBt,toBt];var btnListAuto=[xemUpBt,theoTatBt];this.turnButtons=new TurnButtonUI(btnList,btnListAuto);if(TEST_MODE){var tossChip=MyHelper.createButton("button/btn_0.png",true,function(){thiz.updateBetting()},true,cc.size(150,60),[60,20,60,20]);tossChip.position.set(50,cc.Global.GameView.height-
220);tossChip.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(tossChip);MyHelper.addLblButton(tossChip,"toss",16);var chiaBai=MyHelper.createButton("button/btn_0.png",true,function(){thiz.chiabai()},true,cc.size(150,60),[60,20,60,20]);chiaBai.position.set(50,cc.Global.GameView.height-80);chiaBai.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(chiaBai);MyHelper.addLblButton(chiaBai,"chiabai",16);var showTo=MyHelper.createButton("button/btn_0.png",true,function(){thiz.beginDiDemAndKeCua()},
true,cc.size(150,60),[60,20,60,20]);showTo.position.set(200,cc.Global.GameView.height-80);showTo.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(showTo);MyHelper.addLblButton(showTo,"begindidem",16);var beginBet=MyHelper.createButton("button/btn_0.png",true,function(){thiz.beginBetting()},true,cc.size(150,60),[60,20,60,20]);beginBet.position.set(350,cc.Global.GameView.height-80);beginBet.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(beginBet);MyHelper.addLblButton(beginBet,
"beginBet",16);var showGaPlayer=MyHelper.createButton("button/btn_0.png",true,function(){for(var i=0;i<thiz.allSlot.length;i++)thiz.allSlot[i].showGa(true)},true,cc.size(150,60),[60,20,60,20]);showGaPlayer.position.set(500,cc.Global.GameView.height-80);showGaPlayer.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(showGaPlayer);MyHelper.addLblButton(showGaPlayer,"allGa",16);var endBt=MyHelper.createButton("button/btn_0.png",true,function(){thiz.showResult(true)},true,cc.size(150,
60),[60,20,60,20]);endBt.position.set(200,cc.Global.GameView.height-150);endBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(endBt);MyHelper.addLblButton(endBt,"endBt",16);var recBt=MyHelper.createButton("button/btn_0.png",true,function(){LobbyClient.getInstance().reConnect()},true,cc.size(150,60),[60,20,60,20]);recBt.position.set(50,cc.Global.GameView.height-150);recBt.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(recBt);MyHelper.addLblButton(recBt,"recBt",
16)}};GameBaCay.prototype.updateRealMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.rM=data.m;break}}};GameBaCay.prototype.updateMoneyPlayer=function(data){if(!data)return;var thiz=this;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===data.uid){el.m=data.m;if(data.rM)el.rM=data.rM;break}}};
GameBaCay.prototype.getMoneyPlayer=function(uid){var thiz=this;var length=thiz.data.ps.length;for(var j=0;j<length;j++){var el=thiz.data.ps[j];if(el.uid===uid)return el.m}return-1};GameBaCay.prototype.getIdCoinImg=function(ratio){var id=ChipType.WHITE;if(ratio>=20)id=ChipType.RED;else if(ratio>=10)id=ChipType.VIOLET;else if(ratio>=4)id=ChipType.BLUE;else if(ratio>=2)id=ChipType.GREEN;else if(ratio>=1)id=ChipType.WHITE;return id};
GameBaCay.prototype.getPlayerIndexByUid=function(uid){for(var idx in this.allSlot)if(this.allSlot[idx]===uid)return idx;return-1};GameBaCay.prototype.checkNewChuong=function(){if(this.nrm&&this.nrm===PlayerMe.uid){this.dialogGetOrSellChuong.show(true);this.dialogGetOrSellChuong.showWithAnimationScale()}};
GameBaCay.prototype.showResult=function(isShow,data,timeRemain){if(TEST_MODE){data={"ps":[{"cs":[32,19,23],"ctb":0,"uid":PlayerMe.uid,"b":8E3,"ko":0,"pip":1E3,"rh":10,"wm":26E3,"dn":"rtgddchii","mX":8550,"m":1070375},{"cs":[15,1,35],"ctb":0,"uid":"uid4","b":-8E3,"ko":0,"pip":-1E3,"rh":4,"wm":-8E3,"dn":"quytest","mX":-9E3,"m":9894322}],"nrm":PlayerMe.uid,"wp":PlayerMe.uid,"cmd":652};this.uidChuong="uid4"}cc.log("showResult "+JSON.stringify(data));if(!timeRemain)timeRemain=-1;var thiz=this;thiz.disablePendindAndReset=
false;thiz.forceFinishShapeCard();var cbEnd=cc.callFunc(function(){thiz.resetNewGame();thiz.checkNewChuong()});this.runAction(this,cc.sequence(cc.delayTime(this.timeEndGame/1E3),cbEnd));this.clearAllResult=false;this.dialogShapCardShow.show(false);this.clearAllAmin=true;this.lblNarrativeResult.hideLine();this.btnVaoGa.visible=false;this.nrm=data.nrm;this.ucm=data.ucm;var wp=data.wp;if(wp){this.isAnGa=true;var posWin=cc.p(0,0);var slot=this.getSlotByUid(wp);var slotPos=slot.getGlobalPosition();slotPos.x+=
slot.widthBG/2;slotPos.y+=slot.heightBG/2;posWin=cc.convertToNodeSpace(this.chiponTable,slotPos);var chipArr=this.chiponTable.getChips();for(var k=0;k<chipArr.length;k++){var chipObj=chipArr[k];var pos=cc.convertToNodeSpace(this.chiponTable,cc.convertToWorldSpace(chipObj));chipObj.addOriginWinPot(posWin)}this.chiponTable.reOrder()}var ps=data.ps;this.playerPlayed=ps;for(var i in ps){var isAnGa=false;var player=ps[i];var cs=player.cs;var ctb=player.ctb;var mX=player.mX;var m=player.m;var winMoney=
player.wm;var rh=player.rh;var b=player.b;var pip=player.pip;var ko=player.ko;this.updateMoneyPlayer(player);if(wp&&wp===player.uid)isAnGa=true;var actor=this.getSlotByUid(player.uid);if(actor){actor.stopTimeRemain(false);if(cs&&cs.length){actor.cardList.showCardEndGame(cs,actor.isMe);actor.cardList.flipAndShowAllCard(.2)}actor.showResultBaCay(m,winMoney,rh,cs,isAnGa);actor.showGa(false);actor.showDiDem(false)}var id=this.getSlotByUid(player.uid).sitId;cc.log("id "+id+" b "+b);if(b>0)this.potToPlayer([this.getSlotByUid(player.uid)],
this.chipColumns[id]);else{var idChuong=this.getSlotByUid(this.uidChuong).sitId;if(idChuong<0)idChuong=id;if(id>=0)this.potToPlayer([this.getSlotByUid(this.uidChuong)],this.chipColumns[id])}}};
GameBaCay.prototype.potToPlayer=function(slotList,potColumn){var posWinArr=[];for(var i=0;i<slotList.length;i++){var slot=slotList[i];var slotPos=slot.getGlobalPosition();slotPos.x+=slot.widthBG/2;slotPos.y+=slot.heightBG/2;var posWin=cc.convertToNodeSpace(potColumn,slotPos);posWinArr.push(posWin)}var index=0;var chipList=potColumn.getChips();if(chipList&&chipList.length)for(var i=0;i<chipList.length;i++){chipList[i].addOriginWinPot(posWinArr[index]);index++;if(index>=posWinArr.length)index=0}potColumn.reOrder()};
GameBaCay.prototype.endGame=function(preventWidthDraw){if(preventWidthDraw==undefined)preventWidthDraw=false;var thiz=this;if(thiz.isPlaying&&thiz.meSitDown)thiz.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);if(!preventWidthDraw&&thiz.meSitDown&&2*thiz.betValue>thiz.getMoneyPlayer(PlayerMe.uid)){var realMoney=0;if(this.aid==Constant.ASSET_ID.GOLD)realMoney=PlayerMe.gold;else realMoney=PlayerMe.chip;if(thiz.autoRutTien&&realMoney>=thiz.currentMoneyBuy)thiz.onWithdrawMoney(thiz.currentMoneyBuy,true,
true);else thiz.onSitdown(true)}thiz.gameState=0;thiz.meUpBai=false;if(thiz.meSitDown)thiz.isViewing=false;thiz.resetNewGame()};
GameBaCay.prototype.initPlayer=function(){var center=cc.Global.GameView;var playerMe=new GamePlayerBaCay(this);playerMe.sitId=0;playerMe.position.set(center.width/2-playerMe.widthBG/2,center.height/2+160);var player1=new GamePlayerBaCay(this);player1.sitId=1;player1.position.set(center.width/2+290-player1.widthBG/2,center.height/2+160);var player2=new GamePlayerBaCay(this);player2.sitId=2;player2.position.set(center.width/2+480,center.height/2+20);var player3=new GamePlayerBaCay(this);player3.sitId=
3;player3.position.set(center.width/2+480,center.height/2-180);var player4=new GamePlayerBaCay(this);player4.sitId=4;player4.position.set(center.width/2+190-player4.widthBG/2,center.height/2-330);var player5=new GamePlayerBaCay(this);player5.sitId=5;player5.position.set(center.width/2-190-player5.widthBG/2,center.height/2-330);var player6=new GamePlayerBaCay(this);player6.sitId=6;player6.position.set(center.width/2-600,center.height/2-180);var player7=new GamePlayerBaCay(this);player7.sitId=7;player7.position.set(center.width/
2-600,center.height/2+20);var player8=new GamePlayerBaCay(this);player8.sitId=8;player8.position.set(center.width/2-290-player8.widthBG/2,center.height/2+160);this.playerView=[playerMe,player1,player2,player3,player4,player5,player6,player7,player8];for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;this.playerView[i].listener=this;MyPixi.gameContainer.addChild(this.playerView[i])}if(this.data.Mu==6){this.playerView[2].visible=false;this.playerView[6].visible=
false;this.playerView[8].visible=false;this.playerView[0].x-=100;this.playerView[3].y=center.height/2-this.playerView[3].heightBG/2;this.playerView[6].y=center.height/2-this.playerView[6].heightBG/2}this.chipColumns=[];var thiz=this;var leftVerticalPos=cc.p(-30,30);var rightVerticalPos=cc.p(165,30);var leftPos=cc.p(-60,65);var rightPos=cc.p(195,65);var posArr=[cc.p(5+this.playerView[0].widthBG/2,this.playerView[0].heightBG/2-40),rightPos,leftVerticalPos,leftVerticalPos,rightPos,leftPos,rightVerticalPos,
rightVerticalPos,leftPos];var dxChip=0;var dyChip=0;for(var i=0,max=this.playerView.length;i<max;i++){this.playerView[i].onSitdown=function(){thiz.onSitdown()};var isVertical=false;var sizeCards=cc.size(175,90);var align=LiengCardList.ALIGN_CENTER;if(i==2||i==3){isVertical=true;sizeCards=cc.size(80,90);align=LiengCardList.ALIGN_RIGHT}else if(i==6||i==7){sizeCards=cc.size(80,90);align=LiengCardList.ALIGN_LEFT;isVertical=true}else if(i==1||i==4||i==5||i==8){sizeCards=cc.size(160,90);if(i==5||i==8)align=
LiengCardList.ALIGN_RIGHT}else isVertical=false;this.playerView[i].cardList=new BaCayCardList(posArr[i],sizeCards,GameLieng.cardOriginScaleBackCard,isVertical,align);this.playerView[i].infoLayer.addChild(this.playerView[i].cardList);this.playerView[i].cardList.setListener(this.playerView[i]);this.playerView[i].cardList.setSitId(i);this.playerView[i].cardList.onShowLatBai=function(visible){thiz.onShowLatBai(visible)};if(TEST_MODE)this.playerView[i].cardList.showBlurBg(true);if(i==0||i==1||i==4||i==
5||i==8){dxChip=0;if(i==8)dxChip=0;if(i==0)dyChip=100;else if(i==1||i==8)dyChip=110;else dyChip=-140}else if(i==2||i==3){dxChip=-190;if(i==2)dyChip=30;else dyChip=-20}else if(i==6||i==7){dxChip=190;if(i==7)dyChip=30;else dyChip=-20}var alignLbl=ChipColumnList.LBL_RIGHT;if(i==1||i==2||i==3||i==4)alignLbl=ChipColumnList.LBL_LEFT;var chipColumnPlayer=new ChipColumnList(cc.size(30,100),.3,alignLbl);chipColumnPlayer.position.set(this.playerView[i].x+this.playerView[i].widthBG/2+dxChip-chipColumnPlayer.widthContainer/
2,-chipColumnPlayer.heightContainer/2+this.playerView[i].y+this.playerView[i].heightBG/2-dyChip-50);chipColumnPlayer.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chipColumnPlayer);if(TEST_MODE)chipColumnPlayer.showBlurBg(true);this.chipColumns.push(chipColumnPlayer)}var alignLbl=ChipColumnList.LBL_TOP;var chiponTable=new ChipBaCayOnTable(cc.size(100,100),.3,alignLbl);chiponTable.moneyPotLbl.style.fill="yellow";chiponTable.position.set(cc.Global.GameView.width/2-chiponTable.widthContainer/
2,cc.Global.GameView.height/2-chiponTable.heightContainer/2-50);chiponTable.displayGroup=MyPixi.chipLayer;MyPixi.gameContainer.addChild(chiponTable);this.chiponTable=chiponTable;if(TEST_MODE)chiponTable.showBlurBg(true);this.arrangePlayerInGame()};GameBaCay.prototype.onShowLatBai=function(){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_SHOW_CARD}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0;this.dialogShapCardShow.show(false)};
GameBaCay.prototype.onStandUp=function(){var thiz=this;if(thiz.isPlaying&&thiz.gameState===4||thiz.gameState===5){MessageNode.getInstance().show("V\u00e1n ch\u01a1i ch\u01b0a ch\u01b0a k\u1ebft th\u00fac",2);this.dialogStandUpQuit.show(false);return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,thiz.roomID,{"cmd":BACAY_CMD.CMD_DUNG_LEN}];LobbyClient.getInstance().send(sendObj);cc.log("onStandUp "+JSON.stringify(sendObj))};
GameBaCay.prototype.onSitdown=function(isSitDown){if(isSitDown===undefined)isSitDown=false;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_NGOI_XUONG}];LobbyClient.getInstance().send(sendObj)};
GameBaCay.prototype.onShowTo=function(){var min=this.betValue;var max=this.getMaxRaise();if(TEST_MODE)max=this.betValue*10.5;var showBet=true;var arrCuoc=[cc.Global.NumberFormat2(min),cc.Global.NumberFormat2(min*2),cc.Global.NumberFormat2(min*3),cc.Global.NumberFormat2(min*4)];this.getSlotByUid(PlayerMe.uid).showDiDem(true,showBet,arrCuoc,min)};
GameBaCay.prototype.onTo=function(toValue){cc.log("onTo toValue"+toValue);var bet=toValue*this.betValue;cc.log("onTo bet"+bet);if(bet>0){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_BETTING,"b":bet}];LobbyClient.getInstance().send(sendObj);cc.log("onTo "+Utils.encode(sendObj))}this.ideGameNumber=0};GameBaCay.prototype.onLatBai=function(){cc.log("onLatBai");this.dialogShapCardShow.showDialog(true,this.myCards)};
GameBaCay.prototype.onSendLatBai=function(cs){var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":709,"cs":cs}];if(TEST_MODE){var data=["aaaa",{"cs":cs,"uid":PlayerMe.uid,"cmd":BACAY_CMD.CMD_SHOW_CARD}];this.showCard(data)}else{cc.log("onSendLatBai cs\x3d\x3d\x3e "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}};GameBaCay.prototype.getMaxRaise=function(){return this.betValue*4};
GameBaCay.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){cc.log("arrangeChauRiaOnly "+arrangeChauRiaOnly);if(TEST_MODE&&this.data.ps.length===1){var totalPlayer=9;cc.log("totalPlayer "+totalPlayer);for(var i=1;i<=totalPlayer;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"uidTest","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="uid"+
i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}}this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);this.changeSitToInviteBg()};GameBaCay.prototype.checkLeaveRoomIfCan=function(){var isIdeKick=false;if(this.registerQuit)this.quitRoom(isIdeKick);else if(this.ideGameNumber>=IDE_GAME_KICK&&!this.isViewing){this.ideGameNumber++;isIdeKick=true;this.quitRoom(isIdeKick)}};
GameBaCay.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState>=GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};
GameBaCay.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoom();return}var thiz=this;if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit){this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");this.registerQuitHandler=function(){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();thiz.quitRoom(false)}}else{this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
this.registerQuitHandler=null}return}else if(this.meSitDown){this.dialogStandUpQuit.show(true);this.dialogStandUpQuit.showWithAnimationScale();return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GameBaCay.prototype.onNhanChuong=function(){this.dialogGetOrSellChuong.show(false);cc.log("send onBanChuong");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_SELL_CHUONG,"acpt":false}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameBaCay.prototype.onBanChuong=function(){this.dialogGetOrSellChuong.show(false);cc.log("send onBanChuong");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_SELL_CHUONG,"acpt":true}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameBaCay.prototype.onMuaChuong=function(){this.dialogBuyChuong.show(false);cc.log("send onBanChuong");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,this.roomID,{"cmd":BACAY_CMD.CMD_MUA_CHUONG}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameBaCay.prototype.onVaoGa=function(){cc.log("send onVaoGa");if(TEST_MODE){this.updateVaoGa();return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":BACAY_CMD.CMD_VAO_GA}];LobbyClient.getInstance().send(sendObj);this.ideGameNumber=0};
GameBaCay.prototype.finishShapeCard=function(cardArr){this.dialogShapCardShow.show(false);this.onShowLatBai();var mySlot=this.getSlotByUid(PlayerMe.uid);if(mySlot){mySlot.cardList.showRankCard();mySlot.stopTimeRemain()}};GameBaCay.prototype.forceFinishShapeCard=function(){this.dialogShapCardShow.show(false);var mySlot=this.getSlotByUid(PlayerMe.uid);if(mySlot){mySlot.cardList.showRankCard();mySlot.stopTimeRemain()}};
GameBaCay.prototype.getSitPosArr=function(totalPlayer){if(totalPlayer===2)this.sitdownPlayerNext=[4];else if(totalPlayer===3)this.sitdownPlayerNext=[4,5];else if(totalPlayer===4)this.sitdownPlayerNext=[4,5,7];else if(totalPlayer===5)this.sitdownPlayerNext=[1,4,5,7];else if(totalPlayer===6)this.sitdownPlayerNext=[1,3,4,5,7];else if(totalPlayer===7)this.sitdownPlayerNext=[2,3,4,5,6,7];else if(totalPlayer===8)this.sitdownPlayerNext=[2,3,4,5,6,7,8];else if(totalPlayer>=9)this.sitdownPlayerNext=[1,2,3,
4,5,6,7,8];return this.sitdownPlayerNext};
GameBaCay.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){GameScene.prototype.processPlayerPosition.call(this,players,gameState,arrangeChauRiaOnly);var listPlayer=[];var totalPlayer=0;listPlayer=players;totalPlayer=players.length;var meSitDown=false;var viewerSitedUid=[-1];this.sitIdMyPlayer=-1;var cloneArr=[];for(i=0;i<listPlayer.length;i++)if(PlayerMe.uid===listPlayer[i].uid){meSitDown=true;cloneArr.push(0);if(listPlayer[i].p)this.getSlotByUid(PlayerMe.uid).showRutTienBtn(true);break}if(!listPlayer||
!listPlayer.length)for(var i=0;i<GameBaCay.MAX_SLOT;i++){this.playerView[i].setEnable(false);this.playerView[i].reset()}for(var i=0;i<GameBaCay.MAX_SLOT;i++)if(!this.playerView[i].uid||!this.playerView[i].uid.length)if(!meSitDown){this.playerView[i].showNgoiXuong(true);this.playerView[i].showInfoLayer(false)}};var CMD_CHAN=CMD_CHAN||{};CMD_CHAN.CHIABAI=5E3;CMD_CHAN.CHOSE_CAI=5001;CMD_CHAN.CHANGE_TURN=5002;CMD_CHAN.U=5003;CMD_CHAN.PUNISH=5004;CMD_CHAN.CHIU=5005;CMD_CHAN.XUONG_CUOC=5007;CMD_CHAN.END_GAME=5008;CMD_CHAN.CHON_CUOC=5009;CMD_CHAN.TRA_CUA=5010;CMD_CHAN.BOC=5011;CMD_CHAN.AN=5012;CMD_CHAN.DANH=5013;CMD_CHAN.DUOI=5014;CMD_CHAN.SERVER_CHOSE_NOC_CAI=5015;CMD_CHAN.CHOSE_NOC=5016;CMD_CHAN.UPDATE_GAME_MODE=5017;CMD_CHAN.UPDATE_GA=5018;
var ERROR_CHAN={1:{msg:"\u0103n treo tranh"},2:{msg:"\u0103n ch\u1ecdn c\u1ea1"},3:{msg:"x\u00e9 c\u1ea1 \u0103n c\u1ea1 nh\u01b0ng ch\u01b0a \u0111\u00e1nh \u0111i"},4:{msg:"\u0103n c\u1ea1 chuy\u1ec3n ch\u1edd"},5:{msg:"c\u00f3 ch\u1eafn c\u1ea5u c\u1ea1"},6:{msg:"b\u1ecf ch\u1eafn \u0103n ch\u1eafn"},7:{msg:"b\u1ecf ch\u1eafn \u0103n c\u1ea1"},8:{msg:"b\u1ecf c\u1ea1 \u0103n c\u1ea1"},9:{msg:"b\u1ecf ch\u1eafn \u0111\u00e1nh ch\u1eafn"},10:{msg:"\u0111\u00e1nh c\u1ea1 \u0103n c\u1ea1"},11:{msg:"x\u00e9 c\u1ea1 \u0103n c\u1ea1"},
12:{msg:"\u0111\u00e1nh m\u1ed9t qu\u00e2n r\u1ed3i \u0103n \u0111\u00fang qu\u00e2n \u0111\u00f3"},13:{msg:"\u0111\u00e1nh \u0111\u00f4i ch\u1eafn \u0111i"},14:{msg:"\u0103n m\u1ed9t con r\u1ed3i \u0111\u00e1nh \u0111\u00fang qu\u00e2n \u0111\u00f3"},15:{msg:"\u0103n c\u1ea1 r\u1ed3i \u0103n ch\u1eafn c\u00f9ng h\u00e0ng"},16:{msg:"\u0111\u00e1nh c\u1ea1 khi \u0111\u00e3 \u0103n c\u1ea1"},17:{msg:"\u0103n c\u1ea1 \u0111\u00e1nh con c\u00f9ng h\u00e0ng"},18:{msg:"\u0103n c\u1ea1 r\u1ed3i l\u1ea1i \u0103n c\u1ea1 c\u00f9ng h\u00e0ng"},
19:{msg:"b\u1ecf ch\u1eafn \u0103n c\u1ea1 nh\u01b0ng ch\u01b0a \u0111\u00e1nh \u0111i"},100:{msg:"\u00f9 r\u1ed9ng chi chi"},101:{msg:"b\u1ecf \u00f9"},102:{msg:"x\u01b0\u1edbng thi\u1ebfu \u0111i\u1ec3m"}};
var ERROR_CMD_CHAN={101:{msg:"Thao t\u00e1c kh\u00f4ng h\u1ee3p l\u1ec7"},102:{msg:"T\u1ea5t c\u1ea3 ng\u01b0\u1eddi ch\u01a1i ph\u1ea3i s\u1eb5n s\u00e0ng"},103:{msg:"Tr\u1ea1ng th\u00e1i game ko h\u1ee3p l\u1ec7"},104:{msg:"Tr\u1ea1ng th\u00e1i ng\u01b0\u1eddi ch\u01a1i kh\u00f4ng h\u1ee3p l\u1ec7"},8E3:{msg:"kh\u00f4ng c\u00f3 trong danh s\u00e1ch \u00f9"},8001:{msg:"c\u00f3 ng\u01b0\u1eddi \u0111ang \u0111\u1ee3i \u00f9"},8002:{msg:"\u0102n b\u00e0i ko h\u1ee3p l\u1ec7"},8003:{msg:"C\u00f3 ng\u01b0\u1eddi \u0111ang ch\u00edu"},
8004:{msg:"Kh\u00f4ng ph\u1ea3i l\u00e0 ch\u1ee7 b\u00e0n"},8005:{msg:"G\u00e0 ph\u1ea3i b\u1eb1ng 0"},8006:{msg:"\u0111\u00e3 \u0111\u1ee7 ng\u01b0\u1eddi ch\u01a1i trong b\u00e0n"},8007:{msg:"\u0102n qu\u00e2n b\u00e0i \u0111\u00e3 \u0111\u00e1nh ra"},8008:{msg:"Kh\u00f4ng \u0111\u01b0\u1ee3c thay \u0111\u1ed5i c\u00e0i \u0111\u1eb7t khi b\u00e0n \u0111ang ch\u01a1i"}};var state_player_chan=state_player_chan||{};state_player_chan.NOTHING=0;state_player_chan.READY=1;state_player_chan.CHON_CAI=2;
state_player_chan.BAT_BAO=3;state_player_chan.U=4;state_player_chan.CHON_NOC=5;var PLAYER_STATE=PLAYER_STATE||{};PLAYER_STATE.NONE=0;PLAYER_STATE.CO_LUOT=1;PLAYER_STATE.AN=2;PLAYER_STATE.DANH=4;PLAYER_STATE.CHON_U=5;PLAYER_STATE.BAT_BAO=6;PLAYER_STATE.CHON_CHIU=7;PLAYER_STATE.CHON_U=8;PLAYER_STATE.CHIU=9;PLAYER_STATE.CHON_CUOC=10;PLAYER_STATE.CHON_XONG_CUOC=11;PLAYER_STATE.TRA_CUA=12;PLAYER_STATE.BOC=13;PLAYER_STATE.DUOI=14;var TIME_CHIU=7;
function GameChan(data){GameScene.call(this,data);cc.Global.SetSetting(GameSetting.autoReadyChan,false);this.position.x=0;this.position.y=0;this.registerQuit=false;this.data=data;this.type="GameChan";LobbyClient.getInstance().addListener(kCMD.RoomPluginMessage,this._onRoomPluginMsg,this);this.initGame();this.initCardContainer()}GameChan.prototype=Object.create(GameScene.prototype);GameChan.MAX_SLOT_CHAN=4;
GameChan.prototype.initGame=function(){var thiz=this;var data=this.data;this.timeTurn=data.tft;this.tfeg=data.tfeg/1E3;if(data.gS===GAME_STATE.CHIA_BAI)data.gS=GAME_STATE.PLAYING;var gameState=data.gS;this.gameState=gameState;this.aid=data.aid;var remainTime=data.tRMT/1E3;this.tFDC=data.tFDC;var timeBocNoc=data.tPC;this.timeBocNoc=timeBocNoc;this.timeXuong=data.tSLC/1E3;this.nocSize=data.nSz;this.timeReadyBeforeKickDefault=data.tFRD/1E3;this.timeReadyBeforeKick=data.tFR?data.tFR/1E3:0;cc.log("fuck timeReadyBeforeKick "+
data.tFR+" "+data.tFRD);this.timeChonCai=timeBocNoc;this.timeReady=data.timeReady?data.timeReady:0;cc.log("fuck timeReady "+this.timeReady);this.timeChiaBai=this.tFDC-timeBocNoc;this.gameTopBar=this.hudLayer;this.gameTopBar.updateChicken();this.changeDesignImage();this.initButton();this.initPlayer();var thiz=this;var cKPt=data.cKPt;if(cKPt&&cKPt>0){var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;this.moneyGop=this.data.b*cKPt;if(!isPlaying){var dataPlayer=this.getDataPlayerByUid(PlayerMe.uid);
if(dataPlayer.sit>-1){var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n c\u00f3 mu\u1ed1n v\u00e0o g\u00e0 ?");dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){thiz.quitRoomGameChan(REASON_QUIT.REJECT_GOP_GA);dialog.hide()};dialog.show(this)}}else this.handlerGopGaNewGame=function(){if(thiz.data.cKM!=GA_MODE.GA){thiz.handlerGopGaNewGame=null;thiz.showReadyIfCan();return}var dataPlayer=thiz.getDataPlayerByUid(PlayerMe.uid);
if(dataPlayer.sit<0)return;var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n c\u00f3 mu\u1ed1n v\u00e0o g\u00e0 ?");dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){thiz.quitRoomGameChan(REASON_QUIT.REJECT_GOP_GA);dialog.hide()};dialog.showWithAnimationScale()}}else this.showReadyIfCan();this.clockKick=new ClockKickChan;this.clockKick.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.clockKick);cc.log("this.timeReadyBeforeKick "+
this.timeReadyBeforeKick);if(this.timeReadyBeforeKick>0)this.clockKick.showTimeCountDown(this.timeReadyBeforeKick);cc.log("fuck run timeReadyBeforeKick "+this.timeReadyBeforeKick)};GameChan.prototype.onDestroyGame=function(){cc.log("onDestroyGame");this.clockKick.show(false);this.countDownReady.show(false)};
GameChan.prototype.changeDesignImage=function(){this.gameTopBar.iconMoney.visible=false;this.gameTopBar.settingBt.texture=PIXI.Texture.fromFrame("button/btn_setting_chan.png");this.gameTopBar.backBtn.texture=PIXI.Texture.fromFrame("button/btn_back_chan.png");this.gameTopBar.backBtn.displayGroup=MyPixi.topLayer;MyPixi.popupContainer.addChild(this.gameTopBar.backBtn);this.gameTopBar.chickenHandler=function(){cc.log("send change ga ");var currentCkm=this.data.cKM;var senCkm=GA_MODE.NORMAL;if(currentCkm===
GA_MODE.NORMAL)senCkm=GA_MODE.GA;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.UPDATE_GA,"cKM":senCkm}];LobbyClient.getInstance().send(sendObj)};var thiz=this;this.gameTopBar.onSettingButtonHandler=function(){MH.openSettingChan({inRoom:this.data.gS>=GAME_STATE.PLAYING,fast:this.data.gSd==SPEED_MODE.FAST,uf:this.data.gM==GAME_MODE.IS_411,agree:function(data){console.log(data.fast);console.log(data.uf);if(thiz.data.gS===
GAME_STATE.PLAYING)return;var gameMode=data.uf?GAME_MODE.IS_411:GAME_MODE.FREE;var spdMode=data.fast?SPEED_MODE.FAST:SPEED_MODE.NORMAL;var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.UPDATE_GAME_MODE,"gM":gameMode,"gSd":spdMode}];cc.log("send setting change gameNode "+gameMode);cc.log("send setting change gameNode "+JSON.stringify(sendObj));LobbyClient.getInstance().send(sendObj)}})}};
GameChan.prototype.showGopGaWhenSit=function(data){var thiz=this;var dataPlayer=this.getDataPlayerByUid(PlayerMe.uid);if(dataPlayer.sit>-1){this.showReady(false);var dialog=new MessageConfirmDialog;dialog.setMessage("B\u1ea1n c\u00f3 mu\u1ed1n v\u00e0o g\u00e0 ?");dialog.okButtonHandler=function(){thiz.sendStartRequest();dialog.hide()};dialog.cancelButtonHandler=function(){thiz.quitRoomGameChan(REASON_QUIT.REJECT_GOP_GA);dialog.hide()};dialog.show(this)}};
GameChan.prototype.recconnectGame=function(){this.clockKick.show(false);this.countDownReady.show(false);this.showReady(false);this.chiabaiContainer.hide();if(this.tableResult&&this.tableResult.visible||this.xuongDialog&&this.xuongDialog.visible)this.hideGameObjWhenChoseCuoc()};GameChan.prototype.startCockClick=function(start){cc.log("fuck run "+this.timeReadyBeforeKickDefault);if(start){if(this.clockKick.visible==false)this.clockKick.showTimeCountDown(this.timeReadyBeforeKickDefault)}else this.clockKick.show(false)};
GameChan.prototype.hideGameObjWhenChoseCuoc=function(){this.cardList.removeAll();this.cardOnTable.removeAll();this.nocContainer.resetNewGame();for(var i=0;i<4;i++)this.cardEarnList[i].removeAll();for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].stopTimeRemain(false);this.allSlot[i].setState(state_player_chan.NOTHING)}this.nocContainer.visible=false;cc.log("--------fixxxxx hideGameObjWhenChoseCuoc");this.hideAllBtnPlay()};
GameChan.prototype.initCardContainer=function(){this.countDownReady=new ClockKickChan;this.countDownReady.displayGroup=MyPixi.gameContainerLayer;MyPixi.gameContainer.addChild(this.countDownReady);if(this.timeReady>0){this.countDownReady.showTimeCountDown(this.timeReady);cc.log("fuck run timeReady"+this.timeReady)}this.countDownReady.displayGroup=MyPixi.gameRootLayer;MyPixi.gameContainer.addChild(this.countDownReady);var chiabaiContainer=new ChiaBai(this);chiabaiContainer.displayGroup=MyPixi.gamePlayerLayer;
MyPixi.gameContainer.addChild(chiabaiContainer);this.chiabaiContainer=chiabaiContainer;var cardList=new CardChanList(cc.size(cc.winSize.width-10,200));MyPixi.gameContainer.addChild(cardList);this.cardList=cardList;this.cardList.displayGroup=MyPixi.gamePlayerLayer;var cardOnTable=new CardChanOnTable;cardOnTable.position.set(0,0);MyPixi.gameContainer.addChild(cardOnTable);this.cardOnTable=cardOnTable;this.cardOnTable.displayGroup=MyPixi.cardDragLayer;var avatarSize=cc.size(115,163);var height=avatarSize.height;
var coupleHeight=190;var startEarnX=[10,1020,730,10];this.maxEarnSize=[];this.maxEarnSize.push(cc.size(390-startEarnX[0],200));this.maxEarnSize.push(cc.size(cc.Global.designGame.width-startEarnX[1],coupleHeight));this.maxEarnSize.push(cc.size(980-startEarnX[2],coupleHeight));this.maxEarnSize.push(cc.size(250-startEarnX[3],coupleHeight));this.cardEarnPosition=[];this.cardEarnPosition.push(cc.p(startEarnX[0],cc.winSize.height-10-this.maxEarnSize[0].height));this.cardEarnPosition.push(cc.p(startEarnX[1],
cc.winSize.height/2-height/2-5-this.maxEarnSize[1].height+20));this.cardEarnPosition.push(cc.p(startEarnX[2],coupleHeight+10-this.maxEarnSize[2].height));this.cardEarnPosition.push(cc.p(startEarnX[3],cc.winSize.height/2-height/2-5-this.maxEarnSize[3].height+20));this.cardEarnList=[];for(var i=0;i<4;i++){var cardEarnList=new CardEarnNode(this.maxEarnSize[i]);cardEarnList.position.set(this.cardEarnPosition[i].x,this.cardEarnPosition[i].y);if(i===1)cardEarnList.isReverse=true;cardEarnList.displayGroup=
MyPixi.cardLayer;MyPixi.gameContainer.addChild(cardEarnList);this.cardEarnList[i]=cardEarnList;if(TEST_MODE)cardEarnList.showBlurBg(true)}var tableResult=new ResultTable;this.tableResult=tableResult;MyPixi.gameContainer.addChild(tableResult);tableResult.displayGroup=MyPixi.popupLayer;this.tableResult.visible=false;if(TEST_MODE);this.updateGame(this.data)};GameChan.prototype.showStartIfCan=function(igNoreAutoReady){this.showReadyIfCan(igNoreAutoReady)};
GameChan.prototype.resetNewGame=function(){this.firstTurnDeal=false;this.meGotPunish=false;this.currentTurn=-1;this.gameState=GAME_STATE.WAIT_PLAYER;this.data.gS=this.gameState;this.cardList.removeAll();this.cardOnTable.removeAll();this.nocContainer.resetNewGame();this.tableResult.hide();this.resetStateAllPlayer();if(this.lblDraw&&this.lblDraw.parent){this.lblDraw.parent.removeChild(this.lblDraw);this.lblDraw=null}for(var i=0;i<4;i++)this.cardEarnList[i].removeAll();for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].stopTimeRemain(false);
this.allSlot[i].setState(state_player_chan.NOTHING)}this.nocContainer.visible=false;var idMaster=this.getIdRoomMaster();if(this.data.ps[idMaster].uid==PlayerMe.uid){this.showReady(false);this.showStartIfCan()}else this.showReadyIfCan();if(this.data.ps.length>1)this.clockKick.showTimeCountDown(this.timeReadyBeforeKickDefault)};
GameChan.prototype._onRoomPluginMsg=function(command,dataObj){var cmd=dataObj[1][Constant.CONSTANT.CMD];if(cmd==Constant.CMD_RESULT.ERROR)this.onErrorResponse(dataObj);else if(cmd==7)this.onServerNotifyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.USER_JOIN_OUT)this.onUserInOut(dataObj);else if(cmd==Constant.CMD_RESULT.ROOM_MASTER_CHANGE)this.onRoomMasterResponse(dataObj);else if(cmd==Constant.CMD_RESULT.PLAYER_READY)this.onReadyResponse(dataObj);else if(cmd==Constant.CMD_RESULT.LIST_INVITE)this.onInviteResponse(dataObj);
else if(cmd===205)this.updateGoldAllPlayerFromServer(dataObj);else if(cmd===CMD_CHAN.CHIABAI)this.chiabai(dataObj);else if(cmd===CMD_CHAN.CHOSE_NOC)this.onStiltResponse(dataObj);else if(cmd===CMD_CHAN.CHOSE_CAI)this.onHostResponse(dataObj);else if(cmd===CMD_CHAN.SERVER_CHOSE_NOC_CAI)this.onAutoChoseCaiResponse(dataObj);else if(cmd===CMD_CHAN.DANH)this.onDanhBaiResponse(dataObj);else if(cmd===CMD_CHAN.CHANGE_TURN)this.onChangeTurn(dataObj);else if(cmd===CMD_CHAN.U)this.onU(dataObj);else if(cmd===CMD_CHAN.PUNISH)this.onPunishResponse(dataObj);
else if(cmd===CMD_CHAN.CHIU)this.onChiuResponse(dataObj);else if(cmd===CMD_CHAN.CHON_CUOC)this.onChonCuocResponse(dataObj);else if(cmd===CMD_CHAN.TRA_CUA)this.onDanhTraChiuResponse(dataObj);else if(cmd===CMD_CHAN.DUOI)this.onForwardResponse(dataObj);else if(cmd===CMD_CHAN.BOC)this.onBocBaiResponse(dataObj);else if(cmd===CMD_CHAN.AN)this.onAnBaiResponse(dataObj);else if(cmd===CMD_CHAN.END_GAME)this.onEndGameResponse(dataObj);else if(cmd===CMD_CHAN.UPDATE_GA)this.onUpdateGa(dataObj);else if(cmd===CMD_CHAN.UPDATE_GAME_MODE)this.onUpdateGameMode(dataObj)};
GameChan.prototype.onUpdateGameMode=function(dataObj){cc.log("onUpdateGameMode "+JSON.stringify(dataObj));this.onPlaySound(dataObj[1]);var oldGameMode=this.data.gM;this.data.gM=dataObj[1].gM;this.data.gSd=dataObj[1].spd.gSd;if(dataObj[1].spd.tft){this.tft=dataObj[1].spd.tft;this.data.tft=dataObj[1].spd.tft}if(oldGameMode!=this.data.gM){var str="B\u00e0n ch\u01a1i \u0111\u00e3 chuy\u1ec3n sang ch\u1ebf \u0111\u1ed9 \u00f9 4-11";if(this.data.gM==GAME_MODE.FREE)str="B\u00e0n ch\u01a1i \u0111\u00e3 chuy\u1ec3n sang ch\u1ebf \u0111\u1ed9 \u00f9 t\u1ef1 do";
this.showSystemNotice(str)}this.gameTopBar.refreshView()};GameChan.prototype.onUpdateGa=function(dataObj){cc.log("onUpdateGa "+JSON.stringify(dataObj));this.onPlaySound(dataObj[1]);this.data.cKM=dataObj[1].cKM;this.gameTopBar.updateChicken();var str;if(this.data.cKM==GA_MODE.GA)str="B\u1eadt G\u00e0";else str="T\u1eaft G\u00e0";if(str)this.showSystemNotice(str)};GameChan.prototype.onServerNotifyResponse=function(dataObj){var type=dataObj[1].t;if(type===3)this.isRegisterQuit=true};
GameChan.prototype.onErrorResponse=function(dataObj){var errorCode=dataObj[1].c;if(errorCode===101)return;cc.log("cmd 1 error show showDialogNotice "+errorCode);var errorStr=ERROR_CMD_CHAN[errorCode];if(errorStr===undefined)return;errorStr=errorStr.msg;var msg=errorStr;var dialog=new MessageOkDialog;dialog.setMessage(msg);dialog.showWithAnimationScale()};
GameChan.prototype.onRoomMasterResponse=function(dataObj){var newMasterUid=dataObj[1].uid;cc.log("chu phong moi la "+dataObj[1].dn+" "+dataObj[1].uid);this.data.ps.forEach(function(value,index){if(value.uid==newMasterUid){value.C=true;value.r=false}else value.C=false});if(this.gameState===4||this.gameState===5);else this.arrangePlayerInGame()};
GameChan.prototype.onReadyResponse=function(dataObj){var uid=dataObj[1].uid;var displayName=dataObj[1].dn;var isReady=dataObj[1].isR;cc.log("PLAYER_READY "+uid+" \x3d\x3e "+displayName);this.data.ps.forEach(function(value,index){if(value.uid==uid)value.r=isReady});var dataplayer=this.getDataPlayerByUid();if(uid==PlayerMe.uid){this.showReady(isReady);if(!isReady){this.readyBt.visible=true;this.readyBt.textureState[0]=PIXI.Texture.fromFrame("button/btn_ready.png");this.readyBt.textureState[1]=PIXI.Texture.fromFrame("button/btn_ready_press.png");
this.readyBt.textureState[2]=PIXI.Texture.fromFrame("button/btn_ready.png");this.readyBt.texture=this.readyBt.textureState[0]}else{this.readyBt.visible=true;this.readyBt.textureState[0]=PIXI.Texture.fromFrame("button/btn_unready.png");this.readyBt.textureState[1]=PIXI.Texture.fromFrame("button/btn_unready_press.png");this.readyBt.textureState[2]=PIXI.Texture.fromFrame("button/btn_unready.png");this.readyBt.texture=this.readyBt.textureState[0]}}if(isReady)this.setStatePlayerChan(uid,state_player.READY);
else this.setStatePlayerChan(uid,state_player.NOTHING)};GameChan.prototype.onInviteResponse=function(dataObj){var listUser=dataObj[1].us;cc.log("LIST_INVITE "+JSON.stringify(listUser));LoadingDialog.getInstance().hide();if(!listUser||!listUser.length){var message="Kh\u00f4ng c\u00f3 ng\u01b0\u1eddi ch\u01a1i \u0111\u1ec3 m\u1eddi";this.showSystemNotice(message)}else this.showInviteDialog(listUser)};
GameChan.prototype.updateGoldAllPlayerFromServer=function(dataObj){var playerArr=dataObj[1].ps;if(playerArr)for(var idx in this.allSlot){var slot=this.allSlot[idx];if(!slot)continue;for(var i=0;i<playerArr.length;i++)if(playerArr[i].uid===slot.uid){this.updateMoneyPlayer(playerArr[i]);slot.setTotalGoldWithEffect(playerArr[i].m);if(slot.uid==PlayerMe.uid)if(playerArr[i].rCP){this.data.tCkP=0;this.gameTopBar.updateChicken()}break}}};
GameChan.prototype.chiabai=function(dataObj){cc.log("debug chiabai");this.stopAllActions();this.arrangePlayerInGame();this.showReady(false);this.clockKick.show(false);this.countDownReady.show(false);this.cardList.removeAll();this.cardOnTable.removeAll();var data;this.startGame();if(TEST_MODE){data=null;StartGameData.cardStilt=1;StartGameData.uidChonCai=this.allSlot[0].uid;StartGameData.turnID=this.allSlot[2].uid;this.listCardTest=[19,19,3,3,8,8,24,24,-1,-1,11,11,12,12,13,13,13,15,22];StartGameData.listCards=
this.listCardTest}else{data=dataObj[1];this.data.gS=GAME_STATE.PLAYING;this.gameState=this.data.gS;this.data.gM=data.gM;this.data.cKM=data.cKM;var vGf=data.vGf;var nVGf=data.nVGf;var cards=data.cs;var cardStilt=data.cC;var uidBocCai=data.sNP;var tP=data.tP;var listPlayer=data.lpi;StartGameData.cardStilt=cardStilt;StartGameData.uidChonCai=uidBocCai;StartGameData.turnID=tP.uid;StartGameData.listCards=cards;this.data.ps.forEach(function(player,index){if(listPlayer.indexOf(player.uid)!==-1)player.pi=
true})}var _data={};_data.timeChooseHost=this.timeBocNoc;_data.timeAminCards=this.tFDC-this.timeBocNoc;this.chiabaiContainer.start(_data);var isShow=false;var str="";var listUidVaoGa=[];var moneyVaoGa=0;if(data&&data.vGf&&data.vGf.ps.length){isShow=true;var uidVaoGaArr=data.vGf.ps;this.data.tCkP=data.vGf.tCkP;this.gameTopBar.updateChicken();listUidVaoGa=uidVaoGaArr;moneyVaoGa=data.vGf.pnt*this.data.b;for(var i=0;i<uidVaoGaArr.length;i++){str+=this.getSlotByUid(uidVaoGaArr[i]).username;if(i<uidVaoGaArr.length-
1)str+=","}if(uidVaoGaArr.length>1)str+=" v\u00e0o g\u00e0, m\u1ed7i ng\u01b0\u1eddi "+data.vGf.pnt+" \u0111i\u1ec3m";else str+=" v\u00e0o g\u00e0 "+data.vGf.pnt+"\u0111i\u1ec3m"}str+="\n";if(data&&data.nVGf&&data.nVGf.ps.length){isShow=true;this.data.tCkP=data.nVGf.tCkP;this.gameTopBar.updateChicken();var uidVaoGaArr=data.nVGf.ps;listUidVaoGa=uidVaoGaArr;moneyVaoGa=data.nVGf.pnt*this.data.b;for(var i=0;i<uidVaoGaArr.length;i++){str+=this.getSlotByUid(uidVaoGaArr[i]).username;if(i<uidVaoGaArr.length-
1)str+=","}if(uidVaoGaArr.length>1)str+=" v\u00e0o g\u00e0, m\u1ed7i ng\u01b0\u1eddi "+data.nVGf.pnt+" \u0111i\u1ec3m";else str+=" v\u00e0o g\u00e0 "+data.nVGf.pnt+"\u0111i\u1ec3m"}if(isShow)this.showSystemNotice(str);if(listUidVaoGa.length>0&&moneyVaoGa!=0)for(var i=0;i<listUidVaoGa.length;i++){var slot=this.getSlotByUid(listUidVaoGa[i]);slot.runChangeGoldEffect(-moneyVaoGa)}};GameChan.prototype.showReady=function(visible){this.readyBt.visible=visible};
GameChan.prototype.hideStartAndReady=function(hide){this.readyBt.visible=hide};
GameChan.prototype.initButton=function(){var thiz=this;var nocContainer=new NocChan(function(){thiz.sendBocBai()});MyPixi.gameContainer.addChild(nocContainer);if(!TEST_MODE)nocContainer.visible=false;var readyBt=MyHelper.createButton(["button/btn_ready.png","button/btn_ready_press.png"],true,function(){thiz.sendStartRequest()});readyBt.position.set(cc.Global.GameView.width/2,-readyBt.height/2+350);MyPixi.gameContainer.addChild(readyBt);var posY=30;var scale=.8;var dX=280;var danhbaiBt=MyHelper.createButton(["button/btn_danh.png",
"button/btn_danh_clicked.png"],true,function(){thiz.sendDanhBai()});danhbaiBt.position.set(cc.winSize.width/2+dX,cc.winSize.height-posY);danhbaiBt.scale.set(scale);MyPixi.gameContainer.addChild(danhbaiBt);var danhbaiTraChiuBt=MyHelper.createButton(["button/btn_danh.png","button/btn_danh_clicked.png"],true,function(){thiz.sendDanhBaiTrachiu()});danhbaiTraChiuBt.position.set(cc.winSize.width/2+dX,cc.winSize.height-posY);danhbaiTraChiuBt.scale.set(scale);MyPixi.gameContainer.addChild(danhbaiTraChiuBt);
var bocBt=MyHelper.createButton(["button/btn_boc.png","button/btn_boc_clicked.png"],true,function(){thiz.sendBocBai()});bocBt.position.set(cc.winSize.width/2+dX,danhbaiBt.y);bocBt.scale.set(scale);MyPixi.gameContainer.addChild(bocBt);var duoiBt=MyHelper.createButton(["button/btn_duoi.png","button/btn_duoi_clicked.png"],true,function(){thiz.sendForward()});duoiBt.position.set(cc.winSize.width/2+dX,danhbaiBt.y);duoiBt.scale.set(scale);MyPixi.gameContainer.addChild(duoiBt);var chiuBt=MyHelper.createButton(["button/btn_chiu.png",
"button/btn_chiu_clicked.png"],true,function(){thiz.sendChiu()});chiuBt.position.set(cc.winSize.width/2-dX/2,danhbaiBt.y);chiuBt.scale.set(scale);MyPixi.gameContainer.addChild(chiuBt);var bochiuBt=MyHelper.createButton(["button/btn_bo_chiu.png","button/btn_bo_chiu_press.png"],true,function(){thiz.sendChiu(true)});bochiuBt.position.set(chiuBt.x-dX/2,danhbaiBt.y);bochiuBt.scale.set(scale);MyPixi.gameContainer.addChild(bochiuBt);var anBt=MyHelper.createButton(["button/btn_an.png","button/btn_an_clicked.png"],
true,function(){thiz.sendAnBai()});anBt.position.set(cc.winSize.width/2-dX,danhbaiBt.y);anBt.scale.set(scale);MyPixi.gameContainer.addChild(anBt);var uBt=MyHelper.createButton("button/btn_u.png",true,function(){thiz.sendU()});uBt.position.set(cc.winSize.width/2-2,cc.winSize.height-142);uBt.displayGroup=MyPixi.cardDragLayer;MyPixi.gameContainer.addChild(uBt);var boUbt=MyHelper.createButton(["button/btn_bou.png","button/btn_bou_clicked.png"],true,function(){thiz.sendBoU()});boUbt.position.set(cc.winSize.width/
2-dX/2,danhbaiBt.y);boUbt.scale.set(scale);MyPixi.gameContainer.addChild(boUbt);var testBt=MyHelper.createButton(["button/bg_btn.png","button/bg_btn_clicked.png"],true,function(){thiz.chiabai()});testBt.position.set(cc.winSize.width-100,cc.winSize.height-40);MyPixi.gameContainer.addChild(testBt);MyHelper.addLblButton(testBt,"Chia",12);testBt.visible=false;var openentDanhBt=MyHelper.createButton(["button/bg_btn.png","button/bg_btn_clicked.png"],true,function(){var xuongDialog=new XuongUdialog;thiz.xuongDialog=
xuongDialog;xuongDialog.show();var data={};data.listCards=[-1,-1,2,2,3,3,4,4,5,5,6,6,6,6,7,7,4,5,4,5];data.listNoc=[-1,1,2,3,4,5,6,7,8,9];xuongDialog.showXuong(true);xuongDialog.showResult(data)});openentDanhBt.position.set(cc.winSize.width-100,cc.winSize.height-460);MyPixi.gameContainer.addChild(openentDanhBt);MyHelper.addLblButton(openentDanhBt,"Oponent Deal",12);openentDanhBt.visible=false;var testAnBt=MyHelper.createButton(["button/bg_btn.png","button/bg_btn_clicked.png"],true,function(){thiz.onAnBaiResponse()});
testAnBt.position.set(100,cc.winSize.height-50);MyPixi.gameContainer.addChild(testAnBt);MyHelper.addLblButton(testAnBt,"\u0102n",12);testAnBt.visible=false;var testChiuBt=MyHelper.createButton(["button/bg_btn.png","button/bg_btn_clicked.png"],true,function(){thiz.onChiuHandler()});testChiuBt.position.set(200,cc.winSize.height-50);MyPixi.gameContainer.addChild(testChiuBt);MyHelper.addLblButton(testChiuBt,"Chiu",12);testAnBt.visible=false;var testShowCardBt=MyHelper.createButton(["button/bg_btn.png",
"button/bg_btn_clicked.png"],true,function(){var data=[];for(var i=0;i<12;i++)data[i]=i;data.push(15);data.push(23);data.push(-1);data.push(20);data.push(20);data.push(-1);data.push(-1);StartGameData.turnID=thiz.allSlot[0].uid;StartGameData.listCards=data;thiz.showMyCards()});testShowCardBt.position.set(cc.winSize.width-100,cc.winSize.height-100);MyPixi.gameContainer.addChild(testShowCardBt);MyHelper.addLblButton(testShowCardBt,"ShowCard",12);testShowCardBt.visible=false;var testChooseHostBt=MyHelper.createButton(["button/bg_btn.png",
"button/bg_btn_clicked.png"],true,function(){thiz.chiabaiContainer.onChooseHost()});testChooseHostBt.position.set(cc.winSize.width/2,cc.winSize.height-30);MyPixi.gameContainer.addChild(testChooseHostBt);MyHelper.addLblButton(testChooseHostBt,"choseHost",12);testChooseHostBt.visible=false;danhbaiTraChiuBt.visible=false;danhbaiBt.visible=false;chiuBt.visible=false;bochiuBt.visible=false;duoiBt.visible=false;bocBt.visible=false;anBt.visible=false;readyBt.visible=false;uBt.visible=false;boUbt.visible=
false;this.boUbt=boUbt;this.uBt=uBt;this.danhbaiTraChiuBt=danhbaiTraChiuBt;this.danhbaiBt=danhbaiBt;this.chiuBt=chiuBt;this.bochiuBt=bochiuBt;this.duoiBt=duoiBt;this.bocBt=bocBt;this.anBt=anBt;this.readyBt=readyBt;this.nocContainer=nocContainer;if(!TEST_MODE){anBt.visible=false;testAnBt.visible=false;testShowCardBt.visible=false;openentDanhBt.visible=false;testChiuBt.visible=false;testChooseHostBt.visible=false}else{anBt.visible=true;testAnBt.visible=true;chiuBt.visible=true;testBt.visible=true;testShowCardBt.visible=
true;openentDanhBt.visible=true;testChiuBt.visible=true;testChooseHostBt.visible=true}var recBt=MyHelper.createButton(["button/bg_btn.png","button/bg_btn_clicked.png"],true,function(){LobbyClient.getInstance().reConnect()});recBt.position.set(50,100);recBt.visible=false;MyPixi.gameContainer.addChild(recBt);MyHelper.addLblButton(recBt,"Rec",12)};
GameChan.prototype.initPlayer=function(){var playerMe=new GamePlayer;playerMe.sitId=0;playerMe.position.set(cc.Global.GameView.width/2-playerMe.widthBG/2,-playerMe.heightBG/2+cc.Global.GameView.height-140);var player1=new GamePlayer;player1.sitId=1;player1.position.set(cc.Global.GameView.width-80-player1.widthBG/2,-player1.heightBG/2+370);var player2=new GamePlayer;player2.sitId=2;player2.position.set(cc.Global.GameView.width/2-player2.widthBG/2,-player2.heightBG/2+cc.Global.GameView.height-630);
var player3=new GamePlayer;player3.sitId=3;player3.position.set(80-player3.widthBG/2,player1.y);this.playerView=[playerMe,player1,player2,player3];if(this.data.Mu==2){this.playerView[1].visible=false;this.playerView[3].visible=false}for(var i=0;i<this.playerView.length;i++){this.playerView[i].displayGroup=MyPixi.gamePlayerLayer;MyPixi.gameContainer.addChild(this.playerView[i])}this.arrangePlayerInGame()};
GameChan.prototype.arrangePlayerInGame=function(arrangeChauRiaOnly){if(TEST_MODE&&this.data.ps.length===1){for(var i=1;i<=3;i++){var newPlayer={"a":"http://s3.api1bai247.info/images/avatar/ava-(4).jpg","pS":0,"C":true,"cTs":[],"dn":"tuan20","pid":1,"m":1E7,"uid":"48f7c55e-1f27-4e37-a4a7-70965006062f","r":false,"As":{"gold":1E7,"chip":0,"vip":0},"cCs":[],"pi":false,"id":0,"sit":0};newPlayer.sit=i;newPlayer.uid="asgasga"+i;newPlayer.C=false;newPlayer.dn="bot "+i;this.data.ps.push(newPlayer)}cc.log("arrangePlayerInGame")}if(this.allSlot&&
this.allSlot.length)this.clearStatePlayer();this.processPlayerPosition(this.data.ps,this.data.gS,arrangeChauRiaOnly);if(TEST_MODE);};GameChan.prototype.updateInfoPlayer=function(player,info,index){player.setEnable(true);player.setUsername(info.usViewName);player.setGold(info.money);if(index===0)player.setMasterRoom(true);else player.setMasterRoom(false)};
GameChan.prototype.isReconnectOrViewer=function(){var players=this.data.players;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].TTID===PlayerMe.uid)meInPlayerList=true;if(meInPlayerList&&this.gameState===GAME_STATE.PLAYING)return true;else return false};
GameChan.prototype.showReadyIfCan=function(igNoreAutoReady){var players=this.data.ps;var isPlaying=this.data.gS>=GAME_STATE.PLAYING?true:false;var meReady=false;var meInPlayerList=false;for(var i=0;i<players.length;i++)if(players[i].uid===PlayerMe.uid){meReady=players[i].r;cc.log("meInPlayerList sit "+players[i].sit);if(players[i].sit<0)meInPlayerList=false;else meInPlayerList=true}if(!meReady&&!isPlaying){this.readyBt.visible=true;cc.log("pending change to readySprite");this.readyBt.textureState[0]=
PIXI.Texture.fromFrame("button/btn_ready.png");this.readyBt.textureState[1]=PIXI.Texture.fromFrame("button/btn_ready_press.png");this.readyBt.textureState[2]=PIXI.Texture.fromFrame("button/btn_ready.png");this.readyBt.texture=this.readyBt.textureState[0];cc.log("ready vao dayyyyyy")}else if(meReady&&!isPlaying){this.readyBt.visible=true;cc.log("pending change to UnreadySprite");this.readyBt.textureState[0]=PIXI.Texture.fromFrame("button/btn_unready.png");this.readyBt.textureState[1]=PIXI.Texture.fromFrame("button/btn_unready_press.png");
this.readyBt.textureState[2]=PIXI.Texture.fromFrame("button/btn_unready.png");cc.log("ready vao dayyyyyy bo san sang");this.readyBt.texture=this.readyBt.textureState[0]}else this.readyBt.visible=false;if(this.gameState==GAME_STATE.PLAYING||!meInPlayerList)this.readyBt.visible=false;cc.log("meInPlayerList "+meInPlayerList);var autoReady=cc.Global.GetSetting(GameSetting.autoReadyChan,false);if(!igNoreAutoReady&&autoReady&&this.gameState!=GAME_STATE.PLAYING&&meInPlayerList&&!meReady)if(!this.handlerGopGaNewGame)this.sendStartRequest()};
GameChan.prototype.getCardWithId=function(cardId){var rankCard=cardId%13+3;if(rankCard>13)rankCard-=13;return{rank:rankCard,suit:Math.floor(cardId/13)}};GameChan.prototype.getCardIdWithRank=function(rank,suit){var rankCard=rank-3;if(rankCard<0)rankCard=13+rankCard;return suit*13+rankCard};
GameChan.prototype.showMyCards=function(){this.clearStatePlayer();this.nocContainer.visible=true;this.nocContainer.resetNewGame();if(!StartGameData.turnID)return;var playerHasTurn=this.getSlotByUid(StartGameData.turnID);if(TEST_MODE)playerHasTurn=PlayerMe;if(playerHasTurn&&PlayerMe.uid==playerHasTurn.uid)this.danhbaiBt.visible=true;StartGameData.listCards=cc.Global.sortChan(StartGameData.listCards);var myCardHand=StartGameData.listCards;var animation=true;if(this.firstTurnDeal)animation=false;else if(playerHasTurn)this.onUpdateTurn(playerHasTurn.uid,
this.timeTurn,true);if(!myCardHand)return;this.cardList.dealCardsChan(myCardHand,animation);this.cardList.refreshNumber()};GameChan.prototype.hideAllBtnPlay=function(){this.bocBt.visible=false;this.duoiBt.visible=false;this.danhbaiBt.visible=false;this.danhbaiTraChiuBt.visible=false;this.anBt.visible=false;this.uBt.visible=false;this.boUbt.visible=false;this.chiuBt.visible=false;this.bochiuBt.visible=false;cc.log("--------fixxxxx hideallbtnPlay")};
GameChan.prototype.updateStateButtonByPlayState=function(data,uidTurn){if(data.uid!==PlayerMe.uid)return;var pS=data.pS;if(pS===PLAYER_STATE.BAT_BAO){this.meGotPunish=true;this.setStatePlayerChan(data.uid,state_player_chan.BAT_BAO);cc.log("--------fixxxxx updateStateButtonByPlayState1");this.hideAllBtnPlay()}cc.log("--------fixxxxx updateStateButtonByPlayState2");this.hideAllBtnPlay();var dataState={};dataState.uid=PlayerMe.uid;var newTurn=false;switch(pS){case PLAYER_STATE.AN:dataState.anBaiDone=
true;break;case PLAYER_STATE.BOC:dataState.bocDone=true;break;case PLAYER_STATE.CHIU:dataState.chiuDone=true;break;case PLAYER_STATE.CO_LUOT:case PLAYER_STATE.DANH:case PLAYER_STATE.DUOI:case PLAYER_STATE.TRA_CUA:dataState.newTurn=true;newTurn=true;case PLAYER_STATE.CHON_CUOC:break;case PLAYER_STATE.CHON_XONG_CUOC:break;case PLAYER_STATE.NONE:dataState.newTurnVan=true;break}this.updateStateButton(dataState,uidTurn,newTurn)};
GameChan.prototype.updateStateButton=function(data,uidTurn,changeturn){cc.log("aaaaa "+JSON.stringify(data));cc.log("--------fixxxxx updateStateButton");this.hideAllBtnPlay();if(data&&data.uid==PlayerMe.uid){this.hideAllBtnPlay();if(changeturn){this.anBt.visible=true;this.bocBt.visible=true}if(data.canChiu){this.chiuBt.visible=true;if(uidTurn===PlayerMe.uid)this.duoiBt.visible=true;this.bochiuBt.visible=true}else if(data.canChiuU){this.boUbt.visible=true;this.uBt.visible=true}else if(data.canU){this.boUbt.visible=
true;this.uBt.visible=true}else if(data.anBaiDone)this.danhbaiBt.visible=true;else if(data.bocDone){this.anBt.visible=true;this.duoiBt.visible=true}else if(data.chiuDone)this.danhbaiTraChiuBt.visible=true;else if(data.newTurnVan)this.danhbaiBt.visible=true}if(this.meGotPunish){cc.log("meGotPunish.......");this.hideAllBtnPlay()}else{if(this.uBt.visible)this.zoomAndHide(this.uBt,-1);if(this.chiuBt.visible){var slot=this.getSlotByUid(PlayerMe.uid);var time=TIME_CHIU*1E3;slot.showTimeRemain(time,time);
this.zoomAndHide(this.chiuBt,TIME_CHIU)}}};GameChan.prototype.onUpdateTurn=function(uid,currentTime,newTurn,data){this.currentTurn=uid;for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid==uid)this.allSlot[i].showTimeRemain(currentTime,this.timeTurn);else this.allSlot[i].stopTimeRemain()};
GameChan.prototype.zoomAndHide=function(btn,time){var num=Math.floor(time/.4);if(this.zoomAndHideAction){this.stopAction(this.zoomAndHideAction);this.zoomAndHideAction=null}btn.scale.set(1,1);var action=cc.sequence(cc.scaleTo(.1,1.05),cc.delayTime(.1),cc.scaleTo(.1,1),cc.delayTime(.1));if(time===-1)this.zoomAndHideAction=this.runAction(btn,cc.repeatForever(action));else this.zoomAndHideAction=this.runAction(btn,cc.repeat(action,num))};
GameChan.prototype.onUpdateTurnNoc=function(uid,currentTime,timeTurn){cc.log("onUpdateTurnNoc uid "+uid+" currentTime "+currentTime+" timeTurn "+timeTurn);for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid===uid)this.allSlot[i].showTimeRemain(currentTime,timeTurn);else this.allSlot[i].stopTimeRemain()};GameChan.prototype.stopTurnTime=function(uid){for(var i=0;i<this.allSlot.length;i++)if(this.allSlot[i].uid===uid){this.allSlot[i].stopTimeRemain();break}};
GameChan.prototype.onStiltResponse=function(data){cc.log("onStiltResponse "+JSON.stringify(data));cc.log(data);if(StartGameData.turnID<0){this.showSystemNotice("\u0110ang ch\u1ecdn n\u1ecdc");return}this.chiabaiContainer.onChooseStilt()};GameChan.prototype.onHostResponse=function(data){cc.log("onHostResponsegi "+JSON.stringify(data));cc.log(data);if(StartGameData.turnID<0){this.showSystemNotice("\u0110ang ch\u1ecdn c\u00e1i");return}this.chiabaiContainer.onChooseHost()};
GameChan.prototype.onAutoChoseCaiResponse=function(data){cc.log("onAutoChoseCaiResponse "+JSON.stringify(data));if(StartGameData.turnID<0){this.showSystemNotice("\u0110ang ch\u1ecdn c\u00e1i");return}this.chiabaiContainer.onChooseHost()};GameChan.prototype.onDataSettingResponse=function(cmd,data){cc.log("onDataSettingResponse "+JSON.stringify(data))};
GameChan.prototype.onPunishResponse=function(dataObj){cc.log("onPunishResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);var uidPunish=data.uid;var isShowPunish=data.iSh;var idPunish=data.rId;var slot=this.getSlotByUid(uidPunish);if(slot.isMe)if(isShowPunish)this.meGotPunish=true;if(!isShowPunish)return;this.setStatePlayerChan(data.uid,state_player_chan.BAT_BAO);var _msgPunish=ERROR_CHAN[idPunish].msg;if(_msgPunish===undefined)_msgPunish="b\u1ecb ph\u1ea1t l\u1ed7i id \x3d "+
idPunish;if(slot.isMe)this.showSystemNotice("B\u1ea1n "+_msgPunish);else this.showSystemNotice(slot.username+" "+_msgPunish)};
GameChan.prototype.onDanhTraChiuResponse=function(dataObj){cc.log("onDanhTraChiuResponse");cc.log(dataObj);var data=dataObj[1];this.onPlaySound(data);if(TEST_MODE){var idRd=Math.floor(Math.random()*4);var tracuaRd=Math.floor(Math.random()*4);var isBoc=Math.floor(Math.random()*2)===1?true:false;if(tracuaRd===idRd)isBoc=true;data={cPr:this.allSlot[idRd].uid,tP:tracuaRd,cs:24,cmd:5010}}var isBoc=data.cPr===data.tP?true:false;var slot=this.getSlotByUid(data.cPr);var slotTracua=this.getSlotByUid(data.tP);
var slotTurn=slotTracua;if(slot){cc.log("sitId danh bai "+slot.sitId);var cards=[];cards.push(data.cs);var isBoc=data.isBoc;if(slot.isMe){this.hideAllBtnPlay();var arr=this.cardList.removeCard(cards);this.cardOnTable.moveOldCard();if(isBoc)this.cardOnTable.addCardsMe(arr,slotTracua.sitId,cc.p(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2),true,true);else this.cardOnTable.addCardsMe(arr,slotTracua.sitId,cc.p(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2),true,true);this.cardList.updateNewListCards(data.listCards,
true);this.cardList.resetChoseCard()}else{this.cardOnTable.moveOldCard();var arr=[];var cardData=data.cs;var card=new CardChan(cardData,null);card.canTouch=false;arr.push(card);card.position.set(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2);var isBoc=false;this.cardOnTable.addCardsMe(arr,slotTracua.sitId,cc.p(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2),true,false)}for(var i=0;i<4;i++)if(i!==slotTracua.sitId){this.cardOnTable.reSizeCardList(i,true,true);this.cardOnTable.removeHightLightAll(i)}}if(slot.isMe)if(slotTurn.isMe){this.bocBt.visible=
false;this.anBt.visible=false;if(!this.meGotPunish)this.duoiBt.visible=true}else{this.bocBt.visible=false;this.anBt.visible=false;this.duoiBt.visible=false}else if(slotTurn.isMe){this.bocBt.visible=false;this.duoiBt.visible=false;if(!this.meGotPunish)this.anBt.visible=true;if(!this.meGotPunish)if(data.isBoc)this.duoiBt.visible=true;else this.bocBt.visible=true}else{this.bocBt.visible=false;this.anBt.visible=false;this.duoiBt.visible=false}var uidCanChiu=data.cHi;if(uidCanChiu&&slotTurn.isMe){_data=
{};_data.uid=uidCanChiu;_data.canChiu=true;this.updateStateButton(_data,slotTurn.uid)}};
GameChan.prototype.onChonCuocResponse=function(dataObj){if(TEST_MODE)dataObj=[5,{"cs":[7,7,14,14,15,15,19,19,20,20,23,23,9,10,16,17,22,21,5,3],"uid":PlayerMe.uid,"rmT":31499,"cmd":5009,"dlT":1500,"nCs":[18,8,12,17,21,18,23,15,23,2,10,11,12,4,22,14,-1,4,17]}];if(this.xuongDialog)return;cc.log("--------fixxxxx onChonCuocResponse");this.hideAllBtnPlay();cc.log("onChonCuocResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);data.listCards=data.cs;data.listNoc=data.nCs;var timeXuong=
data.rmT?Math.floor(data.rmT/1E3):this.timeXuong;var xuongDialog=new XuongUdialog(timeXuong);cc.log("this.timeXuong "+this.timeXuong);this.xuongDialog=xuongDialog;this.xuongDialog.show(false);var slot=this.getSlotByUid(data.uid);var isMe=false;if(slot)isMe=slot.isMe;var timeDelay=data.dlT/1E3;var thiz=this;var cb=cc.callFunc(function(){thiz.hideGameObjWhenChoseCuoc();xuongDialog.show();xuongDialog.showXuong(isMe);xuongDialog.showResult(data)});this.runAction(this,cc.sequence(cc.delayTime(timeDelay),
cb));if(!slot.isMe)this.showSystemNotice("Vui l\u00f2ng ch\u1edd "+slot.username+" x\u01b0\u1edbng c\u01b0\u1edbc");else this.showSystemNotice("B\u1ea1n ch\u1ecdn \u00f9 r\u1ed3i. Vui l\u00f2ng ch\u1edd gi\u00e2y l\u00e1t")};
GameChan.prototype.onUpdateStateWhenU=function(uList){var data={};if(uList){if(uList.indexOf(PlayerMe.uid)!==-1){data.canU=true;data.uid=PlayerMe.uid;this.updateStateButton(data,this.currentTurn);var slot=this.getSlotByUid(PlayerMe.uid);var time=TIME_CHIU*1E3;slot.showTimeRemain(time,time)}else{cc.log("--------fixxxxx onUpdateStateWhenU");this.hideAllBtnPlay()}for(var i=0;i<this.allSlot.length;i++)if(uList.indexOf(this.allSlot[i].uid)==-1)this.allSlot[i].stopTimeRemain(false)}};
GameChan.prototype.onU=function(dataObj){cc.log("onU "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);var uList=data.ps;var userIdBoU=data.iNFP;this.onUpdateStateWhenU(uList);if(userIdBoU);};
GameChan.prototype.onChangeTurn=function(dataObj){if(TEST_MODE)dataObj=[5,{"fP":{"uid":this.allSlot[2].uid,"pS":4,"dCS":0},"cmd":5002,"tP":{"cs":0,"uid":PlayerMe.uid,"pS":1,"cHi":false,"cFL":true}}];cc.log("checkRes onChangeTurn "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);this.onUpdateTurn(data.tP.uid,this.timeTurn,true,null);cc.log("--------fixxxxx onChangeTurn");this.hideAllBtnPlay();data.tP.canChiu=data.tP.cHi;if(data.tP.cFL){data.tP.canChiu=false;data.tP.canU=data.tP.cFL}if(data.tP.canChiu&&
data.tP.uid==PlayerMe.uid){this.hideAllBtnPlay();this.chiuBt.visible=true;this.bochiuBt.visible=true;this.bocBt.visible=true;if(this.meGotPunish)this.hideAllBtnPlay();else if(this.chiuBt.visible){this.zoomAndHide(this.chiuBt,TIME_CHIU);var slot=this.getSlotByUid(PlayerMe.uid);var time=TIME_CHIU*1E3;slot.showTimeRemain(time,time)}}else this.updateStateButtonByPlayState(data.tP,data.tP.uid)};GameChan.prototype.onPlaySound=function(data){if(!data)return;var sZz=data.sZz;if(sZz!=-2&&sZz)this.playSoundAction(SOUND_CHAN[sZz.toString()])};
GameChan.prototype.playSoundAction=function(nameSound){if(!cc.Global.GetSetting(GameSetting.sound,true))return;MH.playSound("./sound/sound_chan/"+nameSound+".mp3")};
GameChan.prototype.onDanhBaiResponse=function(dataObj){this.firstTurnDeal=true;cc.log("onDanhBaiResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);if(TEST_MODE)data={"cs":this.cardList.getCardSelected().idCard,"uid":this.allSlot[0].uid,"cmd":5013};var slot=this.getSlotByUid(data.uid);if(slot){cc.log("sitId danh bai "+slot.sitId);slot.stopTimeRemain();var cards=[];cards.push(data.cs);var isBoc=false;if(slot.isMe){var arr=this.cardList.removeCard(cards);this.cardOnTable.moveOldCard();
this.cardOnTable.addCardsMe(arr,slot.sitId,this.cardList.deckPoint,true,true);this.cardList.updateNewListCards(data.listCards,true);this.cardList.resetChoseCard();for(var i=0;i<arr.length;i++)arr[i].showHighLight(true)}else{this.cardOnTable.moveOldCard();var arr=this.cardOnTable.addCardsOponent(cards,slot.sitId,cc.p(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2),isBoc,true);for(var i=0;i<arr.length;i++)arr[i].showHighLight(true)}for(var i=0;i<4;i++)if(i!==slot.sitId){this.cardOnTable.reSizeCardList(i,
true,true);this.cardOnTable.removeHightLightAll(i)}}};
GameChan.prototype.onAnBaiResponse=function(dataObj){cc.log("debug onAnBaiResponse "+JSON.stringify(dataObj));var data;if(TEST_MODE){var idRd=Math.floor(Math.random()*4);var isBoc=Math.floor(Math.random()*2)===1?true:false;isBoc=false;if(idRd===0)data={uid:this.allSlot[idRd].uid,cTc:0,cOH:this.cardList.getCards()[0].idCard,"iFN":isBoc};else data={uid:this.allSlot[idRd].uid,cTc:16,cOH:16,"iFN":isBoc}}else data=dataObj[1];this.onPlaySound(data);if(!TEST_MODE){this.onUpdateTurn(data.uid,this.timeTurn,
false);cc.log("--------fixxxxx onAnBaiResponse");this.hideAllBtnPlay()}var slot=this.getSlotByUid(data.uid);cc.log(slot.uid+" player earn card "+slot.username);if(slot){var cards=[];cards.push(data.cOH);var isBoc=data.iFN;if(slot.isMe){var earnIdList=slot.sitId;if(!isBoc){cc.log(slot.uid+"getSlotBeforeByIndexId "+slot.index);var slotBefore=this.getSlotBeforeByIndexId(slot.index);if(slotBefore)earnIdList=slotBefore.sitId;else{cc.log("error: ko tim thay earnIdList player cos turn truoc day");return}}var arr1=
this.cardOnTable.getCardEarn(earnIdList);var arr=this.cardList.getCard(cards);var earnArr=arr.concat(arr1);this.cardEarnList[slot.sitId].addCardGroup(earnArr,this.cardList.deckPoint);this.cardEarnList[slot.sitId].reOrder(true);this.danhbaiBt.visible=true;this.cardList.updateNewListCards(data.listCards,true);this.cardList.resetChoseCard()}else{var earnIdList=slot.sitId;if(!isBoc){var slotBefore=this.getSlotBeforeByIndexId(slot.index);if(slotBefore)earnIdList=slotBefore.sitId;else{cc.log("error: ko tim thay earnIdList player cos turn truoc day");
return}}var earnArr=[];var cardData=data.cOH;var card=new CardChan(cardData,null);card.canTouch=false;card.position.set(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2);this.cardOnTable.addChild(card);earnArr.push(card);var arr1=this.cardOnTable.getCardEarn(earnIdList);cc.log("arr1 "+arr1);earnArr=earnArr.concat(arr1);cc.log("earnArr "+earnArr);this.cardEarnList[slot.sitId].addCardGroup(earnArr,this.cardList.deckPoint);this.cardEarnList[slot.sitId].reOrder(true)}}};
GameChan.prototype.onWinResponse=function(cmd,data){};GameChan.prototype.onForwardResponse=function(dataObj){cc.log("onForwardResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);this.duoiBt.visible=false;this.chiuBt.visible=false};
GameChan.prototype.onChiuResponse=function(dataObj){cc.log("checkRes onChiuResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);if(data.uid===PlayerMe.uid){if(data.t===1)data.canChiu=true;cc.log(this.getDataPlayerByUid(data.uid).dn+" okkkkkk onChiuResponse canchiu "+data.cHi+" canU flase");this.updateStateButton(data,this.currentTurn)}else this.showSystemNotice("C\u00f3 ng\u01b0\u1eddi ch\u1edd ch\u00edu. Vui l\u00f2ng \u0111\u1ee3i");if(data.t===2)this.onChiuHandler(data);
if(data.vGf&&data.vGf.ps.length){var uidVaoGaArr=data.vGf.ps;this.data.tCkP=data.vGf.tCkP;this.gameTopBar.updateChicken();var str="";for(var i=0;i<uidVaoGaArr.length;i++){str+=this.getSlotByUid(uidVaoGaArr[i]).username;if(i<uidVaoGaArr.length-1)str+=","}if(uidVaoGaArr.length>1)this.showSystemNotice(str+" v\u00e0o g\u00e0, m\u1ed7i ng\u01b0\u1eddi "+data.vGf.pnt+"\u0111i\u1ec3m");else this.showSystemNotice(str+" v\u00e0o g\u00e0 "+data.vGf.pnt+"\u0111i\u1ec3m");var moneyVaoGa=data.vGf.pnt*this.data.b;
if(uidVaoGaArr.length>0&&moneyVaoGa!=0)for(var i=0;i<uidVaoGaArr.length;i++){var slot=this.getSlotByUid(uidVaoGaArr[i]);slot.runChangeGoldEffect(-moneyVaoGa)}}};
GameChan.prototype.onChiuHandler=function(data){cc.log("onChiuHandler");this.onPlaySound(data);if(TEST_MODE){var idRd=Math.floor(Math.random()*4);var isBoc=Math.floor(Math.random()*2)===1?true:false;if(idRd===0)data={uid:this.allSlot[idRd].uid,cs:-1,"isBoc":isBoc};else data={uid:this.allSlot[idRd].uid,cs:-1,"isBoc":isBoc}}var slot=this.getSlotByUid(data.uid);if(slot){this.onUpdateTurn(slot.uid,this.timeTurn);var cards=[];cards.push(data.cs);var isBoc=data.isBoc;if(slot.isMe){cc.log("--------fixxxxx onChiuHandler");
this.hideAllBtnPlay();this.danhbaiTraChiuBt.visible=true;var earnIdList=slot.sitId;var arr1=this.cardOnTable.getCardEarnChiu(data.cs);var arr=this.cardList.getAllCardsWithId(cards);var earnArr=arr.concat(arr1);this.cardEarnList[slot.sitId].addCardGroup(earnArr,this.cardList.deckPoint);this.cardEarnList[slot.sitId].reOrder(true);this.danhbaiBt.visible=true;this.cardList.removeCard(arr);this.cardList.updateNewListCards(data.listCards,true);this.cardList.resetChoseCard()}else{var earnArr=[];for(var k=
0;k<3;k++){var cardData=data.cs;var card=new CardChan(cardData,null);card.canTouch=false;card.setName(data.cs.toString());card.position.set(slot.x+slot.widthBG/2,slot.y+slot.heightBG/2);this.cardOnTable.addChild(card);earnArr.push(card)}var arr1=this.cardOnTable.getCardEarnChiu(data.cs);earnArr=earnArr.concat(arr1);this.cardEarnList[slot.sitId].addCardGroup(earnArr,this.cardList.deckPoint);this.cardEarnList[slot.sitId].reOrder(true)}}};
GameChan.prototype.onBocBaiResponse=function(dataObj){cc.log("checkRes onBocBaiResponse "+JSON.stringify(dataObj));var data=dataObj[1];this.onPlaySound(data);if(TEST_MODE){var idRd=Math.floor(Math.random()*4);data={uid:this.allSlot[idRd].uid,cs:24,"nSz":10}}if(data.vGf){var uidVaoGaArr=data.vGf.ps;this.data.tCkP=data.vGf.tCkP;this.gameTopBar.updateChicken();var str="";for(var i=0;i<uidVaoGaArr.length;i++){str+=this.getSlotByUid(uidVaoGaArr[i]).username;if(i<uidVaoGaArr.length-1)str+=","}if(uidVaoGaArr.length>
1)this.showSystemNotice(str+" v\u00e0o g\u00e0, m\u1ed7i ng\u01b0\u1eddi "+data.vGf.pnt+" \u0111i\u1ec3m");else this.showSystemNotice(str+" v\u00e0o g\u00e0 "+data.vGf.pnt+" \u0111i\u1ec3m");var moneyVaoGa=data.vGf.pnt*this.data.b;if(uidVaoGaArr.length>0&&moneyVaoGa!=0)for(var i=0;i<uidVaoGaArr.length;i++){var slot=this.getSlotByUid(uidVaoGaArr[i]);slot.runChangeGoldEffect(-moneyVaoGa)}}if(data.nSz>0){this.nocContainer.visible=true;this.nocContainer.updateTotalNoc(data.nSz)}this.onUpdateTurn(data.uid,
this.timeTurn,false,null);this.bocBt.visible=false;if(TEST_MODE)this.chiuBt.visible=true;var slot=this.getSlotByUid(data.uid);cc.log("checkRes onBocBaiResponse "+slot.username);var isboc=true;if(slot){var cards=[];cards.push(data.cs);if(slot.isMe){if(data.canChiu)this.anBt.visible=true;if(!this.meGotPunish)this.duoiBt.visible=true;this.cardOnTable.moveOldCard();var cardBoc=this.cardOnTable.addCardBocMe([data.cs],slot.sitId,this.nocContainer.getPosition(),isboc,true);cardBoc.showHighLight(true)}else{this.cardOnTable.moveOldCard();
var arr=this.cardOnTable.addCardsOponent(cards,slot.sitId,this.nocContainer.getPosition(),isboc,true);for(var i=0;i<arr.length;i++)arr[i].showHighLight(true)}for(var i=0;i<4;i++)if(i!==slot.sitId){this.cardOnTable.reSizeCardList(i,true,true);this.cardOnTable.removeHightLightAll(i)}}var _data={};_data.uid=data.uid;if(data.cHi)_data.canChiu=data.cHi;if(data.cFL){_data.canChiu=false;_data.canU=data.cFL}if(!data.cFL&&!data.cHi)_data.bocDone=true;cc.log(this.getDataPlayerByUid(data.uid).dn+" okkkkkk onBoc canchiu "+
data.cHi+" canU "+data.cFL);this.updateStateButton(_data,data.uid)};
GameChan.prototype.onEndGameResponse=function(dataObj){cc.log("onEndGameResponse "+JSON.stringify(dataObj));var data=dataObj[1];var uidXuong=data.xCP;var finishType=data.fNT;var maLoi=data.mTk;var cuocsai=data.wCs;var cuocthieu=data.mCs;var cuocXuong=data.lC;var isAnGa=data.iECJ;var lBb=data.lBb;var cuocHo=[];var userNameDenlang=lBb?this.getSlotByUid(lBb.uid).username:null;var ps=data.ps;var error_code=lBb?lBb.mTk:null;cc.log("--------fixxxxx onEndGameResponse");this.hideAllBtnPlay();this.stopAllSlotTimeTurn();
if(this.xuongDialog)this.xuongDialog.hideXuongTable();var thiz=this;ps.forEach(function(value,index){var slot=thiz.getSlotByUid(value.uid);if(slot)value.dn=slot.username});this.nocContainer.updateTotalNoc(0);if(data.ldc)this.nocContainer.addCardRemainEndGme(data.ldc);if(!uidXuong||finishType===3)this.showDrawLbl();var nameCuocStr="";if(uidXuong){var slotWin=this.getSlotByUid(uidXuong);var strWin=slotWin.username+" \u00f9 : ";if(cuocXuong)for(var i in cuocXuong){cuocHo.push(XUONG_CHAN[cuocXuong[i].toString()]);
var nameCuoc=s_xuong_u_content[cuocXuong[i].toString()];if(!nameCuoc)nameCuoc=s_xuong_u_content_repsonse[cuocXuong[i].toString()];nameCuocStr+=nameCuoc+" "}var strPoint="";if(data.pnt){strPoint=data.pnt+" \u0111i\u1ec3m ";if(data.cKPt>0){strPoint=data.pnt+data.cKPt+" \u0111i\u1ec3m ";strPoint+=" "+Math.floor(data.cKPt/5)+" G\u00e0"}}var cuocSaiStr="";if(cuocsai&&cuocsai.length>0){cuocSaiStr="C\u01b0\u1edbc sai: ";for(var i in cuocsai){var nameCuoc=s_xuong_u_content[cuocsai[i].toString()];if(!nameCuoc)nameCuoc=
s_xuong_u_content_repsonse[cuocsai[i].toString()];cuocSaiStr+=nameCuoc+" "}}else cuocSaiStr="";var cuocthieuStr="";if(cuocthieu&&cuocthieu.length>0){cuocthieuStr="C\u01b0\u1edbc thi\u1ebfu: ";for(var i in cuocthieu){var nameCuoc=s_xuong_u_content[cuocthieu[i].toString()];if(!nameCuoc)nameCuoc=s_xuong_u_content_repsonse[cuocthieu[i].toString()];cuocthieuStr+=nameCuoc+" "}}var cuocLoiStr="";if(maLoi){cuocLoiStr="L\u1ed7i : ";var loiStr=ERROR_CHAN[maLoi].msg;if(loiStr===undefined)loiStr="m\u00e3 l\u1ed7i \x3d "+
maLoi+"";if(maLoi==1)loiStr+=" ";else if(maLoi==102)loiStr+="  (\u0111\u1ec1n 11 \u0111i\u1ec3m)";else loiStr+="  (\u0111\u1ec1n 17 \u0111i\u1ec3m)";if(this.data.gM===GAME_MODE.IS_411)if(data.pnt<4&&(maLoi==1||maLoi==102))loiStr=" \u00f9 d\u01b0\u1edbi 4 \u0111i\u1ec3m (\u0111\u1ec1n 11 \u0111i\u1ec3m)";cuocLoiStr+=loiStr}var denlangStr="";if(error_code&&lBb&&lBb.uid==uidXuong){cuocLoiStr="";var errorStr=ERROR_CHAN[error_code].msg;if(errorStr===undefined)errorStr="m\u00e3 l\u1ed7i \x3d "+error_code+
"";denlangStr=userNameDenlang+" \u0111\u1ec1n l\u00e0ng 17 \u0111i\u1ec3m l\u1ed7i  "+errorStr}var messAnGa="";if(isAnGa){var moneyGaEarn=cc.Global.NumberFormat1(data.eCJM);messAnGa=slotWin.username+" \u0103n g\u00e0 "+moneyGaEarn;this.data.tCkP=0;this.gameTopBar.updateChicken()}else messAnGa="";this.tableResult.showKQLabel(strWin,strPoint,cuocSaiStr,cuocLoiStr,cuocthieuStr,denlangStr,messAnGa,cuocHo,ps,this);this.tableResult.setXuongCuoc(nameCuocStr)}this.data.ps.forEach(function(value,index){value.r=
false});var thiz=this;var delay=cc.delayTime(this.tfeg);var cb=function(){thiz.handlePendingBack();cc.log("debug handlePendingBack done");thiz.resetNewGame();thiz.arrangePlayerInGame();if(thiz.xuongDialog){thiz.xuongDialog.hide();thiz.xuongDialog=null}for(var i=0;i<thiz.allSlot.length;i++)for(var j=0;j<ps.length;j++)if(thiz.allSlot[i].uid===ps[j].uid){thiz.allSlot[i].runChangeGoldEffect(ps[j].mX);break}if(thiz.handlerGopGaNewGame){thiz.handlerGopGaNewGame();thiz.handlerGopGaNewGame=null}};var callFun=
cc.callFunc(cb);this.runAction(this,cc.sequence(delay,callFun));cc.log("delay "+this.tfeg+" then resetgame")};GameChan.prototype.showDrawLbl=function(){if(this.lblDraw){this.lblDraw.parent.removeChild(this.lblDraw);this.lblDraw=null}this.lblDraw=new cc.LabelTTF("Ho\u00e0 c\u1ea3 l\u00e0ng",cc.res.font.Netmuc,50,null,"yellow");this.lblDraw.anchor.set(.5,.5);this.lblDraw.position.set(cc.Global.designGame.width/2,270);MyPixi.gameContainer.addChild(this.lblDraw);this.lblDraw.displayGroup=MyPixi.animationLayer};
GameChan.prototype.sendStartRequest=function(){cc.log("send ready ");var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":Constant.CMD_RESULT.PLAYER_READY}];LobbyClient.getInstance().send(sendObj)};GameChan.prototype.sendChoseStitlRequest=function(){cc.log("sendChoseStitlRequest ");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.CHOSE_NOC}];LobbyClient.getInstance().send(msg)};
GameChan.prototype.sendChoseHostRequest=function(){cc.log("sendChoseHostRequest ");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.CHOSE_CAI}];LobbyClient.getInstance().send(msg)};GameChan.prototype.sendU=function(isU){cc.log("sendU "+isU);var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.U,"iFL":isU}];LobbyClient.getInstance().send(msg)};
GameChan.prototype.sendBoU=function(){cc.log("sendBoU ");cc.log("--------fixxxxx sendBoU");this.uBt.visible=false;this.boUbt.visible=false;if(this.currentTurn>0){var slot=this.getSlotByUid(this.currentTurn);if(slot&&slot.isMe)this.duoiBt.visible=true}this.sendU(false)};
GameChan.prototype.sendChiu=function(isBoChiu){cc.log("sendChiu ");if(TEST_MODE){this.onChiuResponse([5,{}]);return}var value=isBoChiu?false:true;var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.CHIU,igC:value}];LobbyClient.getInstance().send(msg)};
GameChan.prototype.sendAnBai=function(){cc.log("sendAnBai ");if(TEST_MODE){this.onAnBaiResponse([5,{}]);return}var card=this.cardList.getCardSelected();this.cardSelected=card;if(card){var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.AN,"cOH":card.idCard}];LobbyClient.getInstance().send(msg)}else this.showSystemNotice("B\u1ea1n ph\u1ea3i ch\u1ecdn qu\u00e2n b\u00e0i tr\u00ean tay \u0111\u1ec3 \u0103n")};
GameChan.prototype.sendDanhBaiTrachiu=function(){if(TEST_MODE){this.onDanhBaiResponse([5,{}]);return}if(this.cardList.chosenCardId<0||this.cardList.chosenCardId>=this.cardList.length)return;var card=this.cardList.getCardSelected();if(card){cc.log("sendDanhBaiTrachiu ");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.TRA_CUA,"dCS":card.idCard}];LobbyClient.getInstance().send(msg)}else this.showSystemNotice("B\u1ea1n ph\u1ea3i ch\u1ecdn qu\u00e2n b\u00e0i")};
GameChan.prototype.sendDanhBai=function(){if(TEST_MODE){this.onDanhBaiResponse([5,{}]);return}var card=this.cardList.getCardSelected();if(card){cc.log("sendDanhBai ");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.DANH,"dCS":card.idCard}];LobbyClient.getInstance().send(msg)}else this.showSystemNotice("B\u1ea1n ch\u01b0a ch\u1ecdn qu\u00e2n n\u00e0o \u0111\u1ec3 \u0111\u00e1nh")};
GameChan.prototype.sendBocBai=function(){if(TEST_MODE){this.onBocBaiResponse([5,{}]);return}cc.log("sendBocBai ");var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.BOC}];LobbyClient.getInstance().send(msg)};GameChan.prototype.sendForward=function(){if(TEST_MODE){this.onForwardResponse();return}var msg=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":CMD_CHAN.DUOI}];LobbyClient.getInstance().send(msg)};
GameChan.prototype.checkMeIsPlaying=function(){var listPlaying=this.data.ps;if(this.gameState===GAME_STATE.PLAYING)for(var i=0;i<listPlaying.length;i++)if(listPlaying[i].uid===PlayerMe.uid&&listPlaying[i].pi)return true;return false};GameChan.prototype.handlePendingBack=function(){if(this.registerQuit){if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom();cc.log("debug send quit")}};
GameChan.prototype.backButtonClickHandler=function(forceQuit){if(TEST_MODE){LobbyClient.getInstance().quitRoomGameChan();return}cc.log("click quit room GameChan");cc.log(forceQuit+"click quit room gamechan "+this.checkMeIsPlaying());if(!forceQuit&&this.checkMeIsPlaying()){this.registerQuit=!this.registerQuit;if(this.registerQuit)this.showSystemNotice("B\u1ea1n \u0111\u0103ng k\u00fd tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");else this.showSystemNotice("B\u1ea1n hu\u1ef7 tho\u00e1t b\u00e0n khi v\u00e1n ch\u01a1i k\u1ebft th\u00fac");
return}if(!LoadingDialog.getInstance().isShow())LoadingDialog.getInstance().show();LobbyClient.getInstance().quitRoom()};
GameChan.prototype.updateGame=function(data,dataReconnect){cc.log("updateGame "+JSON.stringify(data));var thiz=this;if(data.nSz>0){this.nocContainer.visible=true;this.nocContainer.updateTotalNoc(data.nSz)}var currentPlayer=data.cP;if(currentPlayer){this.currentTurn=currentPlayer;var timeRemain=data.tRMT;this.onUpdateTurn(currentPlayer,timeRemain)}var fistPlayerTurnUid=data.fP;var tFSG=data.tFSG;if(fistPlayerTurnUid&&tFSG){this.hideAllBtnPlay();this.showSystemNotice("\u0110ang chia bai, vui l\u00f2ng ch\u1edd ");
var cb=cc.callFunc(function(){thiz.onUpdateTurn(fistPlayerTurnUid,this.timeTurn,true)});var seq=cc.sequence(cc.delayTime(tFSG/1E3),cb);this.runAction(this,seq)}var fLIf=data.fLIf;if(fLIf){var cs=fLIf.cs;var fP=fLIf.fP;var uList=fLIf.ps;this.onUpdateStateWhenU(uList)}var players=data.ps;var isBoc=false;this.hideAllBtnPlay();for(var i=0;i<players.length;i++){if(players[i].sit==-1)continue;var _player=players[i];var cardAnList=_player.stCs;var cardAnArr=_player.cCs;var cardDanhArr=_player.cTs;var slot=
this.getSlotByUid(_player.uid);var pS=_player.pS;if(pS===PLAYER_STATE.BAT_BAO)this.setStatePlayerChan(_player.uid,state_player_chan.BAT_BAO);if(slot&&slot.uid==PlayerMe.uid){var cs=_player.cs;if(cs)this.cardList.addCardsReconnect(cs,false);if(currentPlayer===PlayerMe.uid)this.updateStateButtonByPlayState(_player,currentPlayer)}if(cardDanhArr&&cardDanhArr.length>0){for(var k in cardDanhArr)cardDanhArr[k]=cardDanhArr[k];this.cardOnTable.addCardsOponent(cardDanhArr,slot.sitId,cc.p(slot.x+slot.widthBG/
2,slot.y+slot.heightBG/2),isBoc,false,true)}var list=this.getCardAn(cardAnList,cardAnArr);if(list&&list.length>0)for(var k in list)this.addCardEarnGroup(list[k],slot)}if(TEST_MODE);};
GameChan.prototype.addCardEarnGroup=function(arrEarnId,slot){if(arrEarnId&&arrEarnId.length>0){var earnArr=[];for(var i=0;i<arrEarnId.length;i++){var cardId=arrEarnId[i];var cardData=cardId;var card=new CardChan(cardData,null);card.displayGroup=MyPixi.cardDragLayer;card.canTouch=false;card.setName(cardId);this.cardOnTable.addChild(card);earnArr.push(card)}this.cardEarnList[slot.sitId].addCardGroup(earnArr,this.cardList.deckPoint);this.cardEarnList[slot.sitId].reOrder(false)}};
GameChan.prototype.getCardAn=function(cardAnList,cardAnArr){if(!cardAnList||!cardAnArr)return null;var arrIndex=[0];var _k=1;var value=cardAnList[_k];for(var i=2;i<cardAnArr.length;i+=2)if(value==cardAnArr[i]){arrIndex.push(i);_k++;value=cardAnList[_k]}arrIndex.push(cardAnArr.length);var arr=[];for(var i=0;i<arrIndex.length-1;i++)arr.push(cardAnArr.slice(arrIndex[i],arrIndex[i+1]).reverse());cc.log(""+JSON.stringify(arr));return arr};
GameChan.prototype.getSlotBeforeByIndexId=function(indexId){var slotKq=null;var slot=this.getSlotByIndex(indexId);if(!slot)return null;var indexTurn=slot.index;if(indexTurn===0){indexTurn=4;while(!slotKq&&indexTurn>0){indexTurn--;slotKq=this.getSlotByIndex(indexTurn)}}else{indexTurn-=1;slotKq=this.getSlotByIndex(indexTurn);while(!slotKq&&indexTurn>0){indexTurn--;slotKq=this.getSlotByIndex(indexTurn)}if(!slotKq){indexTurn=4;while(!slotKq&&indexTurn>0){indexTurn--;slotKq=this.getSlotByIndex(indexTurn)}}}return slotKq};
GameChan.prototype.onUserInOut=function(dataObj){var newPlayer=null;var isJoin=true;var isPlayingPlayerQuit=false;cc.log("onUserInOut"+JSON.stringify(dataObj[1]));if(dataObj[1].t==1){newPlayer=dataObj[1].p;newPlayer["r"]=false;newPlayer["pS"]=0;newPlayer["pi"]=false;newPlayer["rmC"]=0;var length=this.data.ps.length;var isUpdate=false;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.uid===newPlayer.uid){this.data.ps[j]=newPlayer;isUpdate=true;cc.log("onUserInOut full ps "+JSON.stringify(this.data.ps));
break}}if(!isUpdate)this.data.ps.push(newPlayer);if(this.data.gS<GAME_STATE.PLAYING)this.startCockClick(true);var data=dataObj[1];if(data.vGf&&data.vGf.ps.length){var str="";var uidVaoGaArr=data.vGf.ps;for(var i=0;i<uidVaoGaArr.length;i++){str+=this.getSlotByUid(uidVaoGaArr[i]).username;if(i<uidVaoGaArr.length-1)str+=","}if(uidVaoGaArr.length>1)str+=" v\u00e0o g\u00e0, m\u1ed7i ng\u01b0\u1eddi "+data.vGf.pnt+" \u0111i\u1ec3m";else str+=" v\u00e0o g\u00e0 "+data.vGf.pnt+"\u0111i\u1ec3m";this.showSystemNotice(str)}}else if(dataObj[1].t==
2){cc.log("out room"+dataObj[1].p.uid+" "+dataObj[1].p.dn);newPlayer=dataObj[1].p;isJoin=false;var length=this.data.ps.length;for(var j=0;j<length;j++){var el=this.data.ps[j];if(el.pi&&el.uid===dataObj[1].p.uid)isPlayingPlayerQuit=true;if(el.uid===dataObj[1].p.uid){this.data.ps.splice(j,1);cc.log("size new players "+this.data.ps.length);break}}if(this.data.ps.length===1)this.startCockClick(false)}if(this.gameState===4||this.gameState===5)this.arrangePlayerInGame(true);else this.arrangePlayerInGame();
if(this.gameState<4&&dataObj[1].t==1){var data=dataObj[1];if(data.tCkP&&data.p.uid===PlayerMe.uid){var tongGa=data.tCkP;if(tongGa>0)this.showGopGaWhenSit(data)}else if(data.p.uid===PlayerMe.uid)this.showReadyIfCan()}};
GameChan.prototype.processPlayerPosition=function(players,gameState,arrangeChauRiaOnly){var listPlayer=[];var listChauRia=[];var totalPlayer=0;if(gameState<GAME_STATE.PLAYING)for(var i=0;i<players.length;i++){var p=players[i];if(p.sit>=0){totalPlayer++;listPlayer.push(p)}else listChauRia.push(p)}else for(var i=0;i<players.length;i++){var p=players[i];if(p.pi){totalPlayer++;listPlayer.push(p)}else listChauRia.push(p)}if(listPlayer&&listPlayer.length>0&&!arrangeChauRiaOnly){var userList=listPlayer;
this.setPlayerWithPosition(userList);for(var i=0;i<this.allSlot.length;i++){this.allSlot[i].setEnable(false);this.allSlot[i].reset()}var ownerPlayer=null;for(var i=0;i<userList.length;i++){var idx=userList[i].sit;cc.log("DEBUG "+idx+" \x3d\x3e "+userList[i].uid);this.allSlot[idx].setDataPlayer(userList[i]);this.allSlot[idx].setEnable(true);this.allSlot[idx].setIndex(idx);this.allSlot[idx].setUid(userList[i].uid);this.allSlot[idx].setUsername(userList[i].dn);this.allSlot[idx].setGold(Math.floor(userList[i].m));
this.allSlot[idx].setAvatar(userList[i].a);if(gameState<4)this.allSlot[idx].setState(userList[i].r?state_player.READY:state_player.NOTHING);if(PLAYER_STATE.BAT_BAO==userList[i].pS)this.allSlot[idx].setState(state_player.BAT_BAO);this.allSlot[idx].stopTimeRemain();this.allSlot[idx].showChauRia(false);if(this.allSlot[idx].uid===PlayerMe.uid)this.allSlot[idx].isMe=true;else this.allSlot[idx].isMe=false;if(userList[i].C)ownerPlayer=userList[i]}this.updateOwner(ownerPlayer)}for(var j=0;j<this.allSlot.length;j++){var slot=
this.allSlot[j];if(slot.index===-1&&slot.isChauRia()){slot.setEnable(false);slot.showChauRia(false)}}if(listChauRia&&listChauRia.length>0){var userList=listChauRia;var _index=0;for(var i=0;i<listChauRia.length;i++){var user=listChauRia[i];for(var j=_index;j<this.allSlot.length;j++){var slot=this.allSlot[j];if(slot.index===-1&&!slot.isChauRia()){_index=j+1;slot.setDataPlayer(user);slot.setEnable(true);slot.setIndex(-1);slot.setUid(user.uid);slot.setUsername(user.dn);slot.setGold(Math.floor(user.m));
slot.setState(state_player.NOTHING);slot.stopTimeRemain();slot.showChauRia(true);slot.setAvatar(user.a);if(slot.uid===PlayerMe.uid)slot.isMe=true;else slot.isMe=false;break}}}}};function statusChangeCallback(response){console.log("statusChangeCallback");console.log(response);if(response.status==="connected")MiniGameClient.getInstance().postEvent(kCMD.FB_LIBS_SUCCESS,{});else if(response.status==="not_authorized");else;}function checkLoginState(){FB.getLoginStatus(function(response){statusChangeCallback(response)})}window.fbAsyncInit=function(){FB.init({appId:gts_congfig.getFBID(),xfbml:true,version:"v2.7"});FB.getLoginStatus(function(response){statusChangeCallback(response)})};
(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//connect.facebook.net/en_US/sdk.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-jssdk");window.AccountKit_OnInteractive=function(){AccountKit.init({appId:"1998966383739995",state:"cc2adc47244fdda8451c57b19e88d353",version:"v1.1",fbAppEventsEnabled:true,display:"modal",debug:true})};
(function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(d.getElementById(id))return;js=d.createElement(s);js.id=id;js.src="//sdk.accountkit.com/vi_VN/sdk.js";fjs.parentNode.insertBefore(js,fjs)})(document,"script","facebook-accountkit");function testAPI(){console.log("Welcome!  Fetching your information.... ");FB.api("/me",function(response){console.log("Successful login for: "+response.name)})};var MyTopHu=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
function TopHu(){this.element=$("#topHu-wrap");this.crBet=1E3;this.listHu={};this.isSuccess=false;this.onOpen=false;this.gameList={};this.setElm2=false;this.init();var target=MyTopHu.getInstance();target.currentTarget=this;TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onupdate,target)}
TopHu.prototype._onupdate=function(cmd,data){var thiz=this.currentTarget;var sortable=[];thiz.lastData=data;if(thiz.isSuccess===false){thiz.isSuccess=true;thiz.element.show();thiz.buildEvent();setTimeout(function(){if(!thiz.onOpen)thiz.open()},3E3)}if(!thiz.setElm2&&!thiz.onOpen)return;if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++){if(data[1].Js[i].b==thiz.crBet&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element"))sortable.push([data[1].Js[i].gid.toString(),
data[1].Js[i].J]);if(thiz.setElm2&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element2")&&thiz.gameList[data[1].Js[i].gid.toString()]["element2"].length)if(data[1].Js[i].b==100)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(0),data[1].Js[i].J);else if(data[1].Js[i].b==1E3)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(1),data[1].Js[i].J);else if(data[1].Js[i].b==1E4)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(2),
data[1].Js[i].J)}if(!thiz.onOpen)return;sortable.sort(function(a,b){return b[1]-a[1]});for(var i=0;i<sortable.length;i++){thiz.drawHu(sortable[i][0],sortable[i][1]);if(thiz.gameList[sortable[i][0]].index!==i){thiz.gameList[sortable[i][0]].element.attr("data-index",i);thiz.gameList[sortable[i][0]].index=i}}};
TopHu.prototype.open=function(){this.onOpen=true;this.element.find(".topHu-inner").show();if(this.lastData){var sortable=[],data=this.lastData,thiz=this;if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].b==thiz.crBet&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element"))sortable.push([data[1].Js[i].gid.toString(),data[1].Js[i].J]);sortable.sort(function(a,b){return b[1]-
a[1]});for(var i=0;i<sortable.length;i++){thiz.drawHu(sortable[i][0],sortable[i][1]);if(thiz.gameList[sortable[i][0]].index!==i){thiz.gameList[sortable[i][0]].element.attr("data-index",i);thiz.gameList[sortable[i][0]].index=i}}}};TopHu.prototype.close=function(){this.onOpen=false;this.element.find(".topHu-inner").hide()};
TopHu.prototype.drawHu=function(element,num){if(typeof element==="string"){var $element=this.gameList[element].element;var $hu=$element.children(".g-hu")}else{var $element=element;var $hu=element}var _old=$element.data("J")||0;$element.data("J",num);MH.realtimeCount(_old,num,$hu,2E3)};
TopHu.prototype.getElement2=function(){var thiz=this;if(MH.currentPage("home")&&$("#content .game-list .list-item\x3ebutton").length){this.setElm2=true;$("#content .game-list .list-item\x3ebutton").each(function(){var $this=$(this);var _gid=$this.data("gid")||"xxx";var $element2=$this.children("span");if(!$element2.length)return;if(SLOT_GAME_MINI.hasOwnProperty(_gid)&&thiz.gameList.hasOwnProperty(SLOT_GAME_MINI[_gid].toString()))thiz.gameList[SLOT_GAME_MINI[_gid].toString()].element2=$element2.show()})}else{this.setElm2=
false;for(var k in thiz.gameList)if(thiz.gameList.hasOwnProperty(k))thiz.gameList[k].element2=[]}this.buildEvent()};
TopHu.prototype.init=function(){var thiz=this;this.gameList[SLOT_GAME_MINI.MINI_POKER.toString()]={"name":"MINIPOKER","icon":"minipoker.png"};this.gameList[SLOT_GAME_MINI.TRUNG_PHUC_SINH.toString()]={"name":"Gems","icon":"gem.png"};this.gameList[SLOT_GAME_MINI.DEADORALIVE.toString()]={"name":"DEAD OR ALIVE","icon":"deadoralive.png"};this.gameList[SLOT_GAME_MINI.GOLDENMONKEY.toString()]={"name":"T\u00c2Y DU K\u00dd","icon":"monkey.png"};this.gameList[SLOT_GAME_MINI.DICEDICE.toString()]={"name":"DICE DICE DICE",
"icon":"dicedicedice.png"};this.gameList[SLOT_GAME_MINI.SIEUXE.toString()]={"name":"MC Queen","icon":"mcqueen.png"};this.element.find(".list-hu").empty();var ii=0;for(var k in this.gameList)if(this.gameList.hasOwnProperty(k)){this.gameList[k].element=$('\x3cdiv data-index\x3d"'+ii+'"\x3e\x3cimg src\x3d"images/tophu/'+this.gameList[k].icon+'"\x3e\x3cspan\x3e'+this.gameList[k].name+'\x3c/span\x3e\x3cspan class\x3d"g-hu"\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(this.element.find(".list-hu"));ii++}jQuery.each(this.gameList,
function(k,v){if(v&&v.hasOwnProperty("element")){var gid=k;v.element.off().on("click",function(){MH.openGame(gid);return false})}});this.element.find(".label-select").html(MH.numToText(this.crBet)).off().on("click",function(){thiz.element.find(".list-option").toggle();return false});this.element.find(".group-btn button").off().on("click",function(){thiz.crBet=parseInt($(this).attr("data-num"));$(this).addClass("active").siblings("button").removeClass("active");return false});this.element.find(".list-option li").off().on("click",
function(){var _num=parseInt($(this).attr("data-num"));thiz.crBet=_num;thiz.element.find(".label-select").html(MH.numToText(_num));thiz.element.find(".list-option").hide();return false});this.element.find(".list-hu-wrap").perfectScrollbar({suppressScrollX:true});this.getElement2();$(window).on("changePage",function(){thiz.getElement2()})};TopHu.prototype.changeBet=function(num){this.crBet=num};
TopHu.prototype.buildEvent=function(){if(!this.lastData)return;var dataTopHu=this.lastData[1].Js||[];if(MH.currentPage("home"))$("#content .game-list .list-item\x3ea").each(function(){var $this=$(this);var _gid=$this.data("gid")||"xxx";for(var i=0;i<dataTopHu.length;i++)if(_gid==dataTopHu[i].gid&&dataTopHu[i].ae){$this.addClass("sk-xn");break}else if(i==dataTopHu.length-1)$this.removeClass("sk-xn")});for(var i=0;i<dataTopHu.length;i++)if(this.gameList.hasOwnProperty(dataTopHu[i].gid.toString()))if(dataTopHu[i].ae)this.gameList[dataTopHu[i].gid.toString()].element.addClass("sk-xn");
else this.gameList[dataTopHu[i].gid.toString()].element.removeClass("sk-xn")};