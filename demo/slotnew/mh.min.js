function chatLayer(){this.elementWrap=jQuery("#content .chat-wrap");this.mesList=this.elementWrap.find(".mes-inner");this.initChat()}
chatLayer.prototype.sendMessage=function(_mes){if(this.listener&&!this.listener.getSlotByUid(PlayerMe.uid)){MessageNode.getInstance().show("Kh\u00f4ng th\u1ec3 tr\u00f2 chuy\u00ean khi ch\u01b0a ng\u1ed3i v\u00e0o b\u00e0n");return}var sendObj=[command.RoomPluginMessage,Constant.CONSTANT.ZONE_NAME,LobbyClient.getInstance().getCurrentRoomId(),{"cmd":102,"mgs":_mes}];LobbyClient.getInstance().send(sendObj)};
chatLayer.prototype.receiveMessage=function(mes,name){this.mesList.append('\x3cp\x3e\x3cspan class\x3d"uname"\x3e'+name+":\x3c/span\x3e"+mes+"\x3c/p\x3e");this.mesList.parent().animate({scrollTop:this.mesList.height()},100)};
chatLayer.prototype.initChat=function(){var thiz=this;this.elementWrap.find(".btn-emo").off().on("click",function(){thiz.elementWrap.removeClass("on-hide");thiz.elementWrap.find(".emo-wrap").toggleClass("show");thiz.elementWrap.find(".auto-wrap").removeClass("show");return false});this.elementWrap.find(".btn-auto").off().on("click",function(){thiz.elementWrap.removeClass("on-hide");thiz.elementWrap.find(".auto-wrap").toggleClass("show");thiz.elementWrap.find(".emo-wrap").removeClass("show");return false});
this.elementWrap.find(".emo-wrap .item").off().on("click",function(){var _emo=jQuery(this).attr("data-emo");if(!_emo)return false;thiz.sendMessage(_emo);thiz.elementWrap.find(".emo-wrap, .auto-wrap").removeClass("show");return false});this.elementWrap.find(".auto-wrap .item").off().on("click",function(){var _mes=jQuery(this).html();if(!_mes)return false;thiz.sendMessage(_mes);thiz.elementWrap.find(".emo-wrap, .auto-wrap").removeClass("show");return false});this.elementWrap.find(".btn-closeChat").off().on("click",
function(){thiz.elementWrap.toggleClass("on-hide");thiz.elementWrap.find(".emo-wrap, .auto-wrap").removeClass("show");return false}).trigger("click");this.elementWrap.find('.form-input input[type\x3d"text"]').off().on("paste keyup",function(e){if(e&&e.keyCode==13){var _mes=jQuery(this).val();if(!_mes)return;thiz.sendMessage(_mes);jQuery(this).val("");thiz.elementWrap.find(".emo-wrap, .auto-wrap").removeClass("show")}});this.elementWrap.show()};var MH={};MH.scale=1;MH.newMessageCount=0;MH.newNotifyCount=0;MH.contentHome="";MH.contentGame="";MH.contentPlay="";MH.contentPopup="";MH.contentHeader="";MH.contentHeaderLogged="";MH.onOpenPopup=false;MH.popup={};
MH.changePage=function(pname,data){var pagesName=["home","game","play","signup","slot"];if(pagesName.indexOf(pname)===-1)return;$("body").removeClass("on-play").attr("data-page",pname).data("crPage",pname);if(!window.ISMOBILE){$("body").height("auto").animate({scrollTop:0},10);setTimeout(function(){$("body").height("100%")},20)}var $content=$("#content");var $topHu;if($("#topHu-wrap").length)$topHu=$("#topHu-wrap").detach();switch(pname){case "home":var $contentHome=$(MH.contentHome);$content.html($contentHome);
document.title="SlotNew2";var bannerSlider=function(){return;if(typeof window.BANNER!=="undefined"&&window.BANNER.length){var _htmlBN="";for(var i=0;i<window.BANNER.length;i++)_htmlBN+='\x3cdiv class\x3d"item"\x3e\x3ca href\x3d"'+(window.BANNER[i].url?window.BANNER[i].url:"javascript:void(0)")+'" target\x3d"_blank"\x3e\x3cimg src\x3d"'+window.BANNER[i].img+'"\x3e\x3c/a\x3e\x3c/div\x3e';$content.find(".wrap-sukien .sukien-content").html(_htmlBN);if(window.BANNER.length>1)$content.find(".wrap-sukien .sukien-content").slick({dots:true,
infinite:true,speed:500,arrows:false,autoplay:true,autoplaySpeed:3500});$content.find(".wrap-sukien").off("click").on("click","a",function(){var _href=$(this).attr("href");if(_href&&_href.indexOf("facebook.com")==-1&&_href.indexOf("http")!=-1){var $popup=$("#popup-webView");$popup.find(".popup-content").html('\x3ciframe src\x3d"'+_href+"\x26displayName\x3d"+PlayerMe.displayName+'"\x3e\x3c/iframe\x3e');MH.popup.open("#popup-webView");return false}return false})}};if(!window.BANNER)if(HostConfig&&HostConfig.ctconfig&&
HostConfig.ctconfig.bannerUrl)$.getJSON(HostConfig.ctconfig.bannerUrl,function(data){if(data&&data.data&&data.data.length){window.BANNER=data.data;bannerSlider()}});else jQuery(window).one("ConfigSuccess",function(){if(MH.currentPage("home")&&HostConfig&&HostConfig.ctconfig&&HostConfig.ctconfig.bannerUrl)$.getJSON(HostConfig.ctconfig.bannerUrl,function(data){if(data&&data.data&&data.data.length){window.BANNER=data.data;bannerSlider()}})});else bannerSlider();$content.find(".game-list").slick({dots:false,
infinite:false,speed:500,arrows:false,autoplaySpeed:3500,slidesToShow:6,slidesToScroll:2,variableWidth:true});var clickToOpen=true;$content.find(".game-list").on("swipe edge beforeChange breakpoint afterChange",function(event,slick,direction){clickToOpen=false;setTimeout(function(){clickToOpen=true},100)});$content.find(".game-list .list-item\x3ebutton").off("click").on("click",function(){var $that=$(this);setTimeout(function(){if(!clickToOpen){clickToOpen=true;return false}$that.addClass("on-click");
setTimeout(function(){$that.removeClass("on-click")},50);MH.openGame($that.data("gname"))},70);return false}).each(function(){var $that=$(this),_key=$that.attr("data-id");$that.removeAttr("data-id");if(Constant.GAME_ID.hasOwnProperty(_key))$that.data("gid",Constant.GAME_ID[_key]).data("gname",_key);else $that.data("gid",_key).data("gname",_key)});if(MyTaiXiu.getInstance().currentTarget)MyTaiXiu.getInstance().currentTarget.getElementQuy2();MH.changeBG("images/background.jpg");break;case "game":$content.html(MH.contentGame);
var gameId=data.gameId?parseInt(data.gameId):1;GameMng.setCurrentGameId(gameId);$("body").attr("data-game",gameId);var gameIcons={3:"images/page-game/icon-game-bacay.png",7:"images/page-game/icon-game-xito.png",4:"images/page-game/icon-game-binh.png",1:"images/page-game/icon-game-tlmn.png",8:"images/page-game/icon-game-phom.png",9:"images/page-game/icon-game-xocdia.png",2:"images/page-game/icon-game-samloc.png",5:"images/page-game/icon-game-lieng.png",6:"images/page-game/icon-game-poker.png",20:"images/page-game/icon-game-chan.png"};
if(Constant.GAME_NAME_ARRAY[gameId]){document.title=Constant.GAME_NAME_ARRAY[gameId]+" - SlotNew2";$("#content \x3ediv\x3e.game-title").append('\x3cimg src\x3d"'+gameIcons[""+gameId]+'"/\x3e')}var $appendTo=$content.find(".select-table-left"),$control=$content.find(".control-right");if(gameId==Constant.GAME_ID.CHAN)$appendTo.children(".table-header").children("div:eq(3)").html("G\u00e0");$appendTo.children(".table-inner").css("position","relative").perfectScrollbar();var _defaultTab=0;var _activeRoom=
0;var changeTab=function(type){if(type!="Chip"&&type!="Gold")return;$control.find(".btn-getTable").removeClass("active");$control.find(".btn-getTable.get-table-"+type.toLowerCase()).addClass("active");$appendTo.addClass("loading").children(".table-inner").attr("data-loading-text","\u0110ang t\u1ea3i ...");LobbyRequest.getInstance().getListTable(gameId,MoneyType[type],function(cmd,data){$appendTo.removeClass("loading");$("body").removeClass("cover-content");if(data&&typeof data=="object"&&data.length==
2)if(data[1]["rs"].length){var _table="\x3ctable\x3e\x3ctbody\x3e";var _filterRoom="";var allBets=[];$.each(data[1]["rs"],function(k,v){if(gameId==Constant.GAME_ID.CHAN){if(allBets.indexOf(this.b)===-1){_filterRoom+='\x3cli data-num\x3d"'+this.b+'"\x3e'+MH.numToText(this.b)+"\x3c/li\x3e";allBets.push(this.b)}var _mems='\x3cdiv class\x3d"mems"\x3e';for(var i=0;i<this.uC;i++)_mems+='\x3cimg src\x3d"images/page-game/1.png"\x3e';for(var i=0;i<this.Mu-this.uC;i++)_mems+='\x3cimg src\x3d"images/page-game/2.png"\x3e';
_mems+="\x3c/div\x3e";_table+='\x3ctr class\x3d"'+(this.Mu>this.uC?"":"is-full")+'" data-num\x3d"'+this.b+'" style\x3d"display:'+(_activeRoom!=0&&this.b!=_activeRoom?"none":"")+';"\x3e\x3ctd\x3e'+(this.rMt.gM==GAME_MODE.FREE?"T\u1ef1 Do":"4-11")+"\x3c/td\x3e\x3ctd\x3e"+MH.numToText(this.b)+'\x3c/td\x3e\x3ctd data-num\x3d"'+this.uC+'" data-max\x3d"'+this.Mu+'"\x3e'+_mems+'\x3c/td\x3e\x3ctd\x3e\x3cimg src\x3d"images/btn_ga_'+(this.rMt.ckM==GA_MODE.GA?"on":"off")+'.png"\x3e\x3c/td\x3e\x3ctd\x3e'+(this.Mu>
this.uC?"C\u00f2n tr\u1ed1ng":"\u0110\u00e3 \u0111\u1ea7y")+"\x3c/td\x3e\x3c/tr\x3e"}else{var _mems='\x3cdiv class\x3d"mems"\x3e';for(var i=0;i<this.uC;i++)_mems+='\x3cimg src\x3d"images/page-game/1.png"\x3e';for(var i=0;i<this.Mu-this.uC;i++)_mems+='\x3cimg src\x3d"images/page-game/2.png"\x3e';_mems+="\x3c/div\x3e";if(this.Mu>9)_mems=this.uC+" / "+this.Mu;_table+='\x3ctr class\x3d"'+(this.Mu>this.uC?"":"is-full")+'" data-num\x3d"'+this.b+'"\x3e\x3ctd\x3e'+(k+1)+"\x3c/td\x3e\x3ctd\x3e"+MH.numToText(this.b)+
'\x3c/td\x3e\x3ctd data-num\x3d"'+this.uC+'" data-max\x3d"'+this.Mu+'"\x3e'+_mems+"\x3c/td\x3e\x3ctd\x3e"+MH.numToText(this.mM)+"\x3c/td\x3e\x3ctd\x3e"+(this.Mu>this.uC?"C\u00f2n tr\u1ed1ng":"\u0110\u00e3 \u0111\u1ea7y")+"\x3c/td\x3e\x3c/tr\x3e"}});_table+="\x3c/tbody\x3e\x3c/table\x3e";var $table=$(_table);if(gameId==Constant.GAME_ID.CHAN){_filterRoom='\x3cul style\x3d"display:none;"\x3e'+_filterRoom+'\x3cli data-num\x3d""\x3eT\u1ea5t c\u1ea3\x3c/li\x3e\x3c/ul\x3e';_filterRoom='\x3cdiv class\x3d"panel-select"\x3e'+
(!_activeRoom?"T\u1ea5t c\u1ea3":MH.numToText(_activeRoom))+"\x3c/div\x3e"+_filterRoom;_filterRoom='\x3cdiv class\x3d"selector-wrap"\x3e'+_filterRoom+"\x3c/div\x3e";$appendTo.prev(".selector-wrap").remove();var $filterRoom=$(_filterRoom);$filterRoom.children(".panel-select").off().on("click",function(){$filterRoom.children("ul").toggle();return false});$filterRoom.find("li").off().on("click",function(){var _num=$(this).attr("data-num");if(!_num){_activeRoom=0;$filterRoom.children(".panel-select").html("T\u1ea5t c\u1ea3");
$filterRoom.children("ul").hide()}else{_num=parseInt(_num);_activeRoom=_num;$filterRoom.children(".panel-select").html(MH.numToText(_num));$filterRoom.children("ul").hide()}changeTab("Gold");return false});$appendTo.before($filterRoom)}$table.find("tr").each(function(index){var $thisTr=$(this);if(data[1]["rs"][index]){var roomInfo=data[1]["rs"][index];$thisTr.off().on("click",function(){if(Constant.GAME_ID_DONE.indexOf(roomInfo.gid)!==-1){var callBack=function(isJoinSuccess,msgError){MH.loadingDialog.hide();
if(isJoinSuccess)MH.changePage("play");if(!isJoinSuccess&&msgError&&msgError.length)MH.createPopup(msgError)};LobbyRequest.getInstance().joinRoom(roomInfo,callBack)}else MH.createPopup("Game n\u00e0y s\u1eafp ra m\u1eaft");return false})}});$appendTo.removeClass("select-table-gold select-table-chip").addClass("select-table-"+type.toLowerCase()).find(".table-inner").html($table).scrollTop(0);$control.find('input[type\x3d"checkbox"]').trigger("change");GameMng.setMoneyType(MoneyType[type])}LobbyClient.getInstance().removeListener(LobbyRequest.getInstance())},
LobbyRequest.getInstance())};changeTab("Chip");$control.find(".btn-getTable").each(function(){var $btn=$(this),_type="Gold";if($btn.hasClass("get-table-chip"))_type="Chip";else if($btn.hasClass("get-table-gold"))_type="Gold";$btn.off().on("click",function(){changeTab(_type);return false})});$control.find('input[type\x3d"checkbox"]').off().on("change",function(){if($(this).prop("checked"))$appendTo.find("tr.is-full").hide();else if(gameId==Constant.GAME_ID.CHAN&&_activeRoom!=0)$appendTo.find("tr.is-full").each(function(){if($(this).attr("data-num")==
_activeRoom)$(this).show()});else $appendTo.find("tr.is-full").show()});$control.find("#btn-createTable").off().on("click",function(){LobbyRequest.getInstance().createTable(function(cmd,dataObj){LobbyClient.getInstance().removeListener(LobbyRequest.getInstance());cc.log("311 \x3d\x3e"+JSON.stringify(dataObj[1]));var mb=dataObj[1].mB;var b=dataObj[1].b;LoadingDialog.getInstance().hide();if(mb===0){var msg="B\u1ea1n kh\u00f4ng \u0111\u1ee7 ti\u1ec1n \u0111\u1ec3 t\u1ea1o b\u00e0n";MH.createPopup(msg)}else if(b&&
b.length){var minB=b[0];var maxB=b[b.length-1];var stepB=b;MH.createTable({min:minB,max:maxB,step:stepB,create:function(data){var moneyBet=data.moneyBet,maxUser=data.maxUser;LobbyRequest.getInstance().okCreateRoomBtnHandler(moneyBet,maxUser)}})}});return false});$control.find("#btn-reloadTable").off().on("click",function(){$control.find(".btn-getTable.active").trigger("click");return false});MH.changeBG("images/page-game/background.jpg");break;case "play":$("body").addClass("on-play");$content.html(MH.contentPlay);
MyPixi.initGame();break;case "slot":$("#style-bigslot").html(data.style);$content.html(data.template);break;default:}if($topHu)$topHu.appendTo("#topHu-container");if(pname!="slot"){$("#style-bigslot").empty();if(BigSlotTarget.getInstance().currentTarget)BigSlotTarget.getInstance().currentTarget.destroyGame()}MH.header.reInit();if(!MH.checkLogin())MH.marquee.append(["Ch\u00e0o m\u1eebng b\u1ea1n \u0111\u1ebfn v\u1edbi LocClub. Vui l\u00f2ng \u0111\u0103ng nh\u1eadp ho\u1eb7c t\u1ea1o t\u00e0i kho\u1ea3n"]);
else MH.marquee.run();MH.sukien.CardGameJackpot.getInfo(function(obj){var arr=[Constant.GAME_ID.TLMN,Constant.GAME_ID.PHOM,Constant.GAME_ID.SAM,Constant.GAME_ID.MAUBINH];if(obj&&obj.UAMSCardGameJackpot&&obj.UAMSCardGameJackpot.data&&obj.UAMSCardGameJackpot.data&&obj.UAMSCardGameJackpot.data.jackpot){var pname=MH.currentPage();if(pname=="home")$("#content .game-list .list-item\x3ebutton").each(function(){var _gid=$(this).data("gid");if(arr.indexOf(_gid)!=-1)$(this).addClass("sk-cardjackpot")});else if(pname==
"game"&&data.gameId&&arr.indexOf(data.gameId)!=-1){var $btnJackPot=jQuery('\x3cbutton class\x3d"btn-jackpot"\x3e\x3cimg src\x3d"images/sukien/nohu.png"\x3e\x3c/button\x3e');$btnJackPot.appendTo($content.children());$btnJackPot.off().on("click",function(){MH.popup.open("#popup-jackpotCard")})}else if(pname=="play"){var gid=$("body").attr("data-game");if(arr.indexOf(parseInt(gid))==-1)return;$("#mainCanvas").siblings(".btn-jackpot").remove();$('\x3cbutton class\x3d"btn-jackpot"\x3e\x3cimg src\x3d"images/sukien/nohu-intable.png"\x3e\x3cspan\x3e'+
MH.numToText(obj.UAMSCardGameJackpot.data.jackpot,1)+"\x3c/span\x3e\x3c/button\x3e").off("click").on("click",function(){MH.popup.open("#popup-jackpotCard")}).insertAfter("#mainCanvas");JackpotCardPlugin.getInstance().oldJackPot=obj.UAMSCardGameJackpot.data.jackpot;JackpotCardPlugin.getInstance().elmJackPot=$("#mainCanvas").siblings(".btn-jackpot").children("span");JackpotCardPlugin.getInstance().register()}}});$(window).trigger("changePage")};
MH.changeBG=function(_url,_option){var $wrap=$("#bg-wrap");var arrBG=$wrap.data("arrBG")||[];var $newBg;if(arrBG.indexOf(_url)==-1){$newBg=$('\x3cdiv class\x3d"new" style\x3d"background-image: url('+_url+');"/\x3e').appendTo($wrap);arrBG.push(_url);if(arrBG.length<=1)$wrap.data("arrBG",arrBG)}else $newBg=$wrap.children().eq(arrBG.indexOf(_url)).attr("class","new");setTimeout(function(){$wrap.children(".current").removeAttr("class");$wrap.children(".new").attr("class","current")},500)};
MH.currentPage=function(pname){if(pname)return pname==$("body").data("crPage");return $("body").data("crPage")||"loading"};
MH.newMessage=function(arr){return;if(arr&&typeof arr=="object"&&arr.length){var _html="";for(var i=0;i<arr.length;i++){if(arr[i].type=="new")MH.newMessageCount+=1;if(arr[i].title){_html+='\x3ch3 class\x3d"is-new"\x3e';_html+=arr[i].title+' \x3cspan class\x3d"icon-new"\x3enew\x3c/span\x3e';_html+='\x3cspan class\x3d"tb-info"\x3e';if(arr[i].from)_html+=arr[i].from;if(arr[i].time)_html+=" - "+arr[i].time;_html+="\x3c/span\x3e";_html+="\x3c/h3\x3e"}if(arr[i].content)_html+="\x3cdiv\x3e"+arr[i].content+
"\x3c/div\x3e"}$("#popup-message .popup-content\x3e.jm-accordion").prepend(_html).accordion("refresh");setTimeout(function(){$("#popup-message .popup-content\x3e.jm-accordion .no-message").css("display","none")},200);$("#btn-message").addClass("has-new").children("span").html(MH.newMessageCount);MH.playSound("./sound/new-notify.mp3")}};
MH.hasNewMessage=function(num){num=LoginData.unreadMsg+LoginData.newAnnounceMsg;if(num)$("#header .control-right .btn-tinnhan").addClass("has-new").find(".new-count").html(num);else $("#header .control-right .btn-tinnhan").removeClass("has-new").find(".new-count").html("")};MH.hasNewNotify=function(num){num=LoginData.unreadMsg+LoginData.newAnnounceMsg;if(num)$("#header .control-right .btn-thongbao").addClass("has-new").find(".new-count").html(num);else $("#header .control-right .btn-thongbao").removeClass("has-new").find(".new-count").html("")};
MH.newNotify=function(arr){if(arr&&typeof arr=="object"&&arr.length){MH.newNotifyCount+=arr.length;$("#btn-notify").addClass("has-new").children("span").html(MH.newNotifyCount);var _html="";for(var i=0;i<arr.length;i++){if(arr[i].title){_html+='\x3ch3 class\x3d"is-new"\x3e';_html+=arr[i].title+' \x3cspan class\x3d"icon-new"\x3enew\x3c/span\x3e';_html+="\x3c/h3\x3e"}if(arr[i].content)_html+="\x3cdiv\x3e"+arr[i].content+"\x3c/div\x3e"}$("#popup-notify .popup-content\x3e.jm-accordion").prepend(_html).accordion("refresh");
setTimeout(function(){$("#popup-notify .popup-content\x3e.jm-accordion .no-message").css("display","none")},200);MH.playSound("./sound/new-notify.mp3")}};
MH.showLuatChoi=function(gid){var $popup=$("#popup-luatchoi");if(!gid)if(MH.currentPage("game")||MH.currentPage("play"))if(cc.Global.gameId)gid=cc.Global.gameId;$popup.find(".popup-content").html('\x3ciframe src\x3d"http://v2.api1bai247.info/rules/?app\x3dtuquy\x26gameId\x3d'+gid+'"\x3e\x3cp\x3e\u0110ang t\u1ea3i lu\u1eadt ch\u01a1i\x3c/p\x3e\x3c/iframe\x3e');MH.popup.open("#popup-luatchoi")};MH.playSound=function(url){var _audio=new Audio;_audio.src=url;_audio.play()};
MH.createPopup=function(data){if(!data)return;MH.popup.open("#popup-notify");$("#popup-notify .notify-wrap").html(data);var obj=null;if(typeof data==="string")obj={content:[{tag:"p",text:data}]};else obj=data;if(!obj.title)obj.title="";if(obj.zIndex===undefined)obj.zIndex="";var _html='\x3cdiv class\x3d"mh-popup popup-unknown" style\x3d"z-index:'+obj.zIndex+';"\x3e';_html+='\x3cdiv class\x3d"popup-wrapper" style\x3d"width:'+obj.width+";height:"+obj.height+';"\x3e\x3cdiv class\x3d"popup-inner" '+(obj.title?
"":'style\x3d"padding-top:30px;"')+'\x3e\x3cdiv class\x3d"popup-header"\x3e';_html+="\x3ch2\x3e"+obj.title+"\x3c/h2\x3e";_html+='\x3c/div\x3e\x3cdiv class\x3d"popup-content"\x3e';if(typeof obj.content=="object"&&obj.content.length){if(obj.content.length==1&&obj.title==""&&!obj.content[0].text)return;for(var i=0;i<obj.content.length;i++){_html+="\x3c"+obj.content[i]["tag"];for(k in obj["content"][i])if(k!="text"&&k!="tag"&&obj["content"][i].hasOwnProperty(k))_html+=" "+k+'\x3d"'+obj["content"][i][k]+
'"';_html+="\x3e";if(obj["content"][i]["text"])_html+=obj["content"][i]["text"];_html+="\x3c/"+obj.content[i]["tag"]+"\x3e"}}else if(typeof obj.content=="string"){if(obj.title==""&&!obj.content)return;_html+=obj.content}else return;_html+='\x3c/div\x3e\x3cdiv class\x3d"popup-footer"\x3e';if(obj.btnCancel&&typeof obj.btnCancel=="object")_html+='\x3cbutton id\x3d"'+obj.btnCancel.id+'" class\x3d"btn-cancel '+obj.btnCancel.class+'"\x3e'+obj.btnCancel.text+"\x3c/button\x3e";if(obj.btnSave&&typeof obj.btnSave==
"object")_html+='\x3cbutton id\x3d"'+obj.btnSave.id+'" class\x3d"btn-save '+obj.btnSave.class+'"\x3e'+obj.btnSave.text+"\x3c/button\x3e";_html+='\x3c/div\x3e\x3cbutton class\x3d"close-popup"\x3e\x3cimg src\x3d"images/btn-close.png"/\x3e\x3c/button\x3e';var $popup=$(_html);$popup.appendTo("body");var $main=$popup.children(".popup-wrapper");var windowWidth=$(window).width();windowHeight=$(window).height();$main.css({left:(windowWidth-$main.width())/2+"px",top:(windowHeight-$main.height())/2+"px"});
$popup.mhPopup({delay:obj.delay,onClose:function(){setTimeout(function(){$popup.remove()},1E3)}});$popup.data("mhPopup").open(obj.openEffect)};
MH.loginDone=function(obj){if(cc.Global.loginType==LoginType.FB){MH.setCookie("_infoVIP52",MH.getCookie("_infoVIP52"),-1);MH.setCookie("_loginType","FB",100)}else MH.setCookie("_loginType","Normal",100);if(!obj)obj=PlayerMe;$("body").addClass("logged");MH.header.change("logged");setTimeout(function(){MiniGameClient.getInstance().login2(function(){MH.openGame("TAIXIU")})},500);if(obj.kichhoat){MH.marquee.destroy();MH.marquee.append([obj.kichhoat])}setTimeout(function(){MH.hasNewMessage(LoginData.unreadMsg);
MH.hasNewNotify(LoginData.newAnnounceMsg)},1E3)};
MH.header={reInit:function(){var $header=$("#header");$header.find("button").off("click").on("click",function(){var $button=jQuery(this);$button.addClass("on-click");setTimeout(function(){$button.removeClass("on-click")},100)});$header.find(".btn-back").on("click",function(){setTimeout(function(){if(MH.currentPage("home"))MH.logOut();else MH.changePage("home")},150)});$header.find(".btn-quenpass").on("click",function(){$("#popup-forgetPass").data("mhPopup").open()});$header.find(".btn-dangky").on("click",
function(){$("#popup-signup").data("mhPopup").open()});$header.find(".btn-login-facebook").on("click",function(){MH.setCookie("_signatureData","",-1);cc.getClient().loginFBHandler(function(){MH.loadingDialog.hide();MH.loginDone(PlayerMe);if(MH.currentPage("playslot"));else MH.changePage("home")},function(){MH.loadingDialog.hide();if(!MH.currentPage("playslot"))MH.changePage("home")})});$header.find(".btn-dangnhap").on("click",function(){MH.popup.open("#popup-signin");return false;var $thisBtn=$(this);
if($thisBtn.hasClass("disable-click"))return false;MH.setCookie("_signatureData","",-1);var uname=$header.find('input[type\x3d"text"]').val().trim(),upass=$header.find('input[type\x3d"password"]').val().trim();if(!uname||!upass)MH.createPopup("T\u00ean v\u00e0 m\u1eadt kh\u1ea9u kh\u00f4ng \u0111\u01b0\u1ee3c \u0111\u1ec3 tr\u1ed1ng");else{var handlerLoginDone=function(){var _info=window.btoa(uname+"###"+upass);MH.setCookie("_infoVIP52",_info,1);MH.setCookie("_unameVIP52",window.btoa(uname),100);
$thisBtn.removeClass("disable-click");MH.loginDone(PlayerMe)};var handlerLoginFail=function(str){$thisBtn.removeClass("disable-click");var _txt=str||"\u0110\u0103ng nh\u1eadp kh\u00f4ng th\u00e0nh c\u00f4ng";MH.createPopup(_txt)};$thisBtn.addClass("disable-click");setTimeout(function(){$thisBtn.removeClass("disable-click")},3E3);cc.getClient().login(uname,upass,handlerLoginDone,handlerLoginFail)}return false});$header.find(".btn-shop").on("click",function(){setTimeout(function(){MH.popup.open("#popup-shop");
var $popupShop=jQuery("#popup-shop");$popupShop.find(".shop-tabs").tabs("option","active",3)},150)});$header.find(".avatar").off("click").on("click",function(){jQuery("#popup-userInfo").remove();if(!MH.popup.hasOwnProperty("userInfo"))return;var $popup=jQuery(MH.popup["userInfo"]);var _phone=PlayerMe.phoneVerify?PlayerMe.phone:"ch\u01b0a c\u1eadp nh\u1eadt";var _html='\x3cimg src\x3d"'+PlayerMe.avatar+'" /\x3e\x3cspan class\x3d"uname"\x3e'+PlayerMe.displayName+'\x3c/span\x3e\x3cspan class\x3d"uId"\x3eID: '+
PlayerMe.id+'\x3c/span\x3e\x3cspan class\x3d"unphone"\x3eS\u0110T: '+_phone+'\x3c/span\x3e\x3cspan class\x3d"ungold"\x3eCoin: '+MH.numToText(PlayerMe.gold,1)+"\x3c/span\x3e";$popup.find(".popup-content .detail").html(_html);PlayerMe.phoneVerify?$popup.find(".control .btn-updateSdt").hide():$popup.find(".control .btn-updateSdt").show();cc.Global.loginType==LoginType.FB?$popup.find(".control .btn-changePass").hide():$popup.find(".control .btn-changePass").show();$popup.find(".control .btn-updateSdt").off().on("click",
function(){$popup.data("mhPopup").close("");MyRequest.getAccountKit({},function(response){if(response.status==="PARTIALLY_AUTHENTICATED"){var code=response.code;var csrf=response.state;MyRequest.activePhone({"code":code},function(cmd,data){if(data&&data.status===0){console.log("C\u1eadp nh\u1eadt sdt th\u00e0nh c\u00f4ng",data);var msg=data.data.message||"C\u1eadp nh\u1eadt s\u1ed1 \u0111i\u1ec7n tho\u1ea1i th\u00e0nh c\u00f4ng";MH.createPopup(msg);PlayerMe.phone=data.data.phone;PlayerMe.phoneVerify=
true;LobbyRequest.getInstance().requestUpdateMoney();if(typeof fbq==="function")fbq("track","Lead")}else if(data&&data.data&&data.data.message)MH.createPopup(data.data.message)})}else{var msg=data.data.message||"C\u1eadp nh\u1eadt s\u1ed1 \u0111i\u1ec7n tho\u1ea1i th\u1ea5t b\u1ea1i";MH.createPopup(msg)}});return false});$popup.find(".control .btn-changeAva").off().on("click",function(){if($popup.data("mhPopup")){$popup.data("mhPopup").onClose(function(){var $popup2=jQuery("#popup-changeAva");if($popup2.length===
0)return;$popup2.find(".popup-content .avatar-list").empty();MyRequest.getAvatars(function(cmd,data){if(data.status==0&&data.items.length){var _html="";for(var i=0;i<data.items.length;i++){_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"'+data.items[i].url+'" data-id\x3d"'+data.items[i].id+'"/\x3e\x3c/div\x3e';if(i>4&&i===Math.ceil(data.items.length/2)-1)_html+="\x3cbr\x3e"}$popup2.find(".popup-content .avatar-list").html(_html);$popup2.find(".popup-content .avatar-list .item img").off().on("click",
function(){var $that=jQuery(this),_id=$that.attr("data-id"),_src=$that.attr("src");_id=parseInt(_id);if(_id<0)return false;LobbyRequest.getInstance().updateAvatar(_id,function(cmd,data){if(data["status"]==0){MH.header.updateAvatar(_src);$that.parent().addClass("done");setTimeout(function(){$that.parent().removeClass("done")},1E3)}cc.getClient().removeListener(LobbyRequest.getInstance())});return false})}});if($popup2.data("mhPopup"))$popup2.data("mhPopup").open()});$popup.data("mhPopup").close("fadeOut")}return false});
$popup.find(".control .btn-changePass").off().on("click",function(){if($popup.data("mhPopup"))$popup.data("mhPopup").close("fadeOut");var $popup2=jQuery("#popup-changePass");if($popup2.data("mhPopup"))$popup2.data("mhPopup").open();return false});$popup.find(".control .btn-lichsuGiaoDich").off().on("click",function(){$popup.data("mhPopup").close("");jQuery("#popup-lichsuGiaoDich").data("mhPopup").open("");return false});$popup.find(".control .btn-baomatTK").hide().off().on("click",function(){return false;
$popup.data("mhPopup").close("");if(!PlayerMe.phoneVerify){MH.createPopup("Vui l\u00f2ng c\u1eadp nh\u1eadt s\u0111t \u0111\u1ec3 th\u1ef1c hi\u1ec7n ch\u1ee9c n\u0103ng");return false}var $wrap=jQuery("#popup-baomatTK");if(PlayerMe.security)var $main=$wrap.find(".step2");else var $main=$wrap.find(".step1");$wrap.find(".step").not($main).hide();$main.show();$wrap.data("mhPopup").open("");return false});$popup.appendTo("#popups");$popup.mhPopup({autoOpen:true});return false});$header.find(".btn-naptien").on("click",
function(){setTimeout(function(){var $popupShop=jQuery("#popup-shop");$popupShop.find(".shop-tabs").tabs("option","active",0);$popupShop.find("#shop-napthe .napthe-tabs").tabs("option","active",0);$popupShop.data("mhPopup").open("")},150)});$header.find(".btn-giftcode").on("click",function(){setTimeout(function(){var $popupShop=jQuery("#popup-shop");$popupShop.find(".shop-tabs").tabs("option","active",0);$popupShop.find("#shop-napthe .napthe-tabs").tabs("option","active",2);$popupShop.data("mhPopup").open("")},
150)});$header.find(".btn-tinnhan").on("click",function(){setTimeout(function(){var $popup=jQuery("#popup-hopthu");$popup.data("mhPopup").open("")},150)});$header.find(".btn-ketsat").on("click",function(){setTimeout(function(){var $popupShop=jQuery("#popup-shop");$popupShop.find(".shop-tabs").tabs("option","active",1);$popupShop.data("mhPopup").open("")},150)});$header.find(".btn-caidat").on("click",function(){setTimeout(function(){var $popup=jQuery("#popup-setting");$popup.data("mhPopup").open("")},
150)});var $footer=jQuery("#footer");$footer.find("button").off("click").on("click",function(){var $button=jQuery(this);$button.addClass("on-click");setTimeout(function(){$button.removeClass("on-click")},100)});var toFanpage=setInterval(function(){console.log("set fanpage");if(HostConfig&&HostConfig.ctconfig&&HostConfig.ctconfig.fanpage){$footer.find(".btn-fanpage").attr("href",HostConfig.ctconfig.fanpage);clearInterval(toFanpage)}},3E3)},change:function(type){if(type==="logged"){if(!MH.checkLogin())return;
var $header=$("#header");$header.html(MH.contentHeaderLogged);MH.header.updateAvatar();$header.find(".user-name").html(PlayerMe.displayName);$header.find(".user-id").html("ID: "+PlayerMe.id);$header.find(".gold-num").html(MH.numToText(PlayerMe.gold,1));$header.find(".chip-num").html(MH.numToText(PlayerMe.chip,1));MH.header.reInit()}else if(type==="logout"){var $header=$("#header");$header.html(MH.contentHeader).removeClass("hide-top");MH.header.reInit()}},updateMoney:function(n){if(n==undefined)n=
PlayerMe.gold;$("#header").find(".gold-num").html(MH.numToText(n,1))},updateAvatar:function(_url){if(!_url)_url=PlayerMe.avatar;if(!_url)return;var image=new Image;image.onload=function(){PlayerMe.avatar=_url;$("#header").find(".avatar").html('\x3cimg src\x3d"'+PlayerMe.avatar+'" /\x3e')};image.onerror=function(){MH.header.updateAvatar("images/header/avatar.png")};image.src=_url}};MH.checkLogin=function(){return PlayerMe.id===-1?false:true};
MH.numToText=function(n,type){if(typeof n=="undefined")return"";var respon=n;if(type===1)return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,".");else if(n>=1E6)respon=Math.floor(n/1E4)/100+"M";else if(n>=1E3)respon=Math.floor(n/10)/100+"K";return respon+""};
MH.realtimeCount=function(_old,_new,_element,_time){var cb=arguments.length>=5?arguments[4]:null;var _isAppendHtml=arguments.length>=6?arguments[5]:true;if(!_old)_old=0;if(_old==_new){if(_isAppendHtml)_element.html(MH.numToText(_new,1));if(cb)cb(_new);return}if(!_time)_time=1E3;var _count=Math.round(20*_time/1E3)+3;var _step=(_new-_old)/_count;var _index=1;clearInterval(_element.data("realtimeCount"));var timerCtr=setInterval(function(){if(_index>_count)clearInterval(timerCtr);else{if(_isAppendHtml)_element.html(MH.numToText(Math.round(_old+
_step*_index),1));if(cb)cb(Math.round(_old+_step*_index));_index+=1}},_time/_count);_element.data("realtimeCount",timerCtr)};MH.setCookie=function(cname,cvalue,exdays){var d=new Date;d.setTime(d.getTime()+exdays*24*60*60*1E3);var expires="expires\x3d"+d.toUTCString();document.cookie=cname+APPNAME+"\x3d"+cvalue+";"+expires+";path\x3d/"};
MH.getCookie=function(cname){var name=cname+APPNAME+"\x3d";var decodedCookie=decodeURIComponent(document.cookie);var ca=decodedCookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" ")c=c.substring(1);if(c.indexOf(name)==0)return c.substring(name.length,c.length)}return""};
MH.hasInvited=function(obj){if(MH.onOpenPopup)return;$("#popup-invited").remove();if(!MH.popup.hasOwnProperty("invited"))return;var $popup=$(MH.popup["invited"]);if(obj.hasOwnProperty("fu")&&obj["fu"].hasOwnProperty("u"))$popup.find(".user-name").html(obj["fu"]["u"]);if(obj.hasOwnProperty("ri")&&obj["ri"].hasOwnProperty("gid")&&Constant.GAME_NAME_ARRAY[obj["ri"]["gid"]])$popup.find(".game-name").html("M\u1eddi b\u1ea1n ch\u01a1i "+Constant.GAME_NAME_ARRAY[obj["ri"]["gid"]]);if(obj.hasOwnProperty("ri")&&
obj["ri"].hasOwnProperty("aid"))if(obj["ri"]["aid"]==1){$popup.find(".user-chip").hide();if(obj.hasOwnProperty("fu")&&obj["fu"].hasOwnProperty("m"))$popup.find(".user-gold").html(MH.numToText(obj["fu"]["m"])).css("display","block")}else if(obj["ri"]["aid"]==2){$popup.find(".user-gold").hide();if(obj.hasOwnProperty("fu")&&obj["fu"].hasOwnProperty("m"))$popup.find(".user-chip").html(MH.numToText(obj["fu"]["m"])).css("display","block")}if(cc.Global.GetSetting(GameSetting.acceptInvite,true)==false)$popup.find(".input-setting-invted").prop("checked",
true);else $popup.find(".input-setting-invted").prop("checked",false);$popup.find(".input-setting-invited").off().on("change",function(){var _set=$popup.find(".input-setting-invited").prop("checked");cc.Global.SetSetting(GameSetting.acceptInvite,!_set);if(_set)$popup.find(".btn-agree").html("\u0110\u00f3ng");else $popup.find(".btn-agree").html("\u0110\u1ed3ng \u00fd")});$popup.appendTo("#popups");$popup.mhPopup({autoOpen:true});$popup.find(".btn-cancel").off().on("click",function(){$popup.data("mhPopup").close();
return false});$popup.find(".btn-agree").off().on("click",function(){if(cc.Global.GetSetting(GameSetting.acceptInvite,true)==false)$popup.data("mhPopup").close();else{$popup.data("mhPopup").close("");LobbyClient.getInstance().onJoinRoom(obj.ri)}return false})};
MH.invite=function(arr,callback){if(MH.onOpenPopup)return;$("#popup-invite").remove();if(!MH.popup.hasOwnProperty("invite"))return;var $popup=$(MH.popup["invite"]);var _html="";for(var i=0;i<arr.length;i++){var _class=cc.Global.moneyType===MoneyType.Gold?"u-gold":"u-chip";_html+='\x3clabel\x3e\x3cinput type\x3d"checkbox" class\x3d"user-check" name\x3d"" value\x3d"'+i+'" checked\x3e\x3cdiv\x3e\x3c/div\x3e'+(i+1)+". "+arr[i].dn+'\x3cspan class\x3d"'+_class+'"\x3e'+MH.numToText(arr[i].m)+"\x3c/span\x3e\x3c/label\x3e"}$popup.find(".popup-content").html(_html);
$popup.find(".btn-agree").off().on("click",function(){var _list=[];$popup.find(".user-check").each(function(){if($(this).prop("checked"))_list.push(arr[parseInt($(this).val())])});if(typeof callback==="function")callback(_list);$popup.data("mhPopup").close();return false});$popup.find(".btn-back").off().on("click",function(){$popup.data("mhPopup").close();return false});$popup.appendTo("#popups");$popup.mhPopup({autoOpen:true})};
MH.createTable=function(obj){$("#popup-createTable").remove();if(!MH.popup.hasOwnProperty("createTable"))return;var _html=MH.popup["createTable"];var _min=obj.min?obj.min:0,_max=obj.max?obj.max:_min+100,_step=obj.step?obj.step:[],_value=obj.value?obj.value:_min;var $html=$(_html),$slider=$html.find(".slider"),$handle;$html.find(".money-min").html(MH.numToText(_min));$html.find(".money-max").html(MH.numToText(_max));$html.find(".num-player").empty();if(!obj.hasOwnProperty("type")||obj.type!=="inner"){var slot=
cc.Global.getSlotCountByGame();if(slot.length){var _slotInput="";for(var i=0;i<slot.length;i++)_slotInput+='\x3clabel\x3e\x3cinput type\x3d"radio" name\x3d"numplayer" '+(i===0?"checked":"")+' value\x3d"'+slot[i]+'"\x3e\x3cdiv\x3e\x3c/div\x3e '+slot[i]+" Ng\u01b0\u1eddi\x3c/label\x3e";$html.find(".num-player").html(_slotInput)}$slider.find(".money-num").remove();$handle=$html.find(".money-num")}else{$html.find(".slider-wrap").css("margin-top","25px");$handle=$slider.find(".money-num");$html.find(".money-num").not($handle).html(MH.numToText(obj.current))}$html.appendTo("#popups");
$html.mhPopup();var _values=_step;$slider.slider({min:_min,max:_max,value:_value,create:function(){$handle.data("value",$slider.slider("value")).html(MH.numToText($slider.slider("value")))},slide:function(event,ui){if(_values.indexOf(ui.value)!==-1)$handle.html(MH.numToText(ui.value));else for(var i=0;i<_values.length;i++)if(ui.value>_values[i]&&ui.value<_values[i+1]){if(ui.value>_values[i]+(_values[i+1]-_values[i])/2)$handle.data("value",_values[i+1]).html(MH.numToText(_values[i+1]));else $handle.data("value",
_values[i]).html(MH.numToText(_values[i]));return}}});$html.find(".btn-minus").off().on("click",function(){var _value=$slider.slider("value"),_index=_values.indexOf($handle.data("value"));if(_index===-1||_index===0)return;$slider.slider("value",_values[_index-1]);$handle.data("value",_values[_index-1]).html(MH.numToText(_values[_index-1]));return false});$html.find(".btn-plus").off().on("click",function(){var _value=$slider.slider("value"),_index=_values.indexOf($handle.data("value"));if(_index===
-1||_index===_values.length-1)return;$slider.slider("value",_values[_index+1]);$handle.data("value",_values[_index+1]).html(MH.numToText(_values[_index+1]));return false});$html.find(".btn-agree").off().on("click",function(){var _numPlayer=parseInt($html.find('input[name\x3d"numplayer"]:checked').val())||0;if(obj.create&&typeof obj.create==="function")obj.create({moneyBet:$handle.data("value"),maxUser:_numPlayer});$html.data("mhPopup").close("");MH.onOpenPopup=false;return false});$html.find(".btn-back").off().on("click",
function(){$html.data("mhPopup").close();return false});$html.data("mhPopup").open()};
MH.marquee={lastId:0,items:[],checking:{},onRunning:false,speed:100,prepend:function(arr){var _time=(new Date).getTime();for(var i=0;i<arr.length;i++){this.lastId++;this.items.unshift({content:arr[i],process:0,id:this.lastId,onRun:false,runAt:0,time:_time})}this.run()},append:function(arr){var _time=(new Date).getTime();for(var i=0;i<arr.length;i++){this.lastId++;this.items.push({content:arr[i],process:0,id:this.lastId,onRun:false,runAt:0,time:_time})}this.run()},destroy:function(){this.stop();this.items=
[]},run:function(){var $marquee=$("#content .main-notify"),$marqueeWrap=$marquee.children(".notify-inner"),marqueeWidth=$marquee.innerWidth();if(!$marquee.length)return;function addItem(i){var item=MH.marquee.items[i];if(!item)return;var $lastItem=$marqueeWrap.children(".item:last-child");if(!$lastItem.length)var _num=$marqueeWrap.offset().left+marqueeWidth*MH.scale;else var _num=$marquee.offset().left+marqueeWidth*MH.scale-$lastItem.offset().left-$lastItem.width()*MH.scale;if(_num<=0)return;var _html=
'\x3cdiv class\x3d"item" style\x3d"margin-left: '+Math.floor(_num)+'px"\x3e'+item.content+"\x3c/div\x3e";var $item=$(_html);$marquee.addClass("on-run");$item.appendTo($marqueeWrap);item.process=1;var _length=$item.innerWidth()+100;setTimeout(function(){item.process=2;MH.marquee.run()},_length*1E3/MH.marquee.speed);setTimeout(function(){item.process=3;for(var i=0;i<MH.marquee.items.length;i++){if(MH.marquee.items[i].process==0||MH.marquee.items[i].process==1||MH.marquee.items[i].process==2)break;if(i==
MH.marquee.items.length-1)MH.marquee.stop()}},(_length+marqueeWidth*MH.scale)*1E3/MH.marquee.speed)}for(var i=0;i<MH.marquee.items.length;i++)if(MH.marquee.items[i].process==0){addItem(i);break}},stop:function(){$(".main-notify").removeClass("on-run").children(".notify-inner").html("")}};
MH.logOut=function(){MH.setCookie("_infoVIP52","pp",-1);MH.setCookie("_loginType","pp",-1);PlayerMe.id=-1;MiniGameClient.getInstance().logOut();TopHuClient.getInstance().login();MH.minigame.destroy();MH.marquee.destroy();MH.changePage("home");MH.header.change("logout");$("body").removeClass("logged");location.reload()};
MH.loadingDialog={afterTimeout:undefined,show:function(obj){$("#loadingDialog").remove();var _text=obj.text||"",_timeout=obj.timeout||500;var _html='\x3cdiv id\x3d"loadingDialog"\x3e\x3cdiv class\x3d"dialog-content"\x3e\x3cp\x3e'+_text+"\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e";$("body").append(_html);clearTimeout(MH.loadingDialog.afterTimeout);MH.loadingDialog.afterTimeout=setTimeout(function(){if(obj.hasOwnProperty("afterTimeout"))obj.afterTimeout()},_timeout)},hide:function(){clearTimeout(MH.loadingDialog.afterTimeout);
$("#loadingDialog").remove()}};
MH.miniGameLoadingDialog={afterTimeout:undefined,show:function(obj){$("#loadingDialog").remove();var _text=obj.text||"",_timeout=obj.timeout||500;var _html='\x3cdiv id\x3d"loadingDialog"\x3e\x3cdiv class\x3d"dialog-content"\x3e\x3cp\x3e'+_text+"\x3c/p\x3e\x3c/div\x3e\x3c/div\x3e";$("body").append(_html);clearTimeout(MH.miniGameLoadingDialog.afterTimeout);MH.miniGameLoadingDialog.afterTimeout=setTimeout(function(){if(obj.hasOwnProperty("afterTimeout"))obj.afterTimeout()},_timeout)},hide:function(){clearTimeout(MH.miniGameLoadingDialog.afterTimeout);
$("#loadingDialog").remove()}};MH.user={reload:function(){var $header=$("#header");MH.header.updateAvatar();$header.find(".user-name").html(PlayerMe.displayName);$header.find(".user-id").html("ID: "+PlayerMe.id);$header.find(".gold-num").html(MH.numToText(PlayerMe.gold,1));$header.find(".chip-num").html(MH.numToText(PlayerMe.chip,1));$(window).trigger("updateMoney",PlayerMe.gold)}};
MH.openSetting=function(s){$popup=$("#popup-setting");if($popup.length===0)return;if(s===true)$popup.find(".auto-ready").css("display","inline-block");if($popup.data("mhPopup")){$popup.data("mhPopup").onClose(function(){$popup.find(".auto-ready").css("display","none")});$popup.data("mhPopup").open()}};
MH.openSettingChan=function(obj){if(!obj.hasOwnProperty("inRoom"))obj.inRoom=false;if(!obj.hasOwnProperty("uf"))obj.uf=false;if(!obj.hasOwnProperty("fast"))obj.fast=false;var $popupSettingChan=$("#popup-settingChan");$popupSettingChan.find(".input-setting-u411").prop("checked",obj.uf).prop("disabled",obj.inRoom);$popupSettingChan.find(".input-setting-nhanh").prop("checked",obj.fast).prop("disabled",obj.inRoom);$popupSettingChan.find(".input-setting-cham").prop("checked",!obj.fast).prop("disabled",
obj.inRoom);$popupSettingChan.find(".input-setting-autoReady").off().on("change",function(){cc.Global.SetSetting(GameSetting.autoReadyChan,$popupSettingChan.find(".input-setting-autoReady").prop("checked"))});$popupSettingChan.find(".input-setting-sound").off().on("change",function(){var _set=$popupSettingChan.find(".input-setting-sound").prop("checked");cc.Global.SetSetting(GameSetting.sound,_set);$(window).trigger("settingSound",_set)});$popupSettingChan.find(".btn-agree").off().on("click",function(){if(obj.hasOwnProperty("agree")&&
typeof obj.agree==="function")obj.agree({uf:$popupSettingChan.find(".input-setting-u411").prop("checked"),fast:$popupSettingChan.find(".input-setting-nhanh").prop("checked")});$popupSettingChan.data("mhPopup").close();return false});$popupSettingChan.data("mhPopup").open()};
MH.convertTime=function(s,type){var d=new Date(s),result="";if(type==="H:i"){result+=d.getHours()<10?"0"+d.getHours():d.getHours();result+=":";result+=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes()}else if(type==="dd/mm H:i"){result+=d.getDate()<10?"0"+d.getDate():d.getDate();result+="/";result+=d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1;result+=" ";result+=d.getHours()<10?"0"+d.getHours():d.getHours();result+=":";result+=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes()}else{result+=
d.getDate()<10?"0"+d.getDate():d.getDate();result+="/";result+=d.getMonth()<9?"0"+(d.getMonth()+1):d.getMonth()+1;result+=" - ";result+=d.getHours()<10?"0"+d.getHours():d.getHours();result+=":";result+=d.getMinutes()<10?"0"+d.getMinutes():d.getMinutes()}return result};
MH.updateDPN={open:function(){var $popupUpdateDN=$("#popup-updateDisplayName");if(!$popupUpdateDN.length)return;$popupUpdateDN.find(".msg-error").html("");$popupUpdateDN.find(".btn-submitName").off().on("click",function(){var _name=$popupUpdateDN.find('input[name\x3d"namedisplay"]').val();if(!_name)$popupUpdateDN.find(".msg-error").html("Vui l\u00f2ng nh\u1eadp t\u00ean hi\u1ec3n th\u1ecb");else MyRequest.updateDisplayName(_name,function(cmd,data){console.log(data);if(data.status===0){MH.updateDPN.close();
setTimeout(function(){MH.loginDone();if(PlayerMe.phoneVerify==false)setTimeout(function(){cc.getClient()._showKichHoatSuggest()},1E3)},500)}else if(data.error)$popupUpdateDN.find(".msg-error").html(data.error)});return false});$popupUpdateDN.data("mhPopup").open()},close:function(){var $popupUpdateDN=$("#popup-updateDisplayName");if(!$popupUpdateDN.length)return;$popupUpdateDN.data("mhPopup").close()}};
MH.viewPlayers=function(arr){if(MH.onOpenPopup)return;$("#popup-viewplayers").remove();if(!MH.popup.hasOwnProperty("viewplayers"))return;var $popup=$(MH.popup["viewplayers"]);var _html="";for(var i=0;i<arr.length;i++){var _class=cc.Global.moneyType===MoneyType.Gold?"u-gold":"u-chip";_html+='\x3cli\x3e\x3cimg src\x3d"'+arr[i].a+'"\x3e'+(i+1)+". "+arr[i].dn+'\x3cspan class\x3d"'+_class+'"\x3e'+arr[i].m+"\x3c/span\x3e\x3c/li\x3e"}$popup.find(".popup-content").html("\x3cul\x3e"+_html+"\x3c/ul\x3e");$popup.appendTo("#popups");
$popup.mhPopup({autoOpen:true})};MH.minigame={items:[],hide:function(){if(arguments.length==0);},destroy:function(){if(arguments.length==0){for(var i=0;i<MH.minigame.items.length;i++)MH.minigame.items[i].destroyGame();MH.minigame.items=[]}},logout:function(){console.log("LOGOUT MINIGAME");for(var i=0;i<MH.minigame.items.length;i++)MH.minigame.items[i].destroyGame();MH.minigame.items=[]},login:function(){}};MH.hideElement=function(selector){$(selector).hide()};MH.showElement=function(selector){$(selector).show()};
MH.popup.close=function(a){if(a&&typeof a==="string")if(a==="all"){$("#popups\x3e.mh-popup.show").removeClass("show");MH.onOpenPopup=false}else;};MH.popup.open=function(_pid){$(_pid).data("mhPopup").open()};MH.openLoginOTP=function(){var $popup=$("#popup-baomatTK"),$wrap=$popup.find(".step4");$popup.find(".step").not($wrap).hide();$wrap.find(".success, .error").html("");$wrap.find(".cuphapSMS").html("");$wrap.find('input[name\x3d"codeOTP"]').val("");$wrap.show();MH.popup.open("#popup-baomatTK")};
MH.openGame=function(k){console.log("MH.openGame",k);if(!LobbyClient.getInstance().isLoginDone()){MH.popup.open("#popup-signin");return false}k=k+"";var $iconLobby=null;if(MH.currentPage("home"))$("#content .game-list .list-item\x3ebutton").each(function(){if(k===$(this).data("gname")){$iconLobby=$(this);return}});var preload=function(obj,callback){var _nTotal=0,_nLoaded=0;if(obj.status===1)return;else if(obj.status===2){callback();return}var afterLoaded=function(){_nLoaded+=1;if($iconLobby)$iconLobby.attr("data-process",
Math.round(_nLoaded/_nTotal*100)+"%");if(_nLoaded>=_nTotal){obj.status=2;obj.loaded=true;setTimeout(function(){if($iconLobby)$iconLobby.removeClass("on-loading");callback()},300)}};if(obj.hasOwnProperty("style"))_nTotal+=1;if(obj.hasOwnProperty("template"))_nTotal+=1;if(obj.hasOwnProperty("images"))_nTotal+=obj.images.length;if(obj.hasOwnProperty("sounds"))_nTotal+=obj.sounds.length;if(_nTotal>1){obj.status=1;if($iconLobby)$iconLobby.addClass("on-loading")}if(obj.hasOwnProperty("style"))$.get(obj.style,
function(_css){obj.style=_css;afterLoaded()});if(obj.hasOwnProperty("template"))$.get(obj.template,function(_html){obj.template=_html;afterLoaded()});if(obj.hasOwnProperty("sounds"))$.each(obj.sounds,function(k,v){var sound=new Audio(v);sound.onloadeddata=function(){afterLoaded()};sound.load()});if(obj.hasOwnProperty("images"))$.each(obj.images,function(k,v){var image=new Image;image.onload=function(){afterLoaded()};image.onerror=function(){afterLoaded()};image.src=v})};if(Constant.GAME_ID[k]){var _id=
Constant.GAME_ID[k];if(Constant.GAME_ID_DONE.indexOf(_id)!==-1)MH.changePage("game",{gameId:_id});else MH.createPopup("Game n\u00e0y s\u1eafp ra m\u1eaft");return false}if(!MiniGameClient.getInstance().isLoginDone()){MiniGameClient.getInstance().login2(function(){MH.openGame(k)});return}switch(k){case "TAIXIU":if(!TaiXiuPreLoad.loaded)preload(TaiXiuPreLoad,function(){MH.openGame(k)});else if(MyTaiXiu.getInstance().currentTarget)MyTaiXiu.getInstance().currentTarget.open();else{var aaa=new TaiXiu;MH.minigame.items.push(aaa)}break;
case "MINIPOKER":if(!MiniPokerPreLoad.loaded)preload(MiniPokerPreLoad,function(){MH.openGame(k)});else if(MyMiniPoker.getInstance().currentTarget)MyMiniPoker.getInstance().currentTarget.open();else{var aaa=new MiniPoker;MH.minigame.items.push(aaa)}break;case "TPS":if(!TrungPhucSinhPreLoad.loaded)preload(TrungPhucSinhPreLoad,function(){MH.openGame(k)});else if(MyTrungPhucSinh.getInstance().currentTarget)MyTrungPhucSinh.getInstance().currentTarget.open();else{var aaa=new TrungPhucSinh;MH.minigame.items.push(aaa)}break;
case "CAOTHAP":if(!CaoThapPreLoad.loaded)preload(CaoThapPreLoad,function(){MH.openGame(k)});else if(MyCaoThap.getInstance().currentTarget)MyCaoThap.getInstance().currentTarget.open();else{var aaa=new CaoThap;MH.minigame.items.push(aaa)}break;case "BAUCUA":if(!BauCuaPreLoad.loaded)preload(BauCuaPreLoad,function(){MH.openGame(k)});else if(MyBauCua.getInstance().currentTarget)MyBauCua.getInstance().currentTarget.open();else{var aaa=new BauCua;MH.minigame.items.push(aaa)}break;case "SIEUXE":if(!SieuXePreLoad.loaded)preload(SieuXePreLoad,
function(){MH.openGame(k)});else if(MySieuXe.getInstance().currentTarget)MySieuXe.getInstance().currentTarget.open();else{var aaa=new SieuXe;MH.minigame.items.push(aaa)}break;case "DICEDICE":if(!DiceDicePreLoad.loaded)preload(DiceDicePreLoad,function(){MH.openGame(k)});else if(!MH.currentPage("slot"))MH.changePage("slot",DiceDicePreLoad);break;case "DEADORALIVE":if(!DeadOrAlivePreLoad.loaded)preload(DeadOrAlivePreLoad,function(){MH.openGame(k)});else if(!MH.currentPage("slot"))MH.changePage("slot",
DeadOrAlivePreLoad);break;case "GOLDENMONKEY":if(!GoldenMonkeyPreLoad.loaded)preload(GoldenMonkeyPreLoad,function(){MH.openGame(k)});else if(!MH.currentPage("slot"))MH.changePage("slot",GoldenMonkeyPreLoad);break;default:MH.createPopup("Game n\u00e0y s\u1eafp ra m\u1eaft");break}};
MH.sukien={caothap:function(){return},taixiu:{getInfo:function(callback){var abc={"command":"GET_INFO_EVENT","applicationId":Distributor.applicationId,"key":"GSSequenceTaiXiuEvolve"};if(!HostConfig.services||!HostConfig.services.campaignGs)return;HttpRequest.requestGETMethod(HostConfig.services.campaignGs,"",abc,function(cmd,data){console.log("event tx",data);var res=null;if(data&&data.GSSequenceTaiXiuEvolve&&data.GSSequenceTaiXiuEvolve.data)res=data.GSSequenceTaiXiuEvolve.data;if(callback)callback(res)})},
getRank:function(callback){var abc={"command":"TOP_EVENT_TAI_XIU","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"timestamp":(new Date).getTime(),"skip":0,"limit":20,"key":"GSSequenceTaiXiuEvolve"};if(!HostConfig.services||!HostConfig.services.campaignGs)return;HttpRequest.requestGETMethod(HostConfig.services.campaignGs,"",abc,function(cmd,data){var res=null;if(data&&data.GSSequenceTaiXiuEvolve&&data.GSSequenceTaiXiuEvolve.data)res=data.GSSequenceTaiXiuEvolve.data;if(callback)callback(res)})},
getTop:function(timestamp,callback){var abc={"command":"TOP_EVENT_TAI_XIU","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"timestamp":timestamp,"skip":0,"limit":100,"key":"GSSequenceTaiXiuEvolve"};if(!HostConfig.services||!HostConfig.services.campaignGs)return;HttpRequest.requestGETMethod(HostConfig.services.campaignGs,"",abc,function(cmd,data){var res=null;if(data&&data.GSSequenceTaiXiuEvolve&&data.GSSequenceTaiXiuEvolve.data)res=data.GSSequenceTaiXiuEvolve.data;if(callback)callback(res)})},
getHistory:function(callback){var abc={"command":"GET_HISTORY_EVENT","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"limit":100,"skip":0,"key":"GSSequenceTaiXiuEvolve"};if(!HostConfig.services||!HostConfig.services.campaignGs)return;HttpRequest.requestGETMethod(HostConfig.services.campaignGs,"",abc,function(cmd,data){var res=null;if(data&&data.GSSequenceTaiXiuEvolve&&data.GSSequenceTaiXiuEvolve.data&&data.GSSequenceTaiXiuEvolve.data.items)res=data.GSSequenceTaiXiuEvolve.data.items;
if(callback)callback(res)})}},CardGameJackpot:{getInfo:function(callback){if(!HostConfig.services||!HostConfig.services.campaignUams)return;var abc={"command":"ACTION","applicationId":Distributor.applicationId,"key":"UAMSCardGameJackpot","action":{"command":"GET_JACKPOT"}};HttpRequest.requestPOSTMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},getTop:function(callback){if(!HostConfig.services||!HostConfig.services.campaignUams)return;
var abc={"command":"GET_HISTORY_EVENT","applicationId":Distributor.applicationId,"limit":100,"skip":0,"key":"UAMSCardGameJackpot"};HttpRequest.requestPOSTMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},getHistory:function(callback){if(!HostConfig.services||!HostConfig.services.campaignUams)return;var abc={"command":"GET_HISTORY_EVENT","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"limit":100,"skip":0,
"key":"UAMSCardGameJackpot"};HttpRequest.requestPOSTMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},increaseJackpot:function(){if(!HostConfig.services||!HostConfig.services.campaignUams)return;var abc={"command":"ACTION","applicationId":Distributor.applicationId,"key":"UAMSCardGameJackpot","action":{"command":"INCREASE_JACKPOT","amount":1E3}};HttpRequest.requestPOSTMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=
data||null;if(typeof callback=="function")callback(res)})}},getInfo:function(callback){var abc={"command":"GET_INFO_EVENT","applicationId":Distributor.applicationId};if(!HostConfig.services||!HostConfig.services.campaignUams)return;HttpRequest.requestGETMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},getTop:function(callback){var abc={"command":"TOP_EVENT_INFO","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,
"timestamp":(new Date).getTime(),"skip":0,"limit":50};if(!HostConfig.services||!HostConfig.services.campaignUams)return;HttpRequest.requestGETMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},getBXH:function(timestamp,callback){var abc={"command":"TOP_EVENT_INFO","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"timestamp":timestamp,"skip":0,"limit":50};if(!HostConfig.services||!HostConfig.services.campaignUams)return;
HttpRequest.requestGETMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})},getHistory:function(callback){var abc={"command":"GET_HISTORY_EVENT","applicationId":Distributor.applicationId,"displayName":PlayerMe.displayName,"limit":50,"skip":0};if(!HostConfig.services||!HostConfig.services.campaignUams)return;HttpRequest.requestGETMethod(HostConfig.services.campaignUams,"",abc,function(cmd,data){var res=data||null;if(callback)callback(res)})}};!function(a){"function"==typeof define&&define.amd?define(["jquery"],a):"undefined"!=typeof exports?module.exports=a(require("jquery")):a(jQuery)}(function(a){var b=window.Slick||{};b=function(){function c(c,d){var f,e=this;e.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:a(c),appendDots:a(c),arrows:!0,asNavFor:null,prevArrow:'\x3cbutton type\x3d"button" data-role\x3d"none" class\x3d"slick-prev" aria-label\x3d"Previous" tabindex\x3d"0" role\x3d"button"\x3ePrevious\x3c/button\x3e',nextArrow:'\x3cbutton type\x3d"button" data-role\x3d"none" class\x3d"slick-next" aria-label\x3d"Next" tabindex\x3d"0" role\x3d"button"\x3eNext\x3c/button\x3e',
autoplay:!1,autoplaySpeed:3E3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(b,c){return a('\x3cbutton type\x3d"button" data-role\x3d"none" role\x3d"button" tabindex\x3d"0" /\x3e').text(c+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,
slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1E3},e.initials={animating:!1,dragging:!1,autoPlayTimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,
$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},a.extend(e,e.initials),e.activeBreakpoint=null,e.animType=null,e.animProp=null,e.breakpoints=[],e.breakpointSettings=[],e.cssTransitions=!1,e.focussed=!1,e.interrupted=!1,e.hidden="hidden",e.paused=!0,e.positionProp=null,e.respondTo=null,e.rowCount=1,e.shouldClick=!0,e.$slider=a(c),e.$slidesCache=null,e.transformType=null,e.transitionType=null,e.visibilityChange="visibilitychange",e.windowWidth=0,e.windowTimer=null,f=a(c).data("slick")||
{},e.options=a.extend({},e.defaults,d,f),e.currentSlide=e.options.initialSlide,e.originalSettings=e.options,"undefined"!=typeof document.mozHidden?(e.hidden="mozHidden",e.visibilityChange="mozvisibilitychange"):"undefined"!=typeof document.webkitHidden&&(e.hidden="webkitHidden",e.visibilityChange="webkitvisibilitychange"),e.autoPlay=a.proxy(e.autoPlay,e),e.autoPlayClear=a.proxy(e.autoPlayClear,e),e.autoPlayIterator=a.proxy(e.autoPlayIterator,e),e.changeSlide=a.proxy(e.changeSlide,e),e.clickHandler=
a.proxy(e.clickHandler,e),e.selectHandler=a.proxy(e.selectHandler,e),e.setPosition=a.proxy(e.setPosition,e),e.swipeHandler=a.proxy(e.swipeHandler,e),e.dragHandler=a.proxy(e.dragHandler,e),e.keyHandler=a.proxy(e.keyHandler,e),e.instanceUid=b++,e.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,e.registerBreakpoints(),e.init(!0)}var b=0;return c}(),b.prototype.activateADA=function(){var a=this;a.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},
b.prototype.addSlide=b.prototype.slickAdd=function(b,c,d){var e=this;if("boolean"==typeof c)d=c,c=null;else if(0>c||c>=e.slideCount)return!1;e.unload(),"number"==typeof c?0===c&&0===e.$slides.length?a(b).appendTo(e.$slideTrack):d?a(b).insertBefore(e.$slides.eq(c)):a(b).insertAfter(e.$slides.eq(c)):d===!0?a(b).prependTo(e.$slideTrack):a(b).appendTo(e.$slideTrack),e.$slides=e.$slideTrack.children(this.options.slide),e.$slideTrack.children(this.options.slide).detach(),e.$slideTrack.append(e.$slides),
e.$slides.each(function(b,c){a(c).attr("data-slick-index",b)}),e.$slidesCache=e.$slides,e.reinit()},b.prototype.animateHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.animate({height:b},a.options.speed)}},b.prototype.animateSlide=function(b,c){var d={},e=this;e.animateHeight(),e.options.rtl===!0&&e.options.vertical===!1&&(b=-b),e.transformsEnabled===!1?e.options.vertical===
!1?e.$slideTrack.animate({left:b},e.options.speed,e.options.easing,c):e.$slideTrack.animate({top:b},e.options.speed,e.options.easing,c):e.cssTransitions===!1?(e.options.rtl===!0&&(e.currentLeft=-e.currentLeft),a({animStart:e.currentLeft}).animate({animStart:b},{duration:e.options.speed,easing:e.options.easing,step:function(a){a=Math.ceil(a),e.options.vertical===!1?(d[e.animType]="translate("+a+"px, 0px)",e.$slideTrack.css(d)):(d[e.animType]="translate(0px,"+a+"px)",e.$slideTrack.css(d))},complete:function(){c&&
c.call()}})):(e.applyTransition(),b=Math.ceil(b),e.options.vertical===!1?d[e.animType]="translate3d("+b+"px, 0px, 0px)":d[e.animType]="translate3d(0px,"+b+"px, 0px)",e.$slideTrack.css(d),c&&setTimeout(function(){e.disableTransition(),c.call()},e.options.speed))},b.prototype.getNavTarget=function(){var b=this,c=b.options.asNavFor;return c&&null!==c&&(c=a(c).not(b.$slider)),c},b.prototype.asNavFor=function(b){var c=this,d=c.getNavTarget();null!==d&&"object"==typeof d&&d.each(function(){var c=a(this).slick("getSlick");
c.unslicked||c.slideHandler(b,!0)})},b.prototype.applyTransition=function(a){var b=this,c={};b.options.fade===!1?c[b.transitionType]=b.transformType+" "+b.options.speed+"ms "+b.options.cssEase:c[b.transitionType]="opacity "+b.options.speed+"ms "+b.options.cssEase,b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.autoPlay=function(){var a=this;a.autoPlayClear(),a.slideCount>a.options.slidesToShow&&(a.autoPlayTimer=setInterval(a.autoPlayIterator,a.options.autoplaySpeed))},
b.prototype.autoPlayClear=function(){var a=this;a.autoPlayTimer&&clearInterval(a.autoPlayTimer)},b.prototype.autoPlayIterator=function(){var a=this,b=a.currentSlide+a.options.slidesToScroll;a.paused||a.interrupted||a.focussed||(a.options.infinite===!1&&(1===a.direction&&a.currentSlide+1===a.slideCount-1?a.direction=0:0===a.direction&&(b=a.currentSlide-a.options.slidesToScroll,a.currentSlide-1===0&&(a.direction=1))),a.slideHandler(b))},b.prototype.buildArrows=function(){var b=this;b.options.arrows===
!0&&(b.$prevArrow=a(b.options.prevArrow).addClass("slick-arrow"),b.$nextArrow=a(b.options.nextArrow).addClass("slick-arrow"),b.slideCount>b.options.slidesToShow?(b.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.prependTo(b.options.appendArrows),b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.appendTo(b.options.appendArrows),b.options.infinite!==
!0&&b.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):b.$prevArrow.add(b.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},b.prototype.buildDots=function(){var c,d,b=this;if(b.options.dots===!0&&b.slideCount>b.options.slidesToShow){for(b.$slider.addClass("slick-dotted"),d=a("\x3cul /\x3e").addClass(b.options.dotsClass),c=0;c<=b.getDotCount();c+=1)d.append(a("\x3cli /\x3e").append(b.options.customPaging.call(this,b,c)));b.$dots=d.appendTo(b.options.appendDots),
b.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},b.prototype.buildOut=function(){var b=this;b.$slides=b.$slider.children(b.options.slide+":not(.slick-cloned)").addClass("slick-slide"),b.slideCount=b.$slides.length,b.$slides.each(function(b,c){a(c).attr("data-slick-index",b).data("originalStyling",a(c).attr("style")||"")}),b.$slider.addClass("slick-slider"),b.$slideTrack=0===b.slideCount?a('\x3cdiv class\x3d"slick-track"/\x3e').appendTo(b.$slider):b.$slides.wrapAll('\x3cdiv class\x3d"slick-track"/\x3e').parent(),
b.$list=b.$slideTrack.wrap('\x3cdiv aria-live\x3d"polite" class\x3d"slick-list"/\x3e').parent(),b.$slideTrack.css("opacity",0),(b.options.centerMode===!0||b.options.swipeToSlide===!0)&&(b.options.slidesToScroll=1),a("img[data-lazy]",b.$slider).not("[src]").addClass("slick-loading"),b.setupInfinite(),b.buildArrows(),b.buildDots(),b.updateDots(),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.options.draggable===!0&&b.$list.addClass("draggable")},b.prototype.buildRows=function(){var b,
c,d,e,f,g,h,a=this;if(e=document.createDocumentFragment(),g=a.$slider.children(),a.options.rows>1){for(h=a.options.slidesPerRow*a.options.rows,f=Math.ceil(g.length/h),b=0;f>b;b++){var i=document.createElement("div");for(c=0;c<a.options.rows;c++){var j=document.createElement("div");for(d=0;d<a.options.slidesPerRow;d++){var k=b*h+(c*a.options.slidesPerRow+d);g.get(k)&&j.appendChild(g.get(k))}i.appendChild(j)}e.appendChild(i)}a.$slider.empty().append(e),a.$slider.children().children().children().css({width:100/
a.options.slidesPerRow+"%",display:"inline-block"})}},b.prototype.checkResponsive=function(b,c){var e,f,g,d=this,h=!1,i=d.$slider.width(),j=window.innerWidth||a(window).width();if("window"===d.respondTo?g=j:"slider"===d.respondTo?g=i:"min"===d.respondTo&&(g=Math.min(j,i)),d.options.responsive&&d.options.responsive.length&&null!==d.options.responsive){f=null;for(e in d.breakpoints)d.breakpoints.hasOwnProperty(e)&&(d.originalSettings.mobileFirst===!1?g<d.breakpoints[e]&&(f=d.breakpoints[e]):g>d.breakpoints[e]&&
(f=d.breakpoints[e]));null!==f?null!==d.activeBreakpoint?(f!==d.activeBreakpoint||c)&&(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):(d.activeBreakpoint=f,"unslick"===d.breakpointSettings[f]?d.unslick(f):(d.options=a.extend({},d.originalSettings,d.breakpointSettings[f]),b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b)),h=f):null!==
d.activeBreakpoint&&(d.activeBreakpoint=null,d.options=d.originalSettings,b===!0&&(d.currentSlide=d.options.initialSlide),d.refresh(b),h=f),b||h===!1||d.$slider.trigger("breakpoint",[d,h])}},b.prototype.changeSlide=function(b,c){var f,g,h,d=this,e=a(b.currentTarget);switch(e.is("a")&&b.preventDefault(),e.is("li")||(e=e.closest("li")),h=d.slideCount%d.options.slidesToScroll!==0,f=h?0:(d.slideCount-d.currentSlide)%d.options.slidesToScroll,b.data.message){case "previous":g=0===f?d.options.slidesToScroll:
d.options.slidesToShow-f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide-g,!1,c);break;case "next":g=0===f?d.options.slidesToScroll:f,d.slideCount>d.options.slidesToShow&&d.slideHandler(d.currentSlide+g,!1,c);break;case "index":var i=0===b.data.index?0:b.data.index||e.index()*d.options.slidesToScroll;d.slideHandler(d.checkNavigable(i),!1,c),e.children().trigger("focus");break;default:return}},b.prototype.checkNavigable=function(a){var c,d,b=this;if(c=b.getNavigableIndexes(),d=0,
a>c[c.length-1])a=c[c.length-1];else for(var e in c){if(a<c[e]){a=d;break}d=c[e]}return a},b.prototype.cleanUpEvents=function(){var b=this;b.options.dots&&null!==b.$dots&&a("li",b.$dots).off("click.slick",b.changeSlide).off("mouseenter.slick",a.proxy(b.interrupt,b,!0)).off("mouseleave.slick",a.proxy(b.interrupt,b,!1)),b.$slider.off("focus.slick blur.slick"),b.options.arrows===!0&&b.slideCount>b.options.slidesToShow&&(b.$prevArrow&&b.$prevArrow.off("click.slick",b.changeSlide),b.$nextArrow&&b.$nextArrow.off("click.slick",
b.changeSlide)),b.$list.off("touchstart.slick mousedown.slick",b.swipeHandler),b.$list.off("touchmove.slick mousemove.slick",b.swipeHandler),b.$list.off("touchend.slick mouseup.slick",b.swipeHandler),b.$list.off("touchcancel.slick mouseleave.slick",b.swipeHandler),b.$list.off("click.slick",b.clickHandler),a(document).off(b.visibilityChange,b.visibility),b.cleanUpSlideEvents(),b.options.accessibility===!0&&b.$list.off("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().off("click.slick",
b.selectHandler),a(window).off("orientationchange.slick.slick-"+b.instanceUid,b.orientationChange),a(window).off("resize.slick.slick-"+b.instanceUid,b.resize),a("[draggable!\x3dtrue]",b.$slideTrack).off("dragstart",b.preventDefault),a(window).off("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).off("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.cleanUpSlideEvents=function(){var b=this;b.$list.off("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.off("mouseleave.slick",
a.proxy(b.interrupt,b,!1))},b.prototype.cleanUpRows=function(){var b,a=this;a.options.rows>1&&(b=a.$slides.children().children(),b.removeAttr("style"),a.$slider.empty().append(b))},b.prototype.clickHandler=function(a){var b=this;b.shouldClick===!1&&(a.stopImmediatePropagation(),a.stopPropagation(),a.preventDefault())},b.prototype.destroy=function(b){var c=this;c.autoPlayClear(),c.touchObject={},c.cleanUpEvents(),a(".slick-cloned",c.$slider).detach(),c.$dots&&c.$dots.remove(),c.$prevArrow&&c.$prevArrow.length&&
(c.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.prevArrow)&&c.$prevArrow.remove()),c.$nextArrow&&c.$nextArrow.length&&(c.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),c.htmlExpr.test(c.options.nextArrow)&&c.$nextArrow.remove()),c.$slides&&(c.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){a(this).attr("style",
a(this).data("originalStyling"))}),c.$slideTrack.children(this.options.slide).detach(),c.$slideTrack.detach(),c.$list.detach(),c.$slider.append(c.$slides)),c.cleanUpRows(),c.$slider.removeClass("slick-slider"),c.$slider.removeClass("slick-initialized"),c.$slider.removeClass("slick-dotted"),c.unslicked=!0,b||c.$slider.trigger("destroy",[c])},b.prototype.disableTransition=function(a){var b=this,c={};c[b.transitionType]="",b.options.fade===!1?b.$slideTrack.css(c):b.$slides.eq(a).css(c)},b.prototype.fadeSlide=
function(a,b){var c=this;c.cssTransitions===!1?(c.$slides.eq(a).css({zIndex:c.options.zIndex}),c.$slides.eq(a).animate({opacity:1},c.options.speed,c.options.easing,b)):(c.applyTransition(a),c.$slides.eq(a).css({opacity:1,zIndex:c.options.zIndex}),b&&setTimeout(function(){c.disableTransition(a),b.call()},c.options.speed))},b.prototype.fadeSlideOut=function(a){var b=this;b.cssTransitions===!1?b.$slides.eq(a).animate({opacity:0,zIndex:b.options.zIndex-2},b.options.speed,b.options.easing):(b.applyTransition(a),
b.$slides.eq(a).css({opacity:0,zIndex:b.options.zIndex-2}))},b.prototype.filterSlides=b.prototype.slickFilter=function(a){var b=this;null!==a&&(b.$slidesCache=b.$slides,b.unload(),b.$slideTrack.children(this.options.slide).detach(),b.$slidesCache.filter(a).appendTo(b.$slideTrack),b.reinit())},b.prototype.focusHandler=function(){var b=this;b.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(c){c.stopImmediatePropagation();var d=a(this);setTimeout(function(){b.options.pauseOnFocus&&
(b.focussed=d.is(":focus"),b.autoPlay())},0)})},b.prototype.getCurrent=b.prototype.slickCurrentSlide=function(){var a=this;return a.currentSlide},b.prototype.getDotCount=function(){var a=this,b=0,c=0,d=0;if(a.options.infinite===!0)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else if(a.options.centerMode===!0)d=a.slideCount;else if(a.options.asNavFor)for(;b<a.slideCount;)++d,b=c+a.options.slidesToScroll,
c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;else d=1+Math.ceil((a.slideCount-a.options.slidesToShow)/a.options.slidesToScroll);return d-1},b.prototype.getLeft=function(a){var c,d,f,b=this,e=0;return b.slideOffset=0,d=b.$slides.first().outerHeight(!0),b.options.infinite===!0?(b.slideCount>b.options.slidesToShow&&(b.slideOffset=b.slideWidth*b.options.slidesToShow*-1,e=d*b.options.slidesToShow*-1),b.slideCount%b.options.slidesToScroll!==0&&a+b.options.slidesToScroll>
b.slideCount&&b.slideCount>b.options.slidesToShow&&(a>b.slideCount?(b.slideOffset=(b.options.slidesToShow-(a-b.slideCount))*b.slideWidth*-1,e=(b.options.slidesToShow-(a-b.slideCount))*d*-1):(b.slideOffset=b.slideCount%b.options.slidesToScroll*b.slideWidth*-1,e=b.slideCount%b.options.slidesToScroll*d*-1))):a+b.options.slidesToShow>b.slideCount&&(b.slideOffset=(a+b.options.slidesToShow-b.slideCount)*b.slideWidth,e=(a+b.options.slidesToShow-b.slideCount)*d),b.slideCount<=b.options.slidesToShow&&(b.slideOffset=
0,e=0),b.options.centerMode===!0&&b.options.infinite===!0?b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)-b.slideWidth:b.options.centerMode===!0&&(b.slideOffset=0,b.slideOffset+=b.slideWidth*Math.floor(b.options.slidesToShow/2)),c=b.options.vertical===!1?a*b.slideWidth*-1+b.slideOffset:a*d*-1+e,b.options.variableWidth===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow),
c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,b.options.centerMode===!0&&(f=b.slideCount<=b.options.slidesToShow||b.options.infinite===!1?b.$slideTrack.children(".slick-slide").eq(a):b.$slideTrack.children(".slick-slide").eq(a+b.options.slidesToShow+1),c=b.options.rtl===!0?f[0]?-1*(b.$slideTrack.width()-f[0].offsetLeft-f.width()):0:f[0]?-1*f[0].offsetLeft:0,c+=(b.$list.width()-f.outerWidth())/2)),c},b.prototype.getOption=b.prototype.slickGetOption=
function(a){var b=this;return b.options[a]},b.prototype.getNavigableIndexes=function(){var e,a=this,b=0,c=0,d=[];for(a.options.infinite===!1?e=a.slideCount:(b=-1*a.options.slidesToScroll,c=-1*a.options.slidesToScroll,e=2*a.slideCount);e>b;)d.push(b),b=c+a.options.slidesToScroll,c+=a.options.slidesToScroll<=a.options.slidesToShow?a.options.slidesToScroll:a.options.slidesToShow;return d},b.prototype.getSlick=function(){return this},b.prototype.getSlideCount=function(){var c,d,e,b=this;return e=b.options.centerMode===
!0?b.slideWidth*Math.floor(b.options.slidesToShow/2):0,b.options.swipeToSlide===!0?(b.$slideTrack.find(".slick-slide").each(function(c,f){return f.offsetLeft-e+a(f).outerWidth()/2>-1*b.swipeLeft?(d=f,!1):void 0}),c=Math.abs(a(d).attr("data-slick-index")-b.currentSlide)||1):b.options.slidesToScroll},b.prototype.goTo=b.prototype.slickGoTo=function(a,b){var c=this;c.changeSlide({data:{message:"index",index:parseInt(a)}},b)},b.prototype.init=function(b){var c=this;a(c.$slider).hasClass("slick-initialized")||
(a(c.$slider).addClass("slick-initialized"),c.buildRows(),c.buildOut(),c.setProps(),c.startLoad(),c.loadSlider(),c.initializeEvents(),c.updateArrows(),c.updateDots(),c.checkResponsive(!0),c.focusHandler()),b&&c.$slider.trigger("init",[c]),c.options.accessibility===!0&&c.initADA(),c.options.autoplay&&(c.paused=!1,c.autoPlay())},b.prototype.initADA=function(){var b=this;b.$slides.add(b.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),
b.$slideTrack.attr("role","listbox"),b.$slides.not(b.$slideTrack.find(".slick-cloned")).each(function(c){a(this).attr({role:"option","aria-describedby":"slick-slide"+b.instanceUid+c})}),null!==b.$dots&&b.$dots.attr("role","tablist").find("li").each(function(c){a(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+b.instanceUid+c,id:"slick-slide"+b.instanceUid+c})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role",
"toolbar"),b.activateADA()},b.prototype.initArrowEvents=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},a.changeSlide),a.$nextArrow.off("click.slick").on("click.slick",{message:"next"},a.changeSlide))},b.prototype.initDotEvents=function(){var b=this;b.options.dots===!0&&b.slideCount>b.options.slidesToShow&&a("li",b.$dots).on("click.slick",{message:"index"},b.changeSlide),b.options.dots===!0&&b.options.pauseOnDotsHover===
!0&&a("li",b.$dots).on("mouseenter.slick",a.proxy(b.interrupt,b,!0)).on("mouseleave.slick",a.proxy(b.interrupt,b,!1))},b.prototype.initSlideEvents=function(){var b=this;b.options.pauseOnHover&&(b.$list.on("mouseenter.slick",a.proxy(b.interrupt,b,!0)),b.$list.on("mouseleave.slick",a.proxy(b.interrupt,b,!1)))},b.prototype.initializeEvents=function(){var b=this;b.initArrowEvents(),b.initDotEvents(),b.initSlideEvents(),b.$list.on("touchstart.slick mousedown.slick",{action:"start"},b.swipeHandler),b.$list.on("touchmove.slick mousemove.slick",
{action:"move"},b.swipeHandler),b.$list.on("touchend.slick mouseup.slick",{action:"end"},b.swipeHandler),b.$list.on("touchcancel.slick mouseleave.slick",{action:"end"},b.swipeHandler),b.$list.on("click.slick",b.clickHandler),a(document).on(b.visibilityChange,a.proxy(b.visibility,b)),b.options.accessibility===!0&&b.$list.on("keydown.slick",b.keyHandler),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),a(window).on("orientationchange.slick.slick-"+b.instanceUid,
a.proxy(b.orientationChange,b)),a(window).on("resize.slick.slick-"+b.instanceUid,a.proxy(b.resize,b)),a("[draggable!\x3dtrue]",b.$slideTrack).on("dragstart",b.preventDefault),a(window).on("load.slick.slick-"+b.instanceUid,b.setPosition),a(document).on("ready.slick.slick-"+b.instanceUid,b.setPosition)},b.prototype.initUI=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.show(),a.$nextArrow.show()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&
a.$dots.show()},b.prototype.keyHandler=function(a){var b=this;a.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===a.keyCode&&b.options.accessibility===!0?b.changeSlide({data:{message:b.options.rtl===!0?"next":"previous"}}):39===a.keyCode&&b.options.accessibility===!0&&b.changeSlide({data:{message:b.options.rtl===!0?"previous":"next"}}))},b.prototype.lazyLoad=function(){function g(c){a("img[data-lazy]",c).each(function(){var c=a(this),d=a(this).attr("data-lazy"),e=document.createElement("img");
e.onload=function(){c.animate({opacity:0},100,function(){c.attr("src",d).animate({opacity:1},200,function(){c.removeAttr("data-lazy").removeClass("slick-loading")}),b.$slider.trigger("lazyLoaded",[b,c,d])})},e.onerror=function(){c.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),b.$slider.trigger("lazyLoadError",[b,c,d])},e.src=d})}var c,d,e,f,b=this;b.options.centerMode===!0?b.options.infinite===!0?(e=b.currentSlide+(b.options.slidesToShow/2+1),f=e+b.options.slidesToShow+
2):(e=Math.max(0,b.currentSlide-(b.options.slidesToShow/2+1)),f=2+(b.options.slidesToShow/2+1)+b.currentSlide):(e=b.options.infinite?b.options.slidesToShow+b.currentSlide:b.currentSlide,f=Math.ceil(e+b.options.slidesToShow),b.options.fade===!0&&(e>0&&e--,f<=b.slideCount&&f++)),c=b.$slider.find(".slick-slide").slice(e,f),g(c),b.slideCount<=b.options.slidesToShow?(d=b.$slider.find(".slick-slide"),g(d)):b.currentSlide>=b.slideCount-b.options.slidesToShow?(d=b.$slider.find(".slick-cloned").slice(0,b.options.slidesToShow),
g(d)):0===b.currentSlide&&(d=b.$slider.find(".slick-cloned").slice(-1*b.options.slidesToShow),g(d))},b.prototype.loadSlider=function(){var a=this;a.setPosition(),a.$slideTrack.css({opacity:1}),a.$slider.removeClass("slick-loading"),a.initUI(),"progressive"===a.options.lazyLoad&&a.progressiveLazyLoad()},b.prototype.next=b.prototype.slickNext=function(){var a=this;a.changeSlide({data:{message:"next"}})},b.prototype.orientationChange=function(){var a=this;a.checkResponsive(),a.setPosition()},b.prototype.pause=
b.prototype.slickPause=function(){var a=this;a.autoPlayClear(),a.paused=!0},b.prototype.play=b.prototype.slickPlay=function(){var a=this;a.autoPlay(),a.options.autoplay=!0,a.paused=!1,a.focussed=!1,a.interrupted=!1},b.prototype.postSlide=function(a){var b=this;b.unslicked||(b.$slider.trigger("afterChange",[b,a]),b.animating=!1,b.setPosition(),b.swipeLeft=null,b.options.autoplay&&b.autoPlay(),b.options.accessibility===!0&&b.initADA())},b.prototype.prev=b.prototype.slickPrev=function(){var a=this;a.changeSlide({data:{message:"previous"}})},
b.prototype.preventDefault=function(a){a.preventDefault()},b.prototype.progressiveLazyLoad=function(b){b=b||1;var e,f,g,c=this,d=a("img[data-lazy]",c.$slider);d.length?(e=d.first(),f=e.attr("data-lazy"),g=document.createElement("img"),g.onload=function(){e.attr("src",f).removeAttr("data-lazy").removeClass("slick-loading"),c.options.adaptiveHeight===!0&&c.setPosition(),c.$slider.trigger("lazyLoaded",[c,e,f]),c.progressiveLazyLoad()},g.onerror=function(){3>b?setTimeout(function(){c.progressiveLazyLoad(b+
1)},500):(e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),c.$slider.trigger("lazyLoadError",[c,e,f]),c.progressiveLazyLoad())},g.src=f):c.$slider.trigger("allImagesLoaded",[c])},b.prototype.refresh=function(b){var d,e,c=this;e=c.slideCount-c.options.slidesToShow,!c.options.infinite&&c.currentSlide>e&&(c.currentSlide=e),c.slideCount<=c.options.slidesToShow&&(c.currentSlide=0),d=c.currentSlide,c.destroy(!0),a.extend(c,c.initials,{currentSlide:d}),c.init(),b||
c.changeSlide({data:{message:"index",index:d}},!1)},b.prototype.registerBreakpoints=function(){var c,d,e,b=this,f=b.options.responsive||null;if("array"===a.type(f)&&f.length){b.respondTo=b.options.respondTo||"window";for(c in f)if(e=b.breakpoints.length-1,d=f[c].breakpoint,f.hasOwnProperty(c)){for(;e>=0;)b.breakpoints[e]&&b.breakpoints[e]===d&&b.breakpoints.splice(e,1),e--;b.breakpoints.push(d),b.breakpointSettings[d]=f[c].settings}b.breakpoints.sort(function(a,c){return b.options.mobileFirst?a-c:
c-a})}},b.prototype.reinit=function(){var b=this;b.$slides=b.$slideTrack.children(b.options.slide).addClass("slick-slide"),b.slideCount=b.$slides.length,b.currentSlide>=b.slideCount&&0!==b.currentSlide&&(b.currentSlide=b.currentSlide-b.options.slidesToScroll),b.slideCount<=b.options.slidesToShow&&(b.currentSlide=0),b.registerBreakpoints(),b.setProps(),b.setupInfinite(),b.buildArrows(),b.updateArrows(),b.initArrowEvents(),b.buildDots(),b.updateDots(),b.initDotEvents(),b.cleanUpSlideEvents(),b.initSlideEvents(),
b.checkResponsive(!1,!0),b.options.focusOnSelect===!0&&a(b.$slideTrack).children().on("click.slick",b.selectHandler),b.setSlideClasses("number"==typeof b.currentSlide?b.currentSlide:0),b.setPosition(),b.focusHandler(),b.paused=!b.options.autoplay,b.autoPlay(),b.$slider.trigger("reInit",[b])},b.prototype.resize=function(){var b=this;a(window).width()!==b.windowWidth&&(clearTimeout(b.windowDelay),b.windowDelay=window.setTimeout(function(){b.windowWidth=a(window).width(),b.checkResponsive(),b.unslicked||
b.setPosition()},50))},b.prototype.removeSlide=b.prototype.slickRemove=function(a,b,c){var d=this;return"boolean"==typeof a?(b=a,a=b===!0?0:d.slideCount-1):a=b===!0?--a:a,d.slideCount<1||0>a||a>d.slideCount-1?!1:(d.unload(),c===!0?d.$slideTrack.children().remove():d.$slideTrack.children(this.options.slide).eq(a).remove(),d.$slides=d.$slideTrack.children(this.options.slide),d.$slideTrack.children(this.options.slide).detach(),d.$slideTrack.append(d.$slides),d.$slidesCache=d.$slides,void d.reinit())},
b.prototype.setCSS=function(a){var d,e,b=this,c={};b.options.rtl===!0&&(a=-a),d="left"==b.positionProp?Math.ceil(a)+"px":"0px",e="top"==b.positionProp?Math.ceil(a)+"px":"0px",c[b.positionProp]=a,b.transformsEnabled===!1?b.$slideTrack.css(c):(c={},b.cssTransitions===!1?(c[b.animType]="translate("+d+", "+e+")",b.$slideTrack.css(c)):(c[b.animType]="translate3d("+d+", "+e+", 0px)",b.$slideTrack.css(c)))},b.prototype.setDimensions=function(){var a=this;a.options.vertical===!1?a.options.centerMode===!0&&
a.$list.css({padding:"0px "+a.options.centerPadding}):(a.$list.height(a.$slides.first().outerHeight(!0)*a.options.slidesToShow),a.options.centerMode===!0&&a.$list.css({padding:a.options.centerPadding+" 0px"})),a.listWidth=a.$list.width(),a.listHeight=a.$list.height(),a.options.vertical===!1&&a.options.variableWidth===!1?(a.slideWidth=Math.ceil(a.listWidth/a.options.slidesToShow),a.$slideTrack.width(Math.ceil(a.slideWidth*a.$slideTrack.children(".slick-slide").length))):a.options.variableWidth===!0?
a.$slideTrack.width(5E3*a.slideCount):(a.slideWidth=Math.ceil(a.listWidth),a.$slideTrack.height(Math.ceil(a.$slides.first().outerHeight(!0)*a.$slideTrack.children(".slick-slide").length)));var b=a.$slides.first().outerWidth(!0)-a.$slides.first().width();a.options.variableWidth===!1&&a.$slideTrack.children(".slick-slide").width(a.slideWidth-b)},b.prototype.setFade=function(){var c,b=this;b.$slides.each(function(d,e){c=b.slideWidth*d*-1,b.options.rtl===!0?a(e).css({position:"relative",right:c,top:0,
zIndex:b.options.zIndex-2,opacity:0}):a(e).css({position:"relative",left:c,top:0,zIndex:b.options.zIndex-2,opacity:0})}),b.$slides.eq(b.currentSlide).css({zIndex:b.options.zIndex-1,opacity:1})},b.prototype.setHeight=function(){var a=this;if(1===a.options.slidesToShow&&a.options.adaptiveHeight===!0&&a.options.vertical===!1){var b=a.$slides.eq(a.currentSlide).outerHeight(!0);a.$list.css("height",b)}},b.prototype.setOption=b.prototype.slickSetOption=function(){var c,d,e,f,h,b=this,g=!1;if("object"===
a.type(arguments[0])?(e=arguments[0],g=arguments[1],h="multiple"):"string"===a.type(arguments[0])&&(e=arguments[0],f=arguments[1],g=arguments[2],"responsive"===arguments[0]&&"array"===a.type(arguments[1])?h="responsive":"undefined"!=typeof arguments[1]&&(h="single")),"single"===h)b.options[e]=f;else if("multiple"===h)a.each(e,function(a,c){b.options[a]=c});else if("responsive"===h)for(d in f)if("array"!==a.type(b.options.responsive))b.options.responsive=[f[d]];else{for(c=b.options.responsive.length-
1;c>=0;)b.options.responsive[c].breakpoint===f[d].breakpoint&&b.options.responsive.splice(c,1),c--;b.options.responsive.push(f[d])}g&&(b.unload(),b.reinit())},b.prototype.setPosition=function(){var a=this;a.setDimensions(),a.setHeight(),a.options.fade===!1?a.setCSS(a.getLeft(a.currentSlide)):a.setFade(),a.$slider.trigger("setPosition",[a])},b.prototype.setProps=function(){var a=this,b=document.body.style;a.positionProp=a.options.vertical===!0?"top":"left","top"===a.positionProp?a.$slider.addClass("slick-vertical"):
a.$slider.removeClass("slick-vertical"),(void 0!==b.WebkitTransition||void 0!==b.MozTransition||void 0!==b.msTransition)&&a.options.useCSS===!0&&(a.cssTransitions=!0),a.options.fade&&("number"==typeof a.options.zIndex?a.options.zIndex<3&&(a.options.zIndex=3):a.options.zIndex=a.defaults.zIndex),void 0!==b.OTransform&&(a.animType="OTransform",a.transformType="-o-transform",a.transitionType="OTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.MozTransform&&
(a.animType="MozTransform",a.transformType="-moz-transform",a.transitionType="MozTransition",void 0===b.perspectiveProperty&&void 0===b.MozPerspective&&(a.animType=!1)),void 0!==b.webkitTransform&&(a.animType="webkitTransform",a.transformType="-webkit-transform",a.transitionType="webkitTransition",void 0===b.perspectiveProperty&&void 0===b.webkitPerspective&&(a.animType=!1)),void 0!==b.msTransform&&(a.animType="msTransform",a.transformType="-ms-transform",a.transitionType="msTransition",void 0===
b.msTransform&&(a.animType=!1)),void 0!==b.transform&&a.animType!==!1&&(a.animType="transform",a.transformType="transform",a.transitionType="transition"),a.transformsEnabled=a.options.useTransform&&null!==a.animType&&a.animType!==!1},b.prototype.setSlideClasses=function(a){var c,d,e,f,b=this;d=b.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),b.$slides.eq(a).addClass("slick-current"),b.options.centerMode===!0?(c=Math.floor(b.options.slidesToShow/
2),b.options.infinite===!0&&(a>=c&&a<=b.slideCount-1-c?b.$slides.slice(a-c,a+c+1).addClass("slick-active").attr("aria-hidden","false"):(e=b.options.slidesToShow+a,d.slice(e-c+1,e+c+2).addClass("slick-active").attr("aria-hidden","false")),0===a?d.eq(d.length-1-b.options.slidesToShow).addClass("slick-center"):a===b.slideCount-1&&d.eq(b.options.slidesToShow).addClass("slick-center")),b.$slides.eq(a).addClass("slick-center")):a>=0&&a<=b.slideCount-b.options.slidesToShow?b.$slides.slice(a,a+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden",
"false"):d.length<=b.options.slidesToShow?d.addClass("slick-active").attr("aria-hidden","false"):(f=b.slideCount%b.options.slidesToShow,e=b.options.infinite===!0?b.options.slidesToShow+a:a,b.options.slidesToShow==b.options.slidesToScroll&&b.slideCount-a<b.options.slidesToShow?d.slice(e-(b.options.slidesToShow-f),e+f).addClass("slick-active").attr("aria-hidden","false"):d.slice(e,e+b.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===b.options.lazyLoad&&b.lazyLoad()},
b.prototype.setupInfinite=function(){var c,d,e,b=this;if(b.options.fade===!0&&(b.options.centerMode=!1),b.options.infinite===!0&&b.options.fade===!1&&(d=null,b.slideCount>b.options.slidesToShow)){for(e=b.options.centerMode===!0?b.options.slidesToShow+1:b.options.slidesToShow,c=b.slideCount;c>b.slideCount-e;c-=1)d=c-1,a(b.$slides[d]).clone(!0).attr("id","").attr("data-slick-index",d-b.slideCount).prependTo(b.$slideTrack).addClass("slick-cloned");for(c=0;e>c;c+=1)d=c,a(b.$slides[d]).clone(!0).attr("id",
"").attr("data-slick-index",d+b.slideCount).appendTo(b.$slideTrack).addClass("slick-cloned");b.$slideTrack.find(".slick-cloned").find("[id]").each(function(){a(this).attr("id","")})}},b.prototype.interrupt=function(a){var b=this;a||b.autoPlay(),b.interrupted=a},b.prototype.selectHandler=function(b){var c=this,d=a(b.target).is(".slick-slide")?a(b.target):a(b.target).parents(".slick-slide"),e=parseInt(d.attr("data-slick-index"));return e||(e=0),c.slideCount<=c.options.slidesToShow?(c.setSlideClasses(e),
void c.asNavFor(e)):void c.slideHandler(e)},b.prototype.slideHandler=function(a,b,c){var d,e,f,g,j,h=null,i=this;return b=b||!1,i.animating===!0&&i.options.waitForAnimate===!0||i.options.fade===!0&&i.currentSlide===a||i.slideCount<=i.options.slidesToShow?void 0:(b===!1&&i.asNavFor(a),d=a,h=i.getLeft(d),g=i.getLeft(i.currentSlide),i.currentLeft=null===i.swipeLeft?g:i.swipeLeft,i.options.infinite===!1&&i.options.centerMode===!1&&(0>a||a>i.getDotCount()*i.options.slidesToScroll)?void(i.options.fade===
!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):i.options.infinite===!1&&i.options.centerMode===!0&&(0>a||a>i.slideCount-i.options.slidesToScroll)?void(i.options.fade===!1&&(d=i.currentSlide,c!==!0?i.animateSlide(g,function(){i.postSlide(d)}):i.postSlide(d))):(i.options.autoplay&&clearInterval(i.autoPlayTimer),e=0>d?i.slideCount%i.options.slidesToScroll!==0?i.slideCount-i.slideCount%i.options.slidesToScroll:i.slideCount+d:d>=i.slideCount?i.slideCount%i.options.slidesToScroll!==
0?0:d-i.slideCount:d,i.animating=!0,i.$slider.trigger("beforeChange",[i,i.currentSlide,e]),f=i.currentSlide,i.currentSlide=e,i.setSlideClasses(i.currentSlide),i.options.asNavFor&&(j=i.getNavTarget(),j=j.slick("getSlick"),j.slideCount<=j.options.slidesToShow&&j.setSlideClasses(i.currentSlide)),i.updateDots(),i.updateArrows(),i.options.fade===!0?(c!==!0?(i.fadeSlideOut(f),i.fadeSlide(e,function(){i.postSlide(e)})):i.postSlide(e),void i.animateHeight()):void(c!==!0?i.animateSlide(h,function(){i.postSlide(e)}):
i.postSlide(e))))},b.prototype.startLoad=function(){var a=this;a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&(a.$prevArrow.hide(),a.$nextArrow.hide()),a.options.dots===!0&&a.slideCount>a.options.slidesToShow&&a.$dots.hide(),a.$slider.addClass("slick-loading")},b.prototype.swipeDirection=function(){var a,b,c,d,e=this;return a=e.touchObject.startX-e.touchObject.curX,b=e.touchObject.startY-e.touchObject.curY,c=Math.atan2(b,a),d=Math.round(180*c/Math.PI),0>d&&(d=360-Math.abs(d)),45>=d&&
d>=0?e.options.rtl===!1?"left":"right":360>=d&&d>=315?e.options.rtl===!1?"left":"right":d>=135&&225>=d?e.options.rtl===!1?"right":"left":e.options.verticalSwiping===!0?d>=35&&135>=d?"down":"up":"vertical"},b.prototype.swipeEnd=function(a){var c,d,b=this;if(b.dragging=!1,b.interrupted=!1,b.shouldClick=b.touchObject.swipeLength>10?!1:!0,void 0===b.touchObject.curX)return!1;if(b.touchObject.edgeHit===!0&&b.$slider.trigger("edge",[b,b.swipeDirection()]),b.touchObject.swipeLength>=b.touchObject.minSwipe){switch(d=
b.swipeDirection()){case "left":case "down":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide+b.getSlideCount()):b.currentSlide+b.getSlideCount(),b.currentDirection=0;break;case "right":case "up":c=b.options.swipeToSlide?b.checkNavigable(b.currentSlide-b.getSlideCount()):b.currentSlide-b.getSlideCount(),b.currentDirection=1}"vertical"!=d&&(b.slideHandler(c),b.touchObject={},b.$slider.trigger("swipe",[b,d]))}else b.touchObject.startX!==b.touchObject.curX&&(b.slideHandler(b.currentSlide),b.touchObject=
{})},b.prototype.swipeHandler=function(a){var b=this;if(!(b.options.swipe===!1||"ontouchend"in document&&b.options.swipe===!1||b.options.draggable===!1&&-1!==a.type.indexOf("mouse")))switch(b.touchObject.fingerCount=a.originalEvent&&void 0!==a.originalEvent.touches?a.originalEvent.touches.length:1,b.touchObject.minSwipe=b.listWidth/b.options.touchThreshold,b.options.verticalSwiping===!0&&(b.touchObject.minSwipe=b.listHeight/b.options.touchThreshold),a.data.action){case "start":b.swipeStart(a);break;
case "move":b.swipeMove(a);break;case "end":b.swipeEnd(a)}},b.prototype.swipeMove=function(a){var d,e,f,g,h,b=this;return h=void 0!==a.originalEvent?a.originalEvent.touches:null,!b.dragging||h&&1!==h.length?!1:(d=b.getLeft(b.currentSlide),b.touchObject.curX=void 0!==h?h[0].pageX:a.clientX,b.touchObject.curY=void 0!==h?h[0].pageY:a.clientY,b.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(b.touchObject.curX-b.touchObject.startX,2))),b.options.verticalSwiping===!0&&(b.touchObject.swipeLength=
Math.round(Math.sqrt(Math.pow(b.touchObject.curY-b.touchObject.startY,2)))),e=b.swipeDirection(),"vertical"!==e?(void 0!==a.originalEvent&&b.touchObject.swipeLength>4&&a.preventDefault(),g=(b.options.rtl===!1?1:-1)*(b.touchObject.curX>b.touchObject.startX?1:-1),b.options.verticalSwiping===!0&&(g=b.touchObject.curY>b.touchObject.startY?1:-1),f=b.touchObject.swipeLength,b.touchObject.edgeHit=!1,b.options.infinite===!1&&(0===b.currentSlide&&"right"===e||b.currentSlide>=b.getDotCount()&&"left"===e)&&
(f=b.touchObject.swipeLength*b.options.edgeFriction,b.touchObject.edgeHit=!0),b.options.vertical===!1?b.swipeLeft=d+f*g:b.swipeLeft=d+f*(b.$list.height()/b.listWidth)*g,b.options.verticalSwiping===!0&&(b.swipeLeft=d+f*g),b.options.fade===!0||b.options.touchMove===!1?!1:b.animating===!0?(b.swipeLeft=null,!1):void b.setCSS(b.swipeLeft)):void 0)},b.prototype.swipeStart=function(a){var c,b=this;return b.interrupted=!0,1!==b.touchObject.fingerCount||b.slideCount<=b.options.slidesToShow?(b.touchObject=
{},!1):(void 0!==a.originalEvent&&void 0!==a.originalEvent.touches&&(c=a.originalEvent.touches[0]),b.touchObject.startX=b.touchObject.curX=void 0!==c?c.pageX:a.clientX,b.touchObject.startY=b.touchObject.curY=void 0!==c?c.pageY:a.clientY,void(b.dragging=!0))},b.prototype.unfilterSlides=b.prototype.slickUnfilter=function(){var a=this;null!==a.$slidesCache&&(a.unload(),a.$slideTrack.children(this.options.slide).detach(),a.$slidesCache.appendTo(a.$slideTrack),a.reinit())},b.prototype.unload=function(){var b=
this;a(".slick-cloned",b.$slider).remove(),b.$dots&&b.$dots.remove(),b.$prevArrow&&b.htmlExpr.test(b.options.prevArrow)&&b.$prevArrow.remove(),b.$nextArrow&&b.htmlExpr.test(b.options.nextArrow)&&b.$nextArrow.remove(),b.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},b.prototype.unslick=function(a){var b=this;b.$slider.trigger("unslick",[b,a]),b.destroy()},b.prototype.updateArrows=function(){var b,a=this;b=Math.floor(a.options.slidesToShow/
2),a.options.arrows===!0&&a.slideCount>a.options.slidesToShow&&!a.options.infinite&&(a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===a.currentSlide?(a.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-a.options.slidesToShow&&a.options.centerMode===!1?(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled",
"true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):a.currentSlide>=a.slideCount-1&&a.options.centerMode===!0&&(a.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),a.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},b.prototype.updateDots=function(){var a=this;null!==a.$dots&&(a.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),a.$dots.find("li").eq(Math.floor(a.currentSlide/a.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden",
"false"))},b.prototype.visibility=function(){var a=this;a.options.autoplay&&(document[a.hidden]?a.interrupted=!0:a.interrupted=!1)},a.fn.slick=function(){var f,g,a=this,c=arguments[0],d=Array.prototype.slice.call(arguments,1),e=a.length;for(f=0;e>f;f++)if("object"==typeof c||"undefined"==typeof c?a[f].slick=new b(a[f],c):g=a[f].slick[c].apply(a[f].slick,d),"undefined"!=typeof g)return g;return a}});function mhTimer(){this.allTimeOuts=[];this.allTimeIntervals=[];this.setTimeout=function(callback,_t){var thiz=this;var to=setTimeout(function(){callback();var _index=thiz.allTimeOuts.indexOf(to);if(_index>-1)thiz.allTimeOuts.splice(to,1)},_t);this.allTimeOuts.push(to);return to};this.clearTimeout=function(k){clearTimeout(k);var _index=this.allTimeOuts.indexOf(k);if(_index>-1)this.allTimeOuts.splice(k,1)};this.setInterval=function(callback,_t){var to=setInterval(function(){callback()},_t);this.allTimeIntervals.push(to);
return to};this.clearInterval=function(k){clearInterval(k);var _index=this.allTimeIntervals.indexOf(k);if(_index>-1)this.allTimeIntervals.splice(k,1)};this.destroy=function(){for(var i=0;i<this.allTimeOuts.length;i++)clearTimeout(this.allTimeOuts[i]);for(var i=0;i<this.allTimeIntervals.length;i++)clearInterval(this.allTimeIntervals[i]);this.allTimeOuts=[];this.allTimeIntervals=[]}}
function mhSound(data){this.audios=[];this.allSoundKey=data||{};this.timmer=new mhTimer;this.mute=false;this.create=function(_key,_option){var thiz=this;var _loop=false,_keep=false,_autoplay=true,_volume=1,_random=false;if(_option&&_option.hasOwnProperty("loop"))_loop=_option.loop;if(_option&&_option.hasOwnProperty("keep"))_keep=_option.keep;if(_option&&_option.hasOwnProperty("autoplay"))_autoplay=_option.autoplay;if(_option&&_option.hasOwnProperty("volume"))_volume=_option.volume;if(_option&&_option.hasOwnProperty("random"))_random=
_option.random;if(this.allSoundKey&&this.allSoundKey.hasOwnProperty(_key)){var msound=new Audio;if(typeof this.allSoundKey[_key]=="object")if(_random)msound.src=this.allSoundKey[_key][Math.floor(Math.random()*this.allSoundKey[_key].length)];else{msound.src=this.allSoundKey[_key][0];msound.playlist=this.allSoundKey[_key];msound._index=0}else msound.src=this.allSoundKey[_key];msound._key=_key;if(msound.playlist)msound.loop=false;else msound.loop=_loop;if(_option&&_option.hasOwnProperty("delay")){_autoplay=
false;msound.load();this.timmer.setTimeout(function(){msound.play()},_option.delay)}msound.autoplay=_autoplay;msound.volume=_volume;msound.onended=function(){if(this.playlist){this._index+=1;if(this._index>=this.playlist.length)if(_option.loop)this._index=0;else{this.destroy();return}this.src=this.playlist[this._index];this.play()}else if(!_loop&&!_keep)this.destroy()};msound.destroy=function(){thiz.remove(this)};msound.onplay=function(){if(_option&&_option.hasOwnProperty("duration")){console.log("duration",
_option.duration);thiz.timmer.setTimeout(function(){msound.destroy()},_option.duration)}};if(this.mute)msound.muted=true;this.audios.push(msound);return msound}else{console.log("not has ",_key,this.allSoundKey);return null}};this.setMute=function(t){this.mute=t;for(var i=0;i<this.audios.length;i++)this.audios[i].muted=t};this.remove=function(sound){sound.pause();var _index=this.audios.indexOf(sound);if(_index!==-1)this.audios.splice(_index,1)};this.destroy=function(){this.timmer.destroy();for(var i=
0;i<this.audios.length;i++)this.audios[i].pause();this.audios=[]}};(function(jQuery){jQuery.mhPopup=function(element,options){var defaults={autoOpen:false,openEffect:"bounceIn",closeEffect:"bounceOut",disableClose:false,zIndex:0,checkOther:true,delay:0,onOpen:function(){},onClose:function(){}};this.settings={};var $element=jQuery(element),_this=this,$popup=$element,$main=$popup.children(".popup-wrapper");this.init=function(){this.settings=jQuery.extend({},defaults,options);if($element.attr("disableClose")==="true")this.settings.disableClose=true;if($element.attr("isImportant")===
"true")this.settings.checkOther=false;if(_this.settings.zIndex)$element.css("z-index",_this.settings.zIndex);this.applyEvents();if(_this.settings.autoOpen)this.open()};this.open=function(type){if(_this.settings.checkOther&&MH.onOpenPopup==true)return;type="";if(_this.settings.checkOther==false)$("body\x3e.mh-popup").not($element).each(function(){if($(this).attr("disableClose")!="true")$(this).removeClass("show")});MH.onOpenPopup=true;if(!$element.children(".cover").length)$element.append('\x3cdiv class\x3d"cover"\x3e\x3c/div\x3e');
gsap.fromTo($element[0],{opacity:0,scale:1.2},{opacity:1,scale:1,duration:.1,ease:"none"});$element.addClass("show");_this.settings.onOpen()};this.close=function(type){type="";$main.attr("class","popup-wrapper "+type);var _t=type===""?0:700;gsap.fromTo($element[0],{opacity:1,scale:1},{opacity:0,scale:1.2,duration:.1,ease:"none"});MH.onOpenPopup=false;_this.settings.onClose();setTimeout(function(){$popup.removeClass("show").attr("style","")},200)};this.onClose=function(callback){_this.settings.onClose=
callback};this.onOpen=function(callback){_this.settings.onOpen=callback};this.applyEvents=function(){if(_this.settings.disableClose)$popup.find(".close-popup").hide();else{$popup.find(".close-popup").off().on("click",function(){_this.close();return false});$popup.on("click",function(e){if($(e.target).is(this)){_this.close();return false}})}};this.setCheck=function(a){_this.settings.checkOther=a;return this};this.init()};jQuery.fn.mhPopup=function(options){return this.each(function(){if(undefined==
jQuery(this).data("mhPopup")){var plugin=new jQuery.mhPopup(this,options);jQuery(this).data("mhPopup",plugin)}})}})(jQuery);var MenuMiniGame={_element:null,_isShowMenu:false,init:function(){if(this._element)return;this._element=jQuery("#menu-minigame");this._element.children(".mainBtn").css({"top":85*MH.scale-window.innerHeight/2,"left":640*MH.scale-84*MH.scale}).draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top,_newL=_left,_newT=_top;if(_left>0)_newL=640*MH.scale-84*MH.scale;else _newL=-640*MH.scale;if(_top<-360*MH.scale)_newT=-360*MH.scale;else if(_top>360*MH.scale-84*MH.scale)_newT=
360*MH.scale-84*MH.scale;ui.helper.animate({top:_newT,left:_newL},300)}});this._element.find(".menuinner button").each(function(){var gameId=$(this).attr("data-gameid");if(!gameId)$(this).addClass("disable");else $(this).off().on("click",function(){MenuMiniGame.toggleMenu(false);MH.openGame(gameId);return false})});this._element.children(".mainBtn").on("click",function(){MenuMiniGame.toggleMenu(true);return false});this._element.children(".mainMenu").on("click",function(){MenuMiniGame.toggleMenu(false)})},
toggleMenu:function(){if(arguments.length)this._isShowMenu=arguments[0];else this._isShowMenu=!this._isShowMenu;if(this._isShowMenu){this._element.addClass("onOpen");gsap.fromTo(this._element.find(".menuinner")["0"],{opacity:0,rotate:90,scale:1.3},{opacity:1,rotate:0,scale:1,duration:.3,ease:"power4.out"});this._element.addClass("onOpen")}else{gsap.fromTo(this._element.find(".menuinner")["0"],{opacity:1,rotate:0,scale:1},{opacity:0,rotate:90,scale:1.3,duration:.3,ease:"power1.in"});setTimeout(function(){MenuMiniGame._element.removeClass("onOpen").find(".menuinner").attr("style",
"")},500)}},setClock:function(n){this._element.find(".kqTX").hide();var $clock=this._element.find(".timmer").show();var clockFormat=function(k){return k<10?"00:0"+k:"00:"+k};if(this._timerCtr)clearInterval(this._timerCtr);this._timerCtr=setInterval(function(){n=n-1;if(n<0){clearInterval(MenuMiniGame.timerCtr);$clock.hide()}else $clock.html(clockFormat(n))},1E3)},showKqTX:function(type){this._element.find(".timmer").hide();this._element.find(".kqTX").removeClass("kq-tai kq-xiu").addClass(type).show()}};var MyMiniPoker=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var MiniPokerPreLoad={template:"template/mng-minipoker.html",images:["images/minipoker/bgmain.png","images/minipoker/100_on.png","images/minipoker/1k_on.png","images/minipoker/10k_on.png","res/tq_card.png","images/minipoker/quay-eff.png","images/minipoker/card-slide.png"]};
function MiniPoker(){this.gameName="MiniPoker";this.gameId=SLOT_GAME_MINI.MINI_POKER||0;this.timmer=new mhTimer;this.elementWrap=$(MiniPokerPreLoad.template).appendTo("body");this.elementQuy=this.elementWrap.find("#quy-number");this.elementGame=this.elementWrap.find("#game-minipoker");this.resultWrap=this.elementWrap.find(".card-inner");this.elementFreeSpin=this.elementWrap.find(".free-spin");this.elementSuKien=this.elementWrap.find(".sukien");this.lines=[0];this.openEffect="";this.cardLibs={};this.autoSpin=
false;this.onSpin=false;this.onOpen=false;this.moneyType=MoneyType.Gold;this.betting=100;this.timeMoneyEf=3E3;this.spinFast=false;this.freeSpinArr=[{b:100,fs:0},{b:1E3,fs:0},{b:1E4,fs:0}];this.timePhien=4600;this.timeSpinF=0;this.initGame();var target=MyMiniPoker.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnectGame,target);MiniGameClient.getInstance().addListener("100",this._onupdateGame,target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,this._onObserverResponse,target)}
MiniPoker.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);if(SHOW_LOG)console.log("_onObserverResponse");if(SHOW_LOG)console.log(data);if(data&&data.fss&&data.fss.length){thiz.freeSpinArr=data.fss;for(var i=0;i<data.fss.length;i++)for(var j=0;j<thiz.freeSpinArr.length;j++)if(data.fss[i].b==thiz.freeSpinArr[j].b){thiz.freeSpinArr[j].fs=data.fss[i].fs;break}thiz.buildFreeSpin();MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}else thiz.freeSpinArr=
[]};MiniPoker.prototype.hasFreeSpin=function(n){if(n){this.elementFreeSpin.children("span").html(n);this.elementFreeSpin.show()}else this.elementFreeSpin.hide()};MiniPoker.prototype.buildFreeSpin=function(){for(var i=0;i<this.freeSpinArr.length;i++)if(this.freeSpinArr[i].b==this.betting&&this.freeSpinArr[i].fs){this.elementFreeSpin.children("span").html(this.freeSpinArr[i].fs);this.elementFreeSpin.show();return}this.elementFreeSpin.hide()};
MiniPoker.prototype.setQuy=function(n){var _old=this.elementQuy.data("num")||0;this.elementQuy.data("num",n);if(!this.onOpen){this.elementQuy.html(MH.numToText(n,1));return}MH.realtimeCount(_old,n,this.elementQuy,1E3)};MiniPoker.prototype.setSession=function(sid){this.elementWrap.find("\x3e.item-content\x3e.session").html("#"+sid)};
MiniPoker.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;cc.log("thiz.gameID "+thiz.gameId);if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:switch(thiz.betting){case 100:thiz.setQuy(data[1].Js[0].J);break;case 1E3:thiz.setQuy(data[1].Js[1].J);break;case 1E4:thiz.setQuy(data[1].Js[2].J);break;default:thiz.betting=100;thiz.setQuy(data[1].Js[0].J);break}if(thiz.autoSpin&&!thiz.onSpin)thiz.timmer.setTimeout(function(){if(thiz.autoSpin&&!thiz.onSpin)thiz.sendRequestSpin()},
2E3);if(data[1].event&&data[1].event.bs){var _html="";for(var i=0;i<data[1].event.bs.length;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cspan class\x3d"sk-cuoc"\x3e'+MH.numToText(data[1].event.bs[i].b)+'\x3c/span\x3e\x3cspan class\x3d"sk-hu"\x3e'+data[1].event.bs[i].rjc+"\x3c/span\x3e\x3c/div\x3e";thiz.elementSuKien.show().html(_html)}else thiz.elementSuKien.hide();break;case CMD_SLOT_MACHINE.SPIN:if(SHOW_LOG)console.log(data[1]);thiz.spinStart(data[1]);if(SHOW_LOG)console.log("CMD_SLOT_MACHINE.SPIN");
if(SHOW_LOG)console.log(data[1]);break;default:break}};MiniPoker.prototype._onReconnectGame=function(){if(SHOW_LOG)console.log("_onReconnectGame MNP");var thiz=this.currentTarget;MiniGameClient.getInstance().observerByGameID(SLOT_GAME_MINI.MINI_POKER)};
MiniPoker.prototype.initButton=function(){var thiz=this;this.elementWrap.find('input[name\x3d"money-type"]').prop("checked",true).prop("disabled",true);this.elementWrap.find(".btn-vinhdanh").off().on("click",function(){var $popup=$("#popup-minigameVinhdanh");$popup.find("tbody").html("");var _html="";MyRequest.fetchTopSlotMachine(thiz.gameId,function(cmd,obj){if(obj&&obj.status==0&&obj.data.items.length){var _len=obj.data.items.length;for(var i=0;i<_len;i++)if(obj.data.items[i].assetId==MoneyType.Gold){_html+=
"\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(obj.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].betting+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(obj.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}}$popup.find("tbody").html(_html)});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-lichsu").off().on("click",
function(){var $popup=$("#popup-lichsuMiniPoker");$popup.find("#tab-lichsuMNPgold tbody").html("");$popup.find("#tab-lichsuMNPchip tbody").html("");var _page=1,_rowPerPage=50,_total=0,_type=MoneyType.Gold;var getPage=function(n,moneyType){if(n<=0)return;_page=n;$popup.find(".page-control .page-name").html(_page);if(_page<=1)$popup.find(".page-control .btn-prev").addClass("disable");else $popup.find(".page-control .btn-prev").removeClass("disable");MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,
_rowPerPage,(n-1)*_rowPerPage,function(cmd,data){var _html="";if(!data)return;_total=data.data.count;if(data.data&&data.data.items.length)for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].betting+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e";
if(data.data.items[i].symbols.length)for(var j=0;j<data.data.items[i].symbols.length;j++){var card=Utils.getCardFromServer(data.data.items[i].symbols[j]),_cardName=card.toString;if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))_html+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+'px"\x3e\x3c/div\x3e\x3c/div\x3e'}_html+="\x3c/td\x3e";_html+="\x3c/tr\x3e"}if(moneyType==
1)$popup.find("#tab-lichsuMNPgold tbody").html(_html);else $popup.find("#tab-lichsuMNPchip tbody").html(_html);$popup.find(".table-inner").scrollTop(0);if(_page*_rowPerPage>=_total)$popup.find(".page-control .btn-next").addClass("disable");else $popup.find(".page-control .btn-next").removeClass("disable")})};getPage(1,_type);$popup.find(".tabs-lichsu").off("tabsactivate").on("tabsactivate",function(event,ui){if(ui.newPanel.attr("id")=="tab-lichsuMNPchip"){_page=1;_type=MoneyType.Chip}else{_page=1;
_type=MoneyType.Gold}getPage(_page,_type)});$popup.find(".page-control .btn-next").off().on("click",function(){if($(this).hasClass("disable"))return;getPage(_page+1,_type);return false});$popup.find(".page-control .btn-prev").off().on("click",function(){if($(this).hasClass("disable"))return;getPage(_page-1,_type);return false});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-huongdan").off().on("click",function(){return false});this.elementWrap.find(".btn-closeMNP").off().on("click",
function(){if(thiz.autoSpin)thiz.close();else thiz.destroyGame();return false});this.elementWrap.find(".btn-datcuoc").each(function(index){$(this).off().on("click",function(){if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd ..",800);else{switch(index){case 0:thiz.betting=100;break;case 1:thiz.betting=1E3;break;case 2:thiz.betting=1E4;break;default:thiz.betting=thiz.betting||100;break}$(this).addClass("active").siblings(".btn-datcuoc").removeClass("active");thiz.buildFreeSpin()}return false})});
this.elementWrap.find(".btn-autospin").off().on("click",function(){thiz.changeAutoSpin();return false});this.elementWrap.find(".btn-quaynhanh").off().on("click",function(){thiz.spinFast=!thiz.spinFast;if(thiz.spinFast)jQuery(this).addClass("active");else jQuery(this).removeClass("active");return false});this.elementWrap.find('input[name\x3d"money-type"]').off().on("change",function(){if($(this).prop("checked"))thiz.changeMoneyType(MoneyType.Gold);else thiz.changeMoneyType(MoneyType.Chip)});this.btnSpin=
this.elementWrap.find(".btn-spin");this.btnSpin.off().on("click",function(){if(thiz.onSpin||thiz.autoSpin){thiz.btnSpin.addClass("on-disable");thiz.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-disable")},300);thiz.notify("\u0110ang quay vui l\u00f2ng ch\u1edd",1E3);return false}else thiz.sendRequestSpin();return false})};MiniPoker.prototype.close=function(){this.onOpen=false;this.elementWrap.hide()};MiniPoker.prototype.open=function(){this.onOpen=true;this.elementWrap.show();MiniGameClient.getInstance().observerByGameID(SLOT_GAME_MINI.MINI_POKER)};
MiniPoker.prototype.gatcan=function(){var thiz=this;this.btnSpin.addClass("on-gatcan");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-gatcan")},1E3)};MiniPoker.prototype.hideArrow=function(){};MiniPoker.prototype.showArrow=function(){};
MiniPoker.prototype.sendRequestSpin=function(){if(SHOW_LOG)console.log("sendRequestSpin");var thiz=this;var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":thiz.gameId,"aid":thiz.moneyType,"ls":thiz.lines,"b":thiz.betting}];MiniGameClient.getInstance().send(sendObj)};
MiniPoker.prototype.spinStart=function(data){if(this.onSpin)return;if(data.mgs){this.notify(data.mgs);this.changeAutoSpin(false);this.handleSpinDone();return}if(!data.sbs||data.sbs.length!==5)return;this.onSpin=true;this.gatcan();this.hideArrow();this.elementGame.children(".effect, .notify").remove();this.elementGame.removeClass("end").addClass("on-spin");this.setSession(data.sid);var thiz=this;this.timmer.setTimeout(function(){thiz.spinStop(data)},thiz.spinFast?100:2600)};
MiniPoker.prototype.spinStop=function(data){var thiz=this;for(var i=0;i<data.sbs.length;i++){var card=Utils.getCardFromServer(data.sbs[i]),_cardName=card.toString;if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))this.resultWrap.eq(i).css("background-position","-"+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+"px")}this.elementGame.removeClass("on-spin");this.timmer.setTimeout(function(){thiz.elementGame.addClass("end");thiz.winner(data);for(var i=0;i<thiz.freeSpinArr.length;i++)if(thiz.betting==
thiz.freeSpinArr[i].b){thiz.freeSpinArr[i].fs=data.fss||0;break}thiz.buildFreeSpin()},thiz.spinFast?1250:2E3)};MiniPoker.prototype.handleSpinDone=function(){this.onSpin=false;LobbyRequest.getInstance().requestUpdateMoney();if(this.autoSpin)this.sendRequestSpin();else this.showArrow()};
MiniPoker.prototype.spin=function(){var thiz=this;var cardResult=this.elementWrap.find(".card-inner");if(this.onSpin||cardResult.length!==5){if(SHOW_LOG)console.log("on spin / !5 card");return}this.onSpin=true;this.gatcan();this.hideArrow();this.elementGame.children(".effect").remove();this.elementGame.addClass("on-spin");this.timmer.setTimeout(function(){var cards=[];cards.push(Utils.getCardFromServer(Math.floor(Math.random()*51)));cards.push(Utils.getCardFromServer(Math.floor(Math.random()*51)));
cards.push(Utils.getCardFromServer(Math.floor(Math.random()*51)));cards.push(Utils.getCardFromServer(Math.floor(Math.random()*51)));cards.push(Utils.getCardFromServer(Math.floor(Math.random()*51)));for(var i=0;i<5;i++){var _cardName=cards[i].toString;if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))cardResult.eq(i).css("background-position","-"+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+"px");if(SHOW_LOG)console.log(_cardName)}},1500);this.timmer.setTimeout(function(){thiz.elementGame.removeClass("on-spin");
thiz.timmer.setTimeout(function(){thiz.elementGame.append('\x3cdiv class\x3d"effect thungphasanh"\x3e+1.000.000\x3c/div\x3e')},1500);thiz.timmer.setTimeout(function(){thiz.showArrow();thiz.onSpin=false;if(thiz.autoSpin)thiz.spin()},3E3)},3600)};
MiniPoker.prototype.winner=function(data){if(SHOW_LOG)console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");if(SHOW_LOG)console.log(data);var n=data.mX,b=data.b,nohu=data.iJ;var thiz=this;if(!n||!this.onOpen)this.handleSpinDone();else{var _name="";var _lightBorder="";if(nohu)_lightBorder="nohu";var _arr=[{name:"\u0110\u00f4i",money:[250,2500,25E3]},{name:"Hai \u0110\u00f4i",money:[500,5E3,5E4]},{name:"S\u00e1m",money:[800,8E3,8E4]},{name:"S\u1ea3nh",money:[1300,13E3,13E4]},{name:"Th\u00f9ng",
money:[2E3,2E4,2E5]},{name:"C\u00f9 L\u0169",money:[5E3,5E4,5E5]},{name:"T\u1ee9 Qu\u00fd",money:[15E3,15E4,15E5]},{name:"Th\u00f9ng Ph\u00e1 S\u1ea3nh",money:[1E5,1E6,1E7]}];var k;if(b==100)k=0;else if(b==1E3)k=1;else if(b==1E4)k=2;if(k===0||k===1||k===2)for(var i=0;i<_arr.length;i++)if(n==_arr[i].money[k]){_name=_arr[i].name;if(i==_arr.length-1)_lightBorder+=" thungphasanh";break}if(_name=="\u0110\u00f4i")if(data.sbs&&data.sbs.length){var _matchCard=[];for(var i=0;i<data.sbs.length;i++){var _iCard=
Utils.getCardFromServer(data.sbs[i]);if(_matchCard.indexOf(_iCard.point)!=-1&&(_iCard.point>=11||_iCard.point==1)){if(_iCard.point==11)_name+=" J";else if(_iCard.point==12)_name+=" Q";else if(_iCard.point==13)_name+=" K";else if(_iCard.point==1)_name+=" A";break}_matchCard.push(_iCard.point)}}var _effect='\x3cdiv class\x3d"effect '+_lightBorder+'"\x3e\x3cspan class\x3d"name"\x3e'+_name+'\x3c/span\x3e\x3cspan class\x3d"money"\x3e+'+MH.numToText(n,1)+"\x3c/span\x3e\x3c/div\x3e";this.elementGame.append(_effect);
this.timmer.setTimeout(function(){thiz.handleSpinDone();thiz.elementGame.children(".effect").remove()},this.timeMoneyEf)}};MiniPoker.prototype.changeAutoSpin=function(s){if(s==undefined)s=!this.autoSpin;if(s){this.hideArrow();if(!this.onSpin)this.sendRequestSpin()}if(!s&&!this.onSpin)this.showArrow();this.autoSpin=s;if(s)this.elementWrap.find(".btn-autospin").addClass("active");else this.elementWrap.find(".btn-autospin").removeClass("active")};
MiniPoker.prototype.changeMoneyType=function(type){this.moneyType=type;if(SHOW_LOG)console.log(type)};MiniPoker.prototype.notify=function(s,t){this.elementGame.children(".notify").remove();if(!s)return;$notify=$('\x3cdiv class\x3d"notify"\x3e'+s+"\x3c/div\x3e");this.elementGame.append($notify);if(t)this.timmer.setTimeout(function(){$notify.remove()},t)};
MiniPoker.prototype.initGame=function(){var thiz=this;this.elementWrap.addClass("success");this.notify("\u0110ang t\u1ea3i game ..",8E4);$.get("res/tq_card.json",function(data){if(!hiepnh.isObject(data))data=JSON.parse(data);thiz.cardLibs=data.frames;thiz.initButton();thiz.notify("");if(SHOW_LOG)console.log(" get data card")});this.initButton();this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<-380*MH.scale)_top=-380*MH.scale;else if(_top>
(window.innerHeight-100)*MH.scale)_top=(window.innerHeight-100)*MH.scale;if(_left<-625*MH.scale)_left=-625*MH.scale;else if(_left>(window.innerWidth-140)*MH.scale)_left=(window.innerWidth-140)*MH.scale;ui.helper.animate({top:_top,left:_left},300)}});var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.AUTOSPIN_OFF,"gid":thiz.gameId}];MiniGameClient.getInstance().send(sendObj);this.elementWrap.addClass("on-open animated "+
this.openEffect);this.open()};MiniPoker.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=MyMiniPoker.getInstance();MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var BigSlotTarget=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var CandyPreLoad={style:"css/dicedicedice.css",template:"template/slot-dicedicedice.html",images:["images/candy/lobby/bg.png","images/candy/lobby/p100.png","images/candy/lobby/p1000.png","images/candy/lobby/p10000.png","images/candy/lobby/coin.png","images/candy/lobby/hu.png","images/candy/lobby/btn_bxh.png","images/candy/lobby/btn_back.png","images/candy/lobby/logogame.png","images/candy/lobby/btn_ls.png","images/candy/lobby/btn_caidat.png","images/candy/lobby/pchoithu.png"]};
function GameCandy(){this.gameId=SLOT_GAME_MINI.KIM_CUONG||0;this.betting=0;this.isTrial=false;this.trialJackpot=5E7;this.dataJackpot=[{J:0},{J:0},{J:0}];this.timeLineEf=100;this.spinFast=false;this.onSpin=false;this.autoSpin=false;this.moneyType=1;this.session=0;this.onSpinSession=0;this.lines=[];this.winHidden=false;this.audios=[];this.arrayItemInline=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[1,1,0,1,1],[1,1,2,1,1],[0,0,1,0,0],[2,2,1,2,2],[0,2,0,2,0],[2,0,2,0,2],[1,0,2,0,1],[2,1,0,1,2],[0,1,2,1,0],
[1,2,1,0,1],[1,0,1,2,1],[2,1,1,1,2],[0,1,1,1,0],[1,2,2,2,1],[1,0,0,0,1],[2,2,1,0,0],[0,0,1,2,2]];this.prefixItem="";this.app=new PIXI.Application(904,498,{view:slotCandyCanvas,transparent:true,resolution:1,roundPixels:false});this.containerItem=new PIXI.Container;this.columns=[];this.colsBlur=[];this.colsItems=[[],[],[],[],[]];this.slotData=null;this.freespinData={100:{b:100,ls:[],ai:1,fs:0},1E3:{b:1E3,ls:[],ai:1,fs:0},1E4:{b:1E4,ls:[],ai:1,fs:0}};this.winFreeSpin=-1;this.totalIcon=27;this.itemHeight=
166;this.tweenY=(this.totalIcon-3)*this.itemHeight;this.tweenTime=2;this.delayLine=.2;this.elementWrap=jQuery("#content\x3e.wrapper\x3e.slot-wrap").eq(0);this.elementQuy=this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin").eq(0);this.drawLineWrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.draw-lines").eq(0);this.elementQuys=[this.elementWrap.find("\x3e.slot-lobby\x3e.room1\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room2\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room3\x3e.hu"),
this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin")];var target=BigSlotTarget.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN_TRIAL.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,
this._onObserverResponse,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onLoginOrReconnectSucess,target);TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onTopHuResponse,target);this.initGame()}GameCandy.prototype.log=function(){return;console.log.apply(this,arguments)};
GameCandy.prototype.gotoLobby=function(){this.log("gotoLobby");this.betting=0;this.isTrial=false;this.onSpin=false;this.changeSpeedMode(false);this.changeAutoSpin(false);this.visible=false;$("#bg-wrap").css("background-image","url(images/candy/lobby/bg.png)");this.elementWrap.find("\x3e.slot-wraptop\x3e.slot-title").replaceWith('\x3cimg src\x3d"images/candy/lobby/logogame.png" class\x3d"slot-title"\x3e');this.elementWrap.children(".slot-lobby").show();this.elementWrap.children(".slot-gameplay").hide()};
GameCandy.prototype._onupdateGame=function(cmd,data){console.log("Candy _onupdateGame",data);var thiz=this.currentTarget;if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:if(thiz.autoSpin&&!thiz.onSpin)setTimeout(function(){if(thiz.autoSpin&&!thiz.onSpin){console.log("autospin err? try send spin");thiz.sendRequestSpin()}},2E3);break;case CMD_SLOT_MACHINE.SPIN:thiz.spinStart(data[1]);break;case CMD_SLOT_MACHINE.SPIN_TRIAL:thiz.spinStart(data[1]);break;default:break}};
GameCandy.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);thiz.log("GameCandy _onObserverResponse",cmd,data);for(var key in thiz.freespinData)if(thiz.freespinData.hasOwnProperty(key))thiz.freespinData[key].fs=0;thiz.winFreeSpin=-1;if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)thiz.freespinData[data.fss[i].b.toString()]=data.fss[i];MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}if(thiz.freespinData[thiz.betting.toString()]&&
thiz.freespinData[thiz.betting.toString()].fs)thiz.winFreeSpin=0;thiz.hasFreeSpin()};GameCandy.prototype._onLoginOrReconnectSucess=function(cmd,data){var thiz=this.currentTarget;thiz.log("GameCandy _onLoginOrReconnectSucess",cmd,data);MiniGameClient.getInstance().observerByGameID(thiz.gameId)};
GameCandy.prototype._onTopHuResponse=function(cmd,data){var thiz=this.currentTarget;var dataJackpot=[{J:0},{J:0},{J:0}];if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].gid===thiz.gameId)if(data[1].Js[i].b===100)dataJackpot[0].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E3)dataJackpot[1].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E4)dataJackpot[2].J=data[1].Js[i].J;thiz.setQuy(dataJackpot);thiz.log("GameCandy.prototype._onTopHuResponse",data)};
GameCandy.prototype.setQuy=function(data){if(typeof data==="number"){MH.realtimeCount(this.dataJackpot[2].J,data,this.elementQuys[3],1E3);this.dataJackpot[2].J=data}else if(!data||typeof data==="object"){var data=data||this.dataJackpot;if(this.betting===0){MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[0],1E3);MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[1],1E3);MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[2],1E3);MH.realtimeCount(this.dataJackpot[2].J,
data[2].J,this.elementQuys[3],1E3)}else if(!this.isTrial)if(this.betting===100)MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[3],1E3);else if(this.betting===1E3)MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[3],1E3);else if(this.betting===0||this.betting===1E4)MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[3],1E3);this.dataJackpot=data}};
GameCandy.prototype.createSlotGame=function(){var thiz=this;this.prefixItem="";this.colsItems=[];var createItem=function(obj){var item=PIXI.Sprite.fromFrame(thiz.prefixItem+obj.id+".png");item.anchor.set(.5,.5);if(obj.x)item.x=obj.x;if(obj.y)item.y=obj.y;if(obj.visible===false)item.visible=false;if(0&&obj.blur){var ft=new PIXI.filters.BlurFilter;ft.blurX=0;ft.blurY=1.5;item.filters=[ft]}return item};for(var i=0;i<5;i++){this.columns[i]=new PIXI.Container;this.colsBlur[i]=new PIXI.Container;this.colsItems[i]=
[];for(j=0;j<this.totalIcon;j++){var item=createItem({id:Math.floor(Math.random()*10)%7,blur:j>=3&&j<thiz.totalIcon-3?true:false,y:j*thiz.itemHeight+thiz.itemHeight/2,visible:j<3?false:true});if(j>=3&&j<thiz.totalIcon-3)this.colsBlur[i].addChild(item);else this.columns[i].addChild(item);this.colsItems[i].push(item)}this.columns[i].position.set(80+i*186,-this.tweenY);this.columns[i].addChild(this.colsBlur[i]);this.containerItem.addChild(this.columns[i]);(function(i){setTimeout(function(){thiz.colsBlur[i].visible=
false;thiz.colsBlur[i].cacheAsBitmap=true},150)})(i)}this.app.stage.addChild(this.containerItem)};
GameCandy.prototype.spinStart=function(data){var thiz=this;this.slotData=null;if(!data){this.log("spin respon data null");return}if(!this.isTrial&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.changeAutoSpin(false);this.handleSpinDone();return}if(data.mgs){this.notify(data.mgs);this.changeAutoSpin(false);this.handleSpinDone();return}if(!data.hasOwnProperty("sbs")||data.sbs.length!=15){this.changeAutoSpin(false);this.handleSpinDone();return}this.onSpin=true;this.slotData=
data;this.winnerEffect("hide");this.removeDrawLine();thiz.btnSpin.addClass("on-click disabled");setTimeout(function(){thiz.btnSpin.removeClass("on-click")},100);this.runSpin();this.log("this.slotData",data);if(this.isTrial){this.trialJackpot+=20*1E4/100;this.setQuy(this.trialJackpot)}this.setSession(data.sid)};GameCandy.prototype.setSession=function(sid){this.session=sid||0;this.elementWrap.find("\x3e.slot-gameplay\x3e.session").html("#"+sid)};
GameCandy.prototype.runSpin=function(){var thiz=this;var isStopped=false;var playOneting=function(){};if(!this.soundSpinStart){this.soundSpinStart=new AudioDevice("images/candy/sound/spin_start.ogg");this.audios.push(this.soundSpinStart);if(this.winHidden)this.soundSpinStart.changeVolume(0)}this.soundSpinStart.play();var cb=function(){if(isStopped)return;for(var i=0;i<5;i++)TweenLite.killTweensOf(thiz.columns[i].position);thiz.setItems();isStopped=true;setTimeout(function(){thiz.spinStop()},300)};
var timeSpinLine=this.spinFast?.3:thiz.tweenTime;for(var i=0;i<5;i++)(function(i){thiz.colsItems[i][0].visible=true;thiz.colsItems[i][1].visible=true;thiz.colsItems[i][2].visible=true;thiz.colsBlur[i].visible=true;thiz.setSpriteIcon(thiz.colsItems[i][2],thiz.slotData.sbs[0+i]);thiz.setSpriteIcon(thiz.colsItems[i][1],thiz.slotData.sbs[5+i]);thiz.setSpriteIcon(thiz.colsItems[i][0],thiz.slotData.sbs[10+i]);var obj={y:0,delay:i*thiz.delayLine,ease:Power2.easeOut};if(i===4)obj.onComplete=cb;var tl=TweenLite.to(thiz.columns[i].position,
timeSpinLine,obj);setTimeout(function(){if(thiz.winHidden){tl.kill();if(i===4&&!isStopped)cb()}},timeSpinLine*1E3)})(i)};
GameCandy.prototype.spinStop=function(){var thiz=this;var winlines=[];var _type="hide",_money=this.slotData.mX;if(this.slotData.iJ)_type="jackpot";else if(this.slotData.bw)_type="bigwin";else if(this.slotData.mX)_type="normal";else _type="hide";if(this.winFreeSpin>=0)this.winFreeSpin+=this.slotData.mX;if(this.slotData.hMG){_money=0;for(var i=0;i<this.slotData.wls.length;i++)_money+=this.slotData.wls[i].crd}if(this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)winlines.push(this.slotData.wls[i].lid);
var efDraw=!this.spinFast&&_type=="normal";this.drawLines(winlines,efDraw);this.winnerEffect(_type,{money:_money},function(){thiz.checkFreeBonus()})};
GameCandy.prototype.winnerEffect=function(type,data,callback){var thiz=this;var $wrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.win-effect").eq(0);var delayClose=3E3;if(type==="jackpot"||type==="bigwin")delayClose=5E3;if(type==="hide"){$wrap.attr("class","win-effect is-hide").find(".winnum").empty();delayClose=0}else{if(type==="jackpot"&&this.isTrial){this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}var $moneyWrap=$wrap.find("\x3e.type-"+type+" .winnum");if(data&&data.money){var countTo=data.money,
countFrom=countTo-5E3;while(countFrom<0)countFrom+=100;$moneyWrap.parent().parent().show();MH.realtimeCount(countFrom,countTo,$moneyWrap,1E3);if(!this.soundWin){this.soundWin=new AudioDevice("images/candy/sound/win_normal.ogg");this.audios.push(this.soundWin);if(this.winHidden)this.soundWin.changeVolume(0)}this.soundWin.play()}else $moneyWrap.parent().parent().hide();$wrap.attr("class","win-effect show is-"+type)}if(type=="normal")delayClose=1500;if(data&&data.hasOwnProperty("money"))if(data.money==
0)this.elementWrap.find(".game-control\x3e.num-vuathang").html(0);else setTimeout(function(){thiz.elementWrap.find(".game-control\x3e.num-vuathang").html(MH.numToText(data.money,1))},1E3);setTimeout(function(){if(type!=="hide")thiz.winnerEffect("hide");if(callback&&typeof callback==="function")callback();else if(type!=="hide")thiz.handleSpinDone()},delayClose)};
GameCandy.prototype.checkFreeBonus=function(){this.log("checkFreeBonus");var thiz=this;this.freespinData[this.slotData.b.toString()].fs=this.slotData.fss;this.hasFreeSpin();if(this.slotData.hFS)this.winnerEffect("freespin");else if(this.slotData.hMG)this.winnerEffect("bonus",null,function(){thiz.playBonus()});else if(0&&!this.hasFreeSpin()&&this.winFreeSpin>=0)this.winnerEffect("freespin",{money:this.winFreeSpin});else this.handleSpinDone()};GameCandy.prototype.changeSpeedMode=function(type,check){};
GameCandy.prototype.changeGameMode=function(type){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();if(type===false){this.changeSpeedMode(false);this.changeAutoSpin(false);this.changeBetting(1E4);this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}this.isTrial=!type};
GameCandy.prototype.changeBetting=function(bet){var thiz=this;if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.visible=false;this.betting=bet;this.isTrial=false;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.mucCuoc\x3e.num-bet").html(MH.numToText(this.betting,1));this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1));this.elementWrap.find("\x3e.slot-wraptop\x3e.slot-title").replaceWith('\x3cimg src\x3d"images/candy/play/p_'+this.betting+'.png" class\x3d"slot-title p_'+this.betting+'"\x3e');this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();this.hasFreeSpin();setTimeout(function(){if(thiz.isTrial)return;thiz.setQuy()},50);this.setSession(0)};
GameCandy.prototype.hightLight=function(){var thiz=this;var timeShowLine=1E3;var clearHightLight=function(){for(var j=0;j<thiz.timeoutHightLight.length;j++)clearTimeout(thiz.timeoutHightLight[j]);thiz.timeoutHightLight=[];thiz.removeDrawLine()};var zoomLineIcons=function(lid){for(var i=0;i<thiz.arrayItemInline[lid].length;i++)(function(i){var sprite=thiz.colsItems[i][thiz.totalIcon-3+thiz.arrayItemInline[lid][i]];var goBack=function(){TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1,y:1,ease:Power4.easeIn})};
TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1.1,y:1.1,ease:Power4.easeOut,onComplete:goBack})})(i)};if(!this.timeoutHightLight)this.timeoutHightLight=[];else clearHightLight();if(!this.onSpin&&this.slotData&&this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)(function(i){var to=setTimeout(function(){if(thiz.onSpin||thiz.slotData.sid!=thiz.session)clearHightLight();else{thiz.drawLines([thiz.slotData.wls[i].lid]);zoomLineIcons(thiz.slotData.wls[i].lid);if(i===
thiz.slotData.wls.length-1)setTimeout(function(){if(!thiz.onSpin)thiz.removeDrawLine()},timeShowLine)}},(i+1)*timeShowLine);thiz.timeoutHightLight.push(to)})(i)};
GameCandy.prototype.changeAutoSpin=function(type,check){if(check&&(this.isTrial||!MiniGameClient.getInstance().isLoginDone())){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");this.changeAutoSpin(false);return}if(type){this.btnSpinMode.addClass("active");if(!this.onSpin)this.sendRequestSpin()}else this.btnSpinMode.removeClass("active");this.autoSpin=type};
GameCandy.prototype.chooseLines=function(arr){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return false}this.lines=arr;this.elementWrap.find(".chooseLine .num-lines").html(this.lines.length);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*this.lines.length,1))};
GameCandy.prototype.addLine=function(lid){var arr=this.lines.slice();if(arr.indexOf(lid)===-1){arr.push(lid);this.chooseLines(arr)}};GameCandy.prototype.removeLine=function(lid){var arr=this.lines.slice();var index=arr.indexOf(lid);if(index>-1&&arr.length>1){arr.splice(index,1);this.chooseLines(arr)}};
GameCandy.prototype.handleSpinDone=function(){LobbyRequest.getInstance().requestUpdateMoney();this.log("handleSpinDone");if(this.autoSpin||this.hasFreeSpin()){this.onSpin=false;this.sendRequestSpin()}else{this.onSpin=false;this.btnSpin.removeClass("disabled");this.hightLight()}if(!this.hasFreeSpin())this.winFreeSpin=-1;else if(this.winFreeSpin=-1)this.winFreeSpin=0};
GameCandy.prototype.notify=function(str,_time){var thiz=this;if(!str){this.elementWrap.find(".shortnotice").hide().empty();return}this.elementWrap.find(".shortnotice").html(str).show();var _t=_time||2500;setTimeout(function(){thiz.elementWrap.find(".shortnotice").hide().empty()},_t)};
GameCandy.prototype.createPopupCommon=function(text){var $popup=this.elementWrap.children(".popupCommon");$popup.find(".slpopup-content").html(text);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide();clearTimeout($popup.data("timeoutClose"));return false});var timeoutClose=setTimeout(function(){$popup.hide()},3E3);$popup.data("timeoutClose",timeoutClose);$popup.show()};
GameCandy.prototype.hasFreeSpin=function(){var n=this.betting?this.freespinData[this.betting.toString()].fs:0;if(n)this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").show().children(".freespin-num").html(n);else this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").hide().children(".freespin-num").empty();return n};
GameCandy.prototype.setItems=function(){for(var i=0;i<5;i++){this.setSpriteIcon(this.colsItems[i][this.totalIcon-3],this.slotData.sbs[10+i]);this.setSpriteIcon(this.colsItems[i][this.totalIcon-2],this.slotData.sbs[5+i]);this.setSpriteIcon(this.colsItems[i][this.totalIcon-1],this.slotData.sbs[0+i]);this.columns[i].y=-this.tweenY;this.colsItems[i][0].visible=false;this.colsItems[i][1].visible=false;this.colsItems[i][2].visible=false;this.colsBlur[i].visible=false}};
GameCandy.prototype.setSpriteIcon=function(sprite,icon){sprite.texture=PIXI.Texture.fromFrame(this.prefixItem+icon+".png")};
GameCandy.prototype.initButton=function(){var thiz=this;var $control=this.elementWrap.find(".game-control");var isDoubleClick=function(button){var $button=jQuery(button);if($button.data("btndisable"))return true;$button.data("btndisable",true);setTimeout(function(){$button.data("btndisable",false)},1E3);return false};this.btnSpin=$control.children(".btn-quay").off("click").on("click",function(){if(isDoubleClick(this))return false;if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
thiz.gotoLobby();return false}if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");thiz.btnSpin.data("btndisable",false);return false}thiz.sendRequestSpin();return false});this.elementWrap.find("\x3e.slot-lobby\x3e.btn-trial").off("click").on("click",function(){if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeGameMode(false);return false});$control.find("\x3e.group-btndong button").each(function(){var num=
parseInt(jQuery(this).attr("data-num"));jQuery(this).removeAttr("data-num").data("num",num)}).off("mouseenter mouseout").on("mouseenter",function(){if(thiz.onSpin)return false;var num=jQuery(this).data("num");thiz.drawLines([num-1])}).on("mouseout",function(){if(thiz.onSpin)return false;thiz.removeDrawLine()});this.btnSpinMode=$control.children(".btn-autoSpin").off("click").on("click",function(){thiz.changeAutoSpin(!thiz.autoSpin,true);return false});$control.find("\x3e.mucCuoc\x3e.btn-cong").off("click").on("click",
function(){var to;switch(thiz.betting){case 100:to=1E3;break;case 1E3:to=1E4;break;case 1E4:to=100;break;default:to=100;break}thiz.changeBetting(to);return false});$control.find("\x3e.mucCuoc\x3e.btn-tru").off("click").on("click",function(){var to;switch(thiz.betting){case 100:to=1E4;break;case 1E3:to=100;break;case 1E4:to=1E3;break;default:to=100;break}thiz.changeBetting(to);return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-back").off("click").on("click",function(){if(thiz.betting===
0){thiz.destroyGame();MH.changePage("home")}else if(thiz.onSpin)thiz.createPopupCommon("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else thiz.gotoLobby();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-lichsu").off("click").on("click",function(){thiz.showLichSu();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-vinhdanh").off("click").on("click",function(){thiz.showVinhDanh();return false});this.elementWrap.find(".game-control\x3e.btn-help").off("click").on("click",function(){thiz.showLuatChoi();
return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room1").off("click").on("click",function(){if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(100);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room2").off("click").on("click",function(){if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeBetting(1E3);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room3").off("click").on("click",function(){if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(1E4);return false});var $bangChon=this.elementWrap.children(".slchondong");$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=parseInt($this.attr("data-num"))-1;$this.removeAttr("data-num").data("lid",
lid)});var initItemBangChon=function(){$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=$this.data("lid");if(thiz.lines.indexOf(lid)===-1)$this.removeClass("active");else $this.addClass("active")})};$control.find("\x3e.chooseLine\x3e.btn-cong,\x3e.chooseLine\x3e.btn-tru").off("click").on("click",function(){if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(thiz.isTrial){thiz.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");
return}initItemBangChon();$bangChon.show();return false});$bangChon.children(".btn-closePopup").off("click").on("click",function(){$bangChon.hide();return false});$bangChon.find(".controlBottom .btn-chonLe").off().on("click",function(){thiz.chooseLines([0,2,4,6,7,10,12,14,16,18]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonChan").off().on("click",function(){thiz.chooseLines([1,3,5,7,9,11,13,15,17,19]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonAll").off().on("click",
function(){thiz.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonNone").off().on("click",function(){thiz.chooseLines([0]);initItemBangChon();return false});$bangChon.find(".lines button").off().on("click",function(){var lid=$(this).data("lid");if(thiz.lines.indexOf(lid)===-1)thiz.addLine(lid);else thiz.removeLine(lid);initItemBangChon();return false});this.elementWrap.find("button").not(".btn-quay").on("mousedown",
function(){jQuery(this).addClass("on-click")}).on("mouseup",function(){jQuery(this).removeClass("on-click")})};GameCandy.prototype.removeDrawLine=function(){var thiz=this;this.log("removeDrawLine");this.drawLineWrap.empty()};
GameCandy.prototype.drawLines=function(arr,eff,callback){var thiz=this;var delayCallback=this.spinFast?100:500;this.drawLineWrap.empty();if(!eff){this.drawLineWrap.html(this.linesImg(arr));if(callback&&typeof callback==="function")setTimeout(function(){callback()},delayCallback)}else{for(var i=0;i<arr.length;i++)(function(i){var t=i*thiz.timeLineEf;setTimeout(function(){thiz.drawLineWrap.append(thiz.linesImg(arr[i]));if(i===arr.length-1&&callback&&typeof callback==="function")setTimeout(function(){callback()},
delayCallback)},t)})(i);if(!arr.length&&callback&&typeof callback==="function")callback()}};GameCandy.prototype.linesImg=function(data){var _html="";if(typeof data==="object")for(var i=0;i<data.length;i++)_html+='\x3cimg src\x3d"images/candy/play/line/l'+(data[i]+1)+'.png"\x3e';else _html+='\x3cimg src\x3d"images/candy/play/line/l'+(data+1)+'.png"\x3e';return _html};
GameCandy.prototype.sendRequestSpin=function(){if(this.betting===0){this.gotoLobby();return false}if(!MiniGameClient.getInstance().isLoginDone()){if(!this.autoSpin){this.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");this.gotoLobby()}return false}var sendObj=null;if(this.isTrial)sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN_TRIAL,"gid":this.gameId,"aid":this.moneyType,"ls":this.lines,
"b":1E4}];else sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":this.gameId,"aid":this.moneyType,"ls":this.lines,"b":this.betting}];MiniGameClient.getInstance().send(sendObj);this.log("send spin")};
GameCandy.prototype.playBonus=function(){var thiz=this;var $bonusWrap=this.elementWrap.children(".slminigame");var $bonusClock=$bonusWrap.find(".bn-timmer").empty();var $bonusXn=$bonusWrap.find(".bn-xn").empty();var $bonusRemain=$bonusWrap.find(".conlai").html(thiz.slotData.MG.items.length);var totalWin=0;var $bonusTotal=$bonusWrap.find(".nhanduoc").html(totalWin);var timeClose=15;var bonusTimmer,delayBonusTimmer;var rate=0;var countClick=0;var isFinished=false;var setRate=function(n){rate=n;$bonusXn.html("x"+
rate)};var finishBonus=function(){if(isFinished)return;$bonusWrap.removeClass("show");$bonusWrap.find(".items").empty();clearInterval(bonusTimmer);clearTimeout(delayBonusTimmer);thiz.winnerEffect("normal",{money:thiz.slotData.MG.m});isFinished=true};var runBnTimmer=function(){clearInterval(bonusTimmer);clearTimeout(delayBonusTimmer);var _timeClose=timeClose;$bonusClock.hide();delayBonusTimmer=setTimeout(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;$bonusClock.html("00:"+_sec).show();
bonusTimmer=setInterval(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;if(_timeClose>=0)$bonusClock.html("00:"+_sec);_timeClose--;if(_timeClose<0){var itemsNotClick=$bonusWrap.find(".items\x3e.item").not(".active");if(countClick<thiz.slotData.MG.items.length){var numOpen=thiz.slotData.MG.items.length-countClick;var eqOpen=[];var rand=0;for(var i=0;i<numOpen;i++){do rand=Math.floor(Math.random()*itemsNotClick.length);while(eqOpen.indexOf(rand)!=-1);itemsNotClick.eq(rand).trigger("click")}}$bonusRemain.html("0");
setTimeout(function(){finishBonus()},2E3)}},1E3)},5E3)};var _html="";for(var i=0;i<24;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/candy/popup/hu_0.png"\x3e\x3cimg src\x3d"images/candy/popup/hu_1.png"\x3e\x3cspan\x3e\x3c/span\x3e\x3c/div\x3e';$bonusWrap.find(".items").html(_html);runBnTimmer();setRate(this.slotData.MG.rate);this.log("data bonus",this.slotData.MG);$bonusWrap.find(".items\x3e.item").off("click").on("click",function(){var $this=jQuery(this);$this.off();$this.addClass("on-click");
setTimeout(function(){$this.removeClass("on-click")},100);if(countClick>=thiz.slotData.MG.items.length)return;if(thiz.slotData.MG.items[countClick]==-1){setRate(rate+1);$this.children("span").html("x"+rate);$this.addClass("active")}else for(var i=0;i<thiz.slotData.MG.stg.length;i++)if(thiz.slotData.MG.items[countClick]==thiz.slotData.MG.stg[i].id){var bValue=thiz.slotData.MG.stg[i].b2||thiz.slotData.MG.stg[i].b||0;var valueWin=thiz.betting*bValue*rate;totalWin+=valueWin;$this.children("span").html(MH.numToText(valueWin,
1));$this.addClass("active");break}countClick++;$bonusRemain.html(thiz.slotData.MG.items.length-countClick);$bonusTotal.html(MH.numToText(totalWin,1));if(countClick>=thiz.slotData.MG.items.length)setTimeout(function(){finishBonus()},1E3);runBnTimmer();return false});$bonusWrap.children(".btn-closePopup").off("click").on("click",function(){$(this).off("click");clearInterval(bonusTimmer);clearTimeout(delayBonusTimmer);var itemsNotClick=$bonusWrap.find(".items\x3e.item").not(".active");if(countClick<
thiz.slotData.MG.items.length){var numOpen=thiz.slotData.MG.items.length-countClick;var eqOpen=[];var rand=0;for(var i=0;i<numOpen;i++){do rand=Math.floor(Math.random()*itemsNotClick.length);while(eqOpen.indexOf(rand)!=-1);itemsNotClick.eq(rand).trigger("click")}}$bonusRemain.html("0");$bonusTotal.html(MH.numToText(thiz.slotData.MG.m,1));setTimeout(function(){finishBonus()},2E3);return false});$bonusWrap.addClass("show")};
GameCandy.prototype.showLichSu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;
_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-
2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameCandy.prototype.showVinhDanh=function(){var thiz=this;var $popup=this.elementWrap.children(".slvinhdanh");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty();return false});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n){MyRequest.fetchTopSlotMachine2({limit:_numPerPage,skip:(n-1)*_numPerPage,gameId:thiz.gameId},function(cmd,data){thiz.log(data);
var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>
_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page));return false})})};getPage(1);$popup.show()};
GameCandy.prototype.showLuatChoi=function(){var $popup=this.elementWrap.children(".slbangthuong");var thiz=this;var _to=this.betting;$popup.children(".slpopup-content").attr("data-room",this.betting);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide();return false});$popup.show()};GameCandy.prototype.updateGame=function(dt){this.log("GameCandy dt",dt)};
GameCandy.prototype.initGame=function(){this.log("init Tam Quoc");var thiz=this;MH.changeBG("images/candy/lobby/bg.png");this.initButton();this.notify("");this.gotoLobby();this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);var loader=new PIXI.loaders.Loader;loader.add("images/candy/sprites.json");loader.once("complete",function(){thiz.createSlotGame()});loader.load();var elementSoDu=this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap\x3e.coin").html(MH.numToText(PlayerMe.gold,
1));$(window).on("updateMoney",function(e,p){elementSoDu.html(MH.numToText(p,1))});var hidden,visibilityChange;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}if(typeof document.addEventListener==="undefined"||hidden===undefined)thiz.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.");
else document.addEventListener(visibilityChange,function(){if(document[hidden]){for(var i=0;i<thiz.audios.length;i++)thiz.audios[i].changeVolume(0);thiz.winHidden=true}else{for(var i=0;i<thiz.audios.length;i++)thiz.audios[i].changeVolume(1);thiz.winHidden=false}},false)};
GameCandy.prototype.destroyGame=function(){var target=BigSlotTarget.getInstance();TopHuClient.getInstance().removeListener(target);MiniGameClient.getInstance().removeListener(target);for(var i=0;i<this.audios.length;i++)this.audios[i].destroy();this.app.destroy();target.currentTarget=null};var DiceDicePreLoad={style:"css/dicedicedice.css",template:"template/slot-dicedicedice.html",images:["images/dicedicedice/background.jpg","images/dicedicedice/lobby/bg.png","images/dicedicedice/lobby/p0.png","images/dicedicedice/lobby/p100.png","images/dicedicedice/lobby/p1000.png","images/dicedicedice/lobby/p10000.png","images/dicedicedice/lobby/btn_back.png","images/dicedicedice/lobby/btn_bxh.png","images/dicedicedice/lobby/btn_caidat.png","images/dicedicedice/play/khung.png","images/dicedicedice/play/btn_tuquay.png",
"images/dicedicedice/play/btn_quay_0.png"],sounds:["images/dicedicedice/sound/spinLoop.ogg","images/dicedicedice/sound/spinStop.ogg","images/dicedicedice/sound/oneLineTing.ogg","images/dicedicedice/sound/coinUpLoop.ogg","images/dicedicedice/sound/bigWin.ogg","images/dicedicedice/sound/winFreeSpin.ogg","images/dicedicedice/sound/winJackpot.ogg","images/dicedicedice/sound/winBonus.ogg"]};
function GameDiceDice(){this.gameId=SLOT_GAME_MINI.DICEDICE||0;this.gameName="DiceDiceDice";this.timmer=new mhTimer;this.betting=0;this.isTrial=false;this.trialJackpot=5E7;this.dataJackpot=[{J:0},{J:0},{J:0}];this.timeLineEf=100;this.spinFast=false;this.onSpin=false;this.autoSpin=false;this.moneyType=1;this.session=0;this.onSpinSession=0;this.lines=[];this.spinning={sid:0,at:0};this.arrayItemInline=[[0,0,0,0,0],[1,1,1,1,1],[2,2,2,2,2],[1,1,0,1,1],[1,1,2,1,1],[0,0,1,0,0],[2,2,1,2,2],[0,2,0,2,0],[2,
0,2,0,2],[1,0,2,0,1],[2,1,0,1,2],[0,1,2,1,0],[1,2,1,0,1],[1,0,1,2,1],[2,1,1,1,2],[0,1,1,1,0],[1,2,2,2,1],[1,0,0,0,1],[2,2,1,0,0],[0,0,1,2,2]];this.speaker=new mhSound({"soundSpin":"images/dicedicedice/sound/spinLoop.ogg","soundColStop":"images/dicedicedice/sound/spinStop.ogg","oneLineTing":"images/dicedicedice/sound/oneLineTing.ogg","coinUpLoop":"images/dicedicedice/sound/coinUpLoop.ogg","bigWin":"images/dicedicedice/sound/bigWin.ogg","winFreeSpin":"images/dicedicedice/sound/winFreeSpin.ogg","winJackpot":"images/dicedicedice/sound/winJackpot.ogg",
"winBonus":"images/dicedicedice/sound/winBonus.ogg","buttonClick":"images/dicedicedice/sound/buttonClick.ogg","openOtherRuong":"images/dicedicedice/sound/openOtherRuong.ogg","hoverRoom":"images/dicedicedice/sound/hoverRoom.ogg"});this.prefixItem="";this.app=new PIXI.Application(980,468,{view:slotCandyCanvas,transparent:true,resolution:1,roundPixels:false});this.containerItem=new PIXI.Container;this.columns=[];this.colsItems=[[],[],[],[],[]];this.slotData=null;this.freespinData={100:{b:100,ls:[],ai:1,
fs:0},1E3:{b:1E3,ls:[],ai:1,fs:0},1E4:{b:1E4,ls:[],ai:1,fs:0}};this.winFreeSpin=-1;this.itemHeight=156;this.tweenTime=2;this.delayLine=.2;this.elementWrap=jQuery("#content\x3e.wrapper\x3e.slot-wrap").eq(0);this.elementQuy=this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin").eq(0);this.drawLineWrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.draw-lines").eq(0);this.elementQuys=[this.elementWrap.find("\x3e.slot-lobby\x3e.room1\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room2\x3e.hu"),
this.elementWrap.find("\x3e.slot-lobby\x3e.room3\x3e.hu"),this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin")];var target=BigSlotTarget.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN_TRIAL.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,this._onObserverResponse,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onLoginOrReconnectSucess,target);TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onTopHuResponse,target);this.initGame();MiniGameClient.getInstance().observerByGameID(this.gameId)}
GameDiceDice.prototype.log=function(){return;console.log.apply(this,arguments)};
GameDiceDice.prototype.gotoLobby=function(){this.log("gotoLobby");this.betting=0;this.isTrial=false;this.onSpin=false;this.changeSpeedMode(false);this.changeAutoSpin(false);this.app.stop();this.elementWrap.children(".slot-lobby").show();this.elementWrap.children(".slot-gameplay").hide();this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap").css({top:"88px",left:"500px"});this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap").css({top:"88px",left:"1273px"})};
GameDiceDice.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:break;case CMD_SLOT_MACHINE.SPIN:case CMD_SLOT_MACHINE.SPIN_TRIAL:console.log("CMD_SLOT_MACHINE.SPIN",data);thiz.onReceiveSpin(data[1]);break;default:break}};
GameDiceDice.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);thiz.log("GameCandy _onObserverResponse",cmd,data);for(var key in thiz.freespinData)if(thiz.freespinData.hasOwnProperty(key))thiz.freespinData[key].fs=0;thiz.winFreeSpin=-1;if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)thiz.freespinData[data.fss[i].b.toString()]=data.fss[i];MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}if(thiz.freespinData[thiz.betting.toString()]&&
thiz.freespinData[thiz.betting.toString()].fs)thiz.winFreeSpin=0;thiz.hasFreeSpin()};GameDiceDice.prototype._onLoginOrReconnectSucess=function(cmd,data){var thiz=this.currentTarget;thiz.log("GameCandy _onLoginOrReconnectSucess",cmd,data);MiniGameClient.getInstance().observerByGameID(thiz.gameId)};
GameDiceDice.prototype._onTopHuResponse=function(cmd,data){var thiz=this.currentTarget;if(thiz.isTrial)return;var dataJackpot=[{J:0},{J:0},{J:0}];if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].gid===thiz.gameId)if(data[1].Js[i].b===100)dataJackpot[0].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E3)dataJackpot[1].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E4)dataJackpot[2].J=data[1].Js[i].J;thiz.setQuy(dataJackpot)};
GameDiceDice.prototype.setQuy=function(data){if(typeof data==="number"){MH.realtimeCount(this.dataJackpot[2].J,data,this.elementQuys[3],1E3);this.dataJackpot[2].J=data}else if(!data||typeof data==="object"){var data=data||this.dataJackpot;if(this.betting===0){MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[0],1E3);MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[1],1E3);MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[2],1E3);MH.realtimeCount(this.dataJackpot[2].J,
data[2].J,this.elementQuys[3],1E3)}else if(!this.isTrial)if(this.betting===100)MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[3],1E3);else if(this.betting===1E3)MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[3],1E3);else if(this.betting===0||this.betting===1E4)MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[3],1E3);this.dataJackpot=data}};
GameDiceDice.prototype.onReceiveSpin=function(data){var thiz=this;this.slotData=null;if(!data){this.forceStopSpin();return}if(!this.isTrial&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.forceStopSpin();return}if(data.mgs){this.notify(data.mgs);this.forceStopSpin();return}if(!data.hasOwnProperty("sbs")||data.sbs.length!=15){this.forceStopSpin();return}if(this.onSpin&&this.spinning.sid==-1){this.slotData=data;this.runSpin();if(this.isTrial){this.trialJackpot+=20*1E4/100;
this.setQuy(this.trialJackpot)}this.setSession(data.sid)}};GameDiceDice.prototype.setSession=function(sid){this.session=sid||0;this.elementWrap.find("\x3e.slot-gameplay\x3e.session").html("#"+sid);if(this.onSpin)this.spinning.sid=sid};
GameDiceDice.prototype.runSpin=function(){var thiz=this;var isStopped=false;var cb=function(){if(isStopped)return;isStopped=true;if(thiz.soundSpin)thiz.soundSpin.destroy();thiz.timmer.setTimeout(function(){thiz.spinStop()},300)};var timeSpinLine=this.spinFast?.3:thiz.tweenTime;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.timmer.setTimeout(function(){thiz.setSpriteIcon(thiz.colsItems[i][2],thiz.slotData.sbs[0+i]);thiz.setSpriteIcon(thiz.colsItems[i][1],thiz.slotData.sbs[5+
i]);thiz.setSpriteIcon(thiz.colsItems[i][0],thiz.slotData.sbs[10+i])},timeSpinLine*1E3/2);thiz.timmer.setTimeout(function(){if(i==4)thiz.stopColSpin(i,cb);else thiz.stopColSpin(i)},timeSpinLine*1E3)},i*thiz.delayLine*1E3)})(i)};GameDiceDice.prototype.createSound=function(_key,_option){return this.speaker.create(_key,_option)};
GameDiceDice.prototype.forceStopSpin=function(){var thiz=this;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.stopColSpin(i)},i*thiz.delayLine*1E3+2E3)})(i);this.changeAutoSpin(false);this.onSpin=false;this.btnSpin.removeClass("disabled");if(this.soundSpin)this.soundSpin.destroy()};
GameDiceDice.prototype.spinStop=function(){var thiz=this;var winlines=[];var _type="hide",_money=this.slotData.mX;if(this.slotData.iJ)_type="jackpot";else if(this.slotData.bw)_type="bigwin";else if(this.slotData.mX)_type="normal";else _type="hide";if(this.winFreeSpin>=0)this.winFreeSpin+=this.slotData.mX;if(this.slotData.hMG){_money=0;for(var i=0;i<this.slotData.wls.length;i++)_money+=this.slotData.wls[i].crd}if(this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)winlines.push(this.slotData.wls[i].lid);
var efDraw=!this.spinFast&&_type=="normal";this.drawLines(winlines,efDraw);this.winnerEffect(_type,{money:_money},function(){thiz.checkFreeBonus()})};
GameDiceDice.prototype.winnerEffect=function(type,data,callback){var thiz=this;var $wrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.win-effect").eq(0);var delayClose=3E3;if(type==="bigwin")delayClose=5E3;if(type==="jackpot")delayClose=6E3;if(type==="hide"){$wrap.attr("class","win-effect is-hide").find(".winnum").empty();delayClose=0}else{if(type==="jackpot"&&this.isTrial){this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}var $moneyWrap=$wrap.find("\x3e.type-"+type+" .winnum");if(data&&data.money){var countTo=
data.money,countFrom=countTo-5E3;while(countFrom<0)countFrom+=100;$moneyWrap.parent().parent().show();MH.realtimeCount(countFrom,countTo,$moneyWrap,1E3);var soundCoinUp=this.createSound("coinUpLoop",{loop:true,duration:1E3})}else $moneyWrap.parent().parent().hide();$wrap.attr("class","win-effect show is-"+type)}if(type=="normal")delayClose=2E3;if(data&&data.hasOwnProperty("money"))if(data.money==0)this.elementWrap.find(".game-control\x3e.num-vuathang").html(0);else this.timmer.setTimeout(function(){thiz.elementWrap.find(".game-control\x3e.num-vuathang").html(MH.numToText(data.money,
1))},1E3);var soundWin=null;if(type=="bigwin")soundWin=this.createSound("bigWin");else if(type=="freespin")soundWin=this.createSound("winFreeSpin");else if(type=="jackpot")soundWin=this.createSound("winJackpot");else if(type=="bonus")soundWin=this.createSound("winBonus");this.timmer.setTimeout(function(){if(type!=="hide")thiz.winnerEffect("hide");if(callback&&typeof callback==="function")callback();else if(type!=="hide")thiz.handleSpinDone();if(soundWin)soundWin.destroy()},delayClose)};
GameDiceDice.prototype.checkFreeBonus=function(){this.log("checkFreeBonus");var thiz=this;this.freespinData[this.slotData.b.toString()].fs=this.slotData.fss;this.hasFreeSpin();if(this.slotData.hFS)this.winnerEffect("freespin");else if(this.slotData.hMG)this.winnerEffect("bonus",null,function(){thiz.playBonus()});else if(0&&!this.hasFreeSpin()&&this.winFreeSpin>=0)this.winnerEffect("freespin",{money:this.winFreeSpin});else this.handleSpinDone()};
GameDiceDice.prototype.changeSpeedMode=function(type,check){};
GameDiceDice.prototype.changeGameMode=function(type){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();if(type===false){this.changeSpeedMode(false);this.changeAutoSpin(false);this.changeBetting(1E4);this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}this.isTrial=!type};
GameDiceDice.prototype.changeBetting=function(bet){var thiz=this;if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.app.start();this.betting=bet;this.isTrial=false;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.btn-muccuoc").attr("bet",this.betting);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1));this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();this.elementWrap.children(".slot-wraptop").children(".coin-wrap, .hu-wrap").removeAttr("style");this.hasFreeSpin();this.timmer.setTimeout(function(){if(thiz.isTrial)return;thiz.setQuy()},50);this.setSession(0)};
GameDiceDice.prototype.hightLight=function(){var thiz=this;var timeShowLine=1E3;var clearHightLight=function(){for(var j=0;j<thiz.timeoutHightLight.length;j++)thiz.timmer.clearTimeout(thiz.timeoutHightLight[j]);thiz.timeoutHightLight=[];thiz.removeDrawLine()};var zoomLineIcons=function(lid){for(var i=0;i<thiz.arrayItemInline[lid].length;i++)(function(i){var sprite=thiz.colsItems[i][thiz.arrayItemInline[lid][i]];var goBack=function(){TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1,y:1,ease:Power4.easeIn})};
TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1.1,y:1.1,ease:Power4.easeOut,onComplete:goBack})})(i)};if(!this.timeoutHightLight)this.timeoutHightLight=[];else clearHightLight();if(!this.onSpin&&this.slotData&&this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)(function(i){var to=thiz.timmer.setTimeout(function(){if(thiz.onSpin||thiz.slotData.sid!=thiz.session)clearHightLight();else{thiz.drawLines([thiz.slotData.wls[i].lid]);zoomLineIcons(thiz.slotData.wls[i].lid);
if(i===thiz.slotData.wls.length-1)thiz.timmer.setTimeout(function(){if(!thiz.onSpin)thiz.removeDrawLine()},timeShowLine)}console.log("hight line")},(i+1)*timeShowLine);thiz.timeoutHightLight.push(to)})(i)};
GameDiceDice.prototype.changeAutoSpin=function(type,check){if(check&&(this.isTrial||!MiniGameClient.getInstance().isLoginDone())){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");this.changeAutoSpin(false);return}if(type){this.btnSpinMode.addClass("active");if(!this.onSpin)this.sendRequestSpin()}else this.btnSpinMode.removeClass("active");this.autoSpin=type};
GameDiceDice.prototype.chooseLines=function(arr){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return false}this.lines=arr;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.chooseLine\x3e.num-lines").html(this.lines.length);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1))};GameDiceDice.prototype.addLine=function(lid){var arr=this.lines.slice();if(arr.indexOf(lid)===-1){arr.push(lid);this.chooseLines(arr)}};GameDiceDice.prototype.removeLine=function(lid){var arr=this.lines.slice();var index=arr.indexOf(lid);if(index>-1&&arr.length>1){arr.splice(index,1);this.chooseLines(arr)}};
GameDiceDice.prototype.handleSpinDone=function(){LobbyRequest.getInstance().requestUpdateMoney();this.removeDrawLine();if(this.autoSpin||this.hasFreeSpin()){this.onSpin=false;this.sendRequestSpin()}else{this.onSpin=false;this.btnSpin.removeClass("disabled");this.hightLight()}if(!this.hasFreeSpin())this.winFreeSpin=-1;else if(this.winFreeSpin=-1)this.winFreeSpin=0};
GameDiceDice.prototype.notify=function(str,_time){var thiz=this;if(!str){this.elementWrap.find(".shortnotice").hide().children(".mess").empty();return}this.elementWrap.find(".shortnotice").show().children(".mess").html(str);var _t=_time||3500;this.timmer.setTimeout(function(){thiz.elementWrap.find(".shortnotice").hide().children(".mess").empty()},_t)};
GameDiceDice.prototype.createPopupCommon=function(text){var thiz=this;var $popup=this.elementWrap.children(".popupCommon");$popup.find(".slpopup-content").html(text);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide();thiz.timmer.clearTimeout($popup.data("timeoutClose"));return false});var timeoutClose=this.timmer.setTimeout(function(){$popup.hide()},3E3);$popup.data("timeoutClose",timeoutClose);$popup.show()};
GameDiceDice.prototype.hasFreeSpin=function(){var n=this.betting?this.freespinData[this.betting.toString()].fs:0;if(n)this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").show().children(".freespin-num").html(n);else this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").hide().children(".freespin-num").empty();return n};GameDiceDice.prototype.setSpriteIcon=function(sprite,icon){sprite.texture=this.app.loader.resources.icons.textures[icon+".png"];sprite.iconId=icon};
GameDiceDice.prototype.initButton=function(){var thiz=this;var $control=this.elementWrap.find(".game-control");var isDoubleClick=function(button){var $button=jQuery(button);if($button.data("btndisable"))return true;$button.data("btndisable",true);thiz.timmer.setTimeout(function(){$button.data("btndisable",false)},1E3);return false};$("#topHuGroup").children(".btn-tophusl").off().on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active");$("#topHu-container").hide()}else{$(this).addClass("active");
$("#topHu-container").show()}return false});this.btnSpin=$control.children(".btn-quay").off("click").on("click",function(){if(isDoubleClick(this))return false;if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");thiz.gotoLobby();return false}if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");thiz.btnSpin.data("btndisable",false);return false}thiz.sendRequestSpin();return false});$control.find("\x3e.group-btndong button").each(function(){var num=
parseInt(jQuery(this).attr("data-num"));jQuery(this).removeAttr("data-num").data("num",num)}).off("mouseenter mouseout").on("mouseenter",function(){if(thiz.onSpin)return false;var num=jQuery(this).data("num");thiz.drawLines([num-1])}).on("mouseout",function(){if(thiz.onSpin)return false;thiz.removeDrawLine()});this.btnSpinMode=$control.children(".btn-autoSpin").off("click").on("click",function(){thiz.changeAutoSpin(!thiz.autoSpin,true);return false});$control.children(".btn-muccuoc").off("click").on("click",
function(){var to;switch(thiz.betting){case 100:to=1E3;break;case 1E3:to=1E4;break;case 1E4:to=100;break;default:to=100;break}thiz.changeBetting(to);return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-back").off("click").on("click",function(){if(thiz.betting===0){thiz.destroyGame();MH.changePage("home")}else if(thiz.onSpin)thiz.createPopupCommon("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else thiz.gotoLobby();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-vinhdanh").off("click").on("click",
function(){thiz.showVinhDanh();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-caidat").off("click").on("click",function(){thiz.showCaiDat();return false});this.elementWrap.find(".game-control\x3e.btn-help").off("click").on("click",function(){thiz.showLuatChoi();return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room0").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeGameMode(false);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room1").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(100);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room2").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeBetting(1E3);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room3").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(1E4);return false});this.elementWrap.children(".slot-lobby").children(".room0, .room1, .room2, .room3").off("mouseenter").on("mouseenter",function(){thiz.createSound("hoverRoom")});
var $bangChon=this.elementWrap.children(".slchondong");$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=parseInt($this.attr("data-num"))-1;$this.removeAttr("data-num").data("lid",lid)});var initItemBangChon=function(){$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=$this.data("lid");if(thiz.lines.indexOf(lid)===-1)$this.parent().removeClass("active");else $this.parent().addClass("active")})};$control.children(".chooseLine").off("click").on("click",
function(){if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(thiz.isTrial){thiz.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}initItemBangChon();$bangChon.show();return false});$bangChon.children(".btn-closePopup").off("click").on("click",function(){$bangChon.hide();return false});$bangChon.find(".controlBottom .btn-chonLe").off().on("click",function(){thiz.chooseLines([0,2,4,6,7,10,12,14,16,18]);initItemBangChon();
return false});$bangChon.find(".controlBottom .btn-chonChan").off().on("click",function(){thiz.chooseLines([1,3,5,7,9,11,13,15,17,19]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonAll").off().on("click",function(){thiz.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonNone").off().on("click",function(){thiz.chooseLines([0]);initItemBangChon();return false});$bangChon.find(".lines button").off().on("click",
function(){var lid=$(this).data("lid");if(thiz.lines.indexOf(lid)===-1)thiz.addLine(lid);else thiz.removeLine(lid);initItemBangChon();return false});this.elementWrap.find("button").not(".btn-quay").on("mousedown",function(){jQuery(this).addClass("on-click");thiz.createSound("buttonClick")}).on("mouseup",function(){jQuery(this).removeClass("on-click")})};GameDiceDice.prototype.removeDrawLine=function(){var thiz=this;this.log("removeDrawLine");this.drawLineWrap.empty()};
GameDiceDice.prototype.drawLines=function(arr,eff,callback){var thiz=this;var delayCallback=this.spinFast?100:500;this.drawLineWrap.empty();if(!eff){this.drawLineWrap.html(this.linesImg(arr));if(callback&&typeof callback==="function")this.timmer.setTimeout(function(){callback()},delayCallback)}else{for(var i=0;i<arr.length;i++)(function(i){var t=i*thiz.timeLineEf;thiz.timmer.setTimeout(function(){thiz.drawLineWrap.append(thiz.linesImg(arr[i]));thiz.createSound("oneLineTing");if(i===arr.length-1&&
callback&&typeof callback==="function")thiz.timmer.setTimeout(function(){callback()},delayCallback)},t)})(i);if(!arr.length&&callback&&typeof callback==="function")callback()}};GameDiceDice.prototype.linesImg=function(data){var _html="";if(typeof data==="object")for(var i=0;i<data.length;i++)_html+='\x3cimg src\x3d"images/dicedicedice/play/line/'+(data[i]+1)+'.png"\x3e';else _html+='\x3cimg src\x3d"images/dicedicedice/play/line/'+(data+1)+'.png"\x3e';return _html};
GameDiceDice.prototype.sendRequestSpin=function(){var thiz=this;if(this.betting===0){this.gotoLobby();return false}if(!MiniGameClient.getInstance().isLoginDone()){if(!this.autoSpin){this.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");this.gotoLobby()}return false}var sendObj=null;if(this.isTrial)sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN_TRIAL,"gid":this.gameId,"aid":this.moneyType,
"ls":this.lines,"b":1E4}];else sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":this.gameId,"aid":this.moneyType,"ls":this.lines,"b":this.betting}];MiniGameClient.getInstance().send(sendObj);this.btnSpin.addClass("on-click disabled");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-click")},100);this.winnerEffect("hide");this.removeDrawLine();this.spinning.sid=-1;this.spinning.at=(new Date).getTime();
this.onSpin=true;if(this.soundSpin)this.soundSpin.destroy();this.soundSpin=this.createSound("soundSpin",{loop:true});for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.runColSpin(i)},i*thiz.delayLine*1E3)})(i);this.timmer.setTimeout(function(){if(thiz.spinning.sid==-1&&(new Date).getTime()-thiz.spinning.at>59E3)thiz.forceStopSpin()},1*60*1E3)};
GameDiceDice.prototype.playBonus=function(){console.log("Play bonus",this.slotData);var thiz=this;var $bonusWrap=this.elementWrap.children(".slminigame");var $bonusClock=$bonusWrap.find(".bn-timmer").empty();var $bonusXn=$bonusWrap.find(".bn-xn").empty();var $bonusRemain=$bonusWrap.find(".conlai").html(thiz.slotData.MG.items.length);var totalWin=0;var $bonusTotal=$bonusWrap.find(".nhanduoc").html(totalWin);var timeClose=15;var bonusTimmer,delayBonusTimmer;var rate=0;var countClick=0;var isFinished=
false;var canClick=true;var setRate=function(n){rate=n;$bonusXn.html("x"+rate)};var finishBonus=function(){if(isFinished)return;$bonusWrap.removeClass("show");$bonusWrap.find(".items, .items-ruong").empty();thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);thiz.winnerEffect("normal",{money:thiz.slotData.MG.m});isFinished=true;canClick=false};var runBnTimmer=function(){thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);var _timeClose=timeClose;
$bonusClock.hide();delayBonusTimmer=thiz.timmer.setTimeout(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;$bonusClock.html("00:"+_sec).show();bonusTimmer=thiz.timmer.setInterval(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;if(_timeClose>=0)$bonusClock.html("00:"+_sec);_timeClose--;if(_timeClose<0)finishBonus()},1E3)},5E3)};var afterClick=function(){countClick++;canClick=true;$bonusRemain.html(thiz.slotData.MG.items.length-countClick);MH.realtimeCount($bonusTotal.data("num"),
totalWin,$bonusTotal,1E3);$bonusTotal.data("num",totalWin);if(countClick>=thiz.slotData.MG.items.length)thiz.timmer.setTimeout(function(){finishBonus()},1E3);runBnTimmer()};$bonusWrap.removeClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").show();$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").hide();var _html="";for(var i=0;i<32;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/dicedicedice/bonus/item.png"\x3e\x3c/div\x3e';$bonusWrap.find(".items").html(_html);runBnTimmer();
setRate(this.slotData.MG.rate);this.log("data bonus",this.slotData.MG);$bonusWrap.find(".items\x3e.item").off("click").on("click",function(){if(!canClick)return false;thiz.createSound("buttonClick");var $this=jQuery(this);$this.off();$this.addClass("on-click");thiz.timmer.setTimeout(function(){$this.removeClass("on-click")},100);if(countClick>=thiz.slotData.MG.items.length)return;canClick=false;if(thiz.slotData.MG.items[countClick]==-1){setRate(rate+1);$this.append('\x3cimg src\x3d"images/dicedicedice/bonus/key.png"\x3e');
afterClick()}else for(var i=0;i<thiz.slotData.MG.stg.length;i++){var bValue=0,valueWin=0;if(thiz.slotData.MG.items[countClick]==thiz.slotData.MG.stg[i].id){bValue=thiz.slotData.MG.stg[i].b2||thiz.slotData.MG.stg[i].b||0;valueWin=thiz.betting*bValue*rate;totalWin+=valueWin;if(thiz.slotData.MG.items[countClick]){$this.append('\x3cimg src\x3d"images/dicedicedice/bonus/ruong.png"\x3e');var _html="";for(var ii=0;ii<5;ii++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/dicedicedice/bonus/ruong-lg.png"\x3e\x3cimg src\x3d"images/dicedicedice/bonus/ruong_on.png"\x3e\x3c/div\x3e';
$bonusWrap.find(".items-ruong").html(_html);var canOpen=true;var ruongOther=null;if(bValue==10)ruongOther=[10,15,20,15];else if(bValue==15)ruongOther=[20,10,15,10];else if(bValue==20)ruongOther=[10,15,15,10];console.log("bValue, ruongOther",bValue,ruongOther);$bonusWrap.find(".items-ruong\x3e.item").off("click").on("click",function(){if(!canOpen)return false;thiz.createSound("buttonClick");$(this).append("\x3cspan\x3e"+MH.numToText(valueWin,1)+"\x3c/span\x3e").addClass("active");if(ruongOther){var $this=
$(this);thiz.timmer.setTimeout(function(){$this.siblings(".item").each(function(index){$(this).append("\x3cspan\x3e"+MH.numToText(thiz.betting*ruongOther[index]*rate,1)+"\x3c/span\x3e").addClass("active blur");console.log(index,".item")})},1E3)}canOpen=false;thiz.timmer.setTimeout(function(){$bonusWrap.removeClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").show();$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").hide();afterClick()},3E3);return false});thiz.timmer.setTimeout(function(){$bonusWrap.addClass("moruong");
$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").hide();$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").show()},1500)}else{$this.append('\x3cimg src\x3d"images/dicedicedice/bonus/item_on.png"\x3e\x3cspan\x3e0\x3c/span\x3e');MH.realtimeCount(0,valueWin,$this.children("span"),1E3);afterClick()}break}}$this.addClass("active");return false});$bonusWrap.children(".btn-closePopup").off("click").on("click",function(){$(this).off("click");thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);
var itemsNotClick=$bonusWrap.find(".items\x3e.item").not(".active");if(countClick<thiz.slotData.MG.items.length){var numOpen=thiz.slotData.MG.items.length-countClick;var eqOpen=[];var rand=0;for(var i=0;i<numOpen;i++){do rand=Math.floor(Math.random()*itemsNotClick.length);while(eqOpen.indexOf(rand)!=-1);itemsNotClick.eq(rand).trigger("click")}}$bonusRemain.html("0");$bonusTotal.html(MH.numToText(thiz.slotData.MG.m,1));thiz.timmer.setTimeout(function(){finishBonus()},2E3);return false});$bonusWrap.addClass("show")};
GameDiceDice.prototype.showLichSu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=9,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;
_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-
2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameDiceDice.prototype.showLichSuHu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsuhu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=9,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotJackpotHistory(thiz.gameId,_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;
_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-
2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameDiceDice.prototype.showVinhDanh=function(){var thiz=this;var $popup=this.elementWrap.children(".slvinhdanh");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.hide().removeClass("hide").find(".table-content, .pagination").empty()},500);return false});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=9,_type=MoneyType.Gold;var getPage=function(n){MyRequest.fetchTopSlotMachine2({limit:_numPerPage,
skip:(n-1)*_numPerPage,gameId:thiz.gameId},function(cmd,data){thiz.log(data);var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-
1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page));return false})})};getPage(1);$popup.show()};
GameDiceDice.prototype.showLuatChoi=function(){var $popup=this.elementWrap.children(".slbangthuong");var thiz=this;var _to=this.betting;$popup.children(".slpopup-content").attr("data-room",this.betting);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.show()};
GameDiceDice.prototype.showCaiDat=function(){var thiz=this;var $popup=this.elementWrap.children(".slcaidat");if(this.speaker.mute)$popup.find(".amthanh").addClass("mute");else $popup.find(".amthanh").removeClass("mute");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.find(".amthanh").off("click").on("click",function(){$(this).toggleClass("mute");thiz.speaker.setMute($(this).hasClass("mute"));
return false});$popup.find(".lsgd").off("click").on("click",function(){$popup.hide();thiz.showLichSu();return false});$popup.find(".lsh").off("click").on("click",function(){$popup.hide();thiz.showLichSuHu();return false});$popup.show()};
GameDiceDice.prototype.runColSpin=function(colId){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.position.set(0,0);wrapBlur.position.set(0,0);var _h=-(wrapBlur.children.length-3-.5)*this.itemHeight;gsap.from(wrapBlur.position,{y:_h,repeat:1E3,duration:1,ease:"none"});wrapItem.visible=false;wrapBlur.visible=true};
GameDiceDice.prototype.stopColSpin=function(colId,callback){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");wrapBlur.visible=false;wrapItem.visible=true;gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.y=50;gsap.to(wrapItem.position,{duration:.3,ease:"elastic.out(1, 0.3)",y:0});this.createSound("soundColStop");this.timmer.setTimeout(function(){wrapItem.y=0;if(callback&&typeof callback=="function")callback()},
300)};
GameDiceDice.prototype.createSlotGame=function(){var thiz=this;this.prefixItem="";this.colsItems=[];var createItem=function(obj){var item=new PIXI.Sprite(thiz.app.loader.resources.icons.textures[obj.id+".png"]);item.anchor.set(.5,.5);if(obj.x)item.x=obj.x;if(obj.y)item.y=obj.y;if(obj.visible===false)item.visible=false;item.iconId=obj.id;if(obj.blur){var ft=new PIXI.filters.BlurFilter;ft.blurX=0;ft.blurY=5;item.filters=[ft]}return item};for(var i=0;i<5;i++){this.columns[i]=new PIXI.Container;this.columns[i]._index=
i;this.columns[i].position.set(80+i*206,0);this.containerItem.addChild(this.columns[i]);var wrapItem=new PIXI.Container;wrapItem.name="wrapItem";var wrapBlur=new PIXI.Container;wrapBlur.name="wrapBlur";this.columns[i].addChild(wrapItem,wrapBlur);this.colsItems[i]=[];for(j=0;j<3;j++){var item=createItem({id:Math.floor(Math.random()*10)%7,y:j*thiz.itemHeight+thiz.itemHeight/2});wrapItem.addChild(item);this.colsItems[i].push(item)}var ics=[0,1,2,3,4,5,6,5,4,3,2,0,1,2];ics.sort(function(){return.5-Math.random()});
ics.push(ics[0],ics[1],ics[2]);for(var ii=ics.length-1;ii>=0;ii--){var item=createItem({id:ics[ii],blur:true,y:ii*thiz.itemHeight+thiz.itemHeight/2});wrapBlur.addChild(item)}wrapBlur.cacheAsBitmap=true;wrapBlur.visible=false}this.app.stage.addChild(this.containerItem)};
GameDiceDice.prototype.initGame=function(){this.log("init Tam Quoc");var thiz=this;MH.changeBG("images/dicedicedice/background.jpg");this.initButton();this.notify("");this.gotoLobby();this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19]);this.app.loader.add("icons","images/dicedicedice/sprites.json").load(function(loader,data){thiz.createSlotGame()});var elementSoDu=this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap\x3e.coin").html(MH.numToText(PlayerMe.gold,1));var offsetTopHu=
function(){var $topHuGroup=$("#topHuGroup");var _count=0;var timeoutOffset=thiz.timmer.setInterval(function(){$topHuGroup.offset({left:0});_count++;if(_count>=10)thiz.timmer.clearInterval(timeoutOffset)},20)};$(window).on("updateMoney.Slot"+this.gameName,function(e,p){elementSoDu.html(MH.numToText(p,1))}).on("changeView.Slot"+this.gameName,function(){offsetTopHu()});offsetTopHu()};
GameDiceDice.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=BigSlotTarget.getInstance();TopHuClient.getInstance().removeListener(target);MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.speaker.destroy();this.app.destroy();$(window).off(".Slot"+this.gameName);target.currentTarget=null};var DeadOrAlivePreLoad={style:"css/deadoralive.css",template:"template/slot-deadoralive.html",images:["images/deadoralive/background.jpg","images/deadoralive/lobby/bg.png","images/deadoralive/lobby/p0.png","images/deadoralive/lobby/p100.png","images/deadoralive/lobby/p1000.png","images/deadoralive/lobby/p10000.png","images/deadoralive/lobby/btn_back.png","images/deadoralive/lobby/btn_bxh.png","images/deadoralive/lobby/btn_caidat.png","images/deadoralive/play/khung.png","images/deadoralive/play/btn_tuquay.png",
"images/deadoralive/play/btn_quay_0.png"],sounds:["images/deadoralive/sound/nen/4.ogg","images/deadoralive/sound/nen/5.ogg","images/deadoralive/sound/nen/3.ogg","images/deadoralive/sound/nen/6.ogg","images/deadoralive/sound/nen/1.ogg","images/deadoralive/sound/nen/7.ogg","images/deadoralive/sound/nen/8.ogg","images/deadoralive/sound/nen/9.ogg","images/deadoralive/sound/nen/10.ogg","images/deadoralive/sound/nen/11.ogg","images/deadoralive/sound/nen/12.ogg","images/deadoralive/sound/nen/13.ogg","images/deadoralive/sound/nen/14.ogg",
"images/deadoralive/sound/nen/2.ogg","images/deadoralive/sound/winNormal/1.ogg","images/deadoralive/sound/winNormal/2.ogg","images/deadoralive/sound/winNormal/3.ogg","images/deadoralive/sound/winNormal/4.ogg","images/deadoralive/sound/winNormal/5.ogg","images/deadoralive/sound/winNormal/6.ogg","images/deadoralive/sound/winNormal/7.ogg","images/deadoralive/sound/winNormal/8.ogg","images/deadoralive/sound/winNormal/9.ogg","images/deadoralive/sound/winNormal/10.ogg","images/deadoralive/sound/winNormal/11.ogg",
"images/deadoralive/sound/winJackpot.ogg","images/deadoralive/sound/buttonClick.ogg","images/deadoralive/sound/openOtherRuong.ogg","images/deadoralive/sound/hoverRoom.ogg","images/deadoralive/sound/spinLoop.ogg","images/deadoralive/sound/spinStart.ogg","images/deadoralive/sound/spinStop.ogg","images/deadoralive/sound/coinUpLoop.ogg"]};
function GameDeadOrAlive(){this.gameName="DeadOrAlive";this.gameId=SLOT_GAME_MINI.DEADORALIVE||0;this.timmer=new mhTimer;this.betting=0;this.isTrial=false;this.trialJackpot=5E7;this.dataJackpot=[{J:0},{J:0},{J:0}];this.timeLineEf=100;this.spinFast=false;this.onSpin=false;this.autoSpin=false;this.moneyType=1;this.session=0;this.lines=[];this.spinning={sid:0,at:0};this.arrayItemInline=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[2,1,0,1,2],[0,1,2,1,0],[1,0,0,0,1],[1,2,2,2,1],[0,0,1,2,2],[2,2,1,0,0],[1,2,1,
0,1],[1,0,1,2,1],[0,1,1,1,0],[2,1,1,1,2],[0,1,0,1,0],[2,1,2,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,0,2,0,0],[2,2,0,2,2],[0,2,2,2,0],[2,0,0,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,2,0,2,0],[2,0,2,0,2]];this.speaker=new mhSound({"background":["images/deadoralive/sound/nen/4.ogg","images/deadoralive/sound/nen/5.ogg","images/deadoralive/sound/nen/6.ogg","images/deadoralive/sound/nen/3.ogg","images/deadoralive/sound/nen/1.ogg","images/deadoralive/sound/nen/7.ogg","images/deadoralive/sound/nen/8.ogg","images/deadoralive/sound/nen/9.ogg",
"images/deadoralive/sound/nen/10.ogg","images/deadoralive/sound/nen/11.ogg","images/deadoralive/sound/nen/12.ogg","images/deadoralive/sound/nen/13.ogg","images/deadoralive/sound/nen/14.ogg","images/deadoralive/sound/nen/2.ogg"],"soundSpin":"images/deadoralive/sound/spinLoop.ogg","spinStart":"images/deadoralive/sound/spinStart.ogg","soundColStop":"images/deadoralive/sound/spinStop.ogg","coinUpLoop":"images/deadoralive/sound/coinUpLoop.ogg","winNormal":["images/deadoralive/sound/winNormal/1.ogg","images/deadoralive/sound/winNormal/2.ogg",
"images/deadoralive/sound/winNormal/3.ogg","images/deadoralive/sound/winNormal/4.ogg","images/deadoralive/sound/winNormal/5.ogg","images/deadoralive/sound/winNormal/6.ogg","images/deadoralive/sound/winNormal/7.ogg","images/deadoralive/sound/winNormal/8.ogg","images/deadoralive/sound/winNormal/9.ogg","images/deadoralive/sound/winNormal/10.ogg","images/deadoralive/sound/winNormal/11.ogg"],"winJackpot":"images/deadoralive/sound/winJackpot.ogg","buttonClick":"images/deadoralive/sound/buttonClick.ogg",
"openOtherRuong":"images/deadoralive/sound/openOtherRuong.ogg","hoverRoom":"images/deadoralive/sound/hoverRoom.ogg"});this.prefixItem="";this.app=new PIXI.Application(980,573,{view:slotCandyCanvas,transparent:true,resolution:1,roundPixels:false});this.containerItem=new PIXI.Container;this.columns=[];this.colsItems=[[],[],[],[],[]];this.slotData=null;this.freespinData={100:{b:100,ls:[],ai:1,fs:0},1E3:{b:1E3,ls:[],ai:1,fs:0},1E4:{b:1E4,ls:[],ai:1,fs:0}};this.winFreeSpin=-1;this.itemHeight=191;this.tweenTime=
2;this.delayLine=.3;this.elementWrap=jQuery("#content\x3e.wrapper\x3e.slot-wrap").eq(0);this.elementQuy=this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin").eq(0);this.drawLineWrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.draw-lines").eq(0);this.elementQuys=[this.elementWrap.find("\x3e.slot-lobby\x3e.room1\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room2\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room3\x3e.hu"),this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin")];
var target=BigSlotTarget.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN_TRIAL.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,
this._onObserverResponse.bind(this),target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onLoginOrReconnectSucess.bind(this),target);TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onTopHuResponse.bind(this),target);this.initGame();MiniGameClient.getInstance().observerByGameID(this.gameId)}GameDeadOrAlive.prototype.log=function(){return;console.log.apply(this,arguments)};
GameDeadOrAlive.prototype.gotoLobby=function(){this.log("gotoLobby");this.betting=0;this.isTrial=false;this.onSpin=false;this.changeSpeedMode(false);this.changeAutoSpin(false);this.app.stop();this.elementWrap.children(".slot-lobby").show();this.elementWrap.children(".slot-gameplay").hide();this.elementWrap.find("\x3e.slot-wraptop").addClass("inLobby");var thiz=this;var $slCoverLobby=$("#slCoverLobby");var _count=0;var timeoutOffset=thiz.timmer.setInterval(function(){$slCoverLobby.offset({left:window.innerWidth-
503*MH.scale});_count++;if(_count>=10)thiz.timmer.clearInterval(timeoutOffset)},20)};GameDeadOrAlive.prototype._onupdateGame=function(cmd,data){var thiz=this;if(data[1].gid!=this.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:break;case CMD_SLOT_MACHINE.SPIN:case CMD_SLOT_MACHINE.SPIN_TRIAL:this.onReceiveSpin(data[1]);break;default:break}};
GameDeadOrAlive.prototype._onObserverResponse=function(cmd,data){var data=MiniGameClient.getInstance().getObserverDataByGameId(this.gameId);this.log("GameCandy _onObserverResponse",cmd,data);for(var key in this.freespinData)if(this.freespinData.hasOwnProperty(key))this.freespinData[key].fs=0;this.winFreeSpin=-1;if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)this.freespinData[data.fss[i].b.toString()]=data.fss[i];MiniGameClient.getInstance().resetObserverDataByGameId(this.gameId)}if(this.freespinData[this.betting.toString()]&&
this.freespinData[this.betting.toString()].fs)this.winFreeSpin=0;this.hasFreeSpin()};GameDeadOrAlive.prototype._onLoginOrReconnectSucess=function(cmd,data){console.log("Big slot _onLoginOrReconnectSucess",cmd,data);MiniGameClient.getInstance().observerByGameID(this.gameId)};
GameDeadOrAlive.prototype._onTopHuResponse=function(cmd,data){if(this.isTrial)return;var dataJackpot=[{J:0},{J:0},{J:0}];if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].gid===this.gameId)if(data[1].Js[i].b===100)dataJackpot[0].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E3)dataJackpot[1].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E4)dataJackpot[2].J=data[1].Js[i].J;this.setQuy(dataJackpot)};
GameDeadOrAlive.prototype.setQuy=function(data){if(typeof data==="number"){console.log("setQuy",data,this.dataJackpot[2].J);MH.realtimeCount(this.dataJackpot[2].J,data,this.elementQuys[3],1E3);this.dataJackpot[2].J=data}else if(!data||typeof data==="object"){var data=data||this.dataJackpot;if(this.betting===0){MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[0],1E3);MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[1],1E3);MH.realtimeCount(this.dataJackpot[2].J,data[2].J,
this.elementQuys[2],1E3);MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[3],1E3)}else if(!this.isTrial)if(this.betting===100)MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[3],1E3);else if(this.betting===1E3)MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[3],1E3);else if(this.betting===0||this.betting===1E4)MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[3],1E3);this.dataJackpot=data}};
GameDeadOrAlive.prototype.onReceiveSpin=function(data){var thiz=this;this.slotData=null;if(!data){this.forceStopSpin();return}if(!this.isTrial&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.forceStopSpin();return}if(data.mgs){this.notify(data.mgs);this.forceStopSpin();return}if(!data.hasOwnProperty("sbs")||data.sbs.length!=15){this.forceStopSpin();return}if(this.onSpin&&this.spinning.sid==-1){this.slotData=data;this.runSpin();if(this.isTrial){this.trialJackpot+=25*1E4/100;
this.setQuy(this.trialJackpot)}this.setSession(data.sid)}};GameDeadOrAlive.prototype.setSession=function(sid){this.session=sid||0;this.elementWrap.find("\x3e.slot-gameplay\x3e.session").html("#"+sid);if(this.onSpin)this.spinning.sid=sid};
GameDeadOrAlive.prototype.runSpin=function(){var thiz=this;var isStopped=false;var cb=function(){if(isStopped)return;isStopped=true;thiz.timmer.setTimeout(function(){thiz.spinStop()},300)};var timeSpinLine=this.spinFast?.3:thiz.tweenTime;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.timmer.setTimeout(function(){thiz.setSpriteIcon(thiz.colsItems[i][2],thiz.slotData.sbs[0+i]);thiz.setSpriteIcon(thiz.colsItems[i][1],thiz.slotData.sbs[5+i]);thiz.setSpriteIcon(thiz.colsItems[i][0],
thiz.slotData.sbs[10+i])},timeSpinLine*1E3/2);thiz.timmer.setTimeout(function(){if(i==4)thiz.stopColSpin(i,cb);else thiz.stopColSpin(i)},timeSpinLine*1E3)},i*thiz.delayLine*1E3)})(i)};GameDeadOrAlive.prototype.createSound=function(_key,_option){return this.speaker.create(_key,_option)};
GameDeadOrAlive.prototype.forceStopSpin=function(){var thiz=this;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.stopColSpin(i)},i*thiz.delayLine*1E3+2E3)})(i);this.changeAutoSpin(false);this.onSpin=false;this.btnSpin.removeClass("disabled")};
GameDeadOrAlive.prototype.spinStop=function(){var thiz=this;var winlines=[];var _type="hide",_money=this.slotData.mX;if(this.slotData.iJ)_type="jackpot";else if(this.slotData.bw)_type="bigwin";else if(this.slotData.mX)_type="normal";else _type="hide";if(this.winFreeSpin>=0)this.winFreeSpin+=this.slotData.mX;if(this.slotData.hMG){_money=0;for(var i=0;i<this.slotData.wls.length;i++)_money+=this.slotData.wls[i].crd}if(this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)winlines.push(this.slotData.wls[i].lid);
var efDraw=!this.spinFast&&_type=="normal";this.drawLines(winlines,efDraw);this.winnerEffect(_type,{money:_money},function(){thiz.checkFreeBonus()})};
GameDeadOrAlive.prototype.winnerEffect=function(type,data,callback){var thiz=this;var $wrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.win-effect").eq(0);var delayClose=3E3;if(type==="bigwin")delayClose=5E3;if(type==="jackpot")delayClose=6E3;if(type==="hide"){$wrap.attr("class","win-effect is-hide").find(".winnum").empty();delayClose=0}else{if(type==="jackpot"&&this.isTrial){this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}var $moneyWrap=$wrap.find("\x3e.type-"+type+" .winnum");if(data&&data.money){var countTo=
data.money,countFrom=countTo-5E3;while(countFrom<0)countFrom+=100;$moneyWrap.parent().parent().show();MH.realtimeCount(countFrom,countTo,$moneyWrap,1E3);var soundCoinUp=this.createSound("coinUpLoop",{loop:true,duration:1E3})}else $moneyWrap.parent().parent().hide();$wrap.attr("class","win-effect show is-"+type)}if(type=="normal")delayClose=2E3;if(data&&data.hasOwnProperty("money"))if(data.money==0)this.elementWrap.find(".game-control\x3e.num-vuathang").html(0);else this.timmer.setTimeout(function(){thiz.elementWrap.find(".game-control\x3e.num-vuathang").html(MH.numToText(data.money,
1))},1E3);var soundWin=null;if(type=="normal")this.createSound("winNormal",{random:true});else if(type=="bigwin")this.createSound("winNormal",{random:true});else if(type=="freespin")this.createSound("winNormal",{random:true});else if(type=="jackpot")soundWin=this.createSound("winJackpot");else if(type=="bonus")this.createSound("winNormal",{random:true});this.timmer.setTimeout(function(){if(type!=="hide")thiz.winnerEffect("hide");if(callback&&typeof callback==="function")callback();else if(type!==
"hide")thiz.handleSpinDone();if(soundWin)soundWin.destroy()},delayClose)};GameDeadOrAlive.prototype.checkFreeBonus=function(){this.log("checkFreeBonus");var thiz=this;this.freespinData[this.slotData.b.toString()].fs=this.slotData.fss;this.hasFreeSpin();if(this.slotData.hFS)this.winnerEffect("freespin");else if(this.slotData.hMG)this.winnerEffect("bonus",null,function(){thiz.playBonus()});else if(0&&!this.hasFreeSpin()&&this.winFreeSpin>=0)this.winnerEffect("freespin",{money:this.winFreeSpin});else this.handleSpinDone()};
GameDeadOrAlive.prototype.changeSpeedMode=function(type,check){};
GameDeadOrAlive.prototype.changeGameMode=function(type){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();if(type===false){this.changeSpeedMode(false);this.changeAutoSpin(false);this.changeBetting(1E4);this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}this.isTrial=!type};
GameDeadOrAlive.prototype.changeBetting=function(bet){var thiz=this;if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.app.start();this.betting=bet;this.isTrial=false;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.btn-muccuoc").html(MH.numToText(this.betting,1));this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1));this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();this.elementWrap.children(".slot-wraptop").removeClass("inLobby");this.hasFreeSpin();this.timmer.setTimeout(function(){if(thiz.isTrial)return;thiz.setQuy()},50);this.setSession(0)};
GameDeadOrAlive.prototype.hightLight=function(){var thiz=this;var timeShowLine=1E3;var clearHightLight=function(){for(var j=0;j<thiz.timeoutHightLight.length;j++)thiz.timmer.clearTimeout(thiz.timeoutHightLight[j]);thiz.timeoutHightLight=[];thiz.removeDrawLine()};var zoomLineIcons=function(lid){for(var i=0;i<thiz.arrayItemInline[lid].length;i++)(function(i){var sprite=thiz.colsItems[i][thiz.arrayItemInline[lid][i]];var goBack=function(){TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1,y:1,ease:Power4.easeIn})};
TweenLite.to(sprite.scale,timeShowLine/2/1E3,{x:1.1,y:1.1,ease:Power4.easeOut,onComplete:goBack})})(i)};if(!this.timeoutHightLight)this.timeoutHightLight=[];else clearHightLight();if(!this.onSpin&&this.slotData&&this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)(function(i){var to=thiz.timmer.setTimeout(function(){if(thiz.onSpin||thiz.slotData.sid!=thiz.session)clearHightLight();else{thiz.drawLines([thiz.slotData.wls[i].lid]);zoomLineIcons(thiz.slotData.wls[i].lid);
if(i===thiz.slotData.wls.length-1)thiz.timmer.setTimeout(function(){if(!thiz.onSpin)thiz.removeDrawLine()},timeShowLine)}console.log("hight line")},(i+1)*timeShowLine);thiz.timeoutHightLight.push(to)})(i)};
GameDeadOrAlive.prototype.changeAutoSpin=function(type,check){if(check&&(this.isTrial||!MiniGameClient.getInstance().isLoginDone())){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");this.changeAutoSpin(false);return}if(type){this.btnSpinMode.addClass("active");if(!this.onSpin)this.sendRequestSpin()}else this.btnSpinMode.removeClass("active");this.autoSpin=type};
GameDeadOrAlive.prototype.chooseLines=function(arr){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return false}this.lines=arr;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.chooseLine\x3e.num-lines").html(this.lines.length);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1))};GameDeadOrAlive.prototype.addLine=function(lid){var arr=this.lines.slice();if(arr.indexOf(lid)===-1){arr.push(lid);this.chooseLines(arr)}};GameDeadOrAlive.prototype.removeLine=function(lid){var arr=this.lines.slice();var index=arr.indexOf(lid);if(index>-1&&arr.length>1){arr.splice(index,1);this.chooseLines(arr)}};
GameDeadOrAlive.prototype.handleSpinDone=function(){LobbyRequest.getInstance().requestUpdateMoney();this.log("handleSpinDone");if(this.autoSpin||this.hasFreeSpin()){this.onSpin=false;this.sendRequestSpin()}else{this.onSpin=false;this.btnSpin.removeClass("disabled");this.hightLight()}if(!this.hasFreeSpin())this.winFreeSpin=-1;else if(this.winFreeSpin=-1)this.winFreeSpin=0};
GameDeadOrAlive.prototype.notify=function(str,_time){var thiz=this;if(!str){this.elementWrap.find(".shortnotice").hide().children(".mess").empty();return}this.elementWrap.find(".shortnotice").show().children(".mess").html(str);var _t=_time||3500;this.timmer.setTimeout(function(){thiz.elementWrap.find(".shortnotice").hide().children(".mess").empty()},_t)};
GameDeadOrAlive.prototype.createPopupCommon=function(text){var thiz=this;var $popup=this.elementWrap.children(".popupCommon");$popup.find(".slpopup-content").html(text);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide();thiz.timmer.clearTimeout($popup.data("timeoutClose"));return false});var timeoutClose=this.timmer.setTimeout(function(){$popup.hide()},3E3);$popup.data("timeoutClose",timeoutClose);$popup.show()};
GameDeadOrAlive.prototype.hasFreeSpin=function(){var n=this.betting?this.freespinData[this.betting.toString()].fs:0;if(n)this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").show().children(".freespin-num").html(n);else this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").hide().children(".freespin-num").empty();return n};
GameDeadOrAlive.prototype.setSpriteIcon=function(sprite,icon){sprite.texture=this.app.loader.resources.icons.textures[icon+".png"];sprite.iconId=icon;this.playSpriteAnimation(sprite);this.playSpriteAnimation(sprite);this.playSpriteAnimation(sprite)};
GameDeadOrAlive.prototype.initButton=function(){var thiz=this;var $control=this.elementWrap.find(".game-control");var isDoubleClick=function(button){var $button=jQuery(button);if($button.data("btndisable"))return true;$button.data("btndisable",true);thiz.timmer.setTimeout(function(){$button.data("btndisable",false)},1E3);return false};$("#topHuGroup").children(".btn-tophusl").off().on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active");$("#topHu-container").hide()}else{$(this).addClass("active");
$("#topHu-container").show()}return false});this.elementWrap.children(".btn-tophusl").off().on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active");$("#topHu-container").hide()}else{$(this).addClass("active");$("#topHu-container").show()}return false});this.btnSpin=$control.children(".btn-quay").off("click").on("click",function(){if(isDoubleClick(this))return false;if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
thiz.gotoLobby();return false}if(thiz.onSpin||thiz.autoSpin){thiz.btnSpin.data("btndisable",false);return false}thiz.sendRequestSpin();return false});$control.find("\x3e.group-btndong button").each(function(){var num=parseInt(jQuery(this).attr("data-num"));jQuery(this).removeAttr("data-num").data("num",num)}).off("mouseenter mouseout").on("mouseenter",function(){if(thiz.onSpin)return false;var num=jQuery(this).data("num");thiz.drawLines([num-1])}).on("mouseout",function(){if(thiz.onSpin)return false;
thiz.removeDrawLine()});this.btnSpinMode=$control.children(".btn-autoSpin").off("click").on("click",function(){thiz.changeAutoSpin(!thiz.autoSpin,true);return false});$control.children(".btn-muccuoc").off("click").on("click",function(){var to;switch(thiz.betting){case 100:to=1E3;break;case 1E3:to=1E4;break;case 1E4:to=100;break;default:to=100;break}thiz.changeBetting(to);return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-back").off("click").on("click",function(){if(thiz.betting===0){thiz.destroyGame();
MH.changePage("home")}else if(thiz.onSpin)thiz.createPopupCommon("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else thiz.gotoLobby();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-vinhdanh").off("click").on("click",function(){thiz.showVinhDanh();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-caidat").off("click").on("click",function(){thiz.showCaiDat();return false});this.elementWrap.find(".game-control\x3e.btn-help").off("click").on("click",function(){thiz.showLuatChoi();
return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room0").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeGameMode(false);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room1").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeBetting(100);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room2").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(1E3);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room3").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeBetting(1E4);return false});this.elementWrap.children(".slot-lobby").children(".room0, .room1, .room2, .room3").off("mouseenter").on("mouseenter",function(){thiz.createSound("hoverRoom")});var $bangChon=this.elementWrap.children(".slchondong");$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=parseInt($this.attr("data-num"))-1;$this.removeAttr("data-num").data("lid",lid)});var initItemBangChon=function(){$bangChon.find(".lines button").each(function(){var $this=
jQuery(this);var lid=$this.data("lid");if(thiz.lines.indexOf(lid)===-1)$this.parent().removeClass("active");else $this.parent().addClass("active")})};$control.children(".chooseLine").off("click").on("click",function(){if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(thiz.isTrial){thiz.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}initItemBangChon();$bangChon.show();return false});$bangChon.children(".btn-closePopup").off("click").on("click",
function(){$bangChon.hide();return false});$bangChon.find(".controlBottom .btn-chonLe").off().on("click",function(){thiz.chooseLines([0,2,4,6,7,10,12,14,16,18,20,22,24]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonChan").off().on("click",function(){thiz.chooseLines([1,3,5,7,9,11,13,15,17,19,21,23]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonAll").off().on("click",function(){thiz.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,
19,20,21,22,23,24]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonNone").off().on("click",function(){thiz.chooseLines([0]);initItemBangChon();return false});$bangChon.find(".lines button").off().on("click",function(){var lid=$(this).data("lid");if(thiz.lines.indexOf(lid)===-1)thiz.addLine(lid);else thiz.removeLine(lid);initItemBangChon();return false});this.elementWrap.find("button").not(".btn-quay").on("mousedown",function(){jQuery(this).addClass("on-click");thiz.createSound("buttonClick")}).on("mouseup",
function(){jQuery(this).removeClass("on-click")})};GameDeadOrAlive.prototype.removeDrawLine=function(){var thiz=this;this.log("removeDrawLine");this.drawLineWrap.empty()};
GameDeadOrAlive.prototype.drawLines=function(arr,eff,callback){var thiz=this;var delayCallback=this.spinFast?100:500;this.drawLineWrap.empty();if(!eff){this.drawLineWrap.html(this.linesImg(arr));if(callback&&typeof callback==="function")this.timmer.setTimeout(function(){callback()},delayCallback)}else{for(var i=0;i<arr.length;i++)(function(i){var t=i*thiz.timeLineEf;thiz.timmer.setTimeout(function(){thiz.drawLineWrap.append(thiz.linesImg(arr[i]));if(i===arr.length-1&&callback&&typeof callback==="function")thiz.timmer.setTimeout(function(){callback()},
delayCallback)},t)})(i);if(!arr.length&&callback&&typeof callback==="function")callback()}};GameDeadOrAlive.prototype.linesImg=function(data){var _html="";if(typeof data==="object")for(var i=0;i<data.length;i++)_html+='\x3cimg src\x3d"images/deadoralive/play/line/'+(data[i]+1)+'.png"\x3e';else _html+='\x3cimg src\x3d"images/deadoralive/play/line/'+(data+1)+'.png"\x3e';return _html};
GameDeadOrAlive.prototype.sendRequestSpin=function(){var thiz=this;if(this.betting===0){this.gotoLobby();return false}if(!MiniGameClient.getInstance().isLoginDone()){if(!this.autoSpin){this.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");this.gotoLobby()}return false}var sendObj=null;if(this.isTrial)sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN_TRIAL,"gid":this.gameId,"aid":this.moneyType,
"ls":this.lines,"b":1E4}];else sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":this.gameId,"aid":this.moneyType,"ls":this.lines,"b":this.betting}];MiniGameClient.getInstance().send(sendObj);this.btnSpin.addClass("on-click disabled");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-click")},100);this.winnerEffect("hide");this.removeDrawLine();this.spinning.sid=-1;this.spinning.at=(new Date).getTime();
this.onSpin=true;this.createSound("spinStart");for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.runColSpin(i)},i*thiz.delayLine*1E3)})(i);this.timmer.setTimeout(function(){if(thiz.spinning.sid==-1&&(new Date).getTime()-thiz.spinning.at>59E3)thiz.forceStopSpin()},1*60*1E3)};
GameDeadOrAlive.prototype.playBonus=function(){console.log("Play bonus",this.slotData);var thiz=this;var $bonusWrap=this.elementWrap.children(".slminigame");var $bonusClock=$bonusWrap.find(".bn-timmer").empty();var totalWin=0;var $bonusTotal=$bonusWrap.find(".nhanduoc").html(totalWin);var timeClose=15;var bonusTimmer,delayBonusTimmer;var countClick=0;var isFinished=false;var canClick=true;var finishBonus=function(){if(isFinished)return;$bonusWrap.removeClass("show");$bonusWrap.find(".items, .items-ruong").empty();
thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);thiz.winnerEffect("normal",{money:thiz.slotData.MG.m});isFinished=true;canClick=false};var runBnTimmer=function(){thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);var _timeClose=timeClose;$bonusClock.hide();delayBonusTimmer=thiz.timmer.setTimeout(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;$bonusClock.html("00:"+_sec).show();bonusTimmer=thiz.timmer.setInterval(function(){var _sec=
_timeClose>=10?_timeClose:"0"+_timeClose;if(_timeClose>=0)$bonusClock.html("00:"+_sec);_timeClose--;if(_timeClose<0)finishBonus()},1E3)},5E3)};var afterClick=function(){countClick++;canClick=true;MH.realtimeCount($bonusTotal.data("num"),totalWin,$bonusTotal,500);$bonusTotal.data("num",totalWin);if(countClick>=thiz.slotData.MG.items.length)thiz.timmer.setTimeout(function(){finishBonus()},1E3);runBnTimmer()};$bonusWrap.removeClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").show();
$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").hide();var _html="";for(var i=1;i<=12;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/deadoralive/bonus/item/'+i+'.png"\x3e\x3c/div\x3e';$bonusWrap.find(".items").html(_html);runBnTimmer();this.log("data bonus",this.slotData.MG);$bonusWrap.find(".items\x3e.item").off("click").on("click",function(){if(!canClick)return false;thiz.createSound("buttonClick");var $this=jQuery(this);$this.off();$this.addClass("on-click");thiz.timmer.setTimeout(function(){$this.removeClass("on-click")},
100);if(countClick>=thiz.slotData.MG.items.length)return;canClick=false;if(thiz.slotData.MG.items[countClick]==-1){$this.html('\x3cimg src\x3d"images/deadoralive/bonus/item/daulau.png"\x3e');var _html="";for(var ii=0;ii<3;ii++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/deadoralive/bonus/ruong-lg.png"\x3e\x3cimg src\x3d"images/deadoralive/bonus/ruong_on.png"\x3e\x3c/div\x3e';$bonusWrap.find(".items-ruong").html(_html);var canOpen=true;var ruongOther=null;switch(thiz.slotData.MG.rate){case 1:ruongOther=
[2,3];break;case 2:ruongOther=[3,4];break;case 3:ruongOther=[2,4];break;case 4:ruongOther=[3,5];break;case 5:ruongOther=[3,4];break;default:ruongOther=[3,4];break}$bonusWrap.find(".items-ruong\x3e.item").off("click").on("click",function(){if(!canOpen)return false;thiz.createSound("buttonClick");$(this).append("\x3cspan\x3eX"+thiz.slotData.MG.rate+"\x3c/span\x3e").addClass("active");if(ruongOther){var $this=$(this);thiz.timmer.setTimeout(function(){$this.siblings(".item").each(function(index){$(this).append("\x3cspan\x3eX"+
ruongOther[index]+"\x3c/span\x3e").addClass("active blur");console.log(index,".item")})},1E3)}canOpen=false;thiz.timmer.setTimeout(function(){afterClick()},3E3);return false});thiz.timmer.setTimeout(function(){$bonusWrap.addClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").hide();$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").show()},1500)}else for(var i=0;i<thiz.slotData.MG.stg.length;i++){var bValue=0,valueWin=0;if(thiz.slotData.MG.items[countClick]==thiz.slotData.MG.stg[i].id){bValue=
thiz.slotData.MG.stg[i].b2||thiz.slotData.MG.stg[i].b||0;valueWin=thiz.betting*bValue*thiz.lines.length;totalWin+=valueWin;$this.html("\x3cspan\x3e0\x3c/span\x3e");MH.realtimeCount(0,valueWin,$this.children("span"),500);afterClick();break}}$this.addClass("active");return false});$bonusWrap.children(".btn-closePopup").off("click").on("click",function(){$(this).off("click");thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);var itemsNotClick=$bonusWrap.find(".items\x3e.item").not(".active");
if(countClick<thiz.slotData.MG.items.length){var numOpen=thiz.slotData.MG.items.length-countClick;var eqOpen=[];var rand=0;for(var i=0;i<numOpen;i++){do rand=Math.floor(Math.random()*itemsNotClick.length);while(eqOpen.indexOf(rand)!=-1);itemsNotClick.eq(rand).trigger("click")}}$bonusTotal.html(MH.numToText(thiz.slotData.MG.m,1));thiz.timmer.setTimeout(function(){finishBonus()},2E3);return false});$bonusWrap.addClass("show")};
GameDeadOrAlive.prototype.showLichSu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;
_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-
2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameDeadOrAlive.prototype.showLichSuHu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsuhu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotJackpotHistory(thiz.gameId,_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;
_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-
2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameDeadOrAlive.prototype.showVinhDanh=function(){var thiz=this;var $popup=this.elementWrap.children(".slvinhdanh");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.hide().removeClass("hide").find(".table-content, .pagination").empty()},500);return false});$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n){MyRequest.fetchTopSlotMachine2({limit:_numPerPage,
skip:(n-1)*_numPerPage,gameId:thiz.gameId},function(cmd,data){thiz.log(data);var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-
1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';
for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page));return false})})};getPage(1);$popup.show()};
GameDeadOrAlive.prototype.showLuatChoi=function(){var $popup=this.elementWrap.children(".slbangthuong");var thiz=this;var _to=this.betting;var $wrap=$popup.children(".slpopup-content");var _step=1;$wrap.attr("data-room",this.betting).attr("data-step",_step);$wrap.children(".btn-next").off("click").on("click",function(){_step+=1;if(_step>4)_step=1;$wrap.attr("data-step",_step);return false});$wrap.children(".btn-prev").off("click").on("click",function(){_step-=1;if(_step<1)_step=4;$wrap.attr("data-step",
_step);return false});$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.show()};
GameDeadOrAlive.prototype.showCaiDat=function(){var thiz=this;var $popup=this.elementWrap.children(".slcaidat");if(this.speaker.mute)$popup.find(".amthanh").addClass("mute");else $popup.find(".amthanh").removeClass("mute");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.find(".amthanh").off("click").on("click",function(){$(this).toggleClass("mute");thiz.speaker.setMute($(this).hasClass("mute"));
return false});$popup.find(".lsgd").off("click").on("click",function(){$popup.hide();thiz.showLichSu();return false});$popup.find(".lsh").off("click").on("click",function(){$popup.hide();thiz.showLichSuHu();return false});$popup.show()};
GameDeadOrAlive.prototype.runColSpin=function(colId){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.position.set(0,0);wrapBlur.position.set(0,0);gsap.to(wrapItem.position,{duration:.3,ease:"none",y:-50});var _h=-(wrapBlur.children.length-3-.5)*this.itemHeight;this.timmer.setTimeout(function(){gsap.killTweensOf(wrapItem.position);gsap.from(wrapBlur.position,
{y:_h,repeat:1E3,duration:1,ease:"none"});wrapItem.visible=false;wrapBlur.visible=true},300)};
GameDeadOrAlive.prototype.stopColSpin=function(colId,callback){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");wrapBlur.visible=false;wrapItem.visible=true;gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.y=50;gsap.to(wrapItem.position,{duration:.1,ease:"none",y:0});this.createSound("soundColStop");this.timmer.setTimeout(function(){wrapItem.y=0;if(callback&&typeof callback=="function")callback()},
300)};
GameDeadOrAlive.prototype.playSpriteAnimation=function(spr){spr.visible=true;if(spr.mAmimation)spr.parent.removeChild(spr.mAmimation);var anim=null;if(this.app.loader.resources.hasOwnProperty("icon"+spr.iconId)){anim=new PIXI.spine.Spine(this.app.loader.resources["icon"+spr.iconId].spineData);anim.skeleton.setToSetupPose();anim.state.setAnimation(0,this.app.loader.resources["icon"+spr.iconId].spineData.animations[0].name,true)}if(anim){var localRect=anim.getLocalBounds();anim.x=spr.x-anim.width/2-
localRect.x;anim.y=spr.y-anim.height/2-localRect.y;if(spr.iconId==9)anim.y+=30;spr.parent.addChild(anim);spr.mAmimation=anim;spr.visible=false}};GameDeadOrAlive.prototype.stopSpriteAnimation=function(spr){if(spr.mAmimation){spr.parent.removeChild(spr.mAmimation);spr.visible=true}};
GameDeadOrAlive.prototype.createSlotGame=function(){var thiz=this;this.prefixItem="";this.colsItems=[];var createItem=function(obj){var item=new PIXI.Sprite(thiz.app.loader.resources.icons.textures[obj.id+".png"]);item.anchor.set(.5,.5);if(obj.x)item.x=obj.x;if(obj.y)item.y=obj.y;if(obj.visible===false)item.visible=false;item.iconId=obj.id;if(obj.blur){var ft=new PIXI.filters.BlurFilter;ft.blurX=0;ft.blurY=5;item.filters=[ft]}return item};for(var i=0;i<5;i++){this.columns[i]=new PIXI.Container;this.columns[i]._index=
i;this.columns[i].position.set(120+i*185,0);this.containerItem.addChild(this.columns[i]);var wrapItem=new PIXI.Container;wrapItem.name="wrapItem";var wrapBlur=new PIXI.Container;wrapBlur.name="wrapBlur";this.columns[i].addChild(wrapItem,wrapBlur);this.colsItems[i]=[];for(j=0;j<3;j++){var item=createItem({id:Math.floor(Math.random()*10)%7,y:j*thiz.itemHeight+thiz.itemHeight/2});wrapItem.addChild(item);this.colsItems[i].push(item)}var ics=[0,1,2,3,4,5,6,7,8,9,10,0,1,2];ics.sort(function(){return.5-
Math.random()});ics.push(ics[0],ics[1],ics[2]);for(var ii=ics.length-1;ii>=0;ii--){var item=createItem({id:ics[ii],blur:true,y:ii*thiz.itemHeight+thiz.itemHeight/2});wrapBlur.addChild(item)}wrapBlur.cacheAsBitmap=true;wrapBlur.visible=false;this.playSpriteAnimation(this.colsItems[i][0]);this.playSpriteAnimation(this.colsItems[i][1]);this.playSpriteAnimation(this.colsItems[i][2])}this.app.stage.addChild(this.containerItem)};
GameDeadOrAlive.prototype.initGame=function(){this.log("init Tam Quoc");var thiz=this;MH.changeBG("images/deadoralive/background.jpg");if(!this.soundBackground)this.soundBackground=this.createSound("background",{loop:true,volume:.5});this.initButton();this.notify("");this.gotoLobby();this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);this.app.loader.add("icons","images/deadoralive/sprites.json").add("icon0","images/deadoralive/anim/wild_animations.json").add("icon9",
"images/deadoralive/anim/scatter_anim.json").load(function(loader,data){thiz.createSlotGame()});var elementSoDu=this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap\x3e.coin").html(MH.numToText(PlayerMe.gold,1));var offsetTopHu=function(){var $topHuGroup=$("#topHuGroup"),$slCoverLobby=$("#slCoverLobby");var _count=0;var timeoutOffset=thiz.timmer.setInterval(function(){console.log("...");$topHuGroup.offset({left:0});if(thiz.betting==0)$slCoverLobby.offset({left:window.innerWidth-503*MH.scale});_count++;
if(_count>=10)thiz.timmer.clearInterval(timeoutOffset)},20)};$(window).on("updateMoney.Slot"+this.gameName,function(e,p){elementSoDu.html(MH.numToText(p,1))}).on("changeView.Slot"+this.gameName,function(){offsetTopHu()});offsetTopHu()};
GameDeadOrAlive.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=BigSlotTarget.getInstance();TopHuClient.getInstance().removeListener(target);MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.speaker.destroy();this.app.destroy();$(window).off(".Slot"+this.gameName);target.currentTarget=null};var GoldenMonkeyPreLoad={style:"css/goldenmonkey.css",template:"template/slot-goldenmonkey.html",images:["images/goldenmonkey/background.jpg","images/goldenmonkey/lobby/bg.png","images/goldenmonkey/lobby/logo.png","images/goldenmonkey/lobby/p0.png","images/goldenmonkey/lobby/p100.png","images/goldenmonkey/lobby/p1000.png","images/goldenmonkey/lobby/p10000.png","images/goldenmonkey/lobby/btn_back.png","images/goldenmonkey/lobby/btn_bxh.png","images/goldenmonkey/lobby/btn_caidat.png","images/goldenmonkey/play/btn_tuquay.png",
"images/goldenmonkey/play/btn_quay_0.png","images/goldenmonkey/lobby/bggold.png","images/goldenmonkey/lobby/bghu.png"],sounds:["images/goldenmonkey/sound/background.ogg","images/goldenmonkey/sound/spinStart.ogg","images/goldenmonkey/sound/stickyWild.ogg","images/goldenmonkey/sound/spinStop.ogg","images/goldenmonkey/sound/coinUpLoop.ogg","images/goldenmonkey/sound/win/1.ogg","images/goldenmonkey/sound/win/2.ogg","images/goldenmonkey/sound/win/3.ogg","images/goldenmonkey/sound/win/4.ogg","images/goldenmonkey/sound/win/5.ogg",
"images/goldenmonkey/sound/win/6.ogg","images/goldenmonkey/sound/win/7.ogg","images/goldenmonkey/sound/win/8.ogg","images/goldenmonkey/sound/win/9.ogg","images/goldenmonkey/sound/win/10.ogg","images/goldenmonkey/sound/win/11.ogg","images/goldenmonkey/sound/winJackpot.ogg","images/goldenmonkey/sound/bonusDaulau.ogg","images/goldenmonkey/sound/bonusMoruong.ogg","images/goldenmonkey/sound/buttonClick.ogg","images/goldenmonkey/sound/openOtherRuong.ogg","images/goldenmonkey/sound/hoverRoom.ogg"]};
function GameGoldenMonkey(){this.gameId=SLOT_GAME_MINI.GOLDENMONKEY||0;this.gameName="GoldenMonkey";this.timmer=new mhTimer;this.betting=0;this.isTrial=false;this.trialJackpot=5E7;this.dataJackpot=[{J:0},{J:0},{J:0}];this.timeLineEf=100;this.spinFast=false;this.onSpin=false;this.autoSpin=false;this.moneyType=1;this.session=0;this.onSpinSession=0;this.lines=[];this.spinning={sid:0,at:0};this.arrayItemInline=[[1,1,1,1,1],[0,0,0,0,0],[2,2,2,2,2],[2,1,0,1,2],[0,1,2,1,0],[1,0,0,0,1],[1,2,2,2,1],[0,0,1,
2,2],[2,2,1,0,0],[1,2,1,0,1],[1,0,1,2,1],[0,1,1,1,0],[2,1,1,1,2],[0,1,0,1,0],[2,1,2,1,2],[1,1,0,1,1],[1,1,2,1,1],[0,0,2,0,0],[2,2,0,2,2],[0,2,2,2,0],[2,0,0,0,2],[1,0,2,0,1],[1,2,0,2,1],[0,2,0,2,0],[2,0,2,0,2]];this.speaker=new mhSound({"background":"images/goldenmonkey/sound/background.ogg","spinStart":"images/goldenmonkey/sound/spinStart.ogg","stickyWild":"images/goldenmonkey/sound/stickyWild.ogg","soundColStop":"images/goldenmonkey/sound/spinStop.ogg","coinUpLoop":"images/goldenmonkey/sound/coinUpLoop.ogg",
"win":["images/goldenmonkey/sound/win/1.ogg","images/goldenmonkey/sound/win/2.ogg","images/goldenmonkey/sound/win/3.ogg","images/goldenmonkey/sound/win/4.ogg","images/goldenmonkey/sound/win/5.ogg","images/goldenmonkey/sound/win/6.ogg","images/goldenmonkey/sound/win/7.ogg","images/goldenmonkey/sound/win/8.ogg","images/goldenmonkey/sound/win/9.ogg","images/goldenmonkey/sound/win/10.ogg","images/goldenmonkey/sound/win/11.ogg"],"winJackpot":"images/goldenmonkey/sound/winJackpot.ogg","bonusDaulau":"images/goldenmonkey/sound/bonusDaulau.ogg",
"bonusMoruong":"images/goldenmonkey/sound/bonusMoruong.ogg","buttonClick":"images/goldenmonkey/sound/buttonClick.ogg","openOtherRuong":"images/goldenmonkey/sound/openOtherRuong.ogg","hoverRoom":"images/goldenmonkey/sound/hoverRoom.ogg"});this.prefixItem="";this.app=new PIXI.Application(1290,645,{view:slotCandyCanvas,transparent:true,resolution:1,roundPixels:false});this.containerItem=new PIXI.Container;this.columns=[];this.colsItems=[[],[],[],[],[]];this.slotData=null;this.freespinData={100:{b:100,
ls:[],ai:1,fs:0},1E3:{b:1E3,ls:[],ai:1,fs:0},1E4:{b:1E4,ls:[],ai:1,fs:0}};this.winFreeSpin=-1;this.itemHeight=215;this.tweenTime=2;this.delayLine=.3;this.elementWrap=jQuery("#content\x3e.wrapper\x3e.slot-wrap").eq(0);this.elementQuy=this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin").eq(0);this.drawLineWrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.draw-lines").eq(0);this.elementQuys=[this.elementWrap.find("\x3e.slot-lobby\x3e.room1\x3e.hu"),this.elementWrap.find("\x3e.slot-lobby\x3e.room2\x3e.hu"),
this.elementWrap.find("\x3e.slot-lobby\x3e.room3\x3e.hu"),this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap\x3e.coin")];var target=BigSlotTarget.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN_TRIAL.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,this._onObserverResponse,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onLoginOrReconnectSucess,target);TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onTopHuResponse,target);this.initGame();MiniGameClient.getInstance().observerByGameID(this.gameId)}
GameGoldenMonkey.prototype.log=function(){return;console.log.apply(this,arguments)};
GameGoldenMonkey.prototype.gotoLobby=function(){this.log("gotoLobby");this.betting=0;this.isTrial=false;this.onSpin=false;this.changeSpeedMode(false);this.changeAutoSpin(false);this.app.stop();this.elementWrap.children(".slot-lobby").show();this.elementWrap.children(".slot-gameplay").hide();this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap").css({top:"37px",left:"475px"});this.elementWrap.find("\x3e.slot-wraptop\x3e.hu-wrap").css({top:"30px",left:"875px"})};
GameGoldenMonkey.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:break;case CMD_SLOT_MACHINE.SPIN:case CMD_SLOT_MACHINE.SPIN_TRIAL:thiz.onReceiveSpin(data[1]);break;default:break}};
GameGoldenMonkey.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);thiz.log("GameCandy _onObserverResponse",cmd,data);for(var key in thiz.freespinData)if(thiz.freespinData.hasOwnProperty(key))thiz.freespinData[key].fs=0;thiz.winFreeSpin=-1;if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)thiz.freespinData[data.fss[i].b.toString()]=data.fss[i];MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}if(thiz.freespinData[thiz.betting.toString()]&&
thiz.freespinData[thiz.betting.toString()].fs)thiz.winFreeSpin=0;thiz.hasFreeSpin()};GameGoldenMonkey.prototype._onLoginOrReconnectSucess=function(cmd,data){var thiz=this.currentTarget;thiz.log("GameCandy _onLoginOrReconnectSucess",cmd,data);MiniGameClient.getInstance().observerByGameID(thiz.gameId)};
GameGoldenMonkey.prototype._onTopHuResponse=function(cmd,data){var thiz=this.currentTarget;if(thiz.isTrial)return;var dataJackpot=[{J:0},{J:0},{J:0}];if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].gid===thiz.gameId)if(data[1].Js[i].b===100)dataJackpot[0].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E3)dataJackpot[1].J=data[1].Js[i].J;else if(data[1].Js[i].b===1E4)dataJackpot[2].J=data[1].Js[i].J;thiz.setQuy(dataJackpot)};
GameGoldenMonkey.prototype.setQuy=function(data){if(typeof data==="number"){MH.realtimeCount(this.dataJackpot[2].J,data,this.elementQuys[3],1E3);this.dataJackpot[2].J=data}else if(!data||typeof data==="object"){var data=data||this.dataJackpot;if(this.betting===0){MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[0],1E3);MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[1],1E3);MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[2],1E3);MH.realtimeCount(this.dataJackpot[2].J,
data[2].J,this.elementQuys[3],1E3)}else if(!this.isTrial)if(this.betting===100)MH.realtimeCount(this.dataJackpot[0].J,data[0].J,this.elementQuys[3],1E3);else if(this.betting===1E3)MH.realtimeCount(this.dataJackpot[1].J,data[1].J,this.elementQuys[3],1E3);else if(this.betting===0||this.betting===1E4)MH.realtimeCount(this.dataJackpot[2].J,data[2].J,this.elementQuys[3],1E3);this.dataJackpot=data}};
GameGoldenMonkey.prototype.onReceiveSpin=function(data){var thiz=this;this.slotData=null;if(!data){this.forceStopSpin();return}if(!this.isTrial&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.forceStopSpin();return}if(data.mgs){this.notify(data.mgs);this.forceStopSpin();return}if(!data.hasOwnProperty("sbs")||data.sbs.length!=15){this.forceStopSpin();return}if(this.onSpin&&this.spinning.sid==-1){this.slotData=data;this.runSpin();if(this.isTrial){this.trialJackpot+=25*1E4/
100;this.setQuy(this.trialJackpot)}this.setSession(data.sid);console.log("spinStart",data)}};GameGoldenMonkey.prototype.setSession=function(sid){this.session=sid||0;this.elementWrap.find("\x3e.slot-gameplay\x3e.session").html("#"+sid);if(this.onSpin)this.spinning.sid=sid};
GameGoldenMonkey.prototype.runSpin=function(){var thiz=this;var isStopped=false;var cb=function(){if(isStopped)return;isStopped=true;thiz.timmer.setTimeout(function(){thiz.playStickyWildIfHad()},300)};var timeSpinLine=this.spinFast?.3:thiz.tweenTime;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.timmer.setTimeout(function(){thiz.setSpriteIcon(thiz.colsItems[i][2],thiz.slotData.sbs[0+i]);thiz.setSpriteIcon(thiz.colsItems[i][1],thiz.slotData.sbs[5+i]);thiz.setSpriteIcon(thiz.colsItems[i][0],
thiz.slotData.sbs[10+i])},timeSpinLine*1E3/2);thiz.timmer.setTimeout(function(){if(i==4)thiz.stopColSpin(i,cb);else thiz.stopColSpin(i)},timeSpinLine*1E3)},i*thiz.delayLine*1E3)})(i)};GameGoldenMonkey.prototype.createSound=function(_key,_option){return this.speaker.create(_key,_option)};
GameGoldenMonkey.prototype.forceStopSpin=function(){var thiz=this;for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.stopColSpin(i)},i*thiz.delayLine*1E3+2E3)})(i);this.changeAutoSpin(false);this.onSpin=false;this.btnSpin.removeClass("disabled")};
GameGoldenMonkey.prototype.showWinEffect=function(){var thiz=this;var winlines=[];var _type="hide",_money=this.slotData.mX;if(this.slotData.iJ)_type="jackpot";else if(this.slotData.bw)_type="bigwin";else if(this.slotData.mX)_type="normal";else _type="hide";if(this.winFreeSpin>=0)this.winFreeSpin+=this.slotData.mX;if(this.slotData.hMG){_money=0;for(var i=0;i<this.slotData.wls.length;i++)_money+=this.slotData.wls[i].crd}if(this.slotData.wls&&this.slotData.wls.length)for(var i=0;i<this.slotData.wls.length;i++)winlines.push(this.slotData.wls[i].lid);
var efDraw=!this.spinFast&&_type=="normal";this.drawLines(winlines,efDraw);this.winnerEffect(_type,{money:_money},function(){thiz.checkFreeBonus()})};
GameGoldenMonkey.prototype.playStickyWildIfHad=function(){var thiz=this;var hasWild=false;var colsWild=[];var frames=[];for(var ii=0;ii<55;ii++){var t=ii;if(t<10)t="00"+t;else t="0"+t;frames.push(thiz.app.loader.resources.spinStickyWild.textures["images/spinification/spinification_"+t+".png"])}var showStickyWild=function(colId){thiz.setSpriteIcon(thiz.colsItems[colId][0],0);thiz.setSpriteIcon(thiz.colsItems[colId][1],0);thiz.setSpriteIcon(thiz.colsItems[colId][2],0);var column=thiz.columns[colId];
if(MH.winHidden)return;var wrap=new PIXI.Container;wrap.x=column.x;wrap.y=thiz.itemHeight*1.5;var icon=new PIXI.Sprite(thiz.app.loader.resources.icons.textures["stickyWild.png"]);icon.anchor.set(.5,.5);wrap.addChild(icon);var anim=new PIXI.extras.AnimatedSprite(frames);anim.anchor.set(.5);anim.scale.set(1.7);anim.animationSpeed=.5;anim.loop=false;anim.onComplete=function(){wrap.parent.removeChild(wrap);column.visible=true};anim.play();wrap.addChild(anim);column.visible=false;column.parent.addChild(wrap)};
for(var i=0;i<this.slotData.sbs.length;i++)if(this.slotData.sbs[i]==0){hasWild=true;if(colsWild.indexOf(i%5)==-1)colsWild.push(i%5)}if(hasWild){this.createSound("stickyWild");for(var i=0;i<colsWild.length;i++)showStickyWild(colsWild[i]);this.timmer.setTimeout(function(){thiz.showWinEffect()},2E3)}else this.showWinEffect()};
GameGoldenMonkey.prototype.winnerEffect=function(type,data,callback){var thiz=this;var $wrap=this.elementWrap.find("\x3e.slot-gameplay\x3e.win-effect").eq(0);var delayClose=3E3;if(type==="bigwin")delayClose=5E3;if(type==="jackpot")delayClose=6E3;if(type=="normal")delayClose=2E3;if(type==="hide"){$wrap.attr("class","win-effect is-hide").find(".winnum").empty();delayClose=0}else{if(type==="jackpot"&&this.isTrial){this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}var $moneyWrap=$wrap.find("\x3e.type-"+
type+" .winnum");if(data&&data.money){var countTo=data.money,countFrom=countTo-5E3;while(countFrom<0)countFrom+=100;$moneyWrap.parent().parent().show();MH.realtimeCount(countFrom,countTo,$moneyWrap,1E3);var soundCoinUp=this.createSound("coinUpLoop",{loop:true,duration:1100})}else $moneyWrap.parent().parent().hide();$wrap.attr("class","win-effect show is-"+type)}if(data&&data.hasOwnProperty("money"))if(data.money==0)this.elementWrap.find(".game-control\x3e.num-vuathang").html(0);else this.timmer.setTimeout(function(){thiz.elementWrap.find(".game-control\x3e.num-vuathang").html(MH.numToText(data.money,
1))},1E3);var soundWin=null;if(type=="bigwin")this.createSound("win",{random:true});else if(type=="freespin")this.createSound("win",{random:true});else if(type=="bonus")this.createSound("win",{random:true});else if(type=="jackpot")soundWin=this.createSound("winJackpot");this.timmer.setTimeout(function(){if(type!=="hide")thiz.winnerEffect("hide");if(callback&&typeof callback==="function")callback();else if(type!=="hide")thiz.handleSpinDone();if(soundWin)soundWin.destroy()},delayClose)};
GameGoldenMonkey.prototype.checkFreeBonus=function(){this.log("checkFreeBonus");var thiz=this;this.freespinData[this.slotData.b.toString()].fs=this.slotData.fss;this.hasFreeSpin();if(this.slotData.hFS)this.winnerEffect("freespin");else if(this.slotData.hMG)this.winnerEffect("bonus",null,function(){thiz.playBonus()});else if(0&&!this.hasFreeSpin()&&this.winFreeSpin>=0)this.winnerEffect("freespin",{money:this.winFreeSpin});else this.handleSpinDone()};
GameGoldenMonkey.prototype.changeSpeedMode=function(type,check){};
GameGoldenMonkey.prototype.changeGameMode=function(type){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();if(type===false){this.changeSpeedMode(false);this.changeAutoSpin(false);this.changeBetting(1E4);this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);this.trialJackpot=5E7;this.setQuy(this.trialJackpot)}this.isTrial=!type};
GameGoldenMonkey.prototype.changeBetting=function(bet){var thiz=this;if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}this.app.start();this.betting=bet;this.isTrial=false;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.btn-muccuoc").attr("bet",this.betting);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1));this.elementWrap.children(".slot-gameplay").show();this.elementWrap.children(".slot-lobby").hide();this.elementWrap.children(".slot-wraptop").children(".coin-wrap, .hu-wrap").removeAttr("style");this.hasFreeSpin();this.timmer.setTimeout(function(){if(thiz.isTrial)return;thiz.setQuy()},50);this.setSession(0)};
GameGoldenMonkey.prototype.hightLight=function(){var thiz=this;var timeShowLine=2E3;var frames=[];for(var ii=0;ii<50;ii++){var t=ii;if(t<10)t="0"+t;frames.push(thiz.app.loader.resources.spinItem.textures["images/wild_ignite_animation/marking_000"+t+".png"])}var clearHightLight=function(){for(var j=0;j<thiz.timeoutHightLight.length;j++)thiz.timmer.clearTimeout(thiz.timeoutHightLight[j]);thiz.timeoutHightLight=[];thiz.removeDrawLine()};var zoomLineIcons=function(lid){if(MH.winHidden)return;for(var i=
0;i<thiz.arrayItemInline[lid].length;i++){var anim=new PIXI.extras.AnimatedSprite(frames);anim.anchor.set(.5);anim.animationSpeed=.5;anim.loop=false;anim.onComplete=function(){this.parent.removeChild(this)};var sprite=thiz.colsItems[i][thiz.arrayItemInline[lid][i]];anim.x=sprite.x;anim.y=sprite.y;sprite.parent.addChild(anim);anim.play()}};if(!this.timeoutHightLight)this.timeoutHightLight=[];else clearHightLight();if(!this.onSpin&&this.slotData&&this.slotData.wls&&this.slotData.wls.length)for(var i=
0;i<this.slotData.wls.length;i++)(function(i){var to=thiz.timmer.setTimeout(function(){if(thiz.onSpin||thiz.slotData.sid!=thiz.session)clearHightLight();else zoomLineIcons(thiz.slotData.wls[i].lid);console.log("hight line")},(i+1)*timeShowLine);thiz.timeoutHightLight.push(to)})(i)};
GameGoldenMonkey.prototype.changeAutoSpin=function(type,check){if(check&&(this.isTrial||!MiniGameClient.getInstance().isLoginDone())){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");this.changeAutoSpin(false);return}if(type){this.btnSpinMode.addClass("active");if(!this.onSpin)this.sendRequestSpin()}else this.btnSpinMode.removeClass("active");this.autoSpin=type};
GameGoldenMonkey.prototype.chooseLines=function(arr){if(this.onSpin||this.autoSpin){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(this.isTrial){this.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return false}this.lines=arr;this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.chooseLine\x3e.num-lines").html(this.lines.length);this.elementWrap.find("\x3e.slot-gameplay\x3e.game-control\x3e.num-tongdat").html(MH.numToText(this.betting*
this.lines.length,1))};GameGoldenMonkey.prototype.addLine=function(lid){var arr=this.lines.slice();if(arr.indexOf(lid)===-1){arr.push(lid);this.chooseLines(arr)}};GameGoldenMonkey.prototype.removeLine=function(lid){var arr=this.lines.slice();var index=arr.indexOf(lid);if(index>-1&&arr.length>1){arr.splice(index,1);this.chooseLines(arr)}};
GameGoldenMonkey.prototype.handleSpinDone=function(){LobbyRequest.getInstance().requestUpdateMoney();this.log("handleSpinDone");this.removeDrawLine();if(this.autoSpin||this.hasFreeSpin()){this.onSpin=false;this.sendRequestSpin()}else{this.onSpin=false;this.btnSpin.removeClass("disabled");this.hightLight()}if(!this.hasFreeSpin())this.winFreeSpin=-1;else if(this.winFreeSpin=-1)this.winFreeSpin=0};
GameGoldenMonkey.prototype.notify=function(str,_time){var thiz=this;if(!str){this.elementWrap.find(".shortnotice").hide().children(".mess").empty();return}this.elementWrap.find(".shortnotice").show().children(".mess").html(str);var _t=_time||3500;this.timmer.setTimeout(function(){thiz.elementWrap.find(".shortnotice").hide().children(".mess").empty()},_t)};
GameGoldenMonkey.prototype.createPopupCommon=function(text){this.notify(text);return;var thiz=this;var $popup=this.elementWrap.children(".popupCommon");$popup.find(".slpopup-content").html(text);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.hide();thiz.timmer.clearTimeout($popup.data("timeoutClose"));return false});var timeoutClose=this.timmer.setTimeout(function(){$popup.hide()},3E3);$popup.data("timeoutClose",timeoutClose);$popup.show()};
GameGoldenMonkey.prototype.hasFreeSpin=function(){var n=this.betting?this.freespinData[this.betting.toString()].fs:0;if(n)this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").show().children(".freespin-num").html(n);else this.elementWrap.find("\x3e.slot-gameplay\x3e.freespin-info").hide().children(".freespin-num").empty();return n};
GameGoldenMonkey.prototype.setSpriteIcon=function(sprite,icon){sprite.texture=this.app.loader.resources.icons.textures[icon+".png"];sprite.iconId=icon;this.playSpriteAnimation(sprite);this.playSpriteAnimation(sprite);this.playSpriteAnimation(sprite)};
GameGoldenMonkey.prototype.initButton=function(){var thiz=this;var $control=this.elementWrap.find(".game-control");var isDoubleClick=function(button){var $button=jQuery(button);if($button.data("btndisable"))return true;$button.data("btndisable",true);thiz.timmer.setTimeout(function(){$button.data("btndisable",false)},1E3);return false};$("#topHuGroup").children(".btn-tophusl").off().on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active");$("#topHu-container").hide()}else{$(this).addClass("active");
$("#topHu-container").show()}return false});this.btnSpin=$control.children(".btn-quay").off("click").on("click",function(){if(isDoubleClick(this))return false;if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");thiz.gotoLobby();return false}if(thiz.onSpin||thiz.autoSpin){thiz.btnSpin.data("btndisable",false);return false}thiz.sendRequestSpin();return false});$control.find("\x3e.group-btndong button").each(function(){var num=
parseInt(jQuery(this).attr("data-num"));jQuery(this).removeAttr("data-num").data("num",num)}).off("mouseenter mouseout").on("mouseenter",function(){if(thiz.onSpin)return false;var num=jQuery(this).data("num");thiz.drawLines([num-1])}).on("mouseout",function(){if(thiz.onSpin)return false;thiz.removeDrawLine()});this.btnSpinMode=$control.children(".btn-autoSpin").off("click").on("click",function(){thiz.changeAutoSpin(!thiz.autoSpin,false);return false});$control.children(".btn-muccuoc").off("click").on("click",
function(){var to;switch(thiz.betting){case 100:to=1E3;break;case 1E3:to=1E4;break;case 1E4:to=100;break;default:to=100;break}thiz.changeBetting(to);return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-back").off("click").on("click",function(){if(thiz.betting===0){thiz.destroyGame();MH.changePage("home")}else if(thiz.onSpin)thiz.createPopupCommon("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else thiz.gotoLobby();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-vinhdanh").off("click").on("click",
function(){thiz.showVinhDanh();return false});this.elementWrap.find("\x3e.slot-wraptop\x3e.btn-caidat").off("click").on("click",function(){thiz.showCaiDat();return false});this.elementWrap.find(".game-control\x3e.btn-help").off("click").on("click",function(){thiz.showLuatChoi();return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room0").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeGameMode(false);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room1").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(100);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room2").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");
return false}thiz.changeBetting(1E3);return false});this.elementWrap.find("\x3e.slot-lobby\x3e.room3").off("click").on("click",function(){thiz.createSound("buttonClick");if(!MiniGameClient.getInstance().isLoginDone()){thiz.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");return false}thiz.changeBetting(1E4);return false});this.elementWrap.children(".slot-lobby").children(".room0, .room1, .room2, .room3").off("mouseenter").on("mouseenter",function(){thiz.createSound("hoverRoom")});
var $bangChon=this.elementWrap.children(".slchondong");$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=parseInt($this.attr("data-num"))-1;$this.removeAttr("data-num").data("lid",lid)});var initItemBangChon=function(){$bangChon.find(".lines button").each(function(){var $this=jQuery(this);var lid=$this.data("lid");if(thiz.lines.indexOf(lid)===-1)$this.parent().removeClass("active");else $this.parent().addClass("active")})};$control.children(".chooseLine").off("click").on("click",
function(){if(thiz.onSpin||thiz.autoSpin){thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}if(thiz.isTrial){thiz.createPopupCommon("Ch\u1ee9c n\u0103ng kh\u00f4ng h\u1ed7 tr\u1ee3 khi ch\u01a1i th\u1eed");return}initItemBangChon();$bangChon.show();return false});$bangChon.children(".btn-closePopup").off("click").on("click",function(){$bangChon.hide();return false});$bangChon.find(".controlBottom .btn-chonLe").off().on("click",function(){thiz.chooseLines([0,2,4,6,7,10,12,14,16,18,20,22,
24]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonChan").off().on("click",function(){thiz.chooseLines([1,3,5,7,9,11,13,15,17,19,21,23]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonAll").off().on("click",function(){thiz.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);initItemBangChon();return false});$bangChon.find(".controlBottom .btn-chonNone").off().on("click",function(){thiz.chooseLines([0]);initItemBangChon();
return false});$bangChon.find(".lines button").off().on("click",function(){var lid=$(this).data("lid");if(thiz.lines.indexOf(lid)===-1)thiz.addLine(lid);else thiz.removeLine(lid);initItemBangChon();return false});this.elementWrap.find("button").not(".btn-quay").on("mousedown",function(){jQuery(this).addClass("on-click");thiz.createSound("buttonClick")}).on("mouseup",function(){jQuery(this).removeClass("on-click")})};
GameGoldenMonkey.prototype.removeDrawLine=function(){var thiz=this;this.log("removeDrawLine");this.drawLineWrap.empty()};
GameGoldenMonkey.prototype.drawLines=function(arr,eff,callback){var thiz=this;var delayCallback=this.spinFast?100:500;this.drawLineWrap.empty();if(!eff){this.drawLineWrap.html(this.linesImg(arr));if(callback&&typeof callback==="function")this.timmer.setTimeout(function(){callback()},delayCallback)}else{for(var i=0;i<arr.length;i++)(function(i){var t=i*thiz.timeLineEf;thiz.timmer.setTimeout(function(){thiz.drawLineWrap.append(thiz.linesImg(arr[i]));if(i===arr.length-1&&callback&&typeof callback===
"function")thiz.timmer.setTimeout(function(){callback()},delayCallback)},t)})(i);if(!arr.length&&callback&&typeof callback==="function")callback()}};GameGoldenMonkey.prototype.linesImg=function(data){var _html="";if(typeof data==="object")for(var i=0;i<data.length;i++)_html+='\x3cimg src\x3d"images/goldenmonkey/play/line/'+(data[i]+1)+'.png"\x3e';else _html+='\x3cimg src\x3d"images/goldenmonkey/play/line/'+(data+1)+'.png"\x3e';return _html};
GameGoldenMonkey.prototype.sendRequestSpin=function(){var thiz=this;if(this.betting===0){this.gotoLobby();return false}if(!MiniGameClient.getInstance().isLoginDone()){if(!this.autoSpin){this.createPopupCommon("Vui l\u00f2ng \u0111\u0103ng nh\u1eadp \u0111\u1ec3 ch\u01a1i");this.gotoLobby()}return false}var sendObj=null;if(this.isTrial)sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN_TRIAL,"gid":this.gameId,"aid":this.moneyType,
"ls":this.lines,"b":1E4}];else sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":this.gameId,"aid":this.moneyType,"ls":this.lines,"b":this.betting}];MiniGameClient.getInstance().send(sendObj);this.btnSpin.addClass("on-click disabled");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-click")},100);this.winnerEffect("hide");this.removeDrawLine();this.spinning.sid=-1;this.spinning.at=(new Date).getTime();
this.onSpin=true;this.createSound("spinStart");for(var i=0;i<5;i++)(function(i){thiz.timmer.setTimeout(function(){thiz.runColSpin(i)},i*thiz.delayLine*1E3)})(i);this.timmer.setTimeout(function(){if(thiz.spinning.sid==-1&&(new Date).getTime()-thiz.spinning.at>59E3)thiz.forceStopSpin()},1*60*1E3)};
GameGoldenMonkey.prototype.playBonus=function(){console.log("Play bonus",this.slotData);var thiz=this;var $bonusWrap=this.elementWrap.children(".slminigame");var $bonusClock=$bonusWrap.find(".bn-timmer").empty();var totalWin=0;var $bonusTotal=$bonusWrap.find(".nhanduoc").html(totalWin);var timeClose=15;var bonusTimmer,delayBonusTimmer;var countClick=0;var isFinished=false;var canClick=true;var finishBonus=function(){if(isFinished)return;$bonusWrap.removeClass("show");$bonusWrap.find(".items, .items-ruong").empty();
thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);thiz.winnerEffect("normal",{money:thiz.slotData.MG.m});isFinished=true;canClick=false};var runBnTimmer=function(){thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);var _timeClose=timeClose;$bonusClock.hide();delayBonusTimmer=thiz.timmer.setTimeout(function(){var _sec=_timeClose>=10?_timeClose:"0"+_timeClose;$bonusClock.html("00:"+_sec).show();bonusTimmer=thiz.timmer.setInterval(function(){var _sec=
_timeClose>=10?_timeClose:"0"+_timeClose;if(_timeClose>=0)$bonusClock.html("00:"+_sec);_timeClose--;if(_timeClose<0)finishBonus()},1E3)},5E3)};var afterClick=function(){countClick++;canClick=true;MH.realtimeCount($bonusTotal.data("num"),totalWin,$bonusTotal,500);$bonusTotal.data("num",totalWin);if(countClick>=thiz.slotData.MG.items.length)thiz.timmer.setTimeout(function(){finishBonus()},1E3);runBnTimmer()};$bonusWrap.removeClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").show();
$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").hide();var _html="";for(var i=1;i<=12;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/goldenmonkey/bonus/item/'+i+'.png"\x3e\x3c/div\x3e';$bonusWrap.find(".items").html(_html);runBnTimmer();this.log("data bonus",this.slotData.MG);$bonusWrap.find(".items\x3e.item").off("click").on("click",function(){if(!canClick)return false;thiz.createSound("buttonClick");var $this=jQuery(this);$this.off();$this.addClass("on-click");thiz.timmer.setTimeout(function(){$this.removeClass("on-click")},
100);if(countClick>=thiz.slotData.MG.items.length)return;canClick=false;if(thiz.slotData.MG.items[countClick]==-1){$this.html('\x3cimg src\x3d"images/goldenmonkey/bonus/item/daulau.png"\x3e');thiz.createSound("bonusDaulau");var _html="";for(var ii=0;ii<3;ii++)_html+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/goldenmonkey/bonus/ruong-lg.png"\x3e\x3cimg src\x3d"images/goldenmonkey/bonus/ruong_on.png"\x3e\x3c/div\x3e';$bonusWrap.find(".items-ruong").html(_html);var canOpen=true;var ruongOther=
null;switch(thiz.slotData.MG.rate){case 1:ruongOther=[2,3];break;case 2:ruongOther=[3,4];break;case 3:ruongOther=[2,4];break;case 4:ruongOther=[3,5];break;case 5:ruongOther=[3,4];break;default:ruongOther=[3,4];break}$bonusWrap.find(".items-ruong\x3e.item").off("click").on("click",function(){if(!canOpen)return false;thiz.createSound("bonusMoruong");$(this).append('\x3cimg class\x3d"xn" src\x3d"images/goldenmonkey/bonus/x'+thiz.slotData.MG.rate+'.png"\x3e').addClass("active");if(ruongOther){var $this=
$(this);thiz.timmer.setTimeout(function(){$this.siblings(".item").each(function(index){$(this).append('\x3cimg class\x3d"xn" src\x3d"images/goldenmonkey/bonus/x'+ruongOther[index]+'.png"\x3e').addClass("active blur");console.log(index,".item")})},1E3)}canOpen=false;thiz.timmer.setTimeout(function(){afterClick()},3E3);return false});thiz.timmer.setTimeout(function(){$bonusWrap.addClass("moruong");$bonusWrap.find("\x3e.slpopup-content\x3e.wrap1").hide();$bonusWrap.find("\x3e.slpopup-content\x3e.wrap2").show()},
1500)}else for(var i=0;i<thiz.slotData.MG.stg.length;i++){var bValue=0,valueWin=0;if(thiz.slotData.MG.items[countClick]==thiz.slotData.MG.stg[i].id){bValue=thiz.slotData.MG.stg[i].b2||thiz.slotData.MG.stg[i].b||0;valueWin=thiz.betting*bValue*thiz.lines.length;totalWin+=valueWin;$this.html("\x3cspan\x3e0\x3c/span\x3e");MH.realtimeCount(0,valueWin,$this.children("span"),500);afterClick();break}}$this.addClass("active");return false});$bonusWrap.children(".btn-closePopup").off("click").on("click",function(){$(this).off("click");
thiz.timmer.clearInterval(bonusTimmer);thiz.timmer.clearTimeout(delayBonusTimmer);var itemsNotClick=$bonusWrap.find(".items\x3e.item").not(".active");if(countClick<thiz.slotData.MG.items.length){var numOpen=thiz.slotData.MG.items.length-countClick;var eqOpen=[];var rand=0;for(var i=0;i<numOpen;i++){do rand=Math.floor(Math.random()*itemsNotClick.length);while(eqOpen.indexOf(rand)!=-1);itemsNotClick.eq(rand).trigger("click")}}$bonusTotal.html(MH.numToText(thiz.slotData.MG.m,1));thiz.timmer.setTimeout(function(){finishBonus()},
2E3);return false});$bonusWrap.addClass("show")};
GameGoldenMonkey.prototype.showLichSu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});var $btnLeft=$popup.children(".btn-left"),$btnRight=$popup.children(".btn-right");$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,
_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);$btnLeft.off("click").on("click",function(){if(_crPage>1)getPage(_crPage-1,_type);return false});$btnRight.off("click").on("click",function(){getPage(_crPage+1,_type);return false});return;var totalPage=1,_first=_last=false,
_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-
1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';
$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameGoldenMonkey.prototype.showLichSuHu=function(){var thiz=this;var $popup=this.elementWrap.children(".sllichsuhu");$popup.find(".btn-closePopup").off("click").on("click",function(){$popup.hide().find(".table-content, .pagination").empty()});var $btnLeft=$popup.children(".btn-left"),$btnRight=$popup.children(".btn-right");$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=7,_type=MoneyType.Gold;var getPage=function(n,moneyType){MyRequest.fetchSlotJackpotHistory(thiz.gameId,
_numPerPage,(n-1)*_numPerPage,function(cmd,data){var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,
1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);$btnLeft.off("click").on("click",function(){if(_crPage>1)getPage(_crPage-1,_type);return false});$btnRight.off("click").on("click",function(){getPage(_crPage+1,_type);return false});return;var totalPage=1,_first=_last=false,
_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-
1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';
$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page),_type);return false})})};getPage(1,_type);$popup.show()};
GameGoldenMonkey.prototype.showVinhDanh=function(){var thiz=this;var $popup=this.elementWrap.children(".slvinhdanh");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.hide().removeClass("hide").find(".table-content, .pagination").empty()},500);return false});var $btnLeft=$popup.children(".btn-left"),$btnRight=$popup.children(".btn-right");$popup.find(".table-content, .pagination").empty();var _crPage=1,_numPerPage=
7,_type=MoneyType.Gold;var getPage=function(n){MyRequest.fetchTopSlotMachine2({limit:_numPerPage,skip:(n-1)*_numPerPage,gameId:thiz.gameId},function(cmd,data){thiz.log(data);var _html="";if(!data||!data.hasOwnProperty("data"))return;_total=data.data.count;if(data.data&&data.data.items.length){_crPage=n;for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i:s")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].displayName+
"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}_html="\x3ctable\x3e"+_html+"\x3c/table\x3e"}$popup.find(".table-content").html(_html).scrollTop(0);$btnLeft.off("click").on("click",function(){if(_crPage>1)getPage(_crPage-1);return false});$btnRight.off("click").on("click",function(){getPage(_crPage+
1);return false});return;var totalPage=1,_first=_last=false,_button=[_crPage];_pagination="";if(data&&data.data&&data.data.count)totalPage=Math.ceil(data.data.count/_numPerPage);else return;if(_crPage>3)_first=true;if(totalPage>_crPage+2)_last=true;if(_crPage>=2)_button.unshift(_crPage-1);if(_crPage>=3)_button.unshift(_crPage-2);if(totalPage>_crPage)_button.push(_crPage+1);if(totalPage>_crPage+1)_button.push(_crPage+2);while(_button.length<5)if(_button[0]>1)_button.unshift(_button[0]-1);else break;
while(_button.length<5)if(_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);else break;if(!_first&&_button[_button.length-1]<totalPage)_button.push(_button[_button.length-1]+1);if(!_last&&_button[0]>1)_button.unshift(_button[0]-1);if(_first)_pagination+='\x3cbutton page\x3d"1" class\x3d"btn-first"\x3e\x26lt;\x26lt;\x3c/button\x3e';for(var i=0;i<_button.length;i++)_pagination+='\x3cbutton page\x3d"'+_button[i]+'" class\x3d"'+(_button[i]==_crPage?"current":"")+'"\x3e'+_button[i]+
"\x3c/button\x3e";if(_last)_pagination+='\x3cbutton page\x3d"'+totalPage+'" class\x3d"btn-last"\x3e\x26gt;\x26gt;\x3c/button\x3e';$popup.find(".pagination").html(_pagination);$popup.find(".pagination button").on("click",function(){var _page=$(this).attr("page");getPage(parseInt(_page));return false})})};getPage(1);$popup.show()};
GameGoldenMonkey.prototype.showLuatChoi=function(){var $popup=this.elementWrap.children(".slbangthuong");var thiz=this;var _to=this.betting;var _step=1;$popup.children(".slpopup-content").attr("data-room",this.betting).attr("data-step",_step);$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.children(".btn-left, .btn-right").off("click").on("click",function(){if($(this).hasClass("btn-left")){_step-=
1;if(_step<1)_step=4}else{_step+=1;if(_step>4)_step=1}$popup.children(".slpopup-content").attr("data-step",_step);return false});$popup.show()};
GameGoldenMonkey.prototype.showCaiDat=function(){var thiz=this;var $popup=this.elementWrap.children(".slcaidat");if(this.speaker.mute)$popup.find(".amthanh").addClass("mute");else $popup.find(".amthanh").removeClass("mute");$popup.children(".btn-closePopup").off("click").on("click",function(){$popup.addClass("hide");thiz.timmer.setTimeout(function(){$popup.removeClass("hide").hide()},500);return false});$popup.find(".amthanh").off("click").on("click",function(){$(this).toggleClass("mute");thiz.speaker.setMute($(this).hasClass("mute"));
return false});$popup.find(".lsgd").off("click").on("click",function(){$popup.hide();thiz.showLichSu();return false});$popup.find(".lsh").off("click").on("click",function(){$popup.hide();thiz.showLichSuHu();return false});$popup.show()};
GameGoldenMonkey.prototype.runColSpin=function(colId){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.position.set(0,0);wrapBlur.position.set(0,0);gsap.to(wrapItem.position,{duration:.3,ease:"none",y:-50});var _h=-(wrapBlur.children.length-3-.5)*this.itemHeight;this.timmer.setTimeout(function(){gsap.killTweensOf(wrapItem.position);gsap.from(wrapBlur.position,
{y:_h,repeat:1E3,duration:1,ease:"none"});wrapItem.visible=false;wrapBlur.visible=true},300)};
GameGoldenMonkey.prototype.stopColSpin=function(colId,callback){var column=this.columns[colId];var wrapItem=column.getChildByName("wrapItem"),wrapBlur=column.getChildByName("wrapBlur");wrapBlur.visible=false;wrapItem.visible=true;gsap.killTweensOf(wrapBlur.position);gsap.killTweensOf(wrapItem.position);wrapItem.y=50;gsap.to(wrapItem.position,{duration:.1,ease:"none",y:0});this.createSound("soundColStop");this.timmer.setTimeout(function(){wrapItem.y=0;if(callback&&typeof callback=="function")callback()},
300)};
GameGoldenMonkey.prototype.createSlotGame=function(){var thiz=this;this.prefixItem="";this.colsItems=[];var createItem=function(obj){var item=new PIXI.Sprite(thiz.app.loader.resources.icons.textures[obj.id+".png"]);item.anchor.set(.5,.5);if(obj.x)item.x=obj.x;if(obj.y)item.y=obj.y;if(obj.visible===false)item.visible=false;item.iconId=obj.id;if(obj.blur){var ft=new PIXI.filters.BlurFilter;ft.blurX=0;ft.blurY=5;item.filters=[ft]}return item};for(var i=0;i<5;i++){this.columns[i]=new PIXI.Container;this.columns[i]._index=
i;this.columns[i].position.set(108+i*264,0);if(i==0)this.columns[i].x+=8;this.containerItem.addChild(this.columns[i]);var wrapItem=new PIXI.Container;wrapItem.name="wrapItem";var wrapBlur=new PIXI.Container;wrapBlur.name="wrapBlur";this.columns[i].addChild(wrapItem,wrapBlur);this.colsItems[i]=[];for(j=0;j<3;j++){var item=createItem({id:Math.floor(Math.random()*10),y:j*thiz.itemHeight+thiz.itemHeight/2});wrapItem.addChild(item);this.colsItems[i].push(item)}var ics=[0,1,2,3,4,5,6,7,8,9,10,0,1,2];ics.sort(function(){return.5-
Math.random()});ics.push(ics[0],ics[1],ics[2]);for(var ii=ics.length-1;ii>=0;ii--){var item=createItem({id:ics[ii],blur:true,y:ii*thiz.itemHeight+thiz.itemHeight/2});wrapBlur.addChild(item)}wrapBlur.cacheAsBitmap=true;wrapBlur.visible=false;this.playSpriteAnimation(this.colsItems[i][0]);this.playSpriteAnimation(this.colsItems[i][1]);this.playSpriteAnimation(this.colsItems[i][2])}this.app.stage.addChild(this.containerItem)};
GameGoldenMonkey.prototype.playSpriteAnimation=function(spr){var thiz=this;spr.visible=true;if(spr.mAmimation)spr.parent.removeChild(spr.mAmimation);return;if(this.app.loader.resources.hasOwnProperty("icon"+spr.iconId)){var lens={0:29,5:20,6:20,7:20,8:20,9:39};var frames=[];for(var ii=1;ii<=lens[spr.iconId];ii++){var t=ii;if(t<10)t="00"+t;else t="0"+t;frames.push(this.app.loader.resources["icon"+spr.iconId].textures[t+".png"])}var anim=new PIXI.extras.AnimatedSprite(frames);anim.anchor.set(.5);anim.animationSpeed=
.5;anim.loop=true;anim.onFrameChange=function(){};anim.onComplete=function(){console.log("onComplete",this)};anim.onLoop=function(){console.log("onLoop",this)};console.log("runnn anim");anim.play();anim.x=spr.x;anim.y=spr.y;spr.parent.addChild(anim);spr.mAmimation=anim;spr.visible=false}};GameGoldenMonkey.prototype.stopSpriteAnimation=function(spr){if(spr.mAmimation){spr.parent.removeChild(spr.mAmimation);spr.visible=true}};
GameGoldenMonkey.prototype.initGame=function(){var thiz=this;MH.changeBG("images/goldenmonkey/background.jpg");if(!this.soundBackground)this.soundBackground=this.createSound("background",{loop:true});this.initButton();this.notify("");this.gotoLobby();this.chooseLines([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24]);this.app.loader.add("icons","images/goldenmonkey/sprites.json").add("spinStickyWild","images/goldenmonkey/anim/spinification_en.json").add("spinItem","images/goldenmonkey/anim/wild_ignite_animation_en.json").add("icon0",
"images/goldenmonkey/anim/icon0.json").add("icon5","images/goldenmonkey/anim/icon5.json").add("icon6","images/goldenmonkey/anim/icon6.json").add("icon7","images/goldenmonkey/anim/icon7.json").add("icon8","images/goldenmonkey/anim/icon8.json").add("icon9","images/goldenmonkey/anim/icon9.json").load(function(loader,data){thiz.createSlotGame()});var elementSoDu=this.elementWrap.find("\x3e.slot-wraptop\x3e.coin-wrap\x3e.coin").html(MH.numToText(PlayerMe.gold,1));var offsetTopHu=function(){var $topHuGroup=
$("#topHuGroup");var _count=0;var timeoutOffset=thiz.timmer.setInterval(function(){console.log("...");$topHuGroup.offset({left:0});_count++;if(_count>=10)thiz.timmer.clearInterval(timeoutOffset)},20)};$(window).on("updateMoney.Slot"+this.gameName,function(e,p){elementSoDu.html(MH.numToText(p,1))}).on("changeView.Slot"+this.gameName,function(){offsetTopHu()});offsetTopHu()};
GameGoldenMonkey.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=BigSlotTarget.getInstance();TopHuClient.getInstance().removeListener(target);MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.speaker.destroy();this.app.destroy();$(window).off(".Slot"+this.gameName);target.currentTarget=null};var MyTrungPhucSinh=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var TrungPhucSinhPreLoad={template:"template/mng-trungphucsinh.html",images:["images/minigame/tps/bgmain.png","images/minigame/tps/items_blur.png","images/minigame/tps/btn-chondong.png","images/minigame/tps/btn-quay.png","images/minigame/tps/btn-tuquay.png","images/minigame/tps/items/0.png","images/minigame/tps/items/1.png","images/minigame/tps/items/2.png","images/minigame/tps/items/3.png","images/minigame/tps/items/4.png","images/minigame/tps/items/5.png"]};
function TrungPhucSinh(){this.gameName="TrungPhucSinh";this.gameId=SLOT_GAME_MINI.TRUNG_PHUC_SINH||0;this.elementWrap=$(TrungPhucSinhPreLoad.template).appendTo("body");this.elementQuy=this.elementWrap.find("#quy-number");this.elementGame=this.elementWrap.find("#game-trungphucsinh");this.elementFreeSpin=this.elementWrap.find(".free-spin");this.timmer=new mhTimer;this.lines=[];this.openEffect="";this.autoSpin=false;this.onSpin=false;this.onOpen=false;this.moneyType=MoneyType.Gold;this.timeMoneyEf=3500;
this.timeLineEf=100;this.betting=100;this.elementSuKien=this.elementWrap.children(".sukien");var target=MyTrungPhucSinh.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnectGame,
target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,this._onObserverResponse,target);this.initButton();this.initGame()}TrungPhucSinh.prototype.setQuy=function(n){var _old=this.elementQuy.data("num")||0;this.elementQuy.data("num",n);if(!this.onOpen){this.elementQuy.html(MH.numToText(n,1));return}MH.realtimeCount(_old,n,this.elementQuy,1E3)};
TrungPhucSinh.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:switch(thiz.betting){case 100:thiz.setQuy(data[1].Js[0].J);break;case 1E3:thiz.setQuy(data[1].Js[1].J);break;case 1E4:thiz.setQuy(data[1].Js[2].J);break;default:thiz.betting=100;thiz.setQuy(data[1].Js[0].J);break}if(thiz.autoSpin&&!thiz.onSpin)thiz.timmer.setTimeout(function(){if(thiz.autoSpin&&!thiz.onSpin)thiz.sendRequestSpin()},
2E3);if(data[1].event&&data[1].event.bs&&data[1].event.bs.length){var _html="";for(var i=0;i<data[1].event.bs.length;i++)_html+='\x3cdiv class\x3d"item"\x3e\x3cspan class\x3d"sk-cuoc"\x3e'+MH.numToText(data[1].event.bs[i].b,0)+'\x3c/span\x3e\x3cspan class\x3d"sk-hu"\x3e'+data[1].event.bs[i].rjc+"\x3c/span\x3e\x3c/div\x3e";thiz.elementSuKien.html(_html).show()}else thiz.elementSuKien.hide();break;case CMD_SLOT_MACHINE.SPIN:thiz.spinStart(data[1]);break;default:break}};
TrungPhucSinh.prototype._onReconnectGame=function(){if(SHOW_LOG)console.log("_onReconnectGame TPS");var thiz=this.currentTarget;MiniGameClient.getInstance().observerByGameID(thiz.gameId)};TrungPhucSinh.prototype._onRoomPluginMsg=function(cmd,data){if(SHOW_LOG)console.log("this");if(SHOW_LOG)console.log(this)};
TrungPhucSinh.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)if(data.fss[i].aid==thiz.moneyType&&data.fss[i].b==thiz.betting){thiz.hasFreeSpin(data.fss[i].fs);break}MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}};
TrungPhucSinh.prototype.eventTDV=function(){return false;var thiz=this;var $elmSK=this.elementWrap.children(".event-baidep");MH.sukien.getInfo(function(obj){if(obj&&obj.UAMSCollectJackpot2&&obj.UAMSCollectJackpot2.data&&obj.UAMSCollectJackpot2.data.ae){$elmSK.off("click").on("click",function(){var $popup=$("#popup-thanhDaoVang");if($popup.data("mhPopup"))$popup.data("mhPopup").open("");return false});if(obj.UAMSCollectJackpot2.data.evtHs){var evtHs=obj.UAMSCollectJackpot2.data.evtHs;var _now=(new Date).getTime();
for(var i=0;i<evtHs.length;i++)if(_now<evtHs[i].from){runClock(evtHs[i].from,$elmSK.find(".timer-next"));$elmSK.show().children(".wrap1").hide();$elmSK.children(".wrap2").show();break}else if(_now>=evtHs[i].from&&_now<=evtHs[i].to){getYourRank();runClock(evtHs[i].to,$elmSK.find(".timer-cr"));$elmSK.show().children(".wrap1").show();$elmSK.children(".wrap2").hide();break}else if(i==evtHs.length-1)$elmSK.hide()}}else{$elmSK.hide();thiz.elementWrap.find(".text-top img").attr("src","images/minigame/tps/text-top.png").off()}});
function getYourRank(){MH.sukien.getTop(function(obj){var _point=0,_xh="_",_count=0;if(obj&&obj.UAMSCollectJackpot2&&obj.UAMSCollectJackpot2.data&&obj.UAMSCollectJackpot2.data.user){if(obj.UAMSCollectJackpot2.data.user.userRank>0)_xh=obj.UAMSCollectJackpot2.data.user.userRank;if(obj.UAMSCollectJackpot2.data.user.count)_point=obj.UAMSCollectJackpot2.data.user.count;if(obj.UAMSCollectJackpot2.data.user.currCount)_count=obj.UAMSCollectJackpot2.data.user.currCount}$elmSK.find(".point").html(_point);$elmSK.find(".xephang").html(_xh);
$elmSK.find(".count").html(_count)})}function runClock(to,element){thiz.timmer.clearInterval(element.data("timer"));var _now=(new Date).getTime();if(_now>=to){element.html("00:00");return}var convertTime=function(t){if(t<0)return"00:00";var result="";var hour=Math.floor(t/1E3/60/60),minute=Math.floor(t/1E3/60-hour*60),second=Math.floor(t/1E3-hour*3600-minute*60);if(hour<10)hour="0"+hour;result=hour+":";if(minute<10)minute="0"+minute;result+=minute+":";if(second<10)second="0"+second;result+=second;
return result};element.html(convertTime(to-_now));var _clock=thiz.timmer.setInterval(function(){_now+=1E3;if(_now>=to)thiz.timmer.clearInterval(_clock);else element.html(convertTime(to-_now))},1E3);element.data("timer",_clock)}};
TrungPhucSinh.prototype.drawLine=function(n,t,keep){if(n<0||n>20)return;var thiz=this;t=t||0;var pointsPos=[{x:97,y:60},{x:213,y:60},{x:327,y:60},{x:97,y:167},{x:213,y:167},{x:327,y:167},{x:97,y:270},{x:213,y:270},{x:327,y:270}];var _buttons=[{x:22,y:44},{x:19,y:70},{x:16,y:95},{x:13,y:120},{x:12,y:145},{x:11,y:170},{x:12,y:194},{x:13,y:220},{x:14,y:245},{x:19,y:270},{x:405,y:45},{x:410,y:71},{x:413,y:96},{x:415,y:121},{x:417,y:145},{x:417,y:170},{x:417,y:196},{x:414,y:222},{x:414,y:244},{x:412,y:269}];
var _lines=[[1,2,3],[4,5,6],[7,8,9],[1,8,3],[7,2,9],[1,5,3],[1,5,9],[7,5,3],[4,8,6],[4,2,6],[7,5,9],[1,2,6],[4,5,9],[4,5,3],[7,8,6],[4,2,3],[7,5,6],[1,5,6],[4,8,9],[1,8,6]];var _colors=["#ff0066","#0066ff","#00cc99","#ff6600","#cc33ff","#996633","#00cc99","#990000","#ff0066","#0066ff","#00cc99","#ff6600","#cc33ff","#996633","#00cc99","#990000","#ff0066","#0066ff","#00cc99","#ff6600"];var thisLine=_lines[n];var c=this.elementWrap.find("#lines-trungphucsinh")[0];this.timmer.setTimeout(function(){if(!c)return;
var ctx=c.getContext("2d");if(keep!==true)ctx.clearRect(0,0,c.width,c.height);ctx.beginPath();ctx.lineWidth=4;if(n<10)ctx.moveTo(_buttons[n].x+3,_buttons[n].y+3);thisLine.forEach(function(v,k){if(k===0&&n>=10)ctx.moveTo(pointsPos[v-1].x,pointsPos[v-1].y);ctx.lineTo(pointsPos[v-1].x,pointsPos[v-1].y)});if(n>=10)ctx.lineTo(_buttons[n].x+3,_buttons[n].y+3);var _color=_colors[n]||"#ff9800";ctx.strokeStyle=_color;ctx.stroke();thisLine.forEach(function(v,k){ctx.beginPath();ctx.arc(pointsPos[v-1].x,pointsPos[v-
1].y,5,0,2*Math.PI,false);ctx.fillStyle=_color;ctx.fill()});thiz.elementWrap.find(".btn-lineNum:eq("+n+")").addClass("on-hover");$(c).addClass("show")},t)};TrungPhucSinh.prototype.drawLines=function(arr){var thiz=this;this.removeDrawLine();for(var i=0;i<arr.length;i++)thiz.drawLine(arr[i],i*thiz.timeLineEf,true)};
TrungPhucSinh.prototype.winner=function(n,type){var thiz=this;if(n==0||!this.onOpen){this.removeDrawLine();this.handleSpinDone()}else{var wrap=this.elementWrap.children(".item-content");wrap.children(".effect").remove();var _class="effect";if(type)_class+=" nohu";wrap.append('\x3cdiv class\x3d"'+_class+'"\x3e\x3cspan class\x3d"money"\x3e'+MH.numToText(n,1)+"\x3c/span\x3e\x3c/div\x3e");this.timmer.setTimeout(function(){wrap.children(".effect").remove();thiz.handleSpinDone();thiz.removeDrawLine()},
this.timeMoneyEf)}};TrungPhucSinh.prototype.removeDrawLine=function(){this.elementWrap.find(".btn-lineNum").removeClass("on-hover");var c=document.getElementById("lines-trungphucsinh");if(!c)return;var ctx=c.getContext("2d");ctx.clearRect(0,0,c.width,c.height);$(c).removeClass("show")};
TrungPhucSinh.prototype.addLine=function(n){if(this.onSpin||this.autoSpin)return;if(this.lines.indexOf(n)===-1)this.lines.push(n);this.elementWrap.find(".btn-lineNum, .list-dong .item").removeClass("active");this.elementWrap.find(".btn-chooseLine span").html(this.lines.length);for(var i=0;i<this.lines.length;i++)this.elementWrap.find(".btn-lineNum.line"+(this.lines[i]+1)+", .list-dong .item"+(this.lines[i]+1)).addClass("active")};
TrungPhucSinh.prototype.removeLine=function(n){if(this.onSpin||this.autoSpin)return;var index=this.lines.indexOf(n);if(index>-1)this.lines.splice(index,1);this.elementWrap.find(".btn-lineNum, .list-dong .item").removeClass("active");this.elementWrap.find(".btn-chooseLine span").html(this.lines.length);for(var i=0;i<this.lines.length;i++)this.elementWrap.find(".btn-lineNum.line"+(this.lines[i]+1)+", .list-dong .item"+(this.lines[i]+1)).addClass("active")};
TrungPhucSinh.prototype.getEggs=function(arr){var _html="";_html+='\x3cimg src\x3d"images/minigame/tps/items/'+arr[0]+'.png"\x3e';_html+='\x3cimg src\x3d"images/minigame/tps/items/'+arr[1]+'.png"\x3e';_html+='\x3cimg src\x3d"images/minigame/tps/items/'+arr[2]+'.png"\x3e';return _html};
TrungPhucSinh.prototype.notify=function(s){var thiz=this;this.elementGame.children(".notify").remove();var $notify=$('\x3cdiv class\x3d"notify" style\x3d"display:block;"\x3e'+s+"\x3c/div\x3e");this.elementGame.append($notify);this.timmer.setTimeout(function(){$notify.remove()},1E3)};
TrungPhucSinh.prototype.sendRequestSpin=function(){var thiz=this;if(this.lines.length==0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.changeAutoSpin(false);return}var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":thiz.gameId,"aid":thiz.moneyType,"ls":thiz.lines,"b":thiz.betting}];MiniGameClient.getInstance().send(sendObj)};
TrungPhucSinh.prototype.spinStart=function(data){var thiz=this;if(this.onSpin)return;if(this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.changeAutoSpin(false);this.handleSpinDone();return}if(data.mgs){this.notify(data.mgs);this.changeAutoSpin(false);this.handleSpinDone();return}if(!data||!data.hasOwnProperty("sbs")||data.sbs.length!=9){this.changeAutoSpin(false);this.handleSpinDone();return}this.onSpin=true;this.btnSpin.addClass("on-click");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-click")},
300);this.elementWrap.find(".btn-spin, .btn-chooseLine").addClass("disable");this.elementWrap.find(".effect").remove();this.elementWrap.find(".egg-effect").removeClass("stop").addClass("run");this.timmer.setTimeout(function(){thiz.spinStop(data)},1800)};
TrungPhucSinh.prototype.spinStop=function(data){var thiz=this;var col1=this.getEggs([data.sbs[6],data.sbs[3],data.sbs[0]]),col2=this.getEggs([data.sbs[7],data.sbs[4],data.sbs[1]]),col3=this.getEggs([data.sbs[8],data.sbs[5],data.sbs[2]]);this.elementWrap.find(".col-1").children(".result-top, .result-bottom").html(col1);this.elementWrap.find(".col-2").children(".result-top, .result-bottom").html(col2);this.elementWrap.find(".col-3").children(".result-top, .result-bottom").html(col3);this.elementWrap.find(".egg-effect").removeClass("run").addClass("stop");
var _wls=[],_wMoney=0;if(data.wls&&data.wls.length){_wMoney=data.mX;for(var i=0;i<data.wls.length;i++)_wls.push(data.wls[i].lid)}this.timmer.setTimeout(function(){thiz.eventTDV();thiz.elementWrap.find(".egg-effect").removeClass("stop");thiz.drawLines(_wls);thiz.timmer.setTimeout(function(){thiz.winner(_wMoney,data.iJ);thiz.hasFreeSpin(data.fss)},_wls.length*thiz.timeLineEf)},2E3)};
TrungPhucSinh.prototype.handleSpinDone=function(){this.onSpin=false;LobbyRequest.getInstance().requestUpdateMoney();if(this.autoSpin)this.sendRequestSpin();else this.elementWrap.find(".btn-spin, .btn-chooseLine").removeClass("disable")};
TrungPhucSinh.prototype.changeAutoSpin=function(s){if(s==undefined)s=!this.autoSpin;if(s&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");s=false}if(s&&!this.onSpin)this.sendRequestSpin();if(!s&&!this.onSpin)this.elementWrap.find(".btn-chooseLine, .btn-spin").removeClass("disable");this.autoSpin=s;if(s)this.elementWrap.find(".btn-autoSpin").addClass("active");else this.elementWrap.find(".btn-autoSpin").removeClass("active")};
TrungPhucSinh.prototype.hasFreeSpin=function(n){if(n){this.elementFreeSpin.children("span").html(n);this.elementFreeSpin.show()}else this.elementFreeSpin.hide()};
TrungPhucSinh.prototype.initButton=function(){var thiz=this;this.elementWrap.find('input[name\x3d"money-type"]').prop("checked",true).prop("disabled",true);this.elementWrap.find(".btn-vinhdanh").off().on("click",function(){var $popup=$("#popup-minigameVinhdanh");$popup.find("tbody").html("");var _html="";MyRequest.fetchTopSlotMachine(thiz.gameId,function(cmd,obj){if(obj&&obj.status==0&&obj.data.items.length){var _len=obj.data.items.length;for(var i=0;i<_len;i++)if(obj.data.items[i].assetId==MoneyType.Gold){_html+=
"\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(obj.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].betting+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(obj.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}}$popup.find("tbody").html(_html)});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-lichsu").off().on("click",
function(){var $popup=$("#popup-lichsuTPS");$popup.find("#tab-lichsuTPSgold tbody").html("");$popup.find("#tab-lichsuTPSchip tbody").html("");var _page=1,_rowPerPage=50,_total=0,_type=MoneyType.Gold;var getPage=function(n,moneyType){if(n<=0)return;_page=n;$popup.find(".page-control .page-name").html(_page);if(_page<=1)$popup.find(".page-control .btn-prev").addClass("disable");else $popup.find(".page-control .btn-prev").removeClass("disable");MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,
_rowPerPage,(n-1)*_rowPerPage,function(cmd,data){var _html="";if(!data)return;_total=data.data.count;if(data.data&&data.data.items.length)for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].betting+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].numLines+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].totalBet+
"\x3c/td\x3e";_html+="\x3ctd\x3e";for(var j=0;j<data.data.items[i].payoutLines.length;j++){_html+=data.data.items[i].payoutLines[j].id+1;if(j!==data.data.items[i].payoutLines.length-1)_html+=", "}_html+="\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}if(moneyType==1)$popup.find("#tab-lichsuTPSgold tbody").html(_html);else $popup.find("#tab-lichsuTPSchip tbody").html(_html);$popup.find(".table-inner").scrollTop(0);if(_page*_rowPerPage>=
_total)$popup.find(".page-control .btn-next").addClass("disable");else $popup.find(".page-control .btn-next").removeClass("disable")})};getPage(1,_type);$popup.find(".tabs-lichsu").off("tabsactivate").on("tabsactivate",function(event,ui){if(ui.newPanel.attr("id")=="tab-lichsuTPSchip"){_page=1;_type=MoneyType.Chip}else{_page=1;_type=MoneyType.Gold}getPage(_page,_type)});$popup.find(".page-control .btn-next").off().on("click",function(){if($(this).hasClass("disable"))return;getPage(_page+1,_type);return false});
$popup.find(".page-control .btn-prev").off().on("click",function(){if($(this).hasClass("disable"))return;getPage(_page-1,_type);return false});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-huongdan").off().on("click",function(){return false});this.elementWrap.find(".btn-datcuoc").each(function(index){$(this).off().on("click",function(){var $that=$(this);if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else{switch(index){case 0:thiz.betting=100;
break;case 1:thiz.betting=1E3;break;case 2:thiz.betting=1E4;break;default:thiz.betting=thiz.betting||100;break}$that.addClass("active").siblings(".btn-datcuoc").removeClass("active")}return false})});this.elementWrap.find(".btn-autoSpin").off().on("click",function(){var $that=$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);thiz.changeAutoSpin();return false});this.elementWrap.find(".btn-lineNum").off().on("mouseenter",function(){if(!thiz.onSpin&&
!thiz.autoSpin){var _i=$(this).index();thiz.drawLine(_i)}}).on("mouseleave",function(){if(!thiz.onSpin)thiz.timmer.setTimeout(function(){thiz.removeDrawLine()},10)}).on("click",function(){if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else{var $that=$(this);var _index=$that.index();if($that.hasClass("active"))thiz.removeLine(_index);else thiz.addLine(_index)}return false});this.elementWrap.find(".btn-chooseLine").off().on("click",function(){var $that=$(this);$that.addClass("on-click");
thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else thiz.timmer.setTimeout(function(){thiz.elementWrap.find(".popup-chondong").show()},500);return false});this.elementWrap.find(".close-chondong").off().on("click",function(){thiz.elementWrap.find(".popup-chondong").hide();return false});this.elementWrap.find(".list-dong .item").off().on("click",function(){var $that=$(this);var _index=$that.index();if($that.hasClass("active"))thiz.removeLine(_index);
else thiz.addLine(_index);return false});this.elementWrap.find(".btn-dongChan").off().on("click",function(){for(var i=0;i<20;i++)if(i%2===0)thiz.removeLine(i);else thiz.addLine(i);return false});this.elementWrap.find(".btn-dongLe").off().on("click",function(){for(var i=0;i<20;i++)if(i%2===0)thiz.addLine(i);else thiz.removeLine(i);return false});this.elementWrap.find(".btn-dongAll").off().on("click",function(){for(var i=0;i<20;i++)thiz.addLine(i);return false});this.elementWrap.find(".btn-dongNone").off().on("click",
function(){for(var i=0;i<20;i++)thiz.removeLine(i);return false});var btnSpin=this.elementWrap.find(".btn-spin").off().on("click",function(){if(thiz.onSpin||thiz.autoSpin){var $that=$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);thiz.notify("\u0110ang quay, xin ch\u1edd")}else thiz.sendRequestSpin();return false});this.elementWrap.find(".close-minigame").off().on("click",function(){if(!thiz.autoSpin)thiz.destroyGame();else thiz.close();return false});
this.btnSpin=btnSpin};TrungPhucSinh.prototype.open=function(){this.onOpen=true;this.elementWrap.show();MiniGameClient.getInstance().observerByGameID(this.gameId);this.eventTDV()};TrungPhucSinh.prototype.close=function(){this.onOpen=false;this.elementWrap.hide()};
TrungPhucSinh.prototype.initGame=function(){var thiz=this;this.elementWrap.addClass("success");var _windowW=$("body").width(),_windowH=$("body").height();this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<-550*MH.scale)_top=-550*MH.scale;else if(_top>(window.innerHeight-50)*MH.scale)_top=(window.innerHeight-50)*MH.scale;if(_left<-440*MH.scale)_left=-440*MH.scale;else if(_left>(window.innerWidth-40)*MH.scale)_left=(window.innerWidth-40)*MH.scale;
ui.helper.animate({top:_top,left:_left},300)}});if(PlayerMe.gold>this.betting*20)for(var i=0;i<=19;i++)this.addLine(i);else this.addLine(0);var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.AUTOSPIN_OFF,"gid":thiz.gameId}];MiniGameClient.getInstance().send(sendObj);this.elementWrap.addClass("on-open animated "+this.openEffect);this.open()};
TrungPhucSinh.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=MyTrungPhucSinh.getInstance();MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var MyTaiXiu=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();var TaiXiuPreLoad={template:"template/mng-taixiu.html",images:["images/taixiu/bg.png","images/taixiu/bgchat.png","images/taixiu/tai.png","images/taixiu/xiu.png","images/taixiu/font/count.png","images/taixiu/ef-taixiu.png"]};
function TaiXiu(display){this.gameName="TaiXiu";this.timmer=new mhTimer;this.elementWrap=$(TaiXiuPreLoad.template).appendTo("body");this.elementGame=this.elementWrap.find("#game-taixiu");this.userTai=this.elementWrap.find(".tai-wrap .user");this.userXiu=this.elementWrap.find(".xiu-wrap .user");this.quyTai=this.elementWrap.find(".tai-wrap .money");this.quyTai2=null;this.quyXiu=this.elementWrap.find(".xiu-wrap .money");this.quyXiu2=null;this.fontMoney=null;this.fontCount=null;this.inputTai=this.elementWrap.find(".tai-wrap .input-tai");
this.inputXiu=this.elementWrap.find(".xiu-wrap .input-xiu");this.cuocTai=this.elementWrap.find(".tai-wrap .cuoc-tai");this.cuocXiu=this.elementWrap.find(".xiu-wrap .cuoc-xiu");this.clockS=this.elementGame.children(".clock-small");this.clockB=this.elementGame.children(".clock-big");this.vung=this.elementGame.find(".vung");this.timerCtr=undefined;this.gameId=100;this.moneyType=MoneyType.Gold;this.openEffect="";this.onOpen=false;this.history=[];this.sessionId=0;this.timeEff=2E3;this.onBetting=false;
this.timeMoneyEf=4E3;this.timeForBetting=5E4;this.timeForPayout=15E3;this.nan=false;this.cuaDat=0;var target=MyTaiXiu.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_TAI_XIU.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.GET_INFO_PHIEN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.GET_HISTORY_BET.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.BETTING_DONE.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.ENABLE_BETTING.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.CHARGE_MONEY.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.UPDATE_BETTING.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_TAI_XIU.CHAT.toString(),
this._onChatResponse,target);MiniGameClient.getInstance().addListener("1",this._onupdateGame,target);this.initButton();this.initGame(display);this.initChat()}
TaiXiu.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(SHOW_LOG)console.log("Tai xiu receive "+cmd);switch(parseInt(cmd)){case CMD_TAI_XIU.CHARGE_MONEY:if(SHOW_LOG)console.log(data[1]);thiz.notify("Tr\u1ea3 ti\u1ec1n c\u00e2n k\u00e8o",2E3);if(data[1].gBB!=undefined){thiz.quyTai.data("num",data[1].gBB);if(thiz.quyTai2)thiz.quyTai2.data("num",data[1].gBB).html(MH.numToText(data[1].gBB,1));thiz.setQuy(data[1].gBB,"T");thiz.quyXiu.data("num",data[1].gBB);if(thiz.quyXiu2)thiz.quyXiu2.data("num",
data[1].gBB).html(MH.numToText(data[1].gBB,1));thiz.setQuy(data[1].gBB,"X")}if(data[1].gR&&data[1].gB){var _hoantra=data[1].gB-data[1].gR;if(_hoantra<=0)_hoantra=0;if(thiz.cuaDat==1)thiz.cuocTai.html(_hoantra).after('\x3cp class\x3d"hoantra"\x3e+'+data[1].gR+"\x3c/p\x3e");else if(thiz.cuaDat==2)thiz.cuocXiu.html(_hoantra).after('\x3cp class\x3d"hoantra"\x3e+'+data[1].gR+"\x3c/p\x3e")}if(data[1].GX){var _lai=data[1].GX;if(data[1].gR)_lai=_lai-data[1].gR;thiz.timmer.setTimeout(function(){thiz.winner(_lai)},
thiz.timeEff+2500)}else if(data[1].CX){var _lai=data[1].CX;if(data[1].gR)_lai=_lai-data[1].gR;thiz.timmer.setTimeout(function(){thiz.winner(_lai)},thiz.timeEff+2500)}else if(thiz.cuaDat!=0)thiz.timmer.setTimeout(function(){LobbyRequest.getInstance().requestUpdateMoney()},thiz.timeEff+2500);thiz.timmer.setTimeout(function(){thiz.showKq(data[1])},2E3);break;case CMD_TAI_XIU.ENABLE_BETTING:thiz.hideKq();thiz.clockS.css("display","none");thiz.notify("B\u1eaft \u0111\u1ea7u phi\u00ean m\u1edbi",3E3);thiz.userTai.html("0");
thiz.userXiu.html("0");thiz.quyTai.data("num",0);if(thiz.quyTai2)thiz.quyTai2.data("num",0).html(0);thiz.setQuy(0,"T");thiz.quyXiu.data("num",0);if(thiz.quyXiu2)thiz.quyXiu2.data("num",0).html(0);thiz.setQuy(0,"X");thiz.setClockB(thiz.timeForBetting);thiz.sessionId=data[1].sid;thiz.cuaDat=0;thiz.resetBetting();thiz.enableBetting();thiz.elementWrap.find(".winner-effect, .hoantra").remove();thiz.duday("info");if(SHOW_LOG)console.log(data[1]);break;case CMD_TAI_XIU.UPDATE_BETTING:thiz.setTotal(data[1]);
break;case CMD_TAI_XIU.GET_INFO_PHIEN:if(SHOW_LOG)console.log("Lich su phi\u00ean");if(SHOW_LOG)console.log(data);if(!data[1].ended)return;var $popup=thiz.elementWrap.find(".thongke-wrap");$popup.find(".phien-kq").removeClass("kq-tai kq-xiu");$popup.find(".dices, .phien-info, .cuoc-wrap table tbody").html("");if(data[1].d1&&data[1].d2&&data[1].d3){$popup.find(".dices").html('\x3cdiv class\x3d"dices"\x3e\x3cdiv class\x3d"dice dice'+data[1].d1+'"\x3e\x3c/div\x3e\x3cdiv class\x3d"dice dice'+data[1].d2+
'"\x3e\x3c/div\x3e\x3cdiv class\x3d"dice dice'+data[1].d3+'"\x3e\x3c/div\x3e\x3cspan class\x3d"total"\x3e'+(data[1].d1+data[1].d2+data[1].d3)+"\x3c/span\x3e\x3c/div\x3e");var _class=data[1].d1+data[1].d2+data[1].d3<=10?"kq-xiu":"kq-tai";$popup.find(".phien-kq").removeClass("kq-tai kq-xiu").addClass(_class)}else return;$popup.find(".phien-info").html("Phi\u00ean \x3cspan\x3e#"+data[1].sid+"\x3c/span\x3e ("+MH.convertTime(data[1].st)+")");$popup.find(".pagination .btn-prev").attr("data-sid",data[1].sid-
1);$popup.find(".pagination .btn-next").attr("data-sid",data[1].sid+1);var _htmlT="",_htmlX="",_len=data[1].bs.length,_refundT=0,_refundX=0,_bettingT=0,_bettingX=0;for(var i=0;i<_len;i++){var _html="\x3ctr\x3e\x3ctd\x3e"+MH.convertTime(data[1].bs[i].crt,"H:i")+'\x3c/td\x3e\x3ctd\x3e\x3cdiv title\x3d"'+data[1].bs[i].dn+'"\x3e'+data[1].bs[i].dn+"\x3c/div\x3e\x3c/td\x3e\x3ctd\x3e"+MH.numToText(data[1].bs[i].rf)+"\x3c/td\x3e\x3ctd\x3e"+MH.numToText(data[1].bs[i].b)+"\x3c/td\x3e\x3c/tr\x3e";if(data[1].bs[i].eid==
1){_htmlT+=_html;_refundT+=data[1].bs[i].rf;_bettingT+=data[1].bs[i].b}else if(data[1].bs[i].eid==2){_htmlX+=_html;_refundX+=data[1].bs[i].rf;_bettingX+=data[1].bs[i].b}}$popup.find(".cuoc-tai table tbody").html(_htmlT);$popup.find(".cuoc-xiu table tbody").html(_htmlX);$popup.find(".cuoc-tai .inner-content, .cuoc-xiu .inner-content").scrollTop(0);$popup.find(".phien-footer .ft-tai").html("\x3cspan\x3e"+MH.numToText(_refundT,1)+"\x3c/span\x3e / \x3cspan\x3e"+MH.numToText(_bettingT,1)+"\x3c/span\x3e");
$popup.find(".phien-footer .ft-xiu").html("\x3cspan\x3e"+MH.numToText(_refundX,1)+"\x3c/span\x3e / \x3cspan\x3e"+MH.numToText(_bettingX,1)+"\x3c/span\x3e");$popup.find(".pagination .btn-prev, .pagination .btn-next").off().on("click",function(){var _sid=$(this).attr("data-sid");if(!_sid)return false;var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.GET_INFO_PHIEN,"sid":parseInt(_sid),"aid":thiz.moneyType}];MiniGameClient.getInstance().send(sendObj);
return false});$popup.addClass("show");thiz.elementWrap.find(".soicau-wrap").removeClass("show");break;case CMD_OBSERVER.OBSERVER_TAI_XIU:if(SHOW_LOG)console.log(data[1]);thiz.clockS.css("display","none");thiz.elementGame.children(".dice").remove();thiz.setTotal(data[1]);thiz.setClockB(data[1].rmT);if(data[1].tFB)thiz.timeForBetting=data[1].tFB;if(data[1].tFP)thiz.timeForPayout=data[1].tFP;if(thiz.sessionId!=data[1].sid){thiz.resetBetting();thiz.sessionId=data[1].sid}if(data[1].htr.length){thiz.history=
data[1].htr;thiz.drawHistory();thiz.buildSoiCau()}if(data[1].gS==2)thiz.enableBetting();else if(data[1].gS==3){thiz.notify("Tr\u1ea3 ti\u1ec1n c\u00e2n k\u00e8o");thiz.disableBetting()}if(data[1].cH){var _oldChat="",isAdmin=false;for(var i=0;i<data[1].cH.length;i++){isAdmin=data[1].cH[i].fu.indexOf("[")!==-1;if(isAdmin)data[1].cH[i].fu=data[1].cH[i].fu.replace("[","").replace("]","");_oldChat+="\x3cp"+(isAdmin?' class\x3d"isadmin"':"")+'\x3e\x3cspan class\x3d"u-name"\x3e'+data[1].cH[i].fu+":\x3c/span\x3e "+
$("\x3cdiv/\x3e").text(data[1].cH[i].mgs).html()+"\x3c/p\x3e"}thiz.elementWrap.find(".txchat-wrap .chat-inner").html(_oldChat)}break;case CMD_TAI_XIU.BETTING_DONE:if(SHOW_LOG)console.log("dat cuoc thanh cong");if(data[1].b){thiz.notify("\u0110\u1eb7t c\u01b0\u1ee3c th\u00e0nh c\u00f4ng",2E3);thiz.elementWrap.find(".control .cuoc-wrap").removeClass("show");if(data[1].eid==1){thiz.cuocTai.html(data[1].tB);thiz.cuocXiu.html("");thiz.inputTai.val("");thiz.inputXiu.val("").prop("disabled",true)}else if(data[1].eid==
2){thiz.cuocTai.html("");thiz.cuocXiu.html(data[1].tB);thiz.inputTai.val("").prop("disabled",true);thiz.inputXiu.val("")}thiz.cuaDat=data[1].eid}break;case 1:if(data[1].mgs)thiz.notify(data[1].mgs,2E3);break;case CMD_TAI_XIU.GET_HISTORY_BET:if(SHOW_LOG)console.log("receive history");thiz.showHistory(data[1]);break;default:break}};
TaiXiu.prototype.setQuy=function(money,type){if(!this.fontMoney)return;var n=MH.numToText(money,1);var _arr=n.split("");var _html="";var _k=null;for(var i=0;i<_arr.length;i++){if(_arr[i]==".")_k=10;else _k=parseInt(_arr[i]);_html+='\x3cdiv style\x3d"background-position: -'+this.fontMoney[_k]["x"]+"px -"+this.fontMoney[_k]["y"]+"px; width: "+this.fontMoney[_k]["width"]+"px; height: "+this.fontMoney[_k]["height"]+'px;"\x3e\x3c/div\x3e'}if(type=="T")this.quyTai.html(_html);else if(type=="X")this.quyXiu.html(_html)};
TaiXiu.prototype.duday=function(type,_data){return;var thiz=this;var elementSK=this.elementWrap.find(".event-phuonghoang");var arrW=[0,23,46,69,93,116,140,163,187,210,234,257,280,304,330];if(type==="info")MH.sukien.taixiu.getInfo(function(obj){if(obj&&obj.ae){thiz.skDuday=true;thiz.elementWrap.find(".text-top").hide();thiz.duday("rank")}else{thiz.skDuday=false;elementSK.hide();thiz.elementWrap.find(".text-top").show()}});else if(type==="rank"){if(!thiz.skDuday)return;MH.sukien.taixiu.getRank(function(obj){var _countWin=
0,_countLose=0,_maxLose=0,_maxWin=0,_rankWin="_",_rankLose="_";if(obj&&obj.user&&obj.user.winning)_countWin=obj.user.winning;if(obj&&obj.user&&obj.user.losing)_countLose=obj.user.losing;if(obj&&obj.user&&obj.user.rankWin>0)_rankWin=obj.user.rankWin;if(obj&&obj.user&&obj.user.rankLose>0)_rankLose=obj.user.rankLose;if(obj&&obj.user&&obj.user.maxLose>0)_maxLose=obj.user.maxLose;if(obj&&obj.user&&obj.user.maxWin>0)_maxWin=obj.user.maxWin;elementSK.find(".thang-count").html(_maxWin);elementSK.find(".thua-count").html(_maxLose);
elementSK.find(".thang-rank").html(_rankWin);elementSK.find(".thua-rank").html(_rankLose);if(_countWin)elementSK.find(".img-bird").attr("data-type","win");else if(_countLose)elementSK.find(".img-bird").attr("data-type","lose");else elementSK.find(".img-bird").attr("data-type","");var progress=_countWin||_countLose;if(progress&&arrW[progress])elementSK.find(".bar").css("width",arrW[progress]+"px");else elementSK.find(".bar").css("width",0);elementSK.show();elementSK.off("click").on("click",function(){if(thiz.skDuday){$("#popup-dudayTaiXiu").find(".dudayBXH-tabs").tabs("option",
"active",_countWin?0:1);$("#popup-dudayTaiXiu").data("mhPopup").open("");return false}})})}};
TaiXiu.prototype.initButton=function(){var thiz=this;this.elementWrap.find(".control .btn-huongdan").off().on("click",function(){return false});this.elementWrap.find(".control .btn-vinhdanh").off().on("click",function(){var $popup=$("#popup-taixiuVinhdanh");MyRequest.fetchTaiXiuRanking(function(cmd,data){if(!data||data.status==1)return;var _html="",_len=data.data.topAssets[0].topUsers.length;if(data.status==0&&_len)for(var i=0;i<_len;i++){var _num=i+1>3?i+1:"";_html+='\x3ctr class\x3d""\x3e\x3ctd\x3e\x3cspan\x3e'+
_num+"\x3c/span\x3e\x3c/td\x3e\x3ctd\x3e"+data.data.topAssets[0].topUsers[i].displayName+"\x3c/td\x3e\x3ctd\x3e"+MH.numToText(data.data.topAssets[0].topUsers[i].total,1)+"\x3c/td\x3e\x3c/tr\x3e"}$popup.find("table tbody").html(_html);$popup.data("mhPopup").open("")});return false});this.elementWrap.find(".control .btn-lichsu").off().on("click",function(){thiz.crHistoryPage=1;thiz.getHistory(thiz.crHistoryPage);return false});this.btnNan=this.elementWrap.find(".control .btn-nan").off().on("click",
function(){thiz.setNan(!thiz.nan);return false});this.btnSoiCau=this.elementWrap.find(".control .btn-soicau").off().on("click",function(){var $popup=thiz.elementWrap.find(".soicau-wrap");$popup.find(".tab1-wrap").addClass("show");$popup.find(".tab2-wrap").removeClass("show");if($popup.hasClass("show"))$popup.removeClass("show");else{thiz.elementWrap.find(".thongke-wrap").removeClass("show");$popup.addClass("show");thiz.timmer.setTimeout(function(){thiz.buildSoiCau()},10)}return false});this.elementWrap.find(".btn-closeGame").off().on("click",
function(){thiz.close();return false});this.vung.draggable({drag:function(event,ui){var x=ui.position.left,y=ui.position.top;console.log(x,y);if((x-272)*(x-272)+(y-158)*(y-158)>7200)thiz.elementWrap.addClass("nan-done")}});this.inputTai.off().on("click",function(){if(thiz.onBetting==false){thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",2E3);return}var cuocWrap=thiz.elementWrap.find(".control .cuoc-wrap");var _clickBtn=false;cuocWrap.find(".btn-cuocMoney").off().on("click",function(){var _money=
parseInt($(this).attr("data-money"));thiz.sendBetting(_money,1);thiz.inputTai.val("");thiz.inputXiu.val("");_clickBtn=true;return false});cuocWrap.find(".btn-agree").off().on("click",function(){if(!thiz.onBetting){thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",2E3);return false}var _b=thiz.inputTai.val();if(_b){_b=parseInt(_b);thiz.sendBetting(_b,1)}_clickBtn=false;return false});cuocWrap.find(".btn-cancel").off().on("click",function(){thiz.inputTai.val("");thiz.inputXiu.val("");_clickBtn=
false;cuocWrap.removeClass("show");return false});cuocWrap.find(".btn-tattay").off().on("click",function(){thiz.sendBetting("TATTAY",1);_clickBtn=false;return false});cuocWrap.removeClass("show");thiz.timmer.setTimeout(function(){cuocWrap.addClass("show")},200);return false}).on("keyup paste",function(e){var _nhap=$(this).val();if(_nhap){var _trim=_nhap.replace(/[^0-9]/g,"");if(_trim!=_nhap)$(this).val(_trim)}thiz.inputXiu.val("");_clickBtn=false;if(e&&e.keyCode===13){if(!thiz.onBetting)thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",
2E3);var _b=thiz.inputTai.val();if(_b){_b=parseInt(_b);thiz.sendBetting(_b,1)}}});this.inputXiu.off().on("click",function(){if(thiz.onBetting==false){thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",2E3);return}var cuocWrap=thiz.elementWrap.find(".control .cuoc-wrap");var _clickBtn=false;cuocWrap.find(".btn-cuocMoney").off().on("click",function(){var _money=parseInt($(this).attr("data-money"));thiz.sendBetting(_money,2);thiz.inputXiu.val("");thiz.inputTai.val("");_clickBtn=true;return false});
cuocWrap.find(".btn-agree").off().on("click",function(){if(!thiz.onBetting){thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",2E3);return false}var _b=thiz.inputXiu.val();if(_b){_b=parseInt(_b);thiz.sendBetting(_b,2)}_clickBtn=false;return false});cuocWrap.find(".btn-cancel").off().on("click",function(){thiz.inputTai.val("");thiz.inputXiu.val("");_clickBtn=false;cuocWrap.removeClass("show");return false});cuocWrap.find(".btn-tattay").off().on("click",function(){thiz.sendBetting("TATTAY",
2);return false});cuocWrap.removeClass("show");thiz.timmer.setTimeout(function(){cuocWrap.addClass("show")},200);return false}).on("keyup paste",function(e){var _nhap=$(this).val();if(_nhap){var _trim=_nhap.replace(/[^0-9]/g,"");if(_trim!=_nhap)$(this).val(_trim)}thiz.inputTai.val("");_clickBtn=false;if(e&&e.keyCode===13){if(!thiz.onBetting)thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",2E3);var _b=thiz.inputXiu.val();if(_b){_b=parseInt(_b);thiz.sendBetting(_b,2)}}});this.elementWrap.find(".btn-closeSoiSau").off().on("click",
function(){thiz.elementWrap.find(".soicau-wrap").removeClass("show");return false});this.elementWrap.find(".thongke-wrap .close-popup").off().on("click",function(){thiz.elementWrap.find(".thongke-wrap").removeClass("show");return false})};
TaiXiu.prototype.initChat=function(){var thiz=this;var _numPres=0;var $input=this.elementWrap.find(".txchat-wrap input"),$chatList=this.elementWrap.find(".txchat-wrap .chat-inner"),$btnSend=this.elementWrap.find(".txchat-wrap .btn-sendchat"),sendMes=function(content){var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.CHAT,"mgs":content}];MiniGameClient.getInstance().send(sendObj)};$chatList.parent().perfectScrollbar();$input.val("");
$chatList.parent().off("mouseenter mouseleave").on("mouseenter",function(){$chatList.addClass("on-hover");$(this).perfectScrollbar().scrollTop($chatList.height()+20)}).on("mouseleave",function(){$chatList.removeClass("on-hover");$(this).perfectScrollbar("destroy")});$input.off("keyup").on("keyup",function(e){var _mes=$input.val();if(_mes){_mes=_mes.trim();if(_mes!=""&&_numPres>=_mes.length&&e&&e.keyCode==13){$input.val("");sendMes(_mes);_numPres=0}}});$input.off("keydown").on("keydown",function(e){var _mes=
$input.val();if(_mes){_mes=_mes.trim();if(_mes.length>180&&(!e||e.keyCode>=48))return false}_numPres+=1});$input.off("paste").on("paste",function(e){return false});$input.on("touchstart",function(){$(this).focus()});$btnSend.off().on("click",function(){var _mes=$input.val();if(_mes){_mes=_mes.trim();if(_mes!=""&&_numPres>=_mes.length){$input.val("");sendMes(_mes);_numPres=0}}return false});this.elementWrap.find(".control .btn-chat").off().on("click",function(){thiz.elementWrap.find(".txchat-wrap").toggle();
return false});this.elementWrap.find(".txchat-wrap .btn-closeChat").off().on("click",function(){thiz.elementWrap.find(".txchat-wrap").hide();return false})};
TaiXiu.prototype._onChatResponse=function(cmd,data){var thiz=this.currentTarget,$chatList=thiz.elementWrap.find(".txchat-wrap .chat-inner");if(data&&data[1]){var _html="",isAdmin=false,_mes=$("\x3cdiv/\x3e").text(data[1].mgs).html();if(data[1].c==0){isAdmin=data[1].fu.indexOf("[")!==-1;if(isAdmin)data[1].fu=data[1].fu.replace("[","").replace("]","");_html="\x3cp"+(isAdmin?' class\x3d"isadmin"':"")+'\x3e\x3cspan class\x3d"u-name"\x3e'+data[1].fu+":\x3c/span\x3e "+_mes+"\x3c/p\x3e"}else _html='\x3cp style\x3d"color:red"\x3e'+
_mes+"\x3c/p\x3e";$chatList.append(_html);$chatList.parent().scrollTop($chatList.height()+1E3);var $items=$chatList.children();if($items.length>150){var rm=$items.length-150;$items.each(function(index){if(index<rm)$(this).remove()})}}};
TaiXiu.prototype.showHistory=function(data){var thiz=this;if(SHOW_LOG)console.log(data);var $popup=$("#popup-lichsuTaiXiu");var _html="";var _len=data.items.length;if(_len){for(var i=0;i<_len;i++){var _name=data.items[i].eid==1?"T\u00e0i":"X\u1ec9u";_html+='\x3ctr class\x3d""\x3e\x3ctd\x3e#'+data.items[i].sid+"\x3c/td\x3e\x3ctd\x3e"+MH.convertTime(data.items[i].crt)+"\x3c/td\x3e\x3ctd\x3e"+_name+"\x3c/td\x3e\x3ctd\x3e"+data.items[i].d1+" - "+data.items[i].d2+" - "+data.items[i].d3+"\x3c/td\x3e\x3ctd\x3e"+
data.items[i].b+"\x3c/td\x3e\x3ctd\x3e"+data.items[i].rf+"\x3c/td\x3e\x3ctd\x3e"+data.items[i].po+"\x3c/td\x3e\x3c/tr\x3e"}$popup.find("table tbody").html(_html);$popup.find(".page-control .page-name").html(this.crHistoryPage);$popup.find(".table-inner").scrollTop(0)}if(data.count){var _numPage=Math.ceil(data.count/50);if(SHOW_LOG)console.log("_numPage: "+_numPage);if(this.crHistoryPage>=_numPage)$popup.find(".page-control .btn-next").addClass("disable");else $popup.find(".page-control .btn-next").removeClass("disable");
if(this.crHistoryPage<=1)$popup.find(".page-control .btn-prev").addClass("disable");else $popup.find(".page-control .btn-prev").removeClass("disable")}$popup.find(".page-control .btn-next").off().on("click",function(){if($(this).hasClass("disable"))return false;thiz.crHistoryPage+=1;thiz.getHistory(thiz.crHistoryPage);return false});$popup.find(".page-control .btn-prev").off().on("click",function(){if($(this).hasClass("disable"))return false;thiz.crHistoryPage-=1;thiz.getHistory(thiz.crHistoryPage);
return false});$popup.data("mhPopup").open("")};
TaiXiu.prototype.buildSoiCau=function(){var thiz=this;var $popup=this.elementWrap.find(".soicau-wrap");var _off1=false,_off2=false,_off3=false;var drawDice=function(arr,color){var c=document.getElementById("canvas-soicau2");if(!c)return;var ctx=c.getContext("2d");ctx.beginPath();ctx.lineWidth=2;for(var i=0;i<arr.length;i++){if(i==0)ctx.moveTo(c.width-6-29*i,0+6+29*(6-arr[i]));else ctx.lineTo(c.width-6-29*i,0+6+29*(6-arr[i]));if(i>=20)break}ctx.strokeStyle=color;ctx.stroke();for(var i=0;i<arr.length;i++){ctx.beginPath();
ctx.arc(c.width-6-29*i,0+6+29*(6-arr[i]),6,0,2*Math.PI);ctx.fillStyle=color;ctx.fill();if(i>=20)break}};var drawTotal=function(arr){var c=document.getElementById("canvas-soicau1");if(!c)return;var ctx=c.getContext("2d");ctx.clearRect(0,0,c.width,c.height);ctx.beginPath();ctx.lineWidth=2;var _html="",_html4="",_html3="",_cr3colName="",_cr3colCout=0,_cr3colNum=0,_countTai=0,_countXiu=0;for(var i=0;i<arr.length;i++){if(arr[i]<=10)_countTai++;else _countXiu++;if(i<=20){if(i==0)ctx.moveTo(c.width-6-29*
i,0+6+10*(18-arr[i]));else ctx.lineTo(c.width-6-29*i,0+6+10*(18-arr[i]));var _class=arr[i]>10?"is-tai":"is-xiu";_html+='\x3cspan class\x3d"'+_class+'" style\x3d"top:'+(0+6+10*(18-arr[i]))+"px; left:"+(c.width-6-29*i)+'px;"\x3e'+arr[i]+"\x3c/span\x3e"}}ctx.strokeStyle="#4CAF50";ctx.stroke();var _tmp=0;for(var i=arr.length-1;i>=0;i--){var _class=arr[i]>10?"is-tai":"is-xiu";if(_tmp<100){if(_tmp%5==0){if(_tmp!=0)_html4+="\x3c/div\x3e";_html4+='\x3cdiv class\x3d"column"\x3e'}_html4+='\x3cspan class\x3d"'+
_class+'"\x3e'+arr[i]+"\x3c/span\x3e";_tmp+=1;if(i==0||_tmp==100)_html4+="\x3c/div\x3e"}if(_cr3colNum<20){if(_class!==_cr3colName||_cr3colCout%5==0){if(_cr3colName)_html3+="\x3c/div\x3e";_html3+='\x3cdiv class\x3d"column"\x3e';_cr3colName=_class;_cr3colCout=0;_cr3colNum+=1}_html3+='\x3cspan class\x3d"'+_class+'"\x3e'+arr[i]+"\x3c/span\x3e";_cr3colCout++;if(i==0)_html3+="\x3c/div\x3e"}}var $wrap=$(c).next(".total-wrap");$wrap.html(_html);$popup.find("#canvas-soicau3").html(_html3);$popup.find("#canvas-soicau4").html(_html4);
$popup.find(".btn-xiunum").html("X\u1ec9u "+_countXiu);$popup.find(".btn-tainum").html("T\u00e0i "+_countTai)};var drawAll=function(){var c=document.getElementById("canvas-soicau2");if(!c)return;var ctx=c.getContext("2d");ctx.clearRect(0,0,c.width,c.height);var _arr0=[],_arr1=[],_arr2=[],_arr3=[];for(var i=thiz.history.length-1;i>=0;i--){_arr1.push(thiz.history[i].d1);_arr2.push(thiz.history[i].d2);_arr3.push(thiz.history[i].d3);_arr0.push(thiz.history[i].d1+thiz.history[i].d2+thiz.history[i].d3)}if(!_off1)drawDice(_arr1,
"#00bcd4");if(!_off2)drawDice(_arr2,"#F44336");if(!_off3)drawDice(_arr3,"#FFC107");drawTotal(_arr0);var _lasHis=thiz.history[thiz.history.length-1];$popup.find(".newest-id").html("#"+_lasHis.sid);var _txt=_lasHis.d1+_lasHis.d2+_lasHis.d3<11?"X\u1ec9u":"T\u00e0i";_txt+=" "+(_lasHis.d1+_lasHis.d2+_lasHis.d3);_txt+="("+_lasHis.d1+"-"+_lasHis.d2+"-"+_lasHis.d3+")";$popup.find(".newest-info").html(_txt)};$popup.find(".control .xx1 input").prop("checked",true).off().on("change",function(){_off1=!$(this).prop("checked");
drawAll()});$popup.find(".control .xx2 input").prop("checked",true).off().on("change",function(){_off2=!$(this).prop("checked");drawAll()});$popup.find(".control .xx3 input").prop("checked",true).off().on("change",function(){_off3=!$(this).prop("checked");drawAll()});$popup.find(".control .btn-tab1").off().on("click",function(){$popup.find(".tab1-wrap").addClass("show");$popup.find(".tab2-wrap").removeClass("show");return false});$popup.find(".control .btn-tab2").off().on("click",function(){$popup.find(".tab2-wrap").addClass("show");
$popup.find(".tab1-wrap").removeClass("show");return false});drawAll()};TaiXiu.prototype.getHistory=function(page){var thiz=this;if(page<=0)return;var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.GET_HISTORY_BET,"L":50,"S":(page-1)*50,"aid":thiz.moneyType}];MiniGameClient.getInstance().send(sendObj)};
TaiXiu.prototype.enableBetting=function(){this.onBetting=true;this.inputTai.prop("disabled",false);this.inputXiu.prop("disabled",false)};TaiXiu.prototype.disableBetting=function(){this.onBetting=false;this.inputTai.val("").prop("disabled",true);this.inputXiu.val("").prop("disabled",true);this.elementWrap.find(".control .cuoc-wrap").removeClass("show")};TaiXiu.prototype.resetBetting=function(){this.cuocTai.html("");this.cuocXiu.html("")};
TaiXiu.prototype.sendBetting=function(b,eid){var thiz=this;if(b==="TATTAY")var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.BETTING_ALL,"aid":thiz.moneyType,"eid":eid}];else var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.BETTING_DONE,"b":b,"aid":thiz.moneyType,"eid":eid}];MiniGameClient.getInstance().send(sendObj)};
TaiXiu.prototype.winner=function(n){var thiz=this;var wrap=this.elementWrap.children(".item-content");wrap.children(".winner-effect").remove();if(n){var _class="winner-effect";wrap.append('\x3cdiv class\x3d"'+_class+'"\x3e\x3cspan class\x3d"money"\x3e'+n+"\x3c/span\x3e\x3c/div\x3e");this.timmer.setTimeout(function(){wrap.children(".winner-effect").remove()},15E3);if(thiz.cuaDat!=0)this.timmer.setTimeout(function(){LobbyRequest.getInstance().requestUpdateMoney()},15E3)}else if(thiz.cuaDat!=0)LobbyRequest.getInstance().requestUpdateMoney()};
TaiXiu.prototype.setNan=function(a){this.nan=a;if(this.nan){this.btnNan.addClass("active");this.elementWrap.addClass("nan");if(this.elementWrap.hasClass("kq-tai")||this.elementWrap.hasClass("kq-xiu")){this.vung.css({top:"358px",left:"16000px"});this.elementWrap.addClass("nan-done")}else this.vung.css({top:158,left:272})}else{this.btnNan.removeClass("active");this.elementWrap.removeClass("nan nan-done")}};TaiXiu.prototype.close=function(){this.onOpen=false;this.elementWrap.css("display","none")};
TaiXiu.prototype.open=function(){var thiz=this;this.onOpen=true;this.elementWrap.css("display","block");this.timmer.setTimeout(function(){thiz.elementWrap.find(".txchat-wrap").show()},3E3)};
TaiXiu.prototype.getElementQuy2=function(){return;console.log("TX getElementQuy2");var thiz=this;if(MH.currentPage("home"))$("#content .game-list .list-item\x3ebutton").each(function(){var $this=$(this);var _gid=$this.data("gid")||"xxx";if(_gid=="TAIXIU"){thiz.quyTai2=$this.children(".hu-tai").show();thiz.quyXiu2=$this.children(".hu-xiu").show()}return false})};
TaiXiu.prototype.setClockB=function(t){var thiz=this;var n=Math.floor(t/1E3);if(n<=0)return;MenuMiniGame.setClock(n);this.clockB.show();this.clockS.hide();this.timmer.clearInterval(this.timerCtr);var _old1=0,_old2=0;this.timerCtr=this.timmer.setInterval(function(){n=n-1;if(n<0)thiz.timmer.clearInterval(thiz.timerCtr);else{var n1=0,n2=0;if(n>=10)n1=Math.floor(n/10);n2=n-n1*10;var _class1=' class\x3d"mht"',_class2=' class\x3d"mht"';if(_old1==n1)_class1="";if(_old2==n2)_class2="";_old1=n1;_old2=n2;thiz.clockB.html("\x3cdiv"+
_class1+' style\x3d"background-position: -'+thiz.fontCount[n1]["x"]+"px -"+thiz.fontCount[n1]["y"]+"px; width: "+thiz.fontCount[n1]["width"]+"px; height: "+thiz.fontCount[n1]["height"]+'px;"\x3e\x3c/div\x3e\x3cdiv'+_class2+' style\x3d"background-position: -'+thiz.fontCount[n2]["x"]+"px -"+thiz.fontCount[n2]["y"]+"px; width: "+thiz.fontCount[n2]["width"]+"px; height: "+thiz.fontCount[n2]["height"]+'px;"\x3e\x3c/div\x3e')}},1E3);return;var thiz=this;var clockMenu=$("#menu-minigame .timer");var n=Math.floor(t/
1E3);if(n<=0)return;if(SHOW_LOG)console.log(n);if(n>2)this.timmer.setTimeout(function(){thiz.disableBetting()},(n-2)*1E3);else this.disableBetting();this.timmer.clearInterval(this.timerCtr);var clockFormat=function(k){return k<10?"00:0"+k:"00:"+k};this.clockB.css("display","block").html(clockFormat(n));clockMenu.css("display","block").html(clockFormat(n));$("#menu-minigame .kqTX").removeClass("kq-tai kq-xiu");this.timerCtr=this.timmer.setInterval(function(){n=n-1;if(n<0)thiz.timmer.clearInterval(thiz.timerCtr);
else{thiz.clockB.html(clockFormat(n));clockMenu.html(clockFormat(n))}},1E3)};TaiXiu.prototype.setClockS=function(t){var thiz=this;var n=Math.floor(t/1E3);if(n<=0)return;this.clockS.css("display","block");var clockFormat=function(k){return k<10?"0"+k:k};this.clockS.html(clockFormat(n));var runClock=this.timmer.setInterval(function(){n=n-1;if(n<0){thiz.timmer.clearInterval(runClock);thiz.timmer.setTimeout(function(){thiz.clockS.css("display","none")},5E3)}else thiz.clockS.html(clockFormat(n))},1E3)};
TaiXiu.prototype.notify=function(s,t){this.elementGame.children(".notify").remove();if(!s)return;var $notify=$('\x3cdiv class\x3d"notify"\x3e'+s+"\x3c/div\x3e");$notify.appendTo(this.elementGame);if(t)this.timmer.setTimeout(function(){$notify.remove()},t)};
TaiXiu.prototype.showKq=function(data){var thiz=this;var _class=data.d1+data.d2+data.d3<=10?"kq-xiu":"kq-tai";this.elementGame.children(".dice, .effect").remove();this.elementWrap.removeClass("kq-xiu kq-tai").addClass(_class+" run");this.clockB.css("display","none");var kqNum=data.d1+data.d2+data.d3;this.elementGame.children(".kq-num").html(kqNum);if(this.nan){this.vung.css({top:158,left:272});this.elementWrap.removeClass("nan-done")}var _html='\x3cdiv class\x3d"effect"\x3e\x3c/div\x3e\x3cdiv class\x3d"dice dice'+
data.d1+""+data.d2+""+data.d3+'"\x3e\x3c/div\x3e';this.elementGame.append(_html);this.timmer.setTimeout(function(){thiz.elementWrap.removeClass("run");if(!thiz.nan){thiz.changeFavicon(_class);MenuMiniGame.showKqTX(_class)}},this.timeEff);this.timmer.setTimeout(function(){thiz.setClockS(thiz.timeForPayout-1E4);thiz.timmer.setTimeout(function(){if(thiz.nan&&!thiz.elementWrap.hasClass("nan-done")){thiz.vung.animate({top:"358px",left:"472px"},500);thiz.elementWrap.addClass("nan-done");thiz.changeFavicon(_class);
MenuMiniGame.showKqTX(_class)}},2E3)},4500);this.timmer.setTimeout(function(){var obj={d1:data.d1,d2:data.d2,d3:data.d3,sid:thiz.sessionId};thiz.history.push(obj);thiz.drawHistory();thiz.buildSoiCau()},this.timeForPayout-5E3)};TaiXiu.prototype.hideKq=function(){if(SHOW_LOG)console.log("run hideKq");this.elementWrap.removeClass("kq-xiu kq-tai");this.elementGame.children(".dice, .effect").remove()};
TaiXiu.prototype.setTotal=function(data){if(data.gi)for(var i=0;i<data.gi.length;i++)if(data.gi[i].aid===this.moneyType){this.userTai.html(data.gi[i].B.tU);this.quyTai.data("num",data.gi[i].B.tB);this.setQuy(data.gi[i].B.tB,"T");this.userXiu.html(data.gi[i].S.tU);this.quyXiu.data("num",data.gi[i].S.tB);this.setQuy(data.gi[i].S.tB,"X");if(this.quyTai2){_oldT=this.quyTai2.data("num")||0;MH.realtimeCount(_oldT,data.gi[i].B.tB,this.quyTai2.data("num",data.gi[i].B.tB),1E3)}if(this.quyXiu2){_oldX=this.quyXiu2.data("num")||
0;MH.realtimeCount(_oldX,data.gi[i].S.tB,this.quyXiu2.data("num",data.gi[i].S.tB),1E3)}break}};
TaiXiu.prototype.drawHistory=function(){var thiz=this;var _len=this.history.length,_stt=0,_html="";for(var i=_len-1;i>=0;i--){var _class=this.history[i].d1+this.history[i].d2+this.history[i].d3<=10?"xiu":"tai";_html='\x3cimg src\x3d"images/taixiu/ico_kq_'+_class+'.png" data-sid\x3d"'+this.history[i].sid+'"/\x3e'+_html;_stt+=1;if(_stt>=14)break}_html+='\x3cdiv class\x3d"his-tooltip" style\x3d"display:none;"\x3e#12345   T\u00e0i-11(1 4 6)\x3c/div\x3e';this.elementWrap.find(".his").html(_html);var $hisTooltip=
this.elementWrap.find(".his .his-tooltip");this.elementWrap.find(".his img").off().on("click",function(){var _sid=$(this).attr("data-sid");if(!_sid)return false;var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_TAI_XIU.GET_INFO_PHIEN,"sid":parseInt(_sid),"aid":thiz.moneyType}];MiniGameClient.getInstance().send(sendObj);return false}).on("mouseenter",function(){var _sid=$(this).attr("data-sid");_sid=parseInt(_sid);var _len=thiz.history.length;
for(var i=_len-1;i>=0;i--)if(_sid===thiz.history[i].sid){var _txt="#"+_sid+" ";var _total=thiz.history[i].d1+thiz.history[i].d2+thiz.history[i].d3;_txt+=_total<=10?"X\u1ec9u-":"T\u00e0i-";_txt+=_total+"("+thiz.history[i].d1+" "+thiz.history[i].d2+" "+thiz.history[i].d3+")";$hisTooltip.html(_txt);break}$hisTooltip.stop().fadeIn().offset($(this).offset());return false}).on("mouseleave",function(){$hisTooltip.stop().fadeOut("slow")})};
TaiXiu.prototype.updateGame=function(cmd,obj){if(SHOW_LOG)console.log("TaiXiu.prototype.updateGame");if(SHOW_LOG)console.log(obj)};
TaiXiu.prototype.changeFavicon=function(type){var thiz=this;var $favicon=jQuery('link[rel\x3d"shortcut icon"]');if(!this.favicon)this.favicon=$favicon.attr("href");var arr=[];var tmp=0;if(type=="kq-tai"){arr.push("images/minigame/tai_default.png");arr.push("images/minigame/tai_on.png")}else if(type=="kq-xiu"){arr.push("images/minigame/xiu_default.png");arr.push("images/minigame/xiu_on.png")}else{arr.push(this.favicon);arr.push(this.favicon);$favicon.attr("href",this.favicon)}var _timeout=this.timmer.setInterval(function(){$favicon.attr("href",
arr[tmp]);if(tmp==0)tmp=1;else tmp=0},300);this.timmer.setTimeout(function(){thiz.timmer.clearInterval(_timeout);$favicon.attr("href",thiz.favicon)},8E3)};
TaiXiu.prototype.initGame=function(display){var thiz=this;this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<-365*MH.scale)_top=-365*MH.scale;else if(_top>(window.innerHeight-100)*MH.scale)_top=(window.innerHeight-100)*MH.scale;if(_left<-680*MH.scale)_left=-680*MH.scale;else if(_left>(window.innerWidth-80)*MH.scale)_left=(window.innerWidth-80)*MH.scale;ui.helper.animate({top:_top,left:_left},300)}});this.getElementQuy2();$.getJSON("images/taixiu/font/count.json",
function(data){thiz.fontCount=data;$.getJSON("images/taixiu/font/money.json",function(data2){thiz.fontMoney=data2;var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_TAI_XIU,{"cmd":CMD_OBSERVER.OBSERVER_TAI_XIU}];MiniGameClient.getInstance().send(sendObj)})});if(display==="hide")this.close();else this.open();this.elementWrap.addClass("on-open animated "+this.openEffect)};
TaiXiu.prototype.destroyGame=function(){var target=MyTaiXiu.getInstance();MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var MyThienDia=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
function ThienDia(){this.elementWrap=$("body\x3e.item-thiendia");this.elementGame=this.elementWrap.children(".item-content");this.elementQuy=this.elementGame.children(".quy-wrap");this.loader=new PIXI.loaders.Loader;this.app=new PIXI.Application(900,555,{view:canvasThiendia,transparent:true,resolution:1,roundPixels:true});if(window.thiendiaApp)window.thiendiaApp.destroy();window.thiendiaApp=this.app;this.containerWrap=new PIXI.Container;this.app.stage.addChild(this.containerWrap);this.session="";
this.cuoc={up:1,down:-1};this.betting=1E3;this.onOpen=false;this.onPhien=false;this.onSpin=false;this.timeForSpin=12E4;this.timeEf=1200;this.jackPots=[];this.history=[];this.playedX2=false;this.hasNhanBan=false;this.luckyNums=[];this.moneyTop=this.elementGame.children(".money-wrap").children(".money-top");this.moneyBottom=this.elementGame.children(".money-wrap").children(".money-bottom");this.moneyCr=this.elementGame.children(".money-wrap").children(".money-cr");this.initGame();var target=MyThienDia.getInstance();
target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(thiendiaCMD.REGISTER.toString(),this.onInfoResponse.bind(this),target);MiniGameClient.getInstance().addListener(thiendiaCMD.UPDATE_JACKPOT.toString(),this.onUpdateJackpot.bind(this),target);MiniGameClient.getInstance().addListener(thiendiaCMD.START_GAME.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(thiendiaCMD.SPIN.toString(),this._onupdateGame.bind(this),
target);MiniGameClient.getInstance().addListener(thiendiaCMD.STOP_SPIN.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(thiendiaCMD.X2.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(thiendiaCMD.NHANBAN.toString(),this._onupdateGame.bind(this),target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnect,target)}ThienDia.prototype._onReconnect=function(cmd,data){ThienDiaPlugin.getInstance().getInfo()};
ThienDia.prototype.onInfoResponse=function(cmd,data){console.log("onInfoResponse",data);if(data&&data[1]){if(data[1].tft)this.timeForSpin=data[1].tft;if(data[1].Js&&data[1].Js.length){this.setQuy(data[1].Js);this.jackPots=data[1].Js}if(data[1].ss){this.onPhien=true;this.onSpin=false;this.history=data[1].ss.seqs;this.setHistory();this.changeBetting(data[1].ss.b,false);this.setSession(data[1].ss.sid);this.moneyTop.html(MH.numToText(data[1].ss.up,1));this.moneyBottom.html(MH.numToText(data[1].ss.down,
1));this.moneyCr.html(MH.numToText(data[1].ss.cB,1));this.setCurrent(this.history[this.history.length-1],false);this.runClock(data[1].rmT);this.luckyNums=data[1].ss.mcs;this.luckyNums.push(data[1].ss.ln);this.renderLucky();this.btnPlaySpine.state.setAnimation(0,"Sau_bam",true);this.btnUp.removeClass("disabled");this.btnDown.removeClass("disabled");this.playedX2=data[1].ss.ud;if(!this.playedX2&&this.history.length>1)this.btnX2.removeClass("disabled");else this.btnX2.addClass("disabled");this.hasNhanBan=
data[1].ss.uc;if(!this.hasNhanBan&&this.history.length>1)this.btnNhanBan.removeClass("disabled");else this.btnNhanBan.addClass("disabled");if(this.history.length>1)this.btnDung.removeClass("disabled");else this.btnDung.addClass("disabled")}}};
ThienDia.prototype.setCurrent=function(){if(arguments.length==2&&arguments[1]==false)this.btnPlay.children().html('\x3cimg src\x3d"images/thiendia/res/'+arguments[0]+'.png"\x3e');else{var _html='\x3cdiv class\x3d"playinner"\x3e\x3cimg src\x3d"images/thiendia/res/'+arguments[0]+'.png"\x3e';for(var i=0;i<7;i++)_html+='\x3cimg src\x3d"images/thiendia/res/'+(Math.floor(Math.random()*18)+1)+'.png"\x3e';_html+="\x3c/div\x3e";this.btnPlay.html(_html)}};
ThienDia.prototype.renderLucky=function(){var _htmlRes="";if(this.luckyNums.length){for(var i=0;i<this.luckyNums.length;i++)if(this.luckyNums[i])if(this.history.indexOf(this.luckyNums[i])!=-1)_htmlRes+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/number/'+this.luckyNums[i]+'_2.png"\x3e\x3c/div\x3e';else _htmlRes+='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/number/'+this.luckyNums[i]+'.png"\x3e\x3c/div\x3e';if(this.luckyNums[4])this.locTroiSpine.state.setAnimation(0,
"Sau",true);else this.locTroiSpine.state.setAnimation(0,"Truoc",false)}else _htmlRes='\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/icon1.png"\x3e\x3c/div\x3e\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/icon2.png"\x3e\x3c/div\x3e\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/icon3.png"\x3e\x3c/div\x3e\x3cdiv class\x3d"item"\x3e\x3cimg src\x3d"images/thiendia/icon4.png"\x3e\x3c/div\x3e';this.elementGame.children(".items-wrap").html(_htmlRes)};
ThienDia.prototype.spinRes=function(obj){var thiz=this;if(obj.mgs){this.notify(arr.mgs);setTimeout(function(){thiz.resetGame()},3E3)}};
ThienDia.prototype._onupdateGame=function(cmd,data){if(!data||!data[1])return;var thiz=this;if(data[1].cmd){var thiz=this;switch(data[1].cmd){case thiendiaCMD.START_GAME:if(data[1].mgs){this.notify(data[1].mgs);setTimeout(function(){thiz.resetGame()},3E3);return}this.onPhien=true;this.setSession(data[1].sid);this.moneyTop.html(MH.numToText(data[1].up,1));this.moneyBottom.html(MH.numToText(data[1].down,1));this.moneyCr.html(MH.numToText(this.betting,1));this.setCurrent(data[1].n,false);this.history=
[data[1].n];this.setHistory();this.luckyNums=data[1].mcs;this.luckyNums.push(data[1].ln);this.renderLucky();if(this.luckyNums.length){var ef1=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/4_so_no_hu.json"].spineData);ef1.skeleton.setToSetupPose();ef1.state.setAnimation(0,"animation",false);ef1.x=638;ef1.y=300;var ef2=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/4_so_no_hu.json"].spineData);ef2.skeleton.setToSetupPose();ef2.state.setAnimation(0,"animation",
false);ef2.x=773;ef2.y=300;var ef3=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/4_so_no_hu.json"].spineData);ef3.skeleton.setToSetupPose();ef3.state.setAnimation(0,"animation",false);ef3.x=638;ef3.y=434;var ef4=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/4_so_no_hu.json"].spineData);ef4.skeleton.setToSetupPose();ef4.state.setAnimation(0,"animation",false);ef4.x=773;ef4.y=434;this.containerWrap.addChild(ef1,ef2,ef3,ef4);setTimeout(function(){thiz.containerWrap.removeChild(ef1,
ef2,ef3,ef4)},3E3)}this.runClock(this.timeForSpin);if(data[1].n&&data[1].n!=18)this.btnUp.removeClass("disabled");if(data[1].n&&data[1].n!=1)this.btnDown.removeClass("disabled");this.btnX2.addClass("disabled");this.btnDung.addClass("disabled");this.btnNhanBan.addClass("disabled");this.btnPlaySpine.state.setAnimation(0,"Sau_bam",true);LobbyRequest.getInstance().requestUpdateMoney();console.log("thiendiaCMD.START_GAME",data);break;case thiendiaCMD.SPIN:if(data[1].mgs){this.notify(data[1].mgs);setTimeout(function(){thiz.resetGame()},
3E3);return}this.onPhien=true;this.onSpin=true;if(data[1].iJ&&data[1].J)this.winner(data[1].J,"JACKPOT");if(data[1].lc)this.winner(data[1].lc,"LUCKY");if(data[1].n)this.setCurrent(data[1].n);this.btnUp.addClass("disabled");this.btnDown.addClass("disabled");this.btnX2.addClass("disabled");this.btnDung.addClass("disabled");this.btnNhanBan.addClass("disabled");setTimeout(function(){if(!data[1].iF){thiz.setSession(data[1].sid);thiz.moneyTop.html(MH.numToText(data[1].up,1));thiz.moneyBottom.html(MH.numToText(data[1].down,
1));thiz.moneyCr.html(MH.numToText(data[1].cB,1));if(data[1].seqs){thiz.history=data[1].seqs;thiz.setHistory()}thiz.renderLucky();thiz.runClock(thiz.timeForSpin-thiz.timeEf);if(data[1].pc)setTimeout(function(){var _cr=thiz.history[thiz.history.length-1];thiz.setCurrent(_cr,false);thiz.renderLucky();if(_cr&&_cr!=18)thiz.btnUp.removeClass("disabled");if(_cr&&_cr!=1)thiz.btnDown.removeClass("disabled")},2E3)}else{thiz.notify("B\u1ea1n \u0111\u00e3 thua. Ch\u00fac b\u1ea1n may m\u1eafn l\u01b0\u1ee3t sau");
setTimeout(function(){thiz.resetGame()},3500)}thiz.onSpin=false;if(data[1].n&&data[1].n!=18)thiz.btnUp.removeClass("disabled");if(data[1].n&&data[1].n!=1)thiz.btnDown.removeClass("disabled");if(thiz.history.length>1)thiz.btnDung.removeClass("disabled");if(!thiz.playedX2)thiz.btnX2.removeClass("disabled");if(!thiz.hasNhanBan)thiz.btnNhanBan.removeClass("disabled")},this.timeEf);console.log("thiendiaCMD.SPIN",data);break;case thiendiaCMD.STOP_SPIN:console.log("thiendiaCMD.STOP_SPIN",data);if(data[1]&&
data[1].mgs)this.notify(data[1].mgs);else if(data[1].pc){this.moneyTop.html(MH.numToText(data[1].up,1));this.moneyBottom.html(MH.numToText(data[1].down,1));this.moneyCr.html(MH.numToText(data[1].cB,1));if(data[1].seqs){this.history=data[1].seqs;this.setHistory()}this.stopClock();this.renderLucky();var _cr=this.history[this.history.length-1];if(_cr&&_cr!=18)this.btnUp.removeClass("disabled");if(_cr&&_cr!=1)this.btnDown.removeClass("disabled");this.setCurrent(_cr,false)}else{this.winner(data[1].crd);
this.onPhien=false;setTimeout(function(){thiz.resetGame()},3E3)}break;case thiendiaCMD.X2:console.log("thiendiaCMD.X2",data);if(data[1]&&data[1].mgs)this.notify(data[1].mgs);else{this.moneyTop.html(MH.numToText(data[1].up,1));this.moneyBottom.html(MH.numToText(data[1].down,1));this.moneyCr.html(MH.numToText(data[1].cB,1));this.playedX2=true;this.btnX2.addClass("disabled");this.btnDung.addClass("disabled");this.notify("X2 th\u00e0nh c\u00f4ng\x26nbsp;\x26nbsp; "+data[1].mX);LobbyRequest.getInstance().requestUpdateMoney()}break;
case thiendiaCMD.NHANBAN:if(data[1]&&data[1].mgs)this.notify(data[1].mgs);if(data[1].scc){this.hasNhanBan=true;this.btnNhanBan.addClass("disabled");this.notify("Nh\u00e2n b\u1ea3n th\u00e0nh c\u00f4ng\x26nbsp;\x26nbsp; "+data[1].mX);LobbyRequest.getInstance().requestUpdateMoney()}console.log("thiendiaCMD.NHANBAN",data);break}}};
ThienDia.prototype.winner=function(a,b){var thiz=this;var $elm=this.elementGame.children(".winner-money").show().children(".money").empty();var getNumberHtml=function(n){var _html="",_n=MH.numToText(n,1);var _arr=_n.split("");for(var j=0;j<_arr.length;j++)if(_arr[j]=="."||_arr[j]==",")_html+='\x3cdiv style\x3d"width: '+thiz.dataNumberHu["dot.png"].frame.w+"px;height: "+thiz.dataNumberHu["dot.png"].frame.h+"px;background-position: -"+thiz.dataNumberHu["dot.png"].frame.x+"px -"+thiz.dataNumberHu["dot.png"].frame.y+
'px;"\x3e\x3c/div\x3e';else _html+='\x3cdiv style\x3d"width: '+thiz.dataNumberHu[_arr[j]+".png"].frame.w+"px;height: "+thiz.dataNumberHu[_arr[j]+".png"].frame.h+"px;background-position: -"+thiz.dataNumberHu[_arr[j]+".png"].frame.x+"px -"+thiz.dataNumberHu[_arr[j]+".png"].frame.y+'px;"\x3e\x3c/div\x3e';return _html};if(a>100)MH.realtimeCount(a-100,a,$elm,1E3,function(n){$elm.html(getNumberHtml(n))},false);else $elm.html(getNumberHtml(a));if(b=="JACKPOT"){var efNohu=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/no_hu.json"].spineData);
efNohu.skeleton.setToSetupPose();efNohu.state.setAnimation(0,"Idle",true);efNohu.x=470;efNohu.y=474;this.elementGame.children(".canvas-wrap").addClass("showEff");this.containerWrap.addChild(efNohu);setTimeout(function(){thiz.elementGame.children(".canvas-wrap").removeClass("showEff");thiz.containerWrap.removeChild(efNohu);thiz.elementGame.children(".winner-money").hide().children(".money").empty()},5E3)}else if(b=="LUCKY"){var efLoctroi=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/nhan_loc_troi.json"].spineData);
efLoctroi.skeleton.setToSetupPose();efLoctroi.state.setAnimation(0,"xuat_hien",false);efLoctroi.state.addAnimation(0,"Ilde",true,0);efLoctroi.x=470;efLoctroi.y=474;this.elementGame.children(".canvas-wrap").addClass("showEff");this.containerWrap.addChild(efLoctroi);this.elementGame.children(".winner-money").show();setTimeout(function(){thiz.elementGame.children(".canvas-wrap").removeClass("showEff");thiz.containerWrap.removeChild(efLoctroi);thiz.elementGame.children(".winner-money").hide().children(".money").empty();
LobbyRequest.getInstance().requestUpdateMoney()},5E3)}else setTimeout(function(){thiz.elementGame.children(".winner-money").hide().children(".money").empty()},3E3)};ThienDia.prototype.setSession=function(){if(!arguments.length){this.elementGame.children(".session").empty();this.session=0;return}this.session=arguments[0];this.elementGame.children(".session").html("#"+this.session)};
ThienDia.prototype.getJackpot=function(){var bet,_arr;if(arguments.length>0)bet=arguments[0];else bet=this.betting;if(arguments.length>1)_arr=arguments[1];else _arr=this.jackPots;for(var i=_arr.length-1;i>=0;i--)if(_arr[i].b==bet)return _arr[i].J;return 0};
ThienDia.prototype.changeBetting=function(bet,check){if(check&&this.onPhien){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}else{var btncuocs=this.elementGame.find("\x3e.control\x3e.datcuoc-group\x3e.btn-datcuoc").removeClass("active");switch(bet){case 1E3:this.betting=bet;btncuocs.eq(0).addClass("active");break;case 1E4:this.betting=bet;btncuocs.eq(1).addClass("active");break;case 5E4:this.betting=bet;btncuocs.eq(2).addClass("active");break;case 1E5:this.betting=bet;btncuocs.eq(3).addClass("active");
break;case 5E5:this.betting=bet;btncuocs.eq(4).addClass("active");break}this.setQuy(true)}};
ThienDia.prototype.runClock=function(t){var thiz=this;var n=Math.floor(t/1E3);if(this.timerCtr)clearInterval(this.timerCtr);var clockFormat=function(k){var _minute="",_second="";if(k>=60){_minute=Math.floor(k/60);_second=k-_minute*60}else{_minute=0;_second=k}var _res="";_res+=_minute<10?"0"+_minute:_minute;_res+=":";_res+=_second<10?"0"+_second:_second;return _res};var $clock=this.elementGame.children(".timer");this.timerCtr=setInterval(function(){n=n-1;if(n<0)clearInterval(thiz.timerCtr);else $clock.html(clockFormat(n))},
1E3)};ThienDia.prototype.stopClock=function(t){if(!t)t=this.timeForSpin;var n=Math.floor(t/1E3);if(this.timerCtr)clearInterval(this.timerCtr);var clockFormat=function(k){var _minute="",_second="";if(k>=60){_minute=Math.floor(k/60);_second=k-_minute*60}else{_minute=0;_second=k}var _res="";_res+=_minute<10?"0"+_minute:_minute;_res+=":";_res+=_second<10?"0"+_second:_second;return _res};this.elementGame.children(".timer").html(clockFormat(n))};
ThienDia.prototype.setHistory=function(){var _arr=arguments.length?arguments[0]:this.history;var _html="";for(var i=0;i<_arr.length;i++)_html+=_arr[i]+"\x26nbsp;\x26nbsp;";if(!_html)_html="Nh\u1ea5n n\u00fat PLAY \u0111\u1ec3 b\u1eaft \u0111\u1ea7u";this.elementGame.children(".res-list").html(_html)};
ThienDia.prototype.setQuy=function(){var _arr,thiz=this;if(arguments.length&&typeof arguments[0]=="object")_arr=arguments[0];else _arr=this.jackPots;var _new=this.getJackpot(this.betting,_arr),_old=this.getJackpot();var getNumberHtml=function(n){var _html="",_n=MH.numToText(n,1);var _arr=_n.split("");for(var j=0;j<_arr.length;j++)if(_arr[j]=="."||_arr[j]==",")_html+='\x3cdiv style\x3d"width: '+thiz.dataNumberHu["dot.png"].frame.w+"px;height: "+thiz.dataNumberHu["dot.png"].frame.h+"px;background-position: -"+
thiz.dataNumberHu["dot.png"].frame.x+"px -"+thiz.dataNumberHu["dot.png"].frame.y+'px;"\x3e\x3c/div\x3e';else _html+='\x3cdiv style\x3d"width: '+thiz.dataNumberHu[_arr[j]+".png"].frame.w+"px;height: "+thiz.dataNumberHu[_arr[j]+".png"].frame.h+"px;background-position: -"+thiz.dataNumberHu[_arr[j]+".png"].frame.x+"px -"+thiz.dataNumberHu[_arr[j]+".png"].frame.y+'px;"\x3e\x3c/div\x3e';return _html};if(arguments.length&&typeof arguments[0]=="boolean"){this.elementQuy.html(getNumberHtml(_new));return}if(_old!=
_new)MH.realtimeCount(_old,_new,this.elementQuy,1E3,function(n){thiz.elementQuy.html(getNumberHtml(n))},false)};ThienDia.prototype.onUpdateJackpot=function(cmd,data){if(data&&data[1]&&data[1].Js&&data[1].Js.length){this.setQuy(data[1].Js);this.jackPots=data[1].Js}};
ThienDia.prototype.resetGame=function(){this.onPhien=false;this.onSpin=false;this.playedX2=false;this.hasNhanBan=false;this.history=[];this.luckyNums=[];this.setHistory();this.setSession();this.notify();this.renderLucky();this.btnUp.addClass("disabled");this.btnDown.addClass("disabled");this.btnX2.addClass("disabled");this.btnDung.addClass("disabled");this.btnNhanBan.addClass("disabled");this.btnPlay.children().empty();this.moneyTop.html("0");this.moneyBottom.html("0");this.moneyCr.html("0");this.btnPlaySpine.state.setAnimation(0,
"Truoc_bam",true);this.locTroiSpine.state.setAnimation(0,"Truoc",false);this.elementGame.children(".canvas-wrap").removeClass("showEff");this.elementGame.children(".winner-money").hide().children(".money").empty();this.stopClock();console.log("stop clock",this.timeForSpin);LobbyRequest.getInstance().requestUpdateMoney()};
ThienDia.prototype.notify=function(){var thiz=this;this.elementGame.children(".notify").remove();if(!arguments.length||!arguments[0])return;var $notify=jQuery('\x3cspan class\x3d"notify"\x3e'+arguments[0]+"\x3c/span\x3e");this.elementGame.append($notify);var _time=arguments.length==2?arguments[1]:2;setTimeout(function(){$notify.remove()},_time*1E3)};ThienDia.prototype.open=function(){this.onOpen=true;this.elementWrap.show();ThienDiaPlugin.getInstance().getInfo()};
ThienDia.prototype.close=function(){this.onOpen=false;this.elementWrap.hide()};
ThienDia.prototype.initButton=function(){var thiz=this;var btnPlaySpine=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/nut_play.json"].spineData);btnPlaySpine.skeleton.setToSetupPose();btnPlaySpine.state.setAnimation(0,"Truoc_bam",true);btnPlaySpine.x=230;btnPlaySpine.y=387;this.btnPlaySpine=btnPlaySpine;this.containerWrap.addChild(btnPlaySpine);var locTroiSpine=new PIXI.spine.Spine(this.loader.resources["images/thiendia/animation/Loc_troi.json"].spineData);locTroiSpine.skeleton.setToSetupPose();
locTroiSpine.state.setAnimation(0,"Truoc",true);locTroiSpine.x=710;locTroiSpine.y=415;this.locTroiSpine=locTroiSpine;this.containerWrap.addChild(locTroiSpine);var $control=this.elementGame.children(".control");this.btnUp=$control.find(".btn-up");this.btnUp.off("click").on("click",function(){if(jQuery(this).data("clicked"))return false;jQuery(this).data("clicked",true);setTimeout(function(){thiz.btnUp.data("clicked",false)},300);if($(this).hasClass("disabled"))return false;if(thiz.onPhien&&!thiz.onSpin)ThienDiaPlugin.getInstance().spin(thiz.cuoc.up,
thiz.session,thiz.betting);return false});this.btnDown=$control.find(".btn-down");this.btnDown.off("click").on("click",function(){if(jQuery(this).data("clicked"))return false;jQuery(this).data("clicked",true);setTimeout(function(){thiz.btnDown.data("clicked",false)},300);if($(this).hasClass("disabled"))return false;if(thiz.onPhien&&!thiz.onSpin)ThienDiaPlugin.getInstance().spin(thiz.cuoc.down,thiz.session,thiz.betting);return false});this.btnX2=$control.find(".btn-x2");this.btnX2.off("click").on("click",
function(){if(jQuery(this).data("clicked"))return false;jQuery(this).data("clicked",true);setTimeout(function(){thiz.btnX2.data("clicked",false)},300);if(thiz.onPhien&&!thiz.playedX2&&thiz.history.length>1)ThienDiaPlugin.getInstance().playX2(thiz.session);return false});this.btnNhanBan=$control.find(".btn-nhanban");this.btnNhanBan.off("click").on("click",function(){if(jQuery(this).data("clicked"))return false;jQuery(this).data("clicked",true);setTimeout(function(){thiz.btnNhanBan.data("clicked",false)},
300);if(thiz.onPhien&&!thiz.hasNhanBan&&thiz.history.length>1)ThienDiaPlugin.getInstance().nhanBan(thiz.session);return false});this.btnDung=$control.find(".btn-dung");this.btnDung.off("click").on("click",function(){if($(this).hasClass("disabled"))return false;if(thiz.onPhien&&thiz.history.length>1)ThienDiaPlugin.getInstance().stopGame(thiz.session);return false});this.btnPlay=$control.find(".btn-play");this.btnPlay.off("click").on("click",function(){if(jQuery(this).data("clicked"))return false;jQuery(this).data("clicked",
true);setTimeout(function(){thiz.btnPlay.data("clicked",false)},300);if(!thiz.onSpin&&!thiz.onPhien)ThienDiaPlugin.getInstance().startGame(thiz.betting);return false});var btnClose=$control.children(".btn-close");btnClose.off("click").on("click",function(){thiz.close();return false});$control.children(".btn-vinhdanh").off("click").on("click",function(){var $popup=$("#popup-minigameVinhdanh");if(!$popup.data("mhPopup"))return;MyRequest.minigameRequest({command:"fetchThiendiaSpinBoard",limit:50,skip:0,
assetId:1},function(cmd,data){var _html="";if(data.status==0&&data.data&&data.data.items&&data.data.items.length)for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"H:i")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].credit,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+
"\x3c/td\x3e";_html+="\x3c/tr\x3e"}$popup.find(".table-wrap tbody").html(_html);$popup.data("mhPopup").open("")});return false});$control.children(".btn-lichsu").off("click").on("click",function(){var $popup=$("#popup-lichsuThienDia");if(!$popup.data("mhPopup"))return;MyRequest.minigameRequest({command:"fetchThiendiaBettingHistory",limit:100,skip:0,assetId:1},function(cmd,data){var _html="";if(data&&data.status==0&&data.data&&data.data.items)for(var i=0;i<data.data.items.length;i++){var _luachon=
data.data.items[i].predictId;switch(_luachon){case -1:_luachon="D\u01b0\u1edbi ";break;case 0:_luachon="";break;case 1:_luachon="Tr\u00ean ";break}if(_luachon)_luachon+=data.data.items[i].currentBetting;_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"dd/mm H:i")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+_luachon+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].nextNumber+"\x3c/td\x3e";_html+="\x3ctd\x3e"+
MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].turn+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].credit,1)+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}$popup.find(".table-wrap tbody").html(_html);$popup.data("mhPopup").open("")});return false});$control.children(".btn-huongdan").off("click").on("click",function(){jQuery("#popup-luatchoiTHIENDIA").data("mhPopup").open();return false});this.elementGame.find("\x3e.control\x3e.datcuoc-group\x3e.btn-datcuoc").each(function(index){$(this).off("click").on("click",
function(){if(thiz.onPhien)thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else switch(index){case 0:thiz.changeBetting(1E3,true);break;case 1:thiz.changeBetting(1E4,true);break;case 2:thiz.changeBetting(5E4,true);break;case 3:thiz.changeBetting(1E5,true);break;case 4:thiz.changeBetting(5E5,true);break;default:break}return false})})};
ThienDia.prototype.initGame=function(){var thiz=this;this.notify("\u0110ang t\u1ea3i game ..",999);this.loader.add("images/thiendia/animation/nut_play.json").add("images/thiendia/animation/Loc_troi.json").add("images/thiendia/animation/4_so_no_hu.json").add("images/thiendia/animation/no_hu.json").add("images/thiendia/animation/nhan_loc_troi.json").load(function(loader,data){thiz.initButton();thiz.resetGame();thiz.elementWrap.addClass("on-open animated");thiz.open()});jQuery.getJSON("images/thiendia/hu/sprites.json",
function(data){thiz.dataNumberHu=data.frames});var _windowW=$("body").width(),_windowH=$("body").height();this.elementWrap.css({top:_windowH/2+"px",left:"550px"});this.elementWrap.draggable({drag:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_left<-270)ui.position.left=-270;if(_left>_windowW-150)ui.position.left=_windowW-150;if(_top<-210)ui.position.top=-210;if(_top>_windowH-150)ui.position.top=_windowH-150}});$(window).on("resize",function(){_windowW=$("body").width();_windowH=
$("body").height()});this.elementWrap.data("thiendia",this)};var MySieuXe=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var SieuXePreLoad={template:"template/mng-sieuxe.html",images:["images/sieuxe/bgmain11.png","images/sieuxe/nen.png","images/sieuxe/sieutoc.png","images/sieuxe/sieutoc2.png","images/sieuxe/tuquay.png","images/sieuxe/tuquay2.png","images/sieuxe/quay.png","images/sieuxe/icon/sprites.png"]};
function SieuXe(){this.gameName="SieuXe";this.gameId=SLOT_GAME_MINI.SIEUXE||0;this.timmer=new mhTimer;this.elementWrap=$(SieuXePreLoad.template).appendTo("body");this.elementQuy=this.elementWrap.find("#quy-number");this.elementGame=this.elementWrap.children(".item-content");this.elementFreeSpin=this.elementWrap.find(".free-spin");this.drawLineWrap=this.elementWrap.find(".draw-lines");this.app=new PIXI.Application(655,353,{view:canvasSieuxe,transparent:true,resolution:1,roundPixels:true});this.app.stop();
this.containerItem=new PIXI.Container;this.containerItem2=new MaskLayer(cc.rect(-50,-20,228,263));this.containerItem.position.set(65,5);this.containerItem2.position.set(510,100);window.containerItem2=this.containerItem2;this.totalIcon=20;this.totalIcon2=20;this.itemHeight=115;this.itemHeight2=80;this.tweenY=(this.totalIcon-3)*this.itemHeight;this.tweenY2=(this.totalIcon2-3)*this.itemHeight2;this.tweenTime=1.5;this.delayLine=.1;this.columns=[];this.colsBlur=[];this.colsItems=[[],[],[],[],[]];this.lines=
[];this.openEffect="";this.autoSpin=false;this.onSpin=false;this.onOpen=false;this.moneyType=MoneyType.Gold;this.spinFast=false;this.timeMoneyEf=3500;this.timeLineEf=500;this.betting=100;this.elementSuKien=this.elementWrap.children(".sukien");this.onSuKien=false;var target=MySieuXe.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_SLOT_MACHINE.JACKPOT.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnectGame,target);MiniGameClient.getInstance().addListener(kCMD.OBSERVER_RESPONSE,this._onObserverResponse,target);this.initGame()}SieuXe.prototype.setQuy=function(n){var _old=this.elementQuy.data("num")||0;this.elementQuy.data("num",n);if(!this.onOpen){this.elementQuy.html(MH.numToText(n,1));return}MH.realtimeCount(_old,n,this.elementQuy,1E3)};
SieuXe.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(data[1].gid!=thiz.gameId)return;switch(parseInt(cmd)){case CMD_SLOT_MACHINE.JACKPOT:switch(thiz.betting){case 100:thiz.setQuy(data[1].Js[0].J);break;case 1E3:thiz.setQuy(data[1].Js[1].J);break;case 1E4:thiz.setQuy(data[1].Js[2].J);break;default:thiz.betting=100;thiz.setQuy(data[1].Js[0].J);break}if(thiz.autoSpin&&!thiz.onSpin)thiz.timmer.setTimeout(function(){if(thiz.autoSpin&&!thiz.onSpin)thiz.sendRequestSpin()},2E3);
if(data[1].event&&data[1].event.bs&&data[1].event.bs.length){var _html="";var _xMax=0;for(var i=0;i<data[1].event.bs.length;i++){_html+='\x3cdiv class\x3d"item"\x3e\x3cspan class\x3d"sk-cuoc"\x3e'+MH.numToText(data[1].event.bs[i].b,0)+'\x3c/span\x3e\x3cspan class\x3d"sk-hu"\x3e'+data[1].event.bs[i].rjc+"\x3c/span\x3e\x3c/div\x3e";if(data[1].event.bs[i].mtp&&data[1].event.bs[i].mtp>_xMax)_xMax=data[1].event.bs[i].mtp}thiz.elementSuKien.attr("data-type",_xMax).html(_html);if(!thiz.onSuKien){thiz.onSuKien=
true;thiz.elementSuKien.show();thiz.elementSuKien.off("click").on("click",function(){var $popup=$("#popup-webView");$popup.find(".popup-content").html('\x3ciframe src\x3d"http://admin.dev.apislotvip.info/tabsgame/?app\x3devent_slotvip\x26gameId\x3d'+thiz.gameId+'"\x3e\x3c/iframe\x3e');$popup.data("mhPopup").open();return false})}}else if(thiz.onSuKien){thiz.onSuKien=false;thiz.elementSuKien.hide()}break;case CMD_SLOT_MACHINE.SPIN:console.log("SieuXe spin",data[1]);thiz.spinStart(data[1]);break;default:break}};
SieuXe.prototype._onReconnectGame=function(){if(SHOW_LOG)console.log("_onReconnectGame TPS");var thiz=this.currentTarget;MiniGameClient.getInstance().observerByGameID(thiz.gameId)};SieuXe.prototype._onRoomPluginMsg=function(cmd,data){if(SHOW_LOG)console.log("this");if(SHOW_LOG)console.log(this)};
SieuXe.prototype._onObserverResponse=function(cmd,data){var thiz=this.currentTarget;var data=MiniGameClient.getInstance().getObserverDataByGameId(thiz.gameId);if(data&&data.fss&&data.fss.length){for(var i=0;i<data.fss.length;i++)if(data.fss[i].aid==thiz.moneyType&&data.fss[i].b==thiz.betting){thiz.hasFreeSpin(data.fss[i].fs);break}MiniGameClient.getInstance().resetObserverDataByGameId(thiz.gameId)}};
SieuXe.prototype.eventTDV=function(){return false;var thiz=this;var $elmSK=this.elementWrap.children(".event-baidep");MH.sukien.getInfo(function(obj){if(obj&&obj.UAMSCollectJackpot2&&obj.UAMSCollectJackpot2.data&&obj.UAMSCollectJackpot2.data.ae){thiz.elementWrap.find(".text-top img").attr("src","images/minigame/sukien/text_tps.png").off().on("click",function(){var $popup=$("#popup-thanhDaoVang");if($popup.data("mhPopup"))$popup.data("mhPopup").open("");return false});if(obj.UAMSCollectJackpot2.data.evtHs){var evtHs=
obj.UAMSCollectJackpot2.data.evtHs;var _now=(new Date).getTime();for(var i=0;i<evtHs.length;i++)if(_now<evtHs[i].from){runClock(evtHs[i].from,$elmSK.find(".timer-next"));$elmSK.show().children(".wrap1").hide();$elmSK.children(".wrap2").show();break}else if(_now>=evtHs[i].from&&_now<=evtHs[i].to){getYourRank();runClock(evtHs[i].to,$elmSK.find(".timer-cr"));$elmSK.show().children(".wrap1").show();$elmSK.children(".wrap2").hide();break}else if(i==evtHs.length-1)$elmSK.hide()}}else{$elmSK.hide();thiz.elementWrap.find(".text-top img").attr("src",
"images/minigame/text_tps.png").off()}});function getYourRank(){MH.sukien.getTop(function(obj){var _point=0,_xh="_";if(obj&&obj.UAMSCollectJackpot2&&obj.UAMSCollectJackpot2.data&&obj.UAMSCollectJackpot2.data.user){if(obj.UAMSCollectJackpot2.data.user.userRank>0)_xh=obj.UAMSCollectJackpot2.data.user.userRank;if(obj.UAMSCollectJackpot2.data.user.count)_point=obj.UAMSCollectJackpot2.data.user.count}$elmSK.find(".point").html(_point);$elmSK.find(".xephang").html(_xh)})}function runClock(to,element){thiz.timmer.clearInterval(element.data("timer"));
var _now=(new Date).getTime();if(_now>=to){element.html("00:00");return}var convertTime=function(t){if(t<0)return"00:00";var result="";var hour=Math.floor(t/1E3/60/60),minute=Math.floor(t/1E3/60-hour*60),second=Math.floor(t/1E3-hour*3600-minute*60);if(hour<10)hour="0"+hour;result=hour+":";if(minute<10)minute="0"+minute;result+=minute+":";if(second<10)second="0"+second;result+=second;return result};element.html(convertTime(to-_now));var _clock=thiz.timmer.setInterval(function(){_now+=1E3;if(_now>=
to)thiz.timmer.clearInterval(_clock);else element.html(convertTime(to-_now))},1E3);element.data("timer",_clock)}};SieuXe.prototype.removeDrawLine=function(){this.timmer.clearInterval(this.drawLineWrap.data("interval"));this.drawLineWrap.empty()};
SieuXe.prototype.drawLines=function(arr,eff,callback){console.log("SieuXe.prototype.drawLines",arr);var thiz=this;var delayCallback=this.spinFast?100:500;this.timmer.clearInterval(thiz.drawLineWrap.data("interval"));this.drawLineWrap.empty();if(!eff){this.drawLineWrap.html(this.linesImg(arr));if(callback&&typeof callback==="function")this.timmer.setTimeout(function(){callback()},delayCallback)}else{var i=0;var interval=this.timmer.setInterval(function(){if(i<arr.length){thiz.drawLineWrap.append(thiz.linesImg(arr[i]));
if(i===arr.length-1&&callback&&typeof callback==="function")thiz.timmer.setTimeout(function(){callback()},delayCallback);i++}else thiz.timmer.clearInterval(thiz.drawLineWrap.data("interval"))},thiz.timeLineEf);thiz.drawLineWrap.data("interval",interval);if(!arr.length&&callback&&typeof callback==="function")callback()}};
SieuXe.prototype.linesImg=function(data){var _html="";if(typeof data==="object")for(var i=0;i<data.length;i++)_html+='\x3cimg src\x3d"images/sieuxe/line/line'+(data[i]+1)+'.png"\x3e';else _html+='\x3cimg src\x3d"images/sieuxe/line/line'+(data+1)+'.png"\x3e';return _html};
SieuXe.prototype.winner=function(){var thiz=this;var wrap=this.elementWrap.children(".item-content");wrap.children(".effect").remove();var n=this.slotData.mX,type=this.slotData.iJ;console.log("winner",this.slotData);if(n==0){thiz.removeDrawLine();thiz.handleSpinDone()}else{var _class="effect";if(type)_class+=" nohu";wrap.append('\x3cdiv class\x3d"'+_class+'"\x3e\x3cspan class\x3d"money"\x3e+'+MH.numToText(n,1)+"\x3c/span\x3e\x3c/div\x3e");this.timmer.setTimeout(function(){wrap.children(".effect").remove();
thiz.handleSpinDone();thiz.removeDrawLine()},thiz.timeMoneyEf)}};SieuXe.prototype.addLine=function(n){if(this.onSpin||this.autoSpin)return;if(this.lines.indexOf(n)===-1)this.lines.push(n)};SieuXe.prototype.removeLine=function(n){if(this.onSpin||this.autoSpin)return;var index=this.lines.indexOf(n);if(index>-1)this.lines.splice(index,1)};
SieuXe.prototype.notify=function(s,t){var thiz=this;this.elementGame.children(".notify").remove();if(s==="")return;if("undefined"==typeof t)t=3E3;var $notify=$('\x3cdiv class\x3d"notify" style\x3d"display:block;"\x3e'+s+"\x3c/div\x3e");this.elementGame.append($notify);this.timmer.setTimeout(function(){$notify.remove()},t)};
SieuXe.prototype.sendRequestSpin=function(){var thiz=this;if(this.lines.length==0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.changeAutoSpin(false);return}var sendObj=[command.ZonePluginMessage,Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.SPIN,"gid":thiz.gameId,"aid":thiz.moneyType,"ls":thiz.lines,"b":thiz.betting}];MiniGameClient.getInstance().send(sendObj);console.log("send spin",sendObj)};
SieuXe.prototype.spinStart=function(data){var thiz=this;if(this.onSpin)return;if(this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");this.changeAutoSpin(false);this.handleSpinDone();return}if(data.mgs){this.notify(data.mgs);this.changeAutoSpin(false);this.handleSpinDone();return}if(!data||!data.hasOwnProperty("sbs")||data.sbs.length!=15){this.changeAutoSpin(false);this.handleSpinDone();return}this.onSpin=true;this.slotData=data;this.btnSpin.addClass("on-click disable");this.timmer.setTimeout(function(){thiz.btnSpin.removeClass("on-click")},
300);this.elementWrap.find(".effect").remove();this.runSpin()};
SieuXe.prototype.runSpin=function(){var thiz=this;var isStopped=false;var playOneting=function(){};var cb=function(){if(isStopped)return;for(var i=0;i<5;i++)TweenLite.killTweensOf(thiz.columns[i].position);thiz.setItems();isStopped=true;thiz.timmer.setTimeout(function(){thiz.spinStop()},300)};var timeSpinLine=this.spinFast?.3:thiz.tweenTime;for(var i=0;i<5;i++)(function(i){thiz.colsItems[i][0].visible=true;thiz.colsItems[i][1].visible=true;thiz.colsItems[i][2].visible=true;thiz.colsBlur[i].visible=
true;thiz.setSpriteIcon(thiz.colsItems[i][2],thiz.slotData.sbs[0+i]);thiz.setSpriteIcon(thiz.colsItems[i][1],thiz.slotData.sbs[5+i]);thiz.setSpriteIcon(thiz.colsItems[i][0],thiz.slotData.sbs[10+i]);var obj={y:0,delay:i*thiz.delayLine,ease:Power1.easeInOut};var thisColTime=timeSpinLine;if(i===4)obj.onComplete=cb;if(!thiz.spinFast)if(i===3||i===4){thisColTime+=.5;if(i===4)thisColTime+=1}if(thiz.slotData.wls&&thiz.slotData.wls.length)if(i===2)obj.onComplete=function(){var arr=[];for(var i=0;i<thiz.slotData.wls.length;i++)arr.push(thiz.slotData.wls[i].lid);
thiz.drawLines(arr,true)};var tl=TweenLite.to(thiz.columns[i].position,thisColTime,obj);thiz.timmer.setTimeout(function(){if(thiz.winHidden){tl.kill();if(i===4&&!isStopped)cb()}},thisColTime*1E3)})(i)};SieuXe.prototype.spinStop=function(data){this.winner();this.hasFreeSpin()};SieuXe.prototype.handleSpinDone=function(){this.onSpin=false;this.removeDrawLine();LobbyRequest.getInstance().requestUpdateMoney();if(this.autoSpin)this.sendRequestSpin();else this.elementWrap.find(".btn-spin, .btn-chooseLine").removeClass("disable")};
SieuXe.prototype.setItems=function(){for(var i=0;i<5;i++){var px3=this.colsItems[i][this.totalIcon-3].px,py3=this.colsItems[i][this.totalIcon-3].py,localRect3={x:0,y:0},newItem3;this.colsItems[i][this.totalIcon-3].destroy();if(this.itemLibs.hasOwnProperty("icon"+this.slotData.sbs[10+i])){newItem3=new PIXI.spine.Spine(this.itemLibs["icon"+this.slotData.sbs[10+i]].spineData);newItem3.skeleton.setToSetupPose();newItem3.state.setAnimation(0,"Idle",true);localRect3=newItem3.getLocalBounds()}else newItem3=
new PIXI.Sprite(this.itemLibs.icons.textures["icon"+this.slotData.sbs[10+i]+".png"]);newItem3.px=px3;newItem3.py=py3;newItem3.x=newItem3.px-newItem3.width/2-localRect3.x;newItem3.y=newItem3.py-newItem3.height/2-localRect3.y;this.colsItems[i][this.totalIcon-3]=newItem3;this.columns[i].addChild(newItem3);var px2=this.colsItems[i][this.totalIcon-2].px,py2=this.colsItems[i][this.totalIcon-2].py,localRect2={x:0,y:0},newItem2;this.colsItems[i][this.totalIcon-2].destroy();if(this.itemLibs.hasOwnProperty("icon"+
this.slotData.sbs[5+i])){newItem2=new PIXI.spine.Spine(this.itemLibs["icon"+this.slotData.sbs[5+i]].spineData);newItem2.skeleton.setToSetupPose();newItem2.state.setAnimation(0,"Idle",true);localRect2=newItem2.getLocalBounds()}else newItem2=new PIXI.Sprite(this.itemLibs.icons.textures["icon"+this.slotData.sbs[5+i]+".png"]);newItem2.px=px2;newItem2.py=py2;newItem2.x=newItem2.px-newItem2.width/2-localRect2.x;newItem2.y=newItem2.py-newItem2.height/2-localRect2.y;this.colsItems[i][this.totalIcon-2]=newItem2;
this.columns[i].addChild(newItem2);var px1=this.colsItems[i][this.totalIcon-1].px,py1=this.colsItems[i][this.totalIcon-1].py,localRect1={x:0,y:0},newItem1;this.colsItems[i][this.totalIcon-1].destroy();if(this.itemLibs.hasOwnProperty("icon"+this.slotData.sbs[0+i])){newItem1=new PIXI.spine.Spine(this.itemLibs["icon"+this.slotData.sbs[0+i]].spineData);newItem1.skeleton.setToSetupPose();newItem1.state.setAnimation(0,"Idle",true);localRect1=newItem1.getLocalBounds()}else newItem1=new PIXI.Sprite(this.itemLibs.icons.textures["icon"+
this.slotData.sbs[0+i]+".png"]);newItem1.px=px1;newItem1.py=py1;newItem1.x=newItem1.px-newItem1.width/2-localRect1.x;newItem1.y=newItem1.py-newItem1.height/2-localRect1.y;this.colsItems[i][this.totalIcon-1]=newItem1;this.columns[i].addChild(newItem1);if(i==3||i==4)this.columns[i].y=-this.tweenY2;else this.columns[i].y=-this.tweenY;this.colsItems[i][0].visible=false;this.colsItems[i][1].visible=false;this.colsItems[i][2].visible=false;this.colsBlur[i].visible=false}};
SieuXe.prototype.setSpriteIcon=function(sprite,icon){sprite.texture=this.itemLibs.icons.textures["icon"+icon+".png"]};
SieuXe.prototype.changeAutoSpin=function(s){if(s==undefined)s=!this.autoSpin;if(s&&this.lines.length===0){this.notify("Ch\u01b0a ch\u1ecdn d\u00f2ng");s=false}if(s&&!this.onSpin)this.sendRequestSpin();if(!s&&!this.onSpin)this.elementWrap.find(".btn-chooseLine, .btn-spin").removeClass("disable");this.autoSpin=s;if(s)this.elementWrap.find(".btn-autoSpin").addClass("active");else this.elementWrap.find(".btn-autoSpin").removeClass("active");console.log("this.autoSpin",s)};
SieuXe.prototype.hasFreeSpin=function(){var n=0;if(this.slotData&&this.slotData.fss)n=this.slotData.fss;if(n){this.elementFreeSpin.children("span").html(n);this.elementFreeSpin.show()}else this.elementFreeSpin.hide()};
SieuXe.prototype.initButton=function(){var thiz=this;this.elementWrap.find('input[name\x3d"money-type"]').prop("checked",true).prop("disabled",true);this.elementWrap.find(".btn-vinhdanh").off().on("click",function(){var $popup=$("#popup-minigameVinhdanh");$popup.find("tbody").html("");var _html="";MyRequest.fetchTopSlotMachine(thiz.gameId,function(cmd,obj){if(obj.status==0&&obj.data.items.length){var _len=obj.data.items.length;for(var i=0;i<_len;i++)if(obj.data.items[i].assetId==MoneyType.Gold){_html+=
"\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(obj.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].betting+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(obj.data.items[i].money,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+obj.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}}$popup.find("tbody").html(_html)});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-lichsu").off().on("click",
function(){var $popup=$("#popup-lichsuSieuXe");$popup.find(".table-wrap tbody").empty();$popup.find(".wrap-lsphien").hide();var _page=1,_rowPerPage=50,_total=0,_type=MoneyType.Gold,hisItems=[];var getPage=function(n,moneyType){if(n<=0)return;_page=n;$popup.find(".page-control .page-name").html(_page);if(_page<=1)$popup.find(".page-control .btn-prev").addClass("disable");else $popup.find(".page-control .btn-prev").removeClass("disable");MyRequest.fetchSlotMachineHistory(thiz.gameId,moneyType,_rowPerPage,
(n-1)*_rowPerPage,function(cmd,data){console.log(data);var _html="";_total=data.data.count;if(SHOW_LOG)console.log(_total);if(data.data&&data.data.items.length){for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].totalBet,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].money,
1)+"\x3c/td\x3e";_html+='\x3ctd\x3e\x3cbutton class\x3d"btn-chitiet" data-id\x3d"'+i+'"\x3eChi ti\u1ebft\x3c/button\x3e\x3c/td\x3e';_html+="\x3c/tr\x3e"}hisItems=data.data.items}$popup.find(".table-wrap tbody").html(_html);$popup.find(".table-inner").scrollTop(0);if(_page*_rowPerPage>=_total)$popup.find(".page-control .btn-next").addClass("disable");else $popup.find(".page-control .btn-next").removeClass("disable")})};getPage(1,_type);$popup.find(".page-control .btn-next").off().on("click",function(){if($(this).hasClass("disable"))return;
getPage(_page+1,_type);return false});$popup.find(".page-control .btn-prev").off().on("click",function(){if($(this).hasClass("disable"))return;getPage(_page-1,_type);return false});$popup.find(".table-wrap").off("click").on("click",".btn-chitiet",function(){var _id=$(this).attr("data-id");var obj=hisItems[parseInt(_id)];var $wrap=$popup.find(".wrap-lsphien");$wrap.children(".session").html("#"+obj.sessionId);var _htmlIcons="";for(var i=0;i<obj.symbols.length;i++){var thisIcon=thiz.itemLibs.icons.data.frames["icon"+
obj.symbols[i]+".png"].frame;_htmlIcons+='\x3cdiv\x3e\x3cdiv style\x3d"background-position:-'+thisIcon.x+"px -"+thisIcon.y+"px; width: "+thisIcon.w+"px; height: "+thisIcon.h+'px;"\x3e\x3c/div\x3e\x3c/div\x3e'}$wrap.children(".icons").html(_htmlIcons);var _htmlLines="";for(var i=0;i<obj.payoutLines.length;i++)_htmlLines+='\x3cimg src\x3d"images/sieuxe/line/line'+(obj.payoutLines[i].id+1)+'.png"\x3e';$wrap.children(".lines").html(_htmlLines);$wrap.children(".tongthang").children(".moneywin").html(MH.numToText(obj.money,
1));$wrap.show();return false});$popup.find(".btn-closeLSP").off("click").on("click",function(){$popup.find(".wrap-lsphien").hide();return false});$popup.data("mhPopup").open("");return false});this.elementWrap.find(".btn-huongdan").off().on("click",function(){$("#popup-luatchoiSIEUXE").data("mhPopup").open("");return false});this.elementWrap.find(".btn-datcuoc").each(function(index){$(this).off().on("click",function(){var $that=$(this);if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");
else{switch(index){case 0:thiz.betting=100;break;case 1:thiz.betting=1E3;break;case 2:thiz.betting=1E4;break;default:thiz.betting=thiz.betting||100;break}$that.addClass("active").siblings(".btn-datcuoc").removeClass("active")}return false})});this.elementWrap.find(".btn-autoSpin").off().on("click",function(){var $that=$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);thiz.changeAutoSpin();return false});this.elementWrap.find(".btn-speed").off().on("click",
function(){var $that=$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);thiz.spinFast=!thiz.spinFast;if(thiz.spinFast)$that.addClass("active");else $that.removeClass("active");return false});this.elementWrap.find(".btn-lineNum").off().on("mouseenter",function(){if(!thiz.onSpin&&!thiz.autoSpin){var _i=$(this).index();thiz.drawLine(_i)}}).on("mouseleave",function(){if(!thiz.onSpin)thiz.timmer.setTimeout(function(){thiz.removeDrawLine()},10)}).on("click",
function(){if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else{var $that=$(this);var _index=$that.index();if($that.hasClass("active"))thiz.removeLine(_index);else thiz.addLine(_index)}return false});this.elementWrap.find(".btn-chooseLine").off().on("click",function(){var $that=$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);if(thiz.onSpin||thiz.autoSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else thiz.timmer.setTimeout(function(){thiz.elementWrap.find(".popup-chondong").show()},
500);return false});this.elementWrap.find(".close-chondong").off().on("click",function(){thiz.elementWrap.find(".popup-chondong").hide();return false});this.elementWrap.find(".list-dong .item").off().on("click",function(){var $that=$(this);var _index=$that.index();if($that.hasClass("active"))thiz.removeLine(_index);else thiz.addLine(_index);return false});this.elementWrap.find(".btn-dongChan").off().on("click",function(){for(var i=0;i<20;i++)if(i%2===0)thiz.removeLine(i);else thiz.addLine(i);return false});
this.elementWrap.find(".btn-dongLe").off().on("click",function(){for(var i=0;i<20;i++)if(i%2===0)thiz.addLine(i);else thiz.removeLine(i);return false});this.elementWrap.find(".btn-dongAll").off().on("click",function(){for(var i=0;i<20;i++)thiz.addLine(i);return false});this.elementWrap.find(".btn-dongNone").off().on("click",function(){for(var i=0;i<20;i++)thiz.removeLine(i);return false});var btnSpin=this.elementWrap.find(".btn-spin").off().on("click",function(){if(thiz.onSpin||thiz.autoSpin){var $that=
$(this);$that.addClass("on-click");thiz.timmer.setTimeout(function(){$that.removeClass("on-click")},300);thiz.notify("\u0110ang quay, xin ch\u1edd")}else thiz.sendRequestSpin();return false});this.elementWrap.find(".close-minigame").off().on("click",function(){if(thiz.autoSpin)thiz.close();else thiz.destroyGame();return false});this.btnSpin=btnSpin;this.elementWrap.children(".event-baidep").off().on("click",function(){var $popup=$("#popup-thanhDaoVang");if($popup.data("mhPopup"))$popup.data("mhPopup").open("");
return false})};SieuXe.prototype.open=function(){this.onOpen=true;this.elementWrap.show();MiniGameClient.getInstance().observerByGameID(this.gameId);this.eventTDV()};SieuXe.prototype.close=function(){this.onOpen=false;this.elementWrap.hide()};
SieuXe.prototype.createSlotGame=function(loader,resources){console.log("createSlotGame",resources);var thiz=this;this.colsItems=[];var createItem=function(obj){var item;var localRect={x:0,y:0};if(obj._index>=thiz.totalIcon-3&&resources.hasOwnProperty("icon"+obj.id)){item=new PIXI.spine.Spine(resources["icon"+obj.id].spineData);item.skeleton.setToSetupPose();localRect=item.getLocalBounds();item.state.setAnimation(0,"Idle",true)}else item=new PIXI.Sprite(resources.icons.textures["icon"+obj.id+".png"]);
item.px=obj.x||0;item.py=obj.y||0;item.x=item.px-item.width/2-localRect.x;item.y=item.py-item.height/2-localRect.y;if(obj.visible===false)item.visible=false;if(0&&obj.blur){var ft=new PIXI.filters.BlurFilter;ft.blurX=0;ft.blurY=1.5;item.filters=[ft]}return item};var scr1=[0,1,2,3,7,8,0,1,2,3,7,8,0,1,2,3,7,8];for(var i=0;i<3;i++){this.columns[i]=new PIXI.Container;this.colsBlur[i]=new PIXI.Container;this.colsItems[i]=[];for(var j=0;j<this.totalIcon;j++){var item=createItem({id:scr1[Math.floor(Math.random()*
scr1.length)],blur:j>=3&&j<thiz.totalIcon-3?true:false,x:0,y:j*thiz.itemHeight+thiz.itemHeight/2,visible:j<3?false:true,_index:j});if(j>=3&&j<thiz.totalIcon-3)this.colsBlur[i].addChild(item);else this.columns[i].addChild(item);this.colsItems[i].push(item)}this.columns[i].position.set(i*130,-this.tweenY);this.columns[i].addChild(this.colsBlur[i]);this.containerItem.addChild(this.columns[i]);(function(i){thiz.timmer.setTimeout(function(){thiz.colsBlur[i].visible=false;thiz.colsBlur[i].cacheAsBitmap=
true},150)})(i)}var scr2=[4,5,6,8,4,5,6,8,4,5,6,8];for(var i=3;i<5;i++){this.columns[i]=new PIXI.Container;this.colsBlur[i]=new PIXI.Container;this.colsItems[i]=[];for(var j=0;j<this.totalIcon;j++){var item=createItem({id:scr2[Math.floor(Math.random()*scr2.length)],blur:j>=3&&j<thiz.totalIcon2-3?true:false,x:0,y:j*thiz.itemHeight2+thiz.itemHeight2/2,visible:j<3?false:true});if(j>=3&&j<thiz.totalIcon-3)this.colsBlur[i].addChild(item);else this.columns[i].addChild(item);this.colsItems[i].push(item)}this.columns[i].position.set((i-
3)*100,-this.tweenY2);this.columns[i].addChild(this.colsBlur[i]);this.containerItem2.addChild(this.columns[i]);(function(i){thiz.timmer.setTimeout(function(){thiz.colsBlur[i].visible=false;thiz.colsBlur[i].cacheAsBitmap=true},150)})(i)}this.app.stage.addChild(this.containerItem,this.containerItem2);this.app.start()};
SieuXe.prototype.initGame=function(){var thiz=this;this.elementWrap.addClass("success");this.notify("\u0110ang t\u1ea3i game ..",8E4);this.removeDrawLine();this.drawLineWrap.removeClass("hide");var loader=new PIXI.loaders.Loader;loader.add("icons","images/sieuxe/icon/sprites.json").load(function(loader,data){thiz.createSlotGame(loader,data);thiz.notify("");thiz.initButton();thiz.itemLibs=data});this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<
-410*MH.scale)_top=-410*MH.scale;else if(_top>(window.innerHeight+40)*MH.scale)_top=(window.innerHeight+40)*MH.scale;if(_left<-680*MH.scale)_left=-680*MH.scale;else if(_left>window.innerWidth*MH.scale)_left=window.innerWidth*MH.scale;ui.helper.animate({top:_top,left:_left},300)}});for(var i=0;i<27;i++)this.addLine(i);var hidden,visibilityChange;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";
visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}if(typeof document.addEventListener==="undefined"||hidden===undefined)thiz.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.");else document.addEventListener(visibilityChange,function(){if(document[hidden])thiz.winHidden=true;else thiz.winHidden=false},false);var sendObj=[command.ZonePluginMessage,
Constant.CONSTANT.ZONE_NAME_MINI_GAME,miniGamePlugin.PLUGIN_SLOT_GAME,{"cmd":CMD_SLOT_MACHINE.AUTOSPIN_OFF,"gid":thiz.gameId}];MiniGameClient.getInstance().send(sendObj);this.elementWrap.addClass("on-open animated "+this.openEffect);this.open()};
SieuXe.prototype.destroyGame=function(){MiniGameClient.getInstance().removeObserverByGameID(this.gameId);var target=MySieuXe.getInstance();MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.app.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var MyBauCua=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var BauCuaPreLoad={template:"template/mng-baucua.html",images:["images/minigame/baucua/bkg.png","images/minigame/baucua/efect.png","images/minigame/baucua/font/count.png","images/minigame/baucua/doicau.png","images/minigame/baucua/ic_cua.png","images/minigame/baucua/ic_ca.png","images/minigame/baucua/ic_tom.png","images/minigame/baucua/ic_bau.png","images/minigame/baucua/ic_huu.png","images/minigame/baucua/ic-ga.png"]};
function BauCua(){this.gameName="BauCua";this.elementWrap=$(BauCuaPreLoad.template).appendTo("body");this.clockS=this.elementWrap.find(".clockS");this.clockB=this.elementWrap.find(".clockB");this.diaXucXac=this.elementWrap.children().children(".dice");this.his=[];this.sId=0;this.rId=0;this.timmer=new mhTimer;this.fontCount=null;this.enableBet=true;this.betting={sId:0,bts:[0,0,0,0,0,0],rId:0};this.betSuccess={sId:0,bts:[0,0,0,0,0,0],rId:0};this.stepBet={step:[],act:0};this.timeXX=1800;this.timeBet=
6E4;this.timeEndBet=5E3;this.timeTurn=2E4;this.initButton();this.initGame();var target=MyBauCua.getInstance();target.currentTarget=this;MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(baucuaCMD.REGISTER.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.BEGIN_GAME.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.ACCEPT_BET.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.END_GAME.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.RESULT_GAME.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.BET_AGAIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.DOUBLE_BET.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.GET_TOP.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(baucuaCMD.GET_HISTORY.toString(),this._onupdateGame,
target);MiniGameClient.getInstance().addListener(baucuaCMD.UPDATE_JACKPOT.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnect,target)}
BauCua.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(!data||!data[1])return;switch(parseInt(cmd)){case baucuaCMD.REGISTER:if(data[1].hr&&data[1].hr.length)thiz.his=data[1].hr;if(data[1].sId)thiz.setSession(data[1].sId);if(data[1].rMT)if(data[1].gs==1)thiz.runClock(data[1].rMT);else thiz.runClockS(data[1].rMT);if(data[1].tFB)thiz.timeBet=data[1].tFB;if(data[1].tfc)thiz.timeTurn=data[1].tfc;if(data[1].tfD)thiz.timeEndBet=data[1].tfD;if(data[1].rrI){var cuocArr=data[1].rrI;
cuocArr.sort(function(a,b){return a-b});thiz.elementWrap.find(".datcuoc-group .btn-datcuoc").each(function(index){if(cuocArr[index])$(this).data("num",cuocArr[index])})}if(data[1].bsI){var betArr=data[1].bsI;betArr.sort(function(a,b){return a-b});thiz.stepBet.step=betArr;thiz.elementWrap.find(".muccuoc-group .btn-muccuoc").each(function(index){if(betArr[index])$(this).html(MH.numToText(betArr[index],0)).data("num",betArr[index]);if(thiz.stepBet.act==index)$(this).addClass("active");else $(this).removeClass("active")})}if(data[1].bts&&
data[1].bts&&data[1].bts[0]){thiz.betting.bts[0,0,0,0,0,0];thiz.betSuccess.rId=data[1].bts[0].rId;thiz.betSuccess.sId=thiz.sId;for(var i=0;i<data[1].bts[0].bts.length;i++){if(!data[1].bts[0].bts[i].uBM)data[1].bts[0].bts[i].uBM=0;thiz.betSuccess.bts[data[1].bts[0].bts[i].did-1]=data[1].bts[0].bts[i].uBM||0}if(data[1].bts[0].bts)thiz.buildBanCuoc(data[1].bts[0].bts);if(data[1].bts[0].rId)thiz.changeRoom(data[1].bts[0].rId)}thiz.drawHis();if(data[1].gs==1){thiz.enableBet=true;thiz.diaXucXac.attr("class",
"dice")}else thiz.disableBet();thiz.elementWrap.find(".cuadat .item").removeClass("match");break;case baucuaCMD.BEGIN_GAME:console.log("begin game","enableBet");if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.BEGIN_GAME");thiz.diaXucXac.attr("class","dice");thiz.runClock(thiz.timeBet);if(data[1].sId)thiz.setSession(data[1].sId);thiz.resetBet();thiz.enableBet=true;thiz.elementWrap.find(".cuadat .item").removeClass("match");break;case baucuaCMD.ACCEPT_BET:if(SHOW_LOG)console.log(data);
if(SHOW_LOG)console.log("baucuaCMD.ACCEPT_BET");if(data[1].bts&&data[1].bts[0]&&data[1].bts[0].bts){thiz.buildBanCuoc(data[1].bts[0].bts);for(var i=0;i<data[1].bts[0].bts.length;i++)thiz.betSuccess.bts[data[1].bts[0].bts[i].did-1]=data[1].bts[0].bts[i].uBM||0;thiz.betSuccess.rId=thiz.rId;thiz.betSuccess.sId=thiz.sId;thiz.notify("\u0110\u1eb7t c\u01b0\u1ee3c th\u00e0nh c\u00f4ng",3E3)}var err=BauCuaPlugin.getInstance().checkError(data[1]);if(err[0]){thiz.notify(err[1],3E3);var arrBet=[];for(var i=
0;i<thiz.betSuccess.bts.length;i++)arrBet.push({uBM:thiz.betSuccess.bts[i],did:i+1});thiz.buildBanCuoc(arrBet)}thiz.betting.bts=[0,0,0,0,0,0];break;case baucuaCMD.END_GAME:if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.END_GAME");if(data[1].exM)thiz.timmer.setTimeout(function(){thiz.winner(data[1].exM)},thiz.timeXX+500);thiz.buildBanCuoc(thiz.betSuccess.bts);break;case baucuaCMD.RESULT_GAME:if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.RESULT_GAME");thiz.tungXucXac(data[1].skR);
thiz.timmer.setTimeout(function(){thiz.runClockS(thiz.timeTurn-5E3)},5E3);break;case baucuaCMD.BET_AGAIN:if(SHOW_LOG)console.log(data[1]);if(SHOW_LOG)console.log("baucuaCMD.BET_AGAIN");var err=BauCuaPlugin.getInstance().checkError(data[1]);if(err[0])thiz.notify(err[1],3E3);else if(data[1].bts){for(var i=0;i<data[1].bts.length;i++)if(data[1].bts[i].uBM==undefined)data[1].bts[i].uBM=data[1].bts[i].bM;thiz.buildBanCuoc(data[1].bts);for(var i=0;i<data[1].bts.length;i++)thiz.betting.bts[data[1].bts[i].did-
1]=data[1].bts[i].uBM||0;thiz.betting.rId=thiz.rId;thiz.betting.sId=thiz.sId;thiz.notify("\u1ea4n \u0111\u1ed3ng \u00fd \u0111\u1ec3 ho\u00e0n t\u1ea5t",3E3)}break;case baucuaCMD.DOUBLE_BET:if(SHOW_LOG)console.log(data[1]);if(SHOW_LOG)console.log("baucuaCMD.DOUBLE_BET");var err=BauCuaPlugin.getInstance().checkError(data[1]);if(err[0])thiz.notify(err[1],3E3);else if(data[1].bts){for(var i=0;i<data[1].bts.length;i++)if(data[1].bts[i].uBM==undefined)data[1].bts[i].uBM=data[1].bts[i].bM;thiz.buildBanCuoc(data[1].bts);
for(var i=0;i<data[1].bts.length;i++)thiz.betting.bts[data[1].bts[i].did-1]=data[1].bts[i].uBM||0;thiz.betting.rId=thiz.rId;thiz.betting.sId=thiz.sId;thiz.notify("\u1ea4n \u0111\u1ed3ng \u00fd \u0111\u1ec3 ho\u00e0n t\u1ea5t",3E3)}break;case baucuaCMD.GET_TOP:if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.GET_TOP");if(data[1].t){var _html="";for(var i=0;i<data[1].t.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+(i+1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data[1].t[i].dn+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+MH.numToText(data[1].t[i].m,1)+"\x3c/td\x3e";_html+="\x3c/tr\x3e";if(i>50)break}var $popup=$("#popup-xephangBauCua");$popup.find(".table-wrap tbody").html(_html);if($popup.data("mhPopup"))$popup.data("mhPopup").open("")}break;case baucuaCMD.GET_HISTORY:if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.GET_HISTORY");if(data[1].hr){var _html="";for(var i=0;i<data[1].hr.length;i++){var _name=[];if(data[1].hr[i].rs)for(var j=0;j<data[1].hr[i].rs.length;j++)if(data[1].hr[i].rs[j]==
1)_name.push("G\u00e0");else if(data[1].hr[i].rs[j]==2)_name.push("C\u00e1");else if(data[1].hr[i].rs[j]==3)_name.push("T\u00f4m");else if(data[1].hr[i].rs[j]==4)_name.push("Cua");else if(data[1].hr[i].rs[j]==5)_name.push("B\u1ea7u");else if(data[1].hr[i].rs[j]==6)_name.push("H\u01b0\u01a1u");_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data[1].hr[i].sId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data[1].hr[i].tmp)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data[1].hr[i].rId,0)+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+_name.join(", ")+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data[1].hr[i].tbt,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data[1].hr[i].wM,1)+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}var $popup=$("#popup-lichsuBauCua");$popup.find(".table-wrap tbody").html(_html);if($popup.data("mhPopup"))$popup.data("mhPopup").open("")}break;case baucuaCMD.UPDATE_JACKPOT:if(SHOW_LOG)console.log(data);if(SHOW_LOG)console.log("baucuaCMD.UPDATE_JACKPOT");if(data[1].bts&&data[1].bts.length)for(var i=
0;i<data[1].bts.length;i++)if(data[1].bts[i].rId==thiz.rId){thiz.buildBanCuoc(data[1].bts[i].if);break}break}};BauCua.prototype._onReconnect=function(cmd,data){var thiz=this.currentTarget;BauCuaPlugin.getInstance().register(thiz.rId)};
BauCua.prototype.notify=function(string,_time){if(_time===undefined)_time=1E3;var $wrap=this.elementWrap.children(".item-content");$wrap.children(".info").remove();var $notify=$('\x3cdiv class\x3d"info" style\x3d"display:block;"\x3e'+string+"\x3c/div\x3e");$wrap.append($notify);this.timmer.setTimeout(function(){$notify.remove()},_time)};
BauCua.prototype.resetBet=function(){this.betting.sId=this.sId;this.betting.bts=[0,0,0,0,0,0];this.betting.rId=this.rId;this.betSuccess.sId=this.sId;this.betSuccess.bts=[0,0,0,0,0,0];this.betSuccess.rId=this.rId;this.elementWrap.find(".cuadat .y-cuoc").html("0");this.elementWrap.find(".cuadat .t-cuoc").html("0")};
BauCua.prototype.disableBet=function(){console.log("BauCua.prototype.disableBet");this.enableBet=false;this.betting.bts=[0,0,0,0,0,0];this.betting.rId=this.rId;this.betting.sId=this.sId;var arrBet=[];for(var i=0;i<this.betSuccess.bts.length;i++)arrBet.push({uBM:this.betSuccess.bts[i],did:i+1});this.buildBanCuoc(arrBet)};
BauCua.prototype.drawHis=function(other){if(SHOW_LOG)console.log("drawHis");var $wrap=this.elementWrap.find(".cau-wrap\x3e.cau-outer");var _type=$wrap.data("type")||false;if(other){_type=!_type;$wrap.data("type",_type)}var _html="";if(!_type)for(var i=0;i<this.his.length;i++){for(var j=0;j<this.his[i].length;j++)_html+='\x3cdiv class\x3d"item item-'+this.his[i][j]+'"\x3e\x3c/div\x3e';if(i>50)break}else{var arr=[0,0,0,0,0,0];for(var i=0;i<this.his.length;i++)for(var j=0;j<this.his[i].length;j++){var _id=
this.his[i][j];arr[_id-1]+=1}for(var i=0;i<arr.length;i++)_html+='\x3cdiv class\x3d"item item-'+(i+1)+'"\x3e\x3c/div\x3e\x3cspan\x3e'+arr[i]+"\x3c/span\x3e"}_html='\x3cdiv class\x3d"cau-inner"\x3e'+_html+"\x3c/div\x3e";$wrap.html(_html)};
BauCua.prototype.buildBanCuoc=function(arr){if(SHOW_LOG)console.log("buildBanCuoc");if(SHOW_LOG)console.log(arr);this.elementWrap.find(".cuadat .item").each(function(){var $that=$(this),_thisId=$that.data("id")||0;for(var i=0;i<arr.length;i++)if(_thisId==arr[i].did){if(arr[i].tbt!=undefined)$that.children(".t-cuoc").html(MH.numToText(arr[i].tbt));if(arr[i].uBM!=undefined)$that.children(".y-cuoc").html(MH.numToText(arr[i].uBM))}})};
BauCua.prototype.winner=function(money){var thiz=this;var $wrap=this.elementWrap.children(".item-content");$wrap.children(".winner-effect").remove();var _effect='\x3cdiv class\x3d"winner-effect"\x3e\x3cspan\x3e+'+MH.numToText(money,1)+"\x3c/span\x3e\x3c/div\x3e";$wrap.append(_effect);this.timmer.setTimeout(function(){$wrap.children(".winner-effect").remove()},3E3)};
BauCua.prototype.runClockS=function(t){var thiz=this;var n=Math.floor(t/1E3);if(n<=0)return;var clockFormat=function(k){var _minute=Math.floor(k/60),_second=Math.floor(k-_minute*60);var _res=_minute<10?"0"+_minute:_minute;_res+=":";_res+=_second<10?"0"+_second:_second;return _res};this.clockS.show().html(clockFormat(n));this.timmer.clearInterval(this.timerCtr);this.timerCtr=this.timmer.setInterval(function(){n=n-1;if(n<0)thiz.timmer.clearInterval(thiz.timerCtr);else thiz.clockS.html(clockFormat(n))},
1E3)};
BauCua.prototype.runClock=function(t){var thiz=this;var n=Math.floor(t/1E3);if(n<=0)return;this.clockB.show();this.clockS.hide();this.timmer.clearInterval(this.timerCtr2);var _old1=0,_old2=0;this.timerCtr2=this.timmer.setInterval(function(){n=n-1;if(n<0)thiz.timmer.clearInterval(thiz.timerCtr2);else{var n1=0,n2=0;if(n>=10)n1=Math.floor(n/10);n2=n-n1*10;var _class1=' class\x3d"mht"',_class2=' class\x3d"mht"';if(_old1==n1)_class1="";if(_old2==n2)_class2="";_old1=n1;_old2=n2;thiz.clockB.html("\x3cdiv"+_class1+
' style\x3d"background-position: -'+thiz.fontCount[n1]["x"]+"px -"+thiz.fontCount[n1]["y"]+"px; width: "+thiz.fontCount[n1]["width"]+"px; height: "+thiz.fontCount[n1]["height"]+'px;"\x3e\x3c/div\x3e\x3cdiv'+_class2+' style\x3d"background-position: -'+thiz.fontCount[n2]["x"]+"px -"+thiz.fontCount[n2]["y"]+"px; width: "+thiz.fontCount[n2]["width"]+"px; height: "+thiz.fontCount[n2]["height"]+'px;"\x3e\x3c/div\x3e');if(thiz.enableBet&&n<=thiz.timeEndBet/1E3){thiz.disableBet();thiz.clockB.addClass("alert")}}},
1E3)};BauCua.prototype.changeRoom=function(num){this.rId=num;this.elementWrap.find(".datcuoc-group .btn-datcuoc").each(function(){if($(this).data("num")==num)$(this).addClass("active");else $(this).removeClass("active")});this.betting.bts=[0,0,0,0,0,0];this.betting.rId=this.rId;this.betting.sId=this.sId};
BauCua.prototype.tungXucXac=function(arr){var thiz=this;if(arr&&arr.length)for(var i=0;i<arr.length;i++)if(arr[i].rId==this.rId){var kq=arr[i].did;var _dice="dice"+kq.join("");this.diaXucXac.attr("class","dice run "+_dice);this.his.unshift(kq);this.clockB.hide();this.timmer.setTimeout(function(){thiz.drawHis();thiz.diaXucXac.removeClass("run").addClass("finish");thiz.elementWrap.find(".cuadat .item").each(function(){var _id=$(this).data("id")||0;if(kq.indexOf(_id)!=-1)$(this).addClass("match");else $(this).removeClass("match")});
LobbyRequest.getInstance().requestUpdateMoney()},this.timeXX+200);break}};BauCua.prototype.setSession=function(sid){this.sId=sid;this.elementWrap.find(".phien").html("#"+sid)};
BauCua.prototype.initButton=function(){var thiz=this;this.elementWrap.find(".btn-closeGame").off().on("click",function(){thiz.destroyGame();return false});this.elementWrap.find(".datcuoc-group .btn-datcuoc").off().on("click",function(){var num=$(this).data("num")||0;if(thiz.hasBet())thiz.notify("B\u1ea1n \u0111ang \u0111\u1eb7t \u1edf ph\u00f2ng "+MH.numToText(thiz.rId));else BauCuaPlugin.getInstance().register(num);return false});this.elementWrap.find(".cuadat .item").each(function(){var id=$(this).attr("data-cid");
$(this).data("id",parseInt(id)).removeAttr("data-cid")});this.elementWrap.find(".cuadat .item").off().on("click","img",function(){if(!thiz.enableBet){thiz.notify("H\u1ebft gi\u1edd \u0111\u1eb7t c\u01b0\u1ee3c",3E3);return false}var _id=$(this).parent().data("id")||0;var _step=thiz.stepBet.step[thiz.stepBet.act];var _old=0,_cr=0,_new=0;if(thiz.rId==thiz.betSuccess.rId&&thiz.sId==thiz.betSuccess.sId)_cr=thiz.betSuccess.bts[_id-1]||0;if(thiz.rId==thiz.betting.rId&&thiz.sId==thiz.betting.sId)_old=thiz.betting.bts[_id-
1]||0;else{thiz.betting.rId=thiz.rId;thiz.betting.sId=thiz.sId;thiz.betting.bts=[0,0,0,0,0,0]}_new=_old+_step;thiz.betting.bts[_id-1]=_new;$(this).siblings(".y-cuoc").html(MH.numToText(_new+_cr));thiz.notify("\u1ea4n \u0111\u1ed3ng \u00fd \u0111\u1ec3 ho\u00e0n t\u1ea5t",5E3);return false});this.elementWrap.find(".muccuoc-group .btn-muccuoc").off().on("click",function(){var _money=$(this).data("num"),_index=thiz.stepBet.step.indexOf(_money);thiz.stepBet.act=_index;$(this).addClass("active").siblings("button").removeClass("active");
return false});this.elementWrap.find(".control .btn-datlai").off().on("click",function(){if(!thiz.enableBet)thiz.notify("H\u1ebft th\u1eddi gian \u0111\u1eb7t c\u01b0\u1ee3c",3E3);else if(thiz.hasBet())thiz.notify("\u0110\u00e3 \u0111\u1eb7t c\u01b0\u1ee3c kh\u00f4ng th\u1ec3 \u0111\u1eb7t l\u1ea1i",3E3);else BauCuaPlugin.getInstance().betAgain(thiz.rId);return false});this.elementWrap.find(".control .btn-gapthep").off().on("click",function(){if(!thiz.enableBet)thiz.notify("H\u1ebft th\u1eddi gian \u0111\u1eb7t c\u01b0\u1ee3c",
3E3);else if(thiz.hasBet())thiz.notify("\u0110\u00e3 \u0111\u1eb7t c\u01b0\u1ee3c kh\u00f4ng th\u1ec3 g\u1ea5p th\u1ebfp",3E3);else BauCuaPlugin.getInstance().doubleBet(thiz.rId);return false});this.elementWrap.find(".control .btn-xoa").off().on("click",function(){thiz.betting.bts=[0,0,0,0,0,0];thiz.betting.rId=thiz.rId;thiz.betting.sId=thiz.sId;var arrBet=[];for(var i=0;i<thiz.betSuccess.bts.length;i++)arrBet.push({uBM:thiz.betSuccess.bts[i],did:i+1});thiz.buildBanCuoc(arrBet);return false});this.elementWrap.find(".control .btn-xacnhan").off().on("click",
function(){if(thiz.enableBet){var arrBet=[];for(var i=0;i<thiz.betting.bts.length;i++)if(thiz.betting.bts[i])arrBet.push({did:i+1,bM:thiz.betting.bts[i]});if(arrBet.length)BauCuaPlugin.getInstance().acceptBet(thiz.rId,arrBet);else thiz.notify("Ch\u01b0a ch\u1ecdn c\u1eeda",3E3)}else thiz.notify("H\u1ebft th\u1eddi gian \u0111\u1eb7t c\u01b0\u1ee3c",3E3);return false});this.elementWrap.find(".control .btn-doicau").off().on("click",function(){thiz.drawHis(true);return false});this.elementWrap.find(".control .btn-vinhdanh").off().on("click",
function(){BauCuaPlugin.getInstance().getTop();return false});this.elementWrap.find(".control .btn-lichsu").off().on("click",function(){BauCuaPlugin.getInstance().getHistory(100,0);return false});this.elementWrap.find(".control .btn-huongdan").off().on("click",function(){return false});this.elementWrap.find(".cau-wrap\x3e.cau-outer").perfectScrollbar()};
BauCua.prototype.hasBet=function(){var _hasBet=false;if(this.betSuccess.sId==this.sId&&this.betSuccess.rId==this.rId)for(var i=0;i<this.betSuccess.bts.length;i++)if(this.betSuccess.bts[i]!=0){_hasBet=true;break}return _hasBet};BauCua.prototype.open=function(){this.onOpen=true;this.elementWrap.show();BauCuaPlugin.getInstance().register()};BauCua.prototype.close=function(){this.onOpen=false;this.elementWrap.hide();BauCuaPlugin.getInstance().unRegister()};
BauCua.prototype.initGame=function(){var thiz=this;this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<-540*MH.scale)_top=-540*MH.scale;else if(_top>(window.innerHeight-70)*MH.scale)_top=(window.innerHeight-70)*MH.scale;if(_left<-900*MH.scale)_left=-900*MH.scale;else if(_left>(window.innerWidth-60)*MH.scale)_left=(window.innerWidth-60)*MH.scale;ui.helper.animate({top:_top,left:_left},300)}});$.getJSON("images/minigame/baucua/font/count.json",
function(data){thiz.fontCount=data;thiz.open()});this.elementWrap.addClass("on-open animated")};BauCua.prototype.destroyGame=function(){var target=MyBauCua.getInstance();MiniGameClient.getInstance().removeListener(target);BauCuaPlugin.getInstance().unRegister();this.timmer.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var MyCaoThap=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
var CaoThapPreLoad={template:"template/mng-caothap.html",images:["images/minigame/caothap/bg.png","images/minigame/caothap/btn_luotmoi.png","images/minigame/caothap/btn_play.png","res/tq_card.png","images/minigame/caothap/up_select.png","images/minigame/caothap/down_select.png"]};
function CaoThap(){this.gameName="CaoThap";this.elementWrap=$(CaoThapPreLoad.template).appendTo("body");this.elementQuy=this.elementWrap.find(".quy-wrap .quy-number");this.timmer=new mhTimer;this.betting=1E3;this.session="";this.cuoc={up:1,down:-1};this.cardLibs={};this.timeEf=1500;this.onSpin=false;this.onPhien=false;this.countA=0;this.countSpin=0;this.timeForSpin=12E4;this.lastJackPot=[];this.initButton();this.initGame();this.resetGame();var target=MyCaoThap.getInstance();target.currentTarget=this;
MiniGameClient.getInstance().removeListener(target);MiniGameClient.getInstance().addListener(caothapCMD.GET_INFO.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(caothapCMD.START_GAME.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(caothapCMD.SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(caothapCMD.STOP_SPIN.toString(),this._onupdateGame,target);MiniGameClient.getInstance().addListener(caothapCMD.UPDATE_JACKPOT.toString(),
this._onupdateGame,target);MiniGameClient.getInstance().addListener(CMD_OBSERVER.OBSERVER_SLOT_RECONNECT,this._onReconnect,target)}
CaoThap.prototype._onupdateGame=function(cmd,data){var thiz=this.currentTarget;if(!data||!data[1])return;if(data[1].cmd)switch(data[1].cmd){case caothapCMD.GET_INFO:if(SHOW_LOG)console.log(data);if(data[1].ss&&data[1].ss.items&&data[1].ss.items.length){console.log("cao thap phien cu",data);thiz.onPhien=true;thiz.setSession(data[1].ss.sid);thiz.onSpin=false;thiz.countSpin=data[1].ss.items.length;if(data[1].up)thiz.elementWrap.find(".money-wrap .money-top").html(MH.numToText(data[1].up,1));if(data[1].ss.crd)thiz.elementWrap.find(".money-wrap .money-cr").html(MH.numToText(data[1].ss.crd,
1));if(data[1].down)thiz.elementWrap.find(".money-wrap .money-bottom").html(MH.numToText(data[1].down,1));thiz.elementWrap.find(".btn-group button").removeClass("disabled");thiz.elementWrap.find(".btn-start").hide();var card=Utils.getCardFromServer(data[1].ss.items[data[1].ss.items.length-1]),_cardName=card.toString;thiz.elementWrap.find(".card-wrap .card").attr("style","background-position:-"+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+"px").removeClass("run");
if(data[1].rmT)thiz.runClock(data[1].rmT);thiz.elementWrap.find(".res-list").html("");thiz.countA=0;for(var i=0;i<data[1].ss.items.length;i++){thiz.addHis(data[1].ss.items[i]);if(data[1].ss.items[i]>=0&&data[1].ss.items[i]<=3)thiz.countA+=1}thiz.elementWrap.find(".a-list").attr("data-num",thiz.countA);if(data[1].ss.b)thiz.changeBetting(data[1].ss.b)}else thiz.resetGame();if(data[1].rmT)thiz.timeForSpin=data[1].rmT;if(data[1].Js&&data[1].Js.length)thiz.lastJackPot=data[1].Js;thiz.setQuy();break;case caothapCMD.UPDATE_JACKPOT:if(data[1].Js&&
data[1].Js.length){thiz.lastJackPot=data[1].Js;thiz.setQuy()}break;case caothapCMD.START_GAME:thiz.onPhien=true;thiz.setSession(data[1].sid);thiz.spinRes(data[1]);LobbyRequest.getInstance().requestUpdateMoney();if(SHOW_LOG)console.log("caothapCMD.START_GAME");if(SHOW_LOG)console.log(data);break;case caothapCMD.SPIN:thiz.spinRes(data[1]);if(SHOW_LOG)console.log("caothapCMD.SPIN");if(SHOW_LOG)console.log(data);break;case caothapCMD.STOP_SPIN:if(SHOW_LOG)console.log("caothapCMD.STOP_SPIN");if(SHOW_LOG)console.log(data[1]);
thiz.winner(data[1].crd);thiz.elementWrap.find(".res-list").html("\x3cp\x3e#"+thiz.session+" b\u1ea1n \u0111\u00e3 th\u1eafng "+data[1].crd+" V\u00e0ng\x3c/p\x3e");thiz.resetGame();break;default:break}};
CaoThap.prototype.eventBaiDep=function(type){return;var thiz=this;var _now=(new Date).getTime();var _url="http://v2.api1bai247.info/campaign/uams/res";var $elementSK=this.elementWrap.find(".event-baidep");if(!this.evtHs||!this.evtHs.length||_now+5E3>this.evtHs[this.evtHs.length-1].to){$elementSK.hide();return}function getYourCards(){MH.sukien.caothap.getYourCards(function(obj){var _hang="",_cards="";if(obj&&obj.userRank>-1)_hang="H\u1ea1ng "+obj.userRank;else _hang="H\u1ea1ng __";if(obj&&obj.cards&&
obj.cards.length){var cards=obj.cards;for(var i=0;i<cards.length;i++){var card=Utils.getCardFromServer(cards[i]),_cardName=card.toString;if(thiz.cardLibs&&thiz.cardLibs.hasOwnProperty(_cardName+".png"))_cards+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+'px;"\x3e\x3c/div\x3e\x3c/div\x3e'}}else if(thiz.cardLibs&&thiz.cardLibs.hasOwnProperty("card_face_down.png"))for(var i=
0;i<5;i++)_cards+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs["card_face_down.png"].frame.x+"px -"+thiz.cardLibs["card_face_down.png"].frame.y+'px;"\x3e\x3c/div\x3e\x3c/div\x3e';else for(var i=0;i<5;i++)_cards+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position: -670px -884px;"\x3e\x3c/div\x3e\x3c/div\x3e';$elementSK.find(".xephang").html(_hang);$elementSK.find(".card-list").html(_cards)})}if(type){getYourCards();
return}$elementSK.show();function runClock(to,element){thiz.timmer.clearInterval(element.data("timer"));var _now=(new Date).getTime();if(_now>=to){element.html("00:00");return}var convertTime=function(t){if(t<0)return"00:00";var result="";var hour=Math.floor(t/1E3/60/60),minute=Math.floor(t/1E3/60-hour*60),second=Math.floor(t/1E3-hour*3600-minute*60);if(hour<10)hour="0"+hour;result=hour+":";if(minute<10)minute="0"+minute;result+=minute+":";if(second<10)second="0"+second;result+=second;return result};
element.html(convertTime(to-_now));var _clock=thiz.timmer.setInterval(function(){_now+=1E3;if(_now>=to){thiz.eventBaiDep();thiz.timmer.clearInterval(_clock)}else element.html(convertTime(to-_now))},1E3);element.data("timer",_clock)}for(var i=0;i<this.evtHs.length;i++)if(_now<=this.evtHs[i].from){$elementSK.children(".wrap1").hide();$elementSK.children(".wrap2").show();runClock(this.evtHs[i].from,$elementSK.find(".timer-next"));break}else if(_now<this.evtHs[i].to-5E3){$elementSK.children(".wrap1").show();
$elementSK.children(".wrap2").hide();runClock(this.evtHs[i].to,$elementSK.find(".timer-cr"));getYourCards();break}};CaoThap.prototype._onReconnect=function(cmd,data){CaoThapPlugin.getInstance().getInfo()};CaoThap.prototype.setQuy=function(n){var _old=this.elementQuy.data("num")||0;if(n==undefined){var n=0;for(var i=0;i<this.lastJackPot.length;i++)if(this.lastJackPot[i].b==this.betting){n=this.lastJackPot[i].J;break}}this.elementQuy.data("num",n);MH.realtimeCount(_old,n,this.elementQuy,1E3)};
CaoThap.prototype.changeBetting=function(bet,check){if(check&&this.onPhien){this.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");return}else{switch(bet){case 1E3:this.betting=bet;this.elementWrap.find(".btn-datcuoc:eq(0)").addClass("active").siblings(".btn-datcuoc").removeClass("active");break;case 1E4:this.betting=bet;this.elementWrap.find(".btn-datcuoc:eq(1)").addClass("active").siblings(".btn-datcuoc").removeClass("active");break;case 5E4:this.betting=bet;this.elementWrap.find(".btn-datcuoc:eq(2)").addClass("active").siblings(".btn-datcuoc").removeClass("active");
break;case 1E5:this.betting=bet;this.elementWrap.find(".btn-datcuoc:eq(3)").addClass("active").siblings(".btn-datcuoc").removeClass("active");break;case 5E5:this.betting=bet;this.elementWrap.find(".btn-datcuoc:eq(4)").addClass("active").siblings(".btn-datcuoc").removeClass("active");break}this.setQuy()}};
CaoThap.prototype.runClock=function(t){var thiz=this;var n=Math.floor(t/1E3);this.timmer.clearInterval(this.timerCtr);var clockFormat=function(k){var _minute="",_second="";if(k>=60){_minute=Math.floor(k/60);_second=k-_minute*60}else{_minute=0;_second=k}var _res="";_res+=_minute<10?"0"+_minute:_minute;_res+=":";_res+=_second<10?"0"+_second:_second;return _res};var $clock=this.elementWrap.find(".timmer");this.timerCtr=this.timmer.setInterval(function(){n=n-1;if(n<0)thiz.timmer.clearInterval(thiz.timerCtr);
else $clock.html(clockFormat(n))},1E3)};CaoThap.prototype.stopClock=function(t){if(!t)t=this.timeForSpin;var n=Math.floor(t/1E3);this.timmer.clearInterval(this.timerCtr);var clockFormat=function(k){var _minute="",_second="";if(k>=60){_minute=Math.floor(k/60);_second=k-_minute*60}else{_minute=0;_second=k}var _res="";_res+=_minute<10?"0"+_minute:_minute;_res+=":";_res+=_second<10?"0"+_second:_second;return _res};this.elementWrap.find(".timmer").html(clockFormat(n))};
CaoThap.prototype.initButton=function(){var thiz=this;this.elementWrap.find(".btn-datcuoc").each(function(index){$(this).off().on("click",function(){if(thiz.onPhien)thiz.notify("Ch\u01b0a k\u1ebft th\u00fac phi\u00ean");else{switch(index){case 0:thiz.changeBetting(1E3,true);break;case 1:thiz.changeBetting(1E4,true);break;case 2:thiz.changeBetting(5E4,true);break;case 3:thiz.changeBetting(1E5,true);break;case 4:thiz.changeBetting(5E5,true);break;default:break}thiz.elementWrap.find(".money-cr").html(MH.numToText(thiz.betting,
1))}return false})});this.elementWrap.find(".close-minigame").off().on("click",function(){if(thiz.onPhien)thiz.close();else thiz.destroyGame();return false});this.elementWrap.find(".btn-start").off().on("click",function(){CaoThapPlugin.getInstance().startGame(thiz.betting);return false});this.elementWrap.find(".btn-group .btn-up").off().on("click",function(){if($(this).hasClass("disabled"))return false;if(!thiz.onSpin&&thiz.countSpin)CaoThapPlugin.getInstance().spin(thiz.cuoc.up,thiz.session,thiz.betting);
if(!thiz.countSpin)thiz.notify("Click PLAY \u0111\u1ec3 b\u1eaft \u0111\u1ea7u");return false});this.elementWrap.find(".btn-group .btn-down").off().on("click",function(){if($(this).hasClass("disabled"))return false;if(!thiz.onSpin&&thiz.countSpin)CaoThapPlugin.getInstance().spin(thiz.cuoc.down,thiz.session,thiz.betting);if(!thiz.countSpin)thiz.notify("Click PLAY \u0111\u1ec3 b\u1eaft \u0111\u1ea7u");return false});this.elementWrap.find(".btn-group .btn-luotmoi").off().on("click",function(){if(!thiz.countSpin)thiz.notify("Click PLAY \u0111\u1ec3 b\u1eaft \u0111\u1ea7u");
else if(thiz.onSpin)thiz.notify("\u0110ang quay, xin ch\u1edd");else if(thiz.countSpin>=2)CaoThapPlugin.getInstance().stopGame(thiz.session);return false});this.elementWrap.find(".control .btn-vinhdanh").off().on("click",function(){MyRequest.fetchSpinBoard(20,0,function(cmd,data){if(data.status==0&&data.data&&data.data.items&&data.data.items.length){var _html="";for(var i=0;i<data.data.items.length;i++){_html+="\x3ctr\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime,"H:i")+"\x3c/td\x3e";
_html+="\x3ctd\x3e"+data.data.items[i].displayName+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].credit,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].description+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}var $popup=$("#popup-minigameVinhdanh");$popup.find(".table-wrap tbody").html(_html);if($popup.data("mhPopup"))$popup.data("mhPopup").open("")}});return false});this.elementWrap.find(".control .btn-lichsu").off().on("click",
function(){var $popup=$("#popup-lichsuCaoThap");if(!$popup.data("mhPopup"))return;MyRequest.fetchUpdownBettingHistory(100,0,function(cmd,data){var _html="";if(data&&data.status==0&&data.data&&data.data.items)for(var i=0;i<data.data.items.length;i++){var _luachon=data.data.items[i].predictId;switch(_luachon){case -1:_luachon="D\u01b0\u1edbi";break;case 0:_luachon="";break;case 1:_luachon="Tr\u00ean";break}var card=Utils.getCardFromServer(data.data.items[i].itemId),_cardName=card.toString;var _cardE=
"";if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))_cardE='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+'px;"\x3e\x3c/div\x3e\x3c/div\x3e';_html+="\x3ctr\x3e";_html+="\x3ctd\x3e#"+data.data.items[i].sessionId+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.convertTime(data.data.items[i].createdTime)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+_luachon+"\x3c/td\x3e";_html+="\x3ctd\x3e"+
_cardE+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].betting,1)+"\x3c/td\x3e";_html+="\x3ctd\x3e"+data.data.items[i].turn+"\x3c/td\x3e";_html+="\x3ctd\x3e"+MH.numToText(data.data.items[i].credit,1)+"\x3c/td\x3e";_html+="\x3c/tr\x3e"}$popup.find(".table-wrap tbody").html(_html);$popup.data("mhPopup").open("")});return false});this.elementWrap.find(".control .btn-huongdan").off().on("click",function(){MH.createPopup({title:"H\u01b0\u1edbng d\u1eabn",width:"850px",height:"500px",
zIndex:9999999,content:[{tag:"div",text:'\x3cp\x3eGi\u1edbi thi\u1ec7u:Cao th\u1ea5p l\u00e0 1 minigame \u0111\u01a1n gi\u1ea3n v\u1edbi t\u1ef7 l\u1ec7 th\u1eafng l\u1edbn,c\u01a1 h\u1ed9i s\u1edf h\u1eefu qu\u1ef9 th\u01b0\u1edfng l\u1edbn s\u1ebd mang l\u1ea1i cho ng\u01b0\u1eddi ch\u01a1i tr\u1ea3i nghi\u1ec7m c\u1ef1c th\u00fa v\u1ecb.Giao di\u1ec7n game s\u1ebd xu\u1ea5t hi\u1ec7n 1 trong 52 l\u00e1 b\u00e0i,ng\u01b0\u1eddi ch\u01a1i s\u1ebd d\u1ef1 \u0111o\u00e1n l\u00e1 b\u00e0i ti\u1ebfp theo l\u1edbn h\u01a1n hay nh\u1ecf h\u01a1n l\u00e1 b\u00e0i hi\u1ec7n t\u1ea1i\x3c/p\x3e\x3cp\x3eLu\u1eadt ch\u01a1i: \x3c/p\x3e\x3cp\x3eB\u01b0\u1edbc 1: Ch\u1ecdn m\u1ed1c v\u00e0ng mu\u1ed1n d\u1ef1 \u0111o\u00e1n\x3c/p\x3e\x3cp\x3eB\u01b0\u1edbc 2: Ch\u1ecdn play \u0111\u1ec3 ch\u01a1i ngay. B\u1eaft \u0111\u1ea7u ch\u01a1i , h\u1ec7 th\u1ed1ng s\u1ebd ng\u1eabu nhi\u00ean xu\u1ea5t hi\u1ec7n 1 l\u00e1 b\u00e0i \u0111\u1ec3 ng\u01b0\u1eddi ch\u01a1i \u0111\u01b0a ra l\u1ef1a ch\u1ecdn c\u1ee7a m\u00ecnh \x3c/p\x3e\x3cp\x3eB\u01b0\u1edbc 3: D\u1ef1 \u0111o\u00e1n l\u00e1 b\u00e0i ti\u1ebfp theo s\u1ebd cao h\u01a1n hay th\u1ea5p h\u01a1n l\u00e1 b\u00e0i hi\u1ec7n t\u1ea1i.\x3c/p\x3e\x3cp\x3eM\u1ed7i d\u1ef1 \u0111o\u00e1n c\u00f3 1 t\u1ef7 l\u1ec7 th\u01b0\u1edfng kh\u00e1c nhau.\x3c/p\x3e\x3cp\x3eM\u1ed7i l\u01b0\u1ee3t d\u1ef1 \u0111o\u00e1n s\u1ebd di\u1ec5n ra trong v\u00f2ng 2 ph\u00fat. H\u1ebft th\u1eddi gian m\u00e0 ng\u01b0\u1eddi ch\u01a1i kh\u00f4ng \u0111\u01b0a ra d\u1ef1 \u0111o\u00e1n th\u00ec h\u1ec7 th\u1ed1ng s\u1ebd t\u1ef1 \u0111\u1ed9ng ch\u1ecdn ng\u1eabu nhi\u00ean cao ho\u1eb7c th\u1ea5p.\x3c/p\x3e\x3cp\x3eB\u01b0\u1edbc 4: Theo d\u00f5i k\u1ebft qu\u1ea3 \u0111\u1ec3 bi\u1ebft th\u1eafng hay thua\x3c/p\x3e\x3cp\x3eN\u1ebfu kh\u00f4ng mu\u1ed1n ti\u1ebfp t\u1ee5c d\u1ef1 \u0111o\u00e1n v\u00e0 mu\u1ed1n nh\u1eadn ti\u1ec1n th\u1eafng lu\u00f4n th\u00ec ng\u01b0\u1eddi ch\u01a1i ch\u1ecdn "L\u01b0\u1ee3t m\u1edbi".\x3c/p\x3e\x3cp\x3eTrong tr\u01b0\u1eddng h\u1ee3p xu\u1ea5t hi\u1ec7n l\u00e1 b\u00e0i ti\u1ebfp theo c\u00f9ng v\u1edbi gi\u00e1 tr\u1ecb l\u00e1 b\u00e0i hi\u1ec7n t\u1ea1i, h\u1ec7 th\u1ed1ng s\u1ebd tr\u00edch 10% s\u1ed1 ti\u1ec1n \u0111\u1eb7t c\u01b0\u1ee3c c\u1ee7a ng\u01b0\u1eddi ch\u01a1i v\u00e0o Jackpot v\u00e0 l\u01b0\u1ee3t ch\u01a1i ti\u1ebfp t\u1ee5c.\x3c/p\x3e\x3cp\x3eC\u01a1 ch\u1ebf n\u1ed5 qu\u1ef9 th\u01b0\u1edfng :\x3c/p\x3e\x3cp\x3eKhi ng\u01b0\u1eddi ch\u01a1i th\u1eafng li\u00ean ti\u1ebfp trong c\u00f9ng 1 phi\u00ean ch\u01a1i \u0111\u1ed3ng th\u1eddi s\u1edf h\u1eefu b\u1ea5t k\u00ec 3 trong 4 con A th\u00ec h\u0169 s\u1ebd n\u1ed5 v\u00e0 ng\u01b0\u1eddi ch\u01a1i nh\u1eadn \u0111\u01b0\u1ee3c 50% qu\u1ef9 th\u01b0\u1edfng\x3c/p\x3e'}]});
return false});this.elementWrap.find(".event-baidep").off().on("click",function(){$("#popup-baidep").remove();$popup=$(MH.popup["baidep"]);$popup.find("#tabs-baidep").tabs();$popup.find("#tab-baidepThanhtich table tbody").html("");$popup.find("#tab-baidepXephang table tbody").html("");$popup.find("#tabs-baidep").on("tabsactivate",function(event,ui){if(ui.newPanel.attr("id")!="tab-baidepThanhtich")return;$popup.find("#tab-baidepThanhtich table tbody").html("");MH.sukien.caothap.getHistory(function(obj){if(!thiz.cardLibs)return;
var _html="";if(obj){var items=obj;for(var i=0;i<items.length;i++){_html+="\x3ctr\x3e\x3ctd\x3e"+(i+1)+"\x3c/td\x3e\x3ctd\x3e"+MH.convertTime(items[i].timestamp)+"\x3c/td\x3e\x3ctd\x3e";if(items[i].cards)for(var j=0;j<items[i].cards.length;j++){var card=Utils.getCardFromServer(items[i].cards[j]),_cardName=card.toString;if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))_html+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs[_cardName+".png"].frame.x+
"px -"+thiz.cardLibs[_cardName+".png"].frame.y+'px"\x3e\x3c/div\x3e\x3c/div\x3e'}_html+="\x3c/td\x3e\x3ctd\x3e"+items[i].rank+"\x3c/td\x3e\x3ctd\x3e"+items[i].goldStr+"\x3c/td\x3e\x3c/tr\x3e"}}$popup.find("#tab-baidepThanhtich table tbody").html(_html)})});function getBXH(timestamp){MH.sukien.caothap.getTop(timestamp,function(obj){if(!thiz.cardLibs)return;var _html="";if(obj){var items=obj;for(var i=0;i<items.length;i++){_html+="\x3ctr\x3e\x3ctd\x3e"+(i+1)+"\x3c/td\x3e\x3ctd\x3e"+items[i].displayName+
"\x3c/td\x3e\x3ctd\x3e";if(items[i].cards)for(var j=0;j<items[i].cards.length;j++){var card=Utils.getCardFromServer(items[i].cards[j]),_cardName=card.toString;if(thiz.cardLibs.hasOwnProperty(_cardName+".png"))_html+='\x3cdiv class\x3d"card"\x3e\x3cdiv class\x3d"card-inner" style\x3d"background-position:-'+thiz.cardLibs[_cardName+".png"].frame.x+"px -"+thiz.cardLibs[_cardName+".png"].frame.y+'px"\x3e\x3c/div\x3e\x3c/div\x3e'}_html+="\x3c/td\x3e\x3ctd\x3e"+(i+1)+"\x3c/td\x3e\x3ctd\x3e"+items[i].gold+
"\x3c/td\x3e\x3c/tr\x3e"}}$popup.find("#tab-baidepXephang table tbody").html(_html)})}var _now=new Date;if(thiz.evtHs){var _html="",_selected=0;for(var i=thiz.evtHs.length-1;i>=0;i--)if(!_selected&&_now.getTime()>=thiz.evtHs[i].from){_selected=thiz.evtHs[i].from;break}for(var i=0;i<thiz.evtHs.length;i++){var _act="";if(_selected==thiz.evtHs[i].from)_act=' selected\x3d"selected"';var _time=(new Date(thiz.evtHs[i].from)).getHours()+"h";if((new Date(thiz.evtHs[i].from)).getMinutes())if((new Date(thiz.evtHs[i].from)).getMinutes()>=
10)_time+=(new Date(thiz.evtHs[i].from)).getMinutes();else _time+="0"+(new Date(thiz.evtHs[i].from)).getMinutes();_time+="-"+(new Date(thiz.evtHs[i].to)).getHours()+"h";if((new Date(thiz.evtHs[i].to)).getMinutes())if((new Date(thiz.evtHs[i].to)).getMinutes()>=10)_time+=(new Date(thiz.evtHs[i].to)).getMinutes();else _time+="0"+(new Date(thiz.evtHs[i].to)).getMinutes();_html+='\x3coption value\x3d"'+(thiz.evtHs[i].from+1E6)+'"'+_act+"\x3e"+_time+"\x3c/option\x3e"}$popup.find("#tab-baidepXephang select").html(_html);
_selected=!_selected?thiz.evtHs[0].from:_selected;getBXH(_selected+1E6)}$popup.find("#tab-baidepXephang .dayNow").html(_now.getDay()==0?"CN":"Th\u1ee9 "+(_now.getDay()+1)+", "+_now.getDate()+"/"+(_now.getMonth()+1)+"/"+_now.getFullYear());$popup.find("#tab-baidepXephang select").off().on("change",function(){var _val=$(this).val();getBXH(_val)});$popup.appendTo("body");var $main=$popup.children(".popup-wrapper");var windowWidth=$(window).width();windowHeight=$(window).height();$main.css({left:(windowWidth-
$main.width())/2+"px",top:(windowHeight-$main.height())/2+"px"});$popup.mhPopup({autoOpen:true});return false})};
CaoThap.prototype.winner=function(money,type){var $wrap=this.elementWrap.children(".item-content");$wrap.children(".effect").remove();var _class="";if(type=="JACKPOT")_class=" jackpot";var _effect='\x3cdiv class\x3d"effect'+_class+'"\x3e\x3cspan\x3e+'+MH.numToText(money,1)+"\x3c/span\x3e\x3c/div\x3e";$wrap.append(_effect);this.timmer.setTimeout(function(){$wrap.children(".effect").remove()},3E3)};
CaoThap.prototype.setSession=function(session){if(session===undefined)return;this.session=session;this.elementWrap.find(".phien").html("#"+session)};
CaoThap.prototype.resetGame=function(){this.elementWrap.find(".a-list").attr("data-num","");this.elementWrap.find(".card-wrap .card").removeClass("run").removeAttr("style");this.elementWrap.find(".money-top, .money-bottom").html("");this.elementWrap.find(".money-cr").html(MH.numToText(this.betting,1));this.countA=0;this.countSpin=0;this.onPhien=false;this.onSpin=false;this.elementWrap.find(".btn-up, .btn-down").addClass("disabled");this.elementWrap.find(".btn-start").show();this.setSession(0);if(this.elementWrap.find(".res-list\x3ep").length==
0)this.elementWrap.find(".res-list").html("\x3cp\x3eClick PLAY \u0111\u1ec3 b\u1eaft \u0111\u1ea7u\x3c/p\x3e");this.stopClock();LobbyRequest.getInstance().requestUpdateMoney()};
CaoThap.prototype.notify=function(string,_time){if(!_time)_time=1E3;var $wrap=this.elementWrap.children(".item-content");$wrap.children(".notify").remove();var $notify=$('\x3cdiv class\x3d"notify" style\x3d"display:block;"\x3e'+string+"\x3c/div\x3e");$wrap.append($notify);this.timmer.setTimeout(function(){$notify.remove()},_time)};
CaoThap.prototype.spinRes=function(arr){var thiz=this;if(arr.mgs){this.notify(arr.mgs);this.timmer.setTimeout(function(){thiz.resetGame()},3E3)}else if(arr.iid!=undefined){var card=Utils.getCardFromServer(arr.iid),_cardName=card.toString;if(this.cardLibs.hasOwnProperty(_cardName+".png")){this.spinStart();this.timmer.setTimeout(function(){thiz.spinStop(arr)},this.timeEf)}}};
CaoThap.prototype.spinStart=function(){this.onSpin=true;this.elementWrap.find(".btn-group button").addClass("disabled");this.elementWrap.find(".btn-start").hide();this.elementWrap.find(".card-wrap .card").addClass("run").removeAttr("style");this.stopClock();this.countSpin+=1};
CaoThap.prototype.spinStop=function(arr){var thiz=this;var card=Utils.getCardFromServer(arr.iid),_cardName=card.toString;this.elementWrap.find(".card-wrap .card").attr("style","background-position:-"+this.cardLibs[_cardName+".png"].frame.x+"px -"+this.cardLibs[_cardName+".png"].frame.y+"px").removeClass("run");if(arr.iJ&&arr.J)this.winner(arr.J,"JACKPOT");if(!arr.iF){thiz.runClock(thiz.timeForSpin-thiz.timeEf);if(arr.up)this.elementWrap.find(".money-wrap .money-top").html(MH.numToText(arr.up,1));
if(arr.crd)this.elementWrap.find(".money-wrap .money-cr").html(MH.numToText(arr.crd,1));if(arr.down)this.elementWrap.find(".money-wrap .money-bottom").html(MH.numToText(arr.down,1));if(card.point==1){var $btnUp=this.elementWrap.find(".btn-group .btn-up").addClass("disabled");this.elementWrap.find(".btn-group button").not($btnUp).removeClass("disabled")}else if(card.point==2){var $btnDown=this.elementWrap.find(".btn-group .btn-down").addClass("disabled");this.elementWrap.find(".btn-group button").not($btnDown).removeClass("disabled")}else this.elementWrap.find(".btn-group button").removeClass("disabled");
this.timmer.setTimeout(function(){thiz.onSpin=false},500);if(card.point==1){this.countA+=1;this.elementWrap.find(".a-list").attr("data-num",this.countA)}if(this.elementWrap.find(".res-list\x3e.item").length==0)this.elementWrap.find(".res-list").html("");this.addHis(arr.iid);if(arr.ng){this.elementWrap.find(".btn-group .btn-up").addClass("disabled");this.elementWrap.find(".btn-group .btn-down").addClass("disabled")}}else{this.notify("B\u1ea1n \u0111\u00e3 thua. Ch\u00fac b\u1ea1n may m\u1eafn l\u01b0\u1ee3t sau",
3E3);this.timmer.setTimeout(function(){thiz.resetGame()},3500)}thiz.eventBaiDep(true)};CaoThap.prototype.addHis=function(cardId){var card=Utils.getCardFromServer(cardId),_cardName=card.point;switch(_cardName){case 1:_cardName="A";break;case 11:_cardName="J";break;case 12:_cardName="Q";break;case 13:_cardName="K";break}this.elementWrap.find(".res-list").append('\x3cdiv class\x3d"item '+card.suitName+'"\x3e'+_cardName+"\x3c/div\x3e")};
CaoThap.prototype.open=function(){this.onOpen=true;this.elementWrap.show();this.eventBaiDep()};CaoThap.prototype.close=function(){this.onOpen=false;this.elementWrap.hide()};
CaoThap.prototype.initGame=function(){var thiz=this;$.get("res/tq_card.json",function(data){if(!hiepnh.isObject(data))data=JSON.parse(data);thiz.cardLibs=data.frames;thiz.elementWrap.addClass("success");CaoThapPlugin.getInstance().getInfo()});this.elementWrap.draggable({stop:function(event,ui){var _left=ui.position.left,_top=ui.position.top;if(_top<-400*MH.scale)_top=-400*MH.scale;else if(_top>(window.innerHeight-110)*MH.scale)_top=(window.innerHeight-110)*MH.scale;if(_left<-640*MH.scale)_left=-640*
MH.scale;else if(_left>(window.innerWidth-80)*MH.scale)_left=(window.innerWidth-80)*MH.scale;ui.helper.animate({top:_top,left:_left},300)}});this.elementWrap.addClass("on-open animated");this.open()};CaoThap.prototype.destroyGame=function(){var target=MyCaoThap.getInstance();MiniGameClient.getInstance().removeListener(target);this.timmer.destroy();this.elementWrap.remove();target.currentTarget=null;var _index=MH.minigame.items.indexOf(this);if(_index>-1)MH.minigame.items.splice(_index,1)};var MhAppFunc=function(){var $window=$(window),$body=$("body"),$wrap=$("#page-wrap"),$bgWrap=$("#bg-wrap"),$styleView=$("#scale-view");var runChangeView;var changeView=function(){var windowWidth=$window.width(),windowHeight=$window.height();if(windowWidth/windowHeight>1280/720)MH.scale=windowHeight/720;else MH.scale=windowWidth/1280;if(MH.supportZoom)$wrap.css({"zoom":MH.scale});else $wrap.css({"-webkit-transform":"scale("+MH.scale+","+MH.scale+")","-moz-transform":"scale("+MH.scale+","+MH.scale+
")","transform":"scale("+MH.scale+","+MH.scale+")"});if(windowWidth<1280)$wrap.css("left",(windowWidth-1280)/2+"px");else $wrap.css("left","0px");var _scaleCss=".mhScale{transform: scale("+MH.scale+");}";if(MH.scale<1)_scaleCss+=".mhScaleLit{transform: scale("+MH.scale+");}";$("#scale-view").html(_scaleCss);$window.trigger("changeView")};changeView();$window.resize(function(){$body.addClass("has-resized");clearTimeout(runChangeView);runChangeView=setTimeout(function(){changeView()},200)});var hidden,
visibilityChange;if(typeof document.hidden!=="undefined"){hidden="hidden";visibilityChange="visibilitychange"}else if(typeof document.msHidden!=="undefined"){hidden="msHidden";visibilityChange="msvisibilitychange"}else if(typeof document.webkitHidden!=="undefined"){hidden="webkitHidden";visibilityChange="webkitvisibilitychange"}if(typeof document.addEventListener==="undefined"||hidden===undefined)thiz.log("This demo requires a browser, such as Google Chrome or Firefox, that supports the Page Visibility API.");
else document.addEventListener(visibilityChange,function(){MH.winHidden=document[hidden];$window.trigger("visibilityChange",[document[hidden]])},false);var $progress=$("#progress-bar span").css("width","20%").removeClass("ld-end");var templates={contentHome:"template/content-home.html",contentGame:"template/content-game.html",contentPlay:"template/content-play.html",contentPopup:"template/popup.html",contentHeader:"template/header.html",contentHeaderLogged:"template/header-logged.html",contentTopHu:"template/tophu.html"};
var templatesLength=0;for(i in templates)if(templates.hasOwnProperty(i))templatesLength+=1;var tplLoaded=0;$.each(templates,function(k,v){$.get(v,function(data){MH[k]=data;tplLoaded+=1;$progress.css("width",20+tplLoaded*2+"%");if(tplLoaded===templatesLength){MH.header.change("logout");MH.changePage("home");MenuMiniGame.init();$("#popups").append(MH.contentPopup);$(MH.contentPopup).each(function(){var $this=$(this);if($this.hasClass("mh-popup")&&$this.attr("type"))MH.popup[$this.attr("type")]=$("\x3cdiv/\x3e").html($this).html()});
var images=["background.jpg","gameicon/mnp.png","gameicon/tlmn.png"];var _imageLoaded=0;$.each(images,function(k,v){var image=new Image;image.onload=function(){_imageLoaded++;$progress.css("width",20+tplLoaded*2+_imageLoaded*(100-20-tplLoaded*2)/images.length+"%");if(_imageLoaded==images.length){$progress.addClass("ld-end");setTimeout(function(){$body.removeClass("on-loading");if($("#topHu-container").length)$("#topHu-container").append(MH.contentTopHu);else $body.append(MH.contentTopHu);var tophu=
new TopHu;if(MH.getCookie("_infoVIP52")){var _info=window.atob(MH.getCookie("_infoVIP52"));if(_info&&_info.split("###").length===2)LobbyClient.getInstance().login(_info.split("###")[0],_info.split("###")[1],function(){MH.loginDone(PlayerMe);MH.setCookie("_infoVIP52",MH.getCookie("_infoVIP52"),100)},function(){MH.setCookie("_infoVIP52","",-99)})}},1E3)}};image.onerror=function(){_imageLoaded++};image.src="images/"+v})}})});$body.children(".loader-wrap").children(".version").html(VERSION)};var MyTopHu=function(){var instance=null;var Clazz=function(){this.ctor=function(){if(instance)throw"Cannot create new instance for Singleton Class";else var thiz=this};this.ctor()};Clazz.getInstance=function(){if(!instance)instance=new Clazz;return instance};return Clazz}();
function TopHu(){this.element=$("#topHu-wrap");this.crBet=1E3;this.listHu={};this.isSuccess=false;this.onOpen=false;this.gameList={};this.setElm2=false;this.init();var target=MyTopHu.getInstance();target.currentTarget=this;TopHuClient.getInstance().removeListener(target);TopHuClient.getInstance().addListener(kCMD.TOP_HU,this._onupdate,target)}
TopHu.prototype._onupdate=function(cmd,data){var thiz=this.currentTarget;var sortable=[];thiz.lastData=data;if(thiz.isSuccess===false){thiz.isSuccess=true;thiz.element.show();thiz.buildEvent();setTimeout(function(){if(!thiz.onOpen)thiz.open()},3E3)}if(!thiz.setElm2&&!thiz.onOpen)return;if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++){if(data[1].Js[i].b==thiz.crBet&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element"))sortable.push([data[1].Js[i].gid.toString(),
data[1].Js[i].J]);if(thiz.setElm2&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element2")&&thiz.gameList[data[1].Js[i].gid.toString()]["element2"].length)if(data[1].Js[i].b==100)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(0),data[1].Js[i].J);else if(data[1].Js[i].b==1E3)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(1),data[1].Js[i].J);else if(data[1].Js[i].b==1E4)thiz.drawHu(thiz.gameList[data[1].Js[i].gid.toString()]["element2"].eq(2),
data[1].Js[i].J)}if(!thiz.onOpen)return;sortable.sort(function(a,b){return b[1]-a[1]});for(var i=0;i<sortable.length;i++){thiz.drawHu(sortable[i][0],sortable[i][1]);if(thiz.gameList[sortable[i][0]].index!==i){thiz.gameList[sortable[i][0]].element.attr("data-index",i);thiz.gameList[sortable[i][0]].index=i}}};
TopHu.prototype.open=function(){this.onOpen=true;this.element.find(".topHu-inner").show();if(this.lastData){var sortable=[],data=this.lastData,thiz=this;if(data&&data[1]&&data[1].Js&&data[1].Js.length)for(var i=0;i<data[1].Js.length;i++)if(data[1].Js[i].b==thiz.crBet&&thiz.gameList.hasOwnProperty(data[1].Js[i].gid.toString())&&thiz.gameList[data[1].Js[i].gid.toString()].hasOwnProperty("element"))sortable.push([data[1].Js[i].gid.toString(),data[1].Js[i].J]);sortable.sort(function(a,b){return b[1]-
a[1]});for(var i=0;i<sortable.length;i++){thiz.drawHu(sortable[i][0],sortable[i][1]);if(thiz.gameList[sortable[i][0]].index!==i){thiz.gameList[sortable[i][0]].element.attr("data-index",i);thiz.gameList[sortable[i][0]].index=i}}}};TopHu.prototype.close=function(){this.onOpen=false;this.element.find(".topHu-inner").hide()};
TopHu.prototype.drawHu=function(element,num){if(typeof element==="string"){var $element=this.gameList[element].element;var $hu=$element.children(".g-hu")}else{var $element=element;var $hu=element}var _old=$element.data("J")||0;$element.data("J",num);MH.realtimeCount(_old,num,$hu,2E3)};
TopHu.prototype.getElement2=function(){var thiz=this;if(MH.currentPage("home")&&$("#content .game-list .list-item\x3ebutton").length){this.setElm2=true;$("#content .game-list .list-item\x3ebutton").each(function(){var $this=$(this);var _gid=$this.data("gid")||"xxx";var $element2=$this.children("span");if(!$element2.length)return;if(SLOT_GAME_MINI.hasOwnProperty(_gid)&&thiz.gameList.hasOwnProperty(SLOT_GAME_MINI[_gid].toString()))thiz.gameList[SLOT_GAME_MINI[_gid].toString()].element2=$element2.show()})}else{this.setElm2=
false;for(var k in thiz.gameList)if(thiz.gameList.hasOwnProperty(k))thiz.gameList[k].element2=[]}this.buildEvent()};
TopHu.prototype.init=function(){var thiz=this;this.gameList[SLOT_GAME_MINI.MINI_POKER.toString()]={"name":"MINIPOKER","icon":"minipoker.png"};this.gameList[SLOT_GAME_MINI.TRUNG_PHUC_SINH.toString()]={"name":"Gems","icon":"gem.png"};this.gameList[SLOT_GAME_MINI.DEADORALIVE.toString()]={"name":"DEAD OR ALIVE","icon":"deadoralive.png"};this.gameList[SLOT_GAME_MINI.GOLDENMONKEY.toString()]={"name":"T\u00c2Y DU K\u00dd","icon":"monkey.png"};this.gameList[SLOT_GAME_MINI.DICEDICE.toString()]={"name":"DICE DICE DICE",
"icon":"dicedicedice.png"};this.gameList[SLOT_GAME_MINI.SIEUXE.toString()]={"name":"MC Queen","icon":"mcqueen.png"};this.element.find(".list-hu").empty();var ii=0;for(var k in this.gameList)if(this.gameList.hasOwnProperty(k)){this.gameList[k].element=$('\x3cdiv data-index\x3d"'+ii+'"\x3e\x3cimg src\x3d"images/tophu/'+this.gameList[k].icon+'"\x3e\x3cspan\x3e'+this.gameList[k].name+'\x3c/span\x3e\x3cspan class\x3d"g-hu"\x3e\x3c/span\x3e\x3c/div\x3e').appendTo(this.element.find(".list-hu"));ii++}jQuery.each(this.gameList,
function(k,v){if(v&&v.hasOwnProperty("element")){var gid=k;v.element.off().on("click",function(){MH.openGame(gid);return false})}});this.element.find(".label-select").html(MH.numToText(this.crBet)).off().on("click",function(){thiz.element.find(".list-option").toggle();return false});this.element.find(".group-btn button").off().on("click",function(){thiz.crBet=parseInt($(this).attr("data-num"));$(this).addClass("active").siblings("button").removeClass("active");return false});this.element.find(".list-option li").off().on("click",
function(){var _num=parseInt($(this).attr("data-num"));thiz.crBet=_num;thiz.element.find(".label-select").html(MH.numToText(_num));thiz.element.find(".list-option").hide();return false});this.element.find(".list-hu-wrap").perfectScrollbar({suppressScrollX:true});this.getElement2();$(window).on("changePage",function(){thiz.getElement2()})};TopHu.prototype.changeBet=function(num){this.crBet=num};
TopHu.prototype.buildEvent=function(){if(!this.lastData)return;var dataTopHu=this.lastData[1].Js||[];if(MH.currentPage("home"))$("#content .game-list .list-item\x3ea").each(function(){var $this=$(this);var _gid=$this.data("gid")||"xxx";for(var i=0;i<dataTopHu.length;i++)if(_gid==dataTopHu[i].gid&&dataTopHu[i].ae){$this.addClass("sk-xn");break}else if(i==dataTopHu.length-1)$this.removeClass("sk-xn")});for(var i=0;i<dataTopHu.length;i++)if(this.gameList.hasOwnProperty(dataTopHu[i].gid.toString()))if(dataTopHu[i].ae)this.gameList[dataTopHu[i].gid.toString()].element.addClass("sk-xn");
else this.gameList[dataTopHu[i].gid.toString()].element.removeClass("sk-xn")};var PhatLocPlugin=function(){var instance=null;var PhatLocPluginClass=function(){this.ctor=function(){this.pluginName="givingGiftPlugin";this.zoneName=MiniGameClient.getInstance().zoneName;this.gameState={DO_GIVE_AWAY:1,GET_GIVE_AWAY:2,CACULATE:3};this.currentSession=-1;this.currentGameState=-1;this.addListener(phatlocCMD.OBSERVER.toString(),this.onObserverResponse,this);this.addListener(phatlocCMD.BEGIN_GIVEAWAY.toString(),this.onBeginDoGiveAwayResponse,this);this.addListener(phatlocCMD.BEGIN_GET_GIVEAWAY.toString(),
this.onBeginGetGiveAwayResponse,this);this.addListener(phatlocCMD.MONEY_RANGE.toString(),this.onGetMoneyRangeGiveAwayResponse,this);this.addListener(phatlocCMD.DO_GIVEAWAY.toString(),this.onDoGiveAwayResponse,this);this.addListener(phatlocCMD.GET_GIVEAWAY.toString(),this.onGetGiveAwayResponse,this);this.addListener(phatlocCMD.END_GIVEAWAY.toString(),this.onEndGiveAwayResponse,this)};this.addListener=function(command,_listener,_target){MiniGameClient.getInstance().addListener(command,_listener,_target)};
this.send=function(sendObj){MiniGameClient.getInstance().send(sendObj)};this.observer=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":phatlocCMD.OBSERVER}];cc.log("PhatLocPlugin:: observer phat loc send "+JSON.stringify(sendObj));this.send(sendObj)};this.removeObserver=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":phatlocCMD.REMOVE_OBSERVER}];cc.log("PhatLocPlugin:: REMOVE observer phat loc send "+JSON.stringify(sendObj));
this.send(sendObj)};this.getMoneyRangeCanGiveAway=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":phatlocCMD.MONEY_RANGE}];cc.log("PhatLocPlugin:: getMoneyRangeCanGiveAway phat loc send "+JSON.stringify(sendObj));this.send(sendObj)};this.doGiveAway=function(money){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":phatlocCMD.DO_GIVEAWAY,"m":money}];cc.log("PhatLocPlugin:: doGiveAway phat loc send "+JSON.stringify(sendObj));this.send(sendObj)};
this.getGiveAway=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":phatlocCMD.GET_GIVEAWAY}];cc.log("PhatLocPlugin:: getGiveAway phat loc send "+JSON.stringify(sendObj));this.send(sendObj)};this.onObserverResponse=function(cmd,data){cc.log("PhatLocPlugin:: onObserverResponse "+JSON.stringify(data));this.currentGameState=data[1].gS};this.onDoGiveAwayResponse=function(cmd,data){cc.log("PhatLocPlugin:: onDoGiveAwayResponse "+JSON.stringify(data))};this.onGetGiveAwayResponse=
function(cmd,data){cc.log("PhatLocPlugin:: onGetGiveAwayResponse "+JSON.stringify(data))};this.onBeginDoGiveAwayResponse=function(cmd,data){cc.log("PhatLocPlugin:: onBeginDoGiveAwayResponse "+JSON.stringify(data));this.currentSession=data[1].sid;this.currentGameState=this.gameState.DO_GIVE_AWAY};this.onBeginGetGiveAwayResponse=function(cmd,data){cc.log("PhatLocPlugin:: onBeginGetGiveAwayResponse "+JSON.stringify(data));this.currentSession=data[1].sid;this.currentGameState=this.gameState.GET_GIVE_AWAY};
this.onEndGiveAwayResponse=function(cmd,data){cc.log("PhatLocPlugin:: onEndGiveAwayResponse "+JSON.stringify(data));this.currentSession=-1;this.currentGameState=-1};this.onGetMoneyRangeGiveAwayResponse=function(cmd,data){cc.log("PhatLocPlugin:: onGetMoneyRangeGiveAwayResponse "+JSON.stringify(data))};this.ctor()};PhatLocPluginClass.getInstance=function(){if(!instance)instance=new PhatLocPluginClass;return instance};return PhatLocPluginClass}();var CaoThapPlugin=function(){var instance=null;var CaoThapPluginClass=function(){this.ctor=function(){this.pluginName="updownPlugin";this.zoneName=MiniGameClient.getInstance().zoneName;this.addListener(caothapCMD.GET_INFO.toString(),this.onInfoResponse,this);this.addListener(caothapCMD.START_GAME.toString(),this.onStartGameResponse,this);this.addListener(caothapCMD.SPIN.toString(),this.onSpinResponse,this);this.addListener(caothapCMD.STOP_SPIN.toString(),this.onStopSpinResponse,this);this.addListener(caothapCMD.UPDATE_JACKPOT.toString(),
this.onUpdateJackPotResponse,this)};this.addListener=function(command,_listener,_target){MiniGameClient.getInstance().addListener(command,_listener,_target)};this.send=function(sendObj){MiniGameClient.getInstance().send(sendObj)};this.spin=function(type,session,betting){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":caothapCMD.SPIN,"aid":Constant.ASSET_ID.GOLD,"b":betting,"sid":session,"udr":type}];cc.log("getInfo spin send "+JSON.stringify(sendObj));this.send(sendObj)};
this.getInfo=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":caothapCMD.GET_INFO}];cc.log("getInfo caothap send "+JSON.stringify(sendObj));this.send(sendObj)};this.startGame=function(betting){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":caothapCMD.START_GAME,"aid":Constant.ASSET_ID.GOLD,"b":betting}];cc.log("getInfo startGame send "+JSON.stringify(sendObj));this.send(sendObj)};this.stopGame=function(session){var sendObj=[command.ZonePluginMessage,
this.zoneName,this.pluginName,{"cmd":caothapCMD.STOP_SPIN,"sid":session}];cc.log("getInfo stopGame send "+JSON.stringify(sendObj));this.send(sendObj)};this.onInfoResponse=function(cmd,data){cc.log("onInfoResponse "+JSON.stringify(data))};this.onStartGameResponse=function(cmd,data){cc.log("onStartGameResponse "+JSON.stringify(data))};this.onSpinResponse=function(cmd,data){cc.log("onSpinResponse "+JSON.stringify(data))};this.onStopSpinResponse=function(cmd,data){cc.log("onStopSpinResponse "+JSON.stringify(data))};
this.onUpdateJackPotResponse=function(cmd,data){cc.log("onUpdateJackPotResponse "+JSON.stringify(data))};this.ctor()};CaoThapPluginClass.getInstance=function(){if(!instance)instance=new CaoThapPluginClass;return instance};return CaoThapPluginClass}();var VongQuayPlugin=function(){var instance=null;var VongQuayPluginClass=function(){this.ctor=function(){this.pluginName="luckyWheelPlugin";this.zoneName=MiniGameClient.getInstance().zoneName;this.gameIdSmallWheel=300;this.gameIdBigWheel=301;this.addListener(wheelCMD.REGISTER.toString(),this.onRegisterResponse,this);this.addListener(wheelCMD.GET_TOP.toString(),this.onGetTopResponse,this);this.addListener(wheelCMD.SPIN.toString(),this.onSpinResponse,this);this.addListener(wheelCMD.GET_HISTORY.toString(),
this.onGetHistoryResponse,this);this.addListener(wheelCMD.UPDATE_JACKPOT.toString(),this.onUpdateJackPotResponse,this)};this.addListener=function(command,_listener,_target){MiniGameClient.getInstance().addListener(command,_listener,_target)};this.send=function(sendObj){MiniGameClient.getInstance().send(sendObj)};this.registerGame=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":wheelCMD.REGISTER}];cc.log("registerGame vongquay send "+JSON.stringify(sendObj));
this.send(sendObj)};this.unRegisterGame=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":wheelCMD.UNREGISTER}];cc.log("unRegisterGame vongquay send "+JSON.stringify(sendObj));this.send(sendObj)};this.getTop=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":wheelCMD.GET_TOP}];cc.log("getTop vongquay send "+JSON.stringify(sendObj));this.send(sendObj)};this.spin=function(isBigWheel){var sendObj=[command.ZonePluginMessage,this.zoneName,
this.pluginName,{"cmd":wheelCMD.SPIN,"gmI":isBigWheel?this.gameIdBigWheel:this.gameIdSmallWheel}];cc.log("spin vongquay send "+JSON.stringify(sendObj));this.send(sendObj)};this.getHistory=function(skip,limit,groupId){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":wheelCMD.GET_HISTORY,"skip":skip,"groupId":groupId}];cc.log("getHistory vongquay send "+JSON.stringify(sendObj));this.send(sendObj)};this.onRegisterResponse=function(cmd,data){cc.log("onRegisterResponse "+JSON.stringify(data))};
this.onGetTopResponse=function(cmd,data){cc.log("onGetTopResponse "+JSON.stringify(data))};this.onSpinResponse=function(cmd,data){cc.log("onSpinResponse "+JSON.stringify(data))};this.onGetHistoryResponse=function(cmd,data){cc.log("onGetHistoryResponse "+JSON.stringify(data))};this.onUpdateJackPotResponse=function(cmd,data){cc.log("onUpdateJackPotResponse "+JSON.stringify(data))};this.ctor()};VongQuayPluginClass.getInstance=function(){if(!instance)instance=new VongQuayPluginClass;return instance};
return VongQuayPluginClass}();var BauCuaPlugin=function(){var instance=null;var BauCuaPluginClass=function(){this.ctor=function(){this.pluginName="griffinPlugin";this.zoneName=MiniGameClient.getInstance().zoneName;this.ERROR_ID={4500:"TI\u1ec1n c\u01b0\u1ee3c kh\u00f4ng h\u1ee3p l\u1ec7",4501:"S\u1ed1 d\u01b0 kh\u00f4ng \u0111\u1ee7",4502:"H\u1ebft th\u1eddi gian \u0111\u1eb7t c\u01b0\u1ee3c",4503:"Phi\u00ean tr\u01b0\u1edbc kh\u00f4ng \u0111\u1eb7t"};this.GAME_STATE={BETTING:1,REWARD:2};this.gameState=-1;this.addListener(baucuaCMD.REGISTER.toString(),
this.onRegisterResponse,this);this.addListener(baucuaCMD.BEGIN_GAME.toString(),this.onBeginGameResponse,this);this.addListener(baucuaCMD.ACCEPT_BET.toString(),this.onAcceptBetResponse,this);this.addListener(baucuaCMD.END_GAME.toString(),this.onEndGameResponse,this);this.addListener(baucuaCMD.RESULT_GAME.toString(),this.onResultResponse,this);this.addListener(baucuaCMD.BET_AGAIN.toString(),this.onBetAgainResponse,this);this.addListener(baucuaCMD.DOUBLE_BET.toString(),this.onDoubleBetResponse,this);
this.addListener(baucuaCMD.GET_TOP.toString(),this.onGetTopResponse,this);this.addListener(baucuaCMD.UPDATE_JACKPOT.toString(),this.onUpdateJackPotResponse,this)};this.addListener=function(command,_listener,_target){MiniGameClient.getInstance().addListener(command,_listener,_target)};this.send=function(sendObj){MiniGameClient.getInstance().send(sendObj)};this.checkError=function(data){var error=[false,""];if(data&&data.c){error[0]=true;error[1]=this.ERROR_ID[data.c]}return error};this.register=function(roomId){var msg=
{"cmd":baucuaCMD.REGISTER};if(roomId)msg={"cmd":baucuaCMD.REGISTER,"rId":roomId};var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,msg];cc.log("baucua::  register baucua send "+JSON.stringify(sendObj));this.send(sendObj)};this.unRegister=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.UNREGISTER}];cc.log("baucua::  unRegister baucua send "+JSON.stringify(sendObj));this.send(sendObj)};this.acceptBetTest=function(roomId){var sendObj=
[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.ACCEPT_BET,"rId":roomId,"bts":[{"did":Constant.BAUCUA_ID.BAU,"bM":1E3},{"did":Constant.BAUCUA_ID.CUA,"bM":2E3}]}];cc.log("baucua::  acceptBet baucua send "+JSON.stringify(sendObj));this.send(sendObj)};this.acceptBet=function(roomId,arrBet){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.ACCEPT_BET,"rId":roomId,"bts":arrBet}];cc.log("baucua::  acceptBet baucua send "+JSON.stringify(sendObj));
this.send(sendObj)};this.doubleBet=function(roomId){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.DOUBLE_BET,"rId":roomId}];cc.log("baucua::  doubleBet send "+JSON.stringify(sendObj));this.send(sendObj)};this.betAgain=function(roomId){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.BET_AGAIN,"rId":roomId}];cc.log("baucua::  betAgain send "+JSON.stringify(sendObj));this.send(sendObj)};this.getHistory=function(limit,skip){var sendObj=
[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.GET_HISTORY,"sk":skip,"lm":limit}];cc.log("baucua::  getHistory send "+JSON.stringify(sendObj));this.send(sendObj)};this.getTop=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":baucuaCMD.GET_TOP}];cc.log("baucua::  getTop send "+JSON.stringify(sendObj));this.send(sendObj)};this.onRegisterResponse=function(cmd,data){cc.log("baucua::  onRegisterResponse "+JSON.stringify(data));this.gameState=
data[1].gs;this.roomArr=data[1].rri};this.onBeginGameResponse=function(cmd,data){cc.log("baucua::  onBeginGameResponse "+JSON.stringify(data))};this.onAcceptBetResponse=function(cmd,data){cc.log("baucua::  onAcceptBetResponse "+JSON.stringify(data));var err=this.checkError(data);if(!err[0]);else cc.log(err[1])};this.onResultResponse=function(cmd,data){cc.log("baucua::  onResultResponse "+JSON.stringify(data))};this.onEndGameResponse=function(cmd,data){cc.log("baucua::  onEndGameResponse "+JSON.stringify(data))};
this.onUpdateBetResponse=function(cmd,data){cc.log("baucua::  onUpdateBetResponse "+JSON.stringify(data))};this.onDoubleBetResponse=function(cmd,data){cc.log("baucua::  onDoubleBetResponse "+JSON.stringify(data));var err=this.checkError(data);if(!err[0]);else cc.log(err[1])};this.onBetAgainResponse=function(cmd,data){cc.log("baucua::  onBetAgainResponse "+JSON.stringify(data));var err=this.checkError(data);if(!err[0]);else cc.log(err[1])};this.onGetTopResponse=function(cmd,data){cc.log("baucua::  onGetTopResponse "+
JSON.stringify(data))};this.onUpdateJackPotResponse=function(cmd,data){cc.log("baucua::  onUpdateJackPotResponse "+JSON.stringify(data))};this.ctor()};BauCuaPluginClass.getInstance=function(){if(!instance)instance=new BauCuaPluginClass;return instance};return BauCuaPluginClass}();var ThienDiaPlugin=function(){var instance=null;var ThienDiaPluginClass=function(){this.ctor=function(){this.pluginName="thiendiaPlugin";this.zoneName=MiniGameClient.getInstance().zoneName};this.addListener=function(command,_listener,_target){MiniGameClient.getInstance().addListener(command,_listener,_target)};this.send=function(sendObj){MiniGameClient.getInstance().send(sendObj)};this.getInfo=function(){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":thiendiaCMD.REGISTER}];
console.log("thiendia send data",sendObj);this.send(sendObj)};this.startGame=function(betting){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":thiendiaCMD.START_GAME,"aid":Constant.ASSET_ID.GOLD,"b":betting}];console.log("getInfo startGame send "+JSON.stringify(sendObj));this.send(sendObj)};this.spin=function(type,session,betting){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":thiendiaCMD.SPIN,"aid":Constant.ASSET_ID.GOLD,"b":betting,"sid":session,
"udr":type}];console.log("getInfo spin send "+JSON.stringify(sendObj));this.send(sendObj)};this.stopGame=function(session){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":thiendiaCMD.STOP_SPIN,"sid":session}];this.send(sendObj)};this.playX2=function(session){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{"cmd":thiendiaCMD.X2,"sid":session}];this.send(sendObj)};this.nhanBan=function(session){var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,
{"cmd":thiendiaCMD.NHANBAN,"sid":session}];this.send(sendObj)};this.onInfoResponse=function(cmd,data){console.log("onInfoResponse thiendia",data)};this.onStartGameResponse=function(cmd,data){console.log("onStartGameResponse",data)};this.onUpdateJackpot=function(cmd,data){};this.ctor()};ThienDiaPluginClass.getInstance=function(){if(!instance)instance=new ThienDiaPluginClass;return instance};return ThienDiaPluginClass}();var OtpPlugin=function(){var instance=null;var OtpPluginClass=function(){this.ctor=function(){this.pluginName="channelPlugin";this.zoneName=Constant.CONSTANT.ZONE_NAME;this.OTP_TYPE={SMS:1,APP_OTP:2};this.CONFIRM_TYPE={REGISTER:1,LOGIN:2,UNREGISTER:3}};this.addListener=function(command,_listener,_target){cc.getClient().addListener(command,_listener,_target)};this.send=function(sendObj){cc.getClient().send(sendObj)};this.registerOrGetOtp=function(callback){var param={"command":OtpCMD.REGISTER,"type":this.OTP_TYPE.SMS};
cc.log("OtpPlugin:: registerOtp  send "+JSON.stringify(param));cc.getClient().httpRequest(HostConfig.services.id,param,function(status,response){if(!response){if(callback)callback(false,"C\u00f3 l\u1ed7i. Vui l\u00f2ng th\u1eed l\u1ea1i ");return}else if(response.status!=undefined)status=response.status;var success=false;if(status==HttpRequest.RES_SUCCESS&&response){cc.log("_OtpPlugin:: registerOtp  Response"+JSON.stringify(response));success=true}else;var msg="";switch(status){case 0:msg="Th\u00e0nh C\u00f4ng";
break;case 111:msg="ch\u01b0a k\u00edch ho\u1ea1t s\u1ed1 \u0111i\u1ec7n tho\u1ea1i";break;case 112:msg="m\u00e3 thi\u1ebft b\u1ecb ko h\u1ee3p l\u1ec7";break;case 116:msg="B\u1ea1n ko \u0111\u1ee7 ti\u1ec1n";break;case 500:msg="token h\u1ebft h\u1ea1n";break}if(response&&response.data&&response.data.message)msg=response.data.message;if(!hiepnh.isUndefined(callback))callback(success,msg,response)})};this.confirmOTP=function(codeOtp,type,callback){var param={"command":OtpCMD.VERIFY,"verifyType":type,
"code":codeOtp};var thiz=this;cc.log("OtpPlugin:: confirmOTP  send "+JSON.stringify(param));cc.getClient().httpRequest(HostConfig.services.id,param,function(status,response){var success=false;if(response&&response.status)status=response.status;if(status==HttpRequest.RES_SUCCESS&&response){cc.log("_OtpPlugin:: confirmOTP  Response"+JSON.stringify(response));success=true;if(type==thiz.CONFIRM_TYPE.LOGIN)cc.getClient().verifyOtpLoginDoneThenAuthenAcc(response)}var msg="";switch(status){case 0:msg="Th\u00e0nh C\u00f4ng";
break;case 113:msg="code h\u1ebft h\u1ea1n";break;case 114:msg="sai m\u00e3 otp";break;case 115:msg="nh\u1eadp sai qu\u00e1 s\u1ed1 l\u1ea7n quy \u0111\u1ecbnh";break}if(response&&response.data&&response.data.message)msg=response.data.message;if(!hiepnh.isUndefined(callback))callback(success,msg,response)})};this.ctor()};OtpPluginClass.getInstance=function(){if(!instance)instance=new OtpPluginClass;return instance};return OtpPluginClass}();var JackpotCardPlugin=function(){var instance=null;var JackpotCardPluginClass=function(){this.ctor=function(){this.pluginName="adminPlugin";this.zoneName=Constant.CONSTANT.ZONE_NAME;this.hasRegisted=false;this.elmJackPot=null;this.oldJackPot=0;this.addListener("11011",this.onGetJackPotResponse,this);this.addListener("11010",this.onUpdateJackPotResponse,this);$(window).on("changePage",function(){JackpotCardPlugin.getInstance().elmJackPot=null})};this.addListener=function(command,_listener,_target){LobbyClient.getInstance().addListener(command,
_listener,_target)};this.send=function(sendObj){LobbyClient.getInstance().send(sendObj);console.log("send",sendObj)};this.register=function(){if(this.hasRegisted)return;var sendObj=[command.ZonePluginMessage,this.zoneName,this.pluginName,{}];this.send(sendObj)};this.onGetJackPotResponse=function(cmd,data){console.log("onGetJackPotResponse "+JSON.stringify(data));if(!this.elmJackPot||!data||!data[1]||!data[1].gold||!data[1].displayName||data[1].displayName!=PlayerMe.displayName)return;this.elmJackPot.siblings(".eff-jackpotcard").remove();
$("#mainCanvas").after('\x3cdiv class\x3d"eff-jackpotcard"\x3e\x3cimg src\x3d"images/sukien/coin.png"\x3e\x3cimg src\x3d"images/sukien/light.png"\x3e\x3cimg src\x3d"images/sukien/nohu.png"\x3e\x3cspan\x3e+'+MH.numToText(data[1].gold,1)+"\x3c/span\x3e\x3c/div\x3e");setTimeout(function(){$("#mainCanvas").siblings(".eff-jackpotcard").remove()},3E3)};this.onUpdateJackPotResponse=function(cmd,data){console.log("onUpdateJackPotResponse "+JSON.stringify(data));if(!data||!data[1]||!data[1].jackpot)return;
this.hasRegisted=true;if(this.elmJackPot)MH.realtimeCount(this.oldJackPot,data[1].jackpot,this.elmJackPot,1E3);else console.log("elm not found");this.oldJackPot=data[1].jackpot};this.ctor()};JackpotCardPluginClass.getInstance=function(){if(!instance)instance=new JackpotCardPluginClass;return instance};return JackpotCardPluginClass}();(function(){var timmer=new mhTimer;var runAnimation=function(){var tttt=(new Date).getTime();var $gameList=$("#content .game-list .list-item");var $imgTX,$imgMNP,$imgTLMN,$imgGEMS,$imgCARS;$gameList.children("button").each(function(){var gname=$(this).data("gname");switch(gname){case "TAIXIU":$imgTX=$(this).children("img");break;case "MINIPOKER":$imgMNP=$(this).children("img");break;case "TLMN":$imgTLMN=$(this).children("img");break;case "TPS":$imgGEMS=$(this).children("img");break;case "SIEUXE":$imgCARS=
$(this).children("img");break}});(function runTX(){$imgTX.eq(1).attr("class","tada animated");timmer.setTimeout(function(){$imgTX.eq(2).attr("class","tada animated");timmer.setTimeout(function(){$imgTX.attr("class","");timmer.setTimeout(runTX,1500)},1500)},1300)})();(function runMNP(){$imgMNP.eq(1).attr("class","fadeOutLeft animated");$imgMNP.eq(2).attr("class","fadeOutRight animated");timmer.setTimeout(function(){$imgMNP.eq(1).attr("class","fadeInRight animated");$imgMNP.eq(2).attr("class","fadeInLeft animated");
timmer.setTimeout(function(){$imgMNP.attr("class","");timmer.setTimeout(runMNP,1500)},2500)},500)})();(function runTLMN(){if(!$imgTLMN||!$imgTLMN.length)return;$imgTLMN.eq(1).attr("class","bounce animated");timmer.setTimeout(function(){$imgTLMN.eq(2).attr("class","flash animated");timmer.setTimeout(function(){$imgTLMN.attr("class","");timmer.setTimeout(runTLMN,1500)},1500)},1300)})();(function runGEMS(){$imgGEMS.eq(1).attr("class","flipInX animated");timmer.setTimeout(function(){$imgGEMS.eq(2).attr("class",
"flipInY animated");timmer.setTimeout(function(){$imgGEMS.attr("class","");timmer.setTimeout(runGEMS,2E3)},1500)},500)})();(function runCARS(){$imgCARS.eq(1).attr("class","fadeOutDown animated");$imgCARS.eq(2).attr("class","fadeOutUp animated");timmer.setTimeout(function(){$imgCARS.eq(1).attr("class","fadeInDown animated");$imgCARS.eq(2).attr("class","fadeInUp animated");timmer.setTimeout(function(){$imgCARS.attr("class","");timmer.setTimeout(runCARS,2500)},2E3)},500)})()};$(window).on("changePage",
function(){timmer.destroy();if(MH.currentPage("home"))runAnimation()})})();